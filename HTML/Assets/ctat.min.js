/*
 MIT License - https://bitbucket.org/pellepim/jstimezonedetect/src/default/LICENCE.txt

 For usage and examples, visit:
 http://pellepim.bitbucket.org/jstz/

 Copyright (c) Jon Nylander
*/
var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(b,g,f){if(f.get||f.set)throw new TypeError("ES3 does not support getters and setters.");b!=Array.prototype&&b!=Object.prototype&&(b[g]=f.value)};$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global?global:b};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(b){return $jscomp.SYMBOL_PREFIX+(b||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.iterator;b||(b=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[b]&&$jscomp.defineProperty(Array.prototype,b,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(b){var g=0;return $jscomp.iteratorPrototype(function(){return g<b.length?{done:!1,value:b[g++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(b){$jscomp.initSymbolIterator();b={next:b};b[$jscomp.global.Symbol.iterator]=function(){return this};return b};$jscomp.makeIterator=function(b){$jscomp.initSymbolIterator();var g=b[Symbol.iterator];return g?g.call(b):$jscomp.arrayIterator(b)};$jscomp.arrayFromIterator=function(b){for(var g,f=[];!(g=b.next()).done;)f.push(g.value);return f};$jscomp.arrayFromIterable=function(b){return b instanceof Array?b:$jscomp.arrayFromIterator($jscomp.makeIterator(b))};
$jscomp.polyfill=function(b,g,f,e){if(g){f=$jscomp.global;b=b.split(".");for(e=0;e<b.length-1;e++){var c=b[e];c in f||(f[c]={});f=f[c]}b=b[b.length-1];e=f[b];g=g(e);g!=e&&null!=g&&$jscomp.defineProperty(f,b,{configurable:!0,writable:!0,value:g})}};
$jscomp.polyfill("Array.from",function(b){return b?b:function(b,f,e){$jscomp.initSymbolIterator();f=null!=f?f:function(a){return a};var c=[],a=b[Symbol.iterator];if("function"==typeof a)for(b=a.call(b);!(a=b.next()).done;)c.push(f.call(e,a.value));else for(var a=b.length,d=0;d<a;d++)c.push(f.call(e,b[d]));return c}},"es6-impl","es3");$jscomp.array=$jscomp.array||{};
$jscomp.iteratorFromArray=function(b,g){$jscomp.initSymbolIterator();b instanceof String&&(b+="");var f=0,e={next:function(){if(f<b.length){var c=f++;return{value:g(c,b[c]),done:!1}}e.next=function(){return{done:!0,value:void 0}};return e.next()}};e[Symbol.iterator]=function(){return e};return e};$jscomp.polyfill("Array.prototype.keys",function(b){return b?b:function(){return $jscomp.iteratorFromArray(this,function(b){return b})}},"es6-impl","es3");
$jscomp.checkStringArgs=function(b,g,f){if(null==b)throw new TypeError("The 'this' value for String.prototype."+f+" must not be null or undefined");if(g instanceof RegExp)throw new TypeError("First argument to String.prototype."+f+" must not be a regular expression");return b+""};
$jscomp.polyfill("String.prototype.startsWith",function(b){return b?b:function(b,f){var e=$jscomp.checkStringArgs(this,b,"startsWith");b+="";var c=e.length,a=b.length;f=Math.max(0,Math.min(f|0,e.length));for(var d=0;d<a&&f<c;)if(e[f++]!=b[d++])return!1;return d>=a}},"es6-impl","es3");
$jscomp.polyfill("String.prototype.endsWith",function(b){return b?b:function(b,f){var e=$jscomp.checkStringArgs(this,b,"endsWith");b+="";void 0===f&&(f=e.length);f=Math.max(0,Math.min(f|0,e.length));for(var c=b.length;0<c&&0<f;)if(e[--f]!=b[--c])return!1;return 0>=c}},"es6-impl","es3");$jscomp.polyfill("Number.isNaN",function(b){return b?b:function(b){return"number"===typeof b&&isNaN(b)}},"es6-impl","es3");
$jscomp.findInternal=function(b,g,f){b instanceof String&&(b=String(b));for(var e=b.length,c=0;c<e;c++){var a=b[c];if(g.call(f,a,c,b))return{i:c,v:a}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.findIndex",function(b){return b?b:function(b,f){return $jscomp.findInternal(this,b,f).i}},"es6-impl","es3");$jscomp.owns=function(b,g){return Object.prototype.hasOwnProperty.call(b,g)};
$jscomp.polyfill("WeakMap",function(b){function g(a){$jscomp.owns(a,e)||$jscomp.defineProperty(a,e,{value:{}})}function f(a){var d=Object[a];d&&(Object[a]=function(a){g(a);return d(a)})}if(function(){if(!b||!Object.seal)return!1;try{var a=Object.seal({}),c=Object.seal({}),e=new b([[a,2],[c,3]]);if(2!=e.get(a)||3!=e.get(c))return!1;e.delete(a);e.set(c,4);return!e.has(a)&&4==e.get(c)}catch(n){return!1}}())return b;var e="$jscomp_hidden_"+Math.random().toString().substring(2);f("freeze");f("preventExtensions");
f("seal");var c=0,a=function(a){this.id_=(c+=Math.random()+1).toString();if(a){$jscomp.initSymbol();$jscomp.initSymbolIterator();a=$jscomp.makeIterator(a);for(var d;!(d=a.next()).done;)d=d.value,this.set(d[0],d[1])}};a.prototype.set=function(a,c){g(a);if(!$jscomp.owns(a,e))throw Error("WeakMap key fail: "+a);a[e][this.id_]=c;return this};a.prototype.get=function(a){return $jscomp.owns(a,e)?a[e][this.id_]:void 0};a.prototype.has=function(a){return $jscomp.owns(a,e)&&$jscomp.owns(a[e],this.id_)};a.prototype.delete=
function(a){return $jscomp.owns(a,e)&&$jscomp.owns(a[e],this.id_)?delete a[e][this.id_]:!1};return a},"es6-impl","es3");$jscomp.ASSUME_NO_NATIVE_MAP=!1;
$jscomp.polyfill("Map",function(b){if(!$jscomp.ASSUME_NO_NATIVE_MAP&&function(){if(!b||!b.prototype.entries||"function"!=typeof Object.seal)return!1;try{var a=Object.seal({x:4}),d=new b($jscomp.makeIterator([[a,"s"]]));if("s"!=d.get(a)||1!=d.size||d.get({x:4})||d.set({x:4},"t")!=d||2!=d.size)return!1;var c=d.entries(),e=c.next();if(e.done||e.value[0]!=a||"s"!=e.value[1])return!1;e=c.next();return e.done||4!=e.value[0].x||"t"!=e.value[1]||!c.next().done?!1:!0}catch(q){return!1}}())return b;$jscomp.initSymbol();
$jscomp.initSymbolIterator();var g=new WeakMap,f=function(d){this.data_={};this.head_=a();this.size=0;if(d){d=$jscomp.makeIterator(d);for(var c;!(c=d.next()).done;)c=c.value,this.set(c[0],c[1])}};f.prototype.set=function(a,d){var c=e(this,a);c.list||(c.list=this.data_[c.id]=[]);c.entry?c.entry.value=d:(c.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:a,value:d},c.list.push(c.entry),this.head_.previous.next=c.entry,this.head_.previous=c.entry,this.size++);return this};f.prototype.delete=
function(a){a=e(this,a);return a.entry&&a.list?(a.list.splice(a.index,1),a.list.length||delete this.data_[a.id],a.entry.previous.next=a.entry.next,a.entry.next.previous=a.entry.previous,a.entry.head=null,this.size--,!0):!1};f.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=a();this.size=0};f.prototype.has=function(a){return!!e(this,a).entry};f.prototype.get=function(a){return(a=e(this,a).entry)&&a.value};f.prototype.entries=function(){return c(this,function(a){return[a.key,
a.value]})};f.prototype.keys=function(){return c(this,function(a){return a.key})};f.prototype.values=function(){return c(this,function(a){return a.value})};f.prototype.forEach=function(a,d){for(var c=this.entries(),b;!(b=c.next()).done;)b=b.value,a.call(d,b[1],b[0],this)};f.prototype[Symbol.iterator]=f.prototype.entries;var e=function(a,c){var b;b=c&&typeof c;"object"==b||"function"==b?g.has(c)?b=g.get(c):(b=""+ ++d,g.set(c,b)):b="p_"+c;var e=a.data_[b];if(e&&$jscomp.owns(a.data_,b))for(a=0;a<e.length;a++){var f=
e[a];if(c!==c&&f.key!==f.key||c===f.key)return{id:b,list:e,index:a,entry:f}}return{id:b,list:e,index:-1,entry:void 0}},c=function(a,d){var c=a.head_;return $jscomp.iteratorPrototype(function(){if(c){for(;c.head!=a.head_;)c=c.previous;for(;c.next!=c.head;)return c=c.next,{done:!1,value:d(c)};c=null}return{done:!0,value:void 0}})},a=function(){var a={};return a.previous=a.next=a.head=a},d=0;return f},"es6-impl","es3");
$jscomp.polyfill("Array.prototype.values",function(b){return b?b:function(){return $jscomp.iteratorFromArray(this,function(b,f){return f})}},"es6","es3");$jscomp.polyfill("Number.isFinite",function(b){return b?b:function(b){return"number"!==typeof b?!1:!isNaN(b)&&Infinity!==b&&-Infinity!==b}},"es6-impl","es3");$jscomp.polyfill("Number.isInteger",function(b){return b?b:function(b){return Number.isFinite(b)?b===Math.floor(b):!1}},"es6-impl","es3");
$jscomp.polyfill("Array.prototype.find",function(b){return b?b:function(b,f){return $jscomp.findInternal(this,b,f).v}},"es6-impl","es3");$jscomp.ASSUME_NO_NATIVE_SET=!1;
$jscomp.polyfill("Set",function(b){if(!$jscomp.ASSUME_NO_NATIVE_SET&&function(){if(!b||!b.prototype.entries||"function"!=typeof Object.seal)return!1;try{var f=Object.seal({x:4}),e=new b($jscomp.makeIterator([f]));if(!e.has(f)||1!=e.size||e.add(f)!=e||1!=e.size||e.add({x:4})!=e||2!=e.size)return!1;var c=e.entries(),a=c.next();if(a.done||a.value[0]!=f||a.value[1]!=f)return!1;a=c.next();return a.done||a.value[0]==f||4!=a.value[0].x||a.value[1]!=a.value[0]?!1:c.next().done}catch(d){return!1}}())return b;
$jscomp.initSymbol();$jscomp.initSymbolIterator();var g=function(b){this.map_=new Map;if(b){b=$jscomp.makeIterator(b);for(var e;!(e=b.next()).done;)this.add(e.value)}this.size=this.map_.size};g.prototype.add=function(b){this.map_.set(b,b);this.size=this.map_.size;return this};g.prototype.delete=function(b){b=this.map_.delete(b);this.size=this.map_.size;return b};g.prototype.clear=function(){this.map_.clear();this.size=0};g.prototype.has=function(b){return this.map_.has(b)};g.prototype.entries=function(){return this.map_.entries()};
g.prototype.values=function(){return this.map_.values()};g.prototype[Symbol.iterator]=g.prototype.values;g.prototype.forEach=function(b,e){var c=this;this.map_.forEach(function(a){return b.call(e,a,a,c)})};return g},"es6-impl","es3");$jscomp.polyfill("Object.assign",function(b){return b?b:function(b,f){for(var e=1;e<arguments.length;e++){var c=arguments[e];if(c)for(var a in c)$jscomp.owns(c,a)&&(b[a]=c[a])}return b}},"es6-impl","es3");
$jscomp.polyfill("String.prototype.repeat",function(b){return b?b:function(b){var f=$jscomp.checkStringArgs(this,null,"repeat");if(0>b||1342177279<b)throw new RangeError("Invalid count value");b|=0;for(var e="";b;)if(b&1&&(e+=f),b>>>=1)f+=f;return e}},"es6-impl","es3");
$jscomp.polyfill("Array.prototype.fill",function(b){return b?b:function(b,f,e){var c=this.length||0;0>f&&(f=Math.max(0,c+f));if(null==e||e>c)e=c;e=Number(e);0>e&&(e=Math.max(0,c+e));for(f=Number(f||0);f<e;f++)this[f]=b;return this}},"es6-impl","es3");$jscomp.polyfill("String.prototype.includes",function(b){return b?b:function(b,f){return-1!==$jscomp.checkStringArgs(this,b,"includes").indexOf(b,f||0)}},"es6-impl","es3");
$jscomp.polyfill("Object.setPrototypeOf",function(b){return b?b:"object"!=typeof"".__proto__?null:function(b,f){b.__proto__=f;if(b.__proto__!==f)throw new TypeError(b+" is not extensible");return b}},"es6","es5");$jscomp.polyfill("Math.sign",function(b){return b?b:function(b){b=Number(b);return 0===b||isNaN(b)?b:0<b?1:-1}},"es6-impl","es3");$jscomp.polyfill("Array.prototype.entries",function(b){return b?b:function(){return $jscomp.iteratorFromArray(this,function(b,f){return[b,f]})}},"es6-impl","es3");
$jscomp.polyfill("Math.log10",function(b){return b?b:function(b){return Math.log(b)/Math.LN10}},"es6-impl","es3");$jscomp.polyfill("Number.MAX_SAFE_INTEGER",function(){return 9007199254740991},"es6-impl","es3");$jscomp.polyfill("Number.isSafeInteger",function(b){return b?b:function(b){return Number.isInteger(b)&&Math.abs(b)<=Number.MAX_SAFE_INTEGER}},"es6-impl","es3");
var jstz=function(){var b={"America/Denver":["America/Mazatlan"],"Europe/London":["Africa/Casablanca"],"America/Chicago":["America/Mexico_City"],"America/Asuncion":["America/Campo_Grande","America/Santiago"],"America/Montevideo":["America/Sao_Paulo","America/Santiago"],"Asia/Beirut":"Asia/Amman Asia/Jerusalem Europe/Helsinki Asia/Damascus Africa/Cairo Asia/Gaza Europe/Minsk".split(" "),"Pacific/Auckland":["Pacific/Fiji"],"America/Los_Angeles":["America/Santa_Isabel"],"America/New_York":["America/Havana"],
"America/Halifax":["America/Goose_Bay"],"America/Godthab":["America/Miquelon"],"Asia/Dubai":["Asia/Yerevan"],"Asia/Jakarta":["Asia/Krasnoyarsk"],"Asia/Shanghai":["Asia/Irkutsk","Australia/Perth"],"Australia/Sydney":["Australia/Lord_Howe"],"Asia/Tokyo":["Asia/Yakutsk"],"Asia/Dhaka":["Asia/Omsk"],"Asia/Baku":["Asia/Yerevan"],"Australia/Brisbane":["Asia/Vladivostok"],"Pacific/Noumea":["Asia/Vladivostok"],"Pacific/Majuro":["Asia/Kamchatka","Pacific/Fiji"],"Pacific/Tongatapu":["Pacific/Apia"],"Asia/Baghdad":["Europe/Minsk",
"Europe/Moscow"],"Asia/Karachi":["Asia/Yekaterinburg"],"Africa/Johannesburg":["Asia/Gaza","Africa/Cairo"]},g=function(a){a=-a.getTimezoneOffset();return null!==a?a:0},f=function(){var a=g(new Date(2014,0,2)),d=g(new Date(2014,5,2)),c=a-d;return 0>c?a+",1":0<c?d+",1,s":a+",0"},e=function(){var a;if("undefined"!==typeof Intl&&"undefined"!==typeof Intl.DateTimeFormat&&(a=Intl.DateTimeFormat(),"undefined"!==typeof a&&"undefined"!==typeof a.resolvedOptions&&(a=a.resolvedOptions().timeZone)&&(-1<a.indexOf("/")||
"UTC"===a)))return a},c=function n(a,d,c){"undefined"===typeof d&&(d=864E5,c=36E5);var b=(new Date(a.getTime()-d)).getTime();a=a.getTime()+d;for(var e=(new Date(b)).getTimezoneOffset(),f=null;b<a-c;){var h=new Date(b);if(h.getTimezoneOffset()!==e){f=h;break}b+=c}return 864E5===d?n(f,36E5,6E4):36E5===d?n(f,6E4,1E3):f},a=function(a,d,c,b){if("N/A"!==c)return c;if("Asia/Beirut"===d){if("Africa/Cairo"===b.name&&13983768E5===a[6].s&&14116788E5===a[6].e||"Asia/Jerusalem"===b.name&&13959648E5===a[6].s&&
14118588E5===a[6].e)return 0}else if("America/Santiago"===d){if("America/Asuncion"===b.name&&14124816E5===a[6].s&&1397358E6===a[6].e||"America/Campo_Grande"===b.name&&14136912E5===a[6].s&&13925196E5===a[6].e)return 0}else if("America/Montevideo"===d){if("America/Sao_Paulo"===b.name&&14136876E5===a[6].s&&1392516E6===a[6].e)return 0}else if("Pacific/Auckland"===d&&"Pacific/Fiji"===b.name&&14142456E5===a[6].s&&13961016E5===a[6].e)return 0;return c},d=function(d,c){for(var e={},f=jstz.olson.dst_rules.zones,
h=f.length,n=b[c],w=0;w<h;w++){var g=f[w],p;p=f[w];for(var C=0,D=0;D<d.length;D++)if(p.rules[D]&&d[D]){if(d[D].s>=p.rules[D].s&&d[D].e<=p.rules[D].e)C=0,C+=Math.abs(d[D].s-p.rules[D].s),C+=Math.abs(p.rules[D].e-d[D].e);else{C="N/A";break}if(864E6<C){C="N/A";break}}p=C=a(d,c,C,p);"N/A"!==p&&(e[g.name]=p)}for(var F in e)if(e.hasOwnProperty(F))for(d=0;d<n.length;d++)if(n[d]===F)return F;return c},h=function(a){var b=function(){for(var a=[],d=0;d<jstz.olson.dst_rules.years.length;d++){var b;b=jstz.olson.dst_rules.years[d];
var e=(new Date(b,0,1,0,0,1,0)).getTime();b=(new Date(b,12,31,23,59,59)).getTime();for(var f=(new Date(e)).getTimezoneOffset(),h=null,n=null;e<b-864E5;){var g=new Date(e),p=g.getTimezoneOffset();p!==f&&(p<f&&(h=g),p>f&&(n=g),f=p);e+=864E5}b=h&&n?{s:c(h).getTime(),e:c(n).getTime()}:!1;a.push(b)}return a}();return function(a){for(var d=0;d<a.length;d++)if(!1!==a[d])return!0;return!1}(b)?d(b,a):a};return{determine:function(){var a=e();a||(a=jstz.olson.timezones[f()],"undefined"!==typeof b[a]&&(a=h(a)));
return{name:function(){return a}}}}}();jstz.olson=jstz.olson||{};
jstz.olson.timezones={"-720,0":"Etc/GMT+12","-660,0":"Pacific/Pago_Pago","-660,1,s":"Pacific/Apia","-600,1":"America/Adak","-600,0":"Pacific/Honolulu","-570,0":"Pacific/Marquesas","-540,0":"Pacific/Gambier","-540,1":"America/Anchorage","-480,1":"America/Los_Angeles","-480,0":"Pacific/Pitcairn","-420,0":"America/Phoenix","-420,1":"America/Denver","-360,0":"America/Guatemala","-360,1":"America/Chicago","-360,1,s":"Pacific/Easter","-300,0":"America/Bogota","-300,1":"America/New_York","-270,0":"America/Caracas",
"-240,1":"America/Halifax","-240,0":"America/Santo_Domingo","-240,1,s":"America/Asuncion","-210,1":"America/St_Johns","-180,1":"America/Godthab","-180,0":"America/Argentina/Buenos_Aires","-180,1,s":"America/Montevideo","-120,0":"America/Noronha","-120,1":"America/Noronha","-60,1":"Atlantic/Azores","-60,0":"Atlantic/Cape_Verde","0,0":"UTC","0,1":"Europe/London","60,1":"Europe/Berlin","60,0":"Africa/Lagos","60,1,s":"Africa/Windhoek","120,1":"Asia/Beirut","120,0":"Africa/Johannesburg","180,0":"Asia/Baghdad",
"180,1":"Europe/Moscow","210,1":"Asia/Tehran","240,0":"Asia/Dubai","240,1":"Asia/Baku","270,0":"Asia/Kabul","300,1":"Asia/Yekaterinburg","300,0":"Asia/Karachi","330,0":"Asia/Kolkata","345,0":"Asia/Kathmandu","360,0":"Asia/Dhaka","360,1":"Asia/Omsk","390,0":"Asia/Rangoon","420,1":"Asia/Krasnoyarsk","420,0":"Asia/Jakarta","480,0":"Asia/Shanghai","480,1":"Asia/Irkutsk","525,0":"Australia/Eucla","525,1,s":"Australia/Eucla","540,1":"Asia/Yakutsk","540,0":"Asia/Tokyo","570,0":"Australia/Darwin","570,1,s":"Australia/Adelaide",
"600,0":"Australia/Brisbane","600,1":"Asia/Vladivostok","600,1,s":"Australia/Sydney","630,1,s":"Australia/Lord_Howe","660,1":"Asia/Kamchatka","660,0":"Pacific/Noumea","690,0":"Pacific/Norfolk","720,1,s":"Pacific/Auckland","720,0":"Pacific/Majuro","765,1,s":"Pacific/Chatham","780,0":"Pacific/Tongatapu","780,1,s":"Pacific/Apia","840,0":"Pacific/Kiritimati"};jstz.olson.dst_rules={years:[2008,2009,2010,2011,2012,2013,2014],zones:[{name:"Africa/Cairo",rules:[{e:12199572E5,s:12090744E5},{e:1250802E6,s:1240524E6},{e:12858804E5,s:12840696E5},!1,!1,!1,{e:14116788E5,s:1406844E6}]},{name:"Africa/Casablanca",rules:[{e:12202236E5,s:12122784E5},{e:12508092E5,s:12438144E5},{e:1281222E6,s:12727584E5},{e:13120668E5,s:13017888E5},{e:13489704E5,s:1345428E6},{e:13828392E5,s:13761E8},{e:14142888E5,s:14069448E5}]},{name:"America/Asuncion",rules:[{e:12050316E5,s:12243888E5},
{e:12364812E5,s:12558384E5},{e:12709548E5,s:12860784E5},{e:13024044E5,s:1317528E6},{e:1333854E6,s:13495824E5},{e:1364094E6,s:1381032E6},{e:13955436E5,s:14124816E5}]},{name:"America/Campo_Grande",rules:[{e:12032172E5,s:12243888E5},{e:12346668E5,s:12558384E5},{e:12667212E5,s:1287288E6},{e:12981708E5,s:13187376E5},{e:13302252E5,s:1350792E6},{e:136107E7,s:13822416E5},{e:13925196E5,s:14136912E5}]},{name:"America/Goose_Bay",rules:[{e:122559486E4,s:120503526E4},{e:125704446E4,s:123648486E4},{e:128909886E4,
s:126853926E4},{e:13205556E5,s:129998886E4},{e:13520052E5,s:13314456E5},{e:13834548E5,s:13628952E5},{e:14149044E5,s:13943448E5}]},{name:"America/Havana",rules:[{e:12249972E5,s:12056436E5},{e:12564468E5,s:12364884E5},{e:12885012E5,s:12685428E5},{e:13211604E5,s:13005972E5},{e:13520052E5,s:13332564E5},{e:13834548E5,s:13628916E5},{e:14149044E5,s:13943412E5}]},{name:"America/Mazatlan",rules:[{e:1225008E6,s:12074724E5},{e:12564576E5,s:1238922E6},{e:1288512E6,s:12703716E5},{e:13199616E5,s:13018212E5},{e:13514112E5,
s:13332708E5},{e:13828608E5,s:13653252E5},{e:14143104E5,s:13967748E5}]},{name:"America/Mexico_City",rules:[{e:12250044E5,s:12074688E5},{e:1256454E6,s:12389184E5},{e:12885084E5,s:1270368E6},{e:1319958E6,s:13018176E5},{e:13514076E5,s:13332672E5},{e:13828572E5,s:13653216E5},{e:14143068E5,s:13967712E5}]},{name:"America/Miquelon",rules:[{e:12255984E5,s:12050388E5},{e:1257048E6,s:12364884E5},{e:12891024E5,s:12685428E5},{e:1320552E6,s:12999924E5},{e:13520016E5,s:1331442E6},{e:13834512E5,s:13628916E5},{e:14149008E5,
s:13943412E5}]},{name:"America/Santa_Isabel",rules:[{e:12250116E5,s:1207476E6},{e:12564612E5,s:12389256E5},{e:12885156E5,s:12703752E5},{e:13199652E5,s:13018248E5},{e:13514148E5,s:13332744E5},{e:13828644E5,s:13653288E5},{e:1414314E6,s:13967784E5}]},{name:"America/Santiago",rules:[{e:1206846E6,s:1223784E6},{e:1237086E6,s:12552336E5},{e:127035E7,s:12866832E5},{e:13048236E5,s:13138992E5},{e:13356684E5,s:13465584E5},{e:1367118E6,s:13786128E5},{e:13985676E5,s:14100624E5}]},{name:"America/Sao_Paulo",rules:[{e:12032136E5,
s:12243852E5},{e:12346632E5,s:12558348E5},{e:12667176E5,s:12872844E5},{e:12981672E5,s:1318734E6},{e:13302216E5,s:13507884E5},{e:13610664E5,s:1382238E6},{e:1392516E6,s:14136876E5}]},{name:"Asia/Amman",rules:[{e:1225404E6,s:12066552E5},{e:12568536E5,s:12381048E5},{e:12883032E5,s:12695544E5},{e:13197528E5,s:13016088E5},!1,!1,{e:14147064E5,s:13959576E5}]},{name:"Asia/Damascus",rules:[{e:12254868E5,s:120726E7},{e:125685E7,s:12381048E5},{e:12882996E5,s:12701592E5},{e:13197492E5,s:13016088E5},{e:13511988E5,
s:13330584E5},{e:13826484E5,s:1364508E6},{e:14147028E5,s:13959576E5}]},{name:"Asia/Dubai",rules:[!1,!1,!1,!1,!1,!1,!1]},{name:"Asia/Gaza",rules:[{e:12199572E5,s:12066552E5},{e:12520152E5,s:12381048E5},{e:1281474E6,s:126964086E4},{e:1312146E6,s:130160886E4},{e:13481784E5,s:13330584E5},{e:13802292E5,s:1364508E6},{e:1414098E6,s:13959576E5}]},{name:"Asia/Irkutsk",rules:[{e:12249576E5,s:12068136E5},{e:12564072E5,s:12382632E5},{e:12884616E5,s:12697128E5},!1,!1,!1,!1]},{name:"Asia/Jerusalem",rules:[{e:12231612E5,
s:12066624E5},{e:1254006E6,s:1238112E6},{e:1284246E6,s:12695616E5},{e:131751E7,s:1301616E6},{e:13483548E5,s:13330656E5},{e:13828284E5,s:13645152E5},{e:1414278E6,s:13959648E5}]},{name:"Asia/Kamchatka",rules:[{e:12249432E5,s:12067992E5},{e:12563928E5,s:12382488E5},{e:12884508E5,s:12696984E5},!1,!1,!1,!1]},{name:"Asia/Krasnoyarsk",rules:[{e:12249612E5,s:12068172E5},{e:12564108E5,s:12382668E5},{e:12884652E5,s:12697164E5},!1,!1,!1,!1]},{name:"Asia/Omsk",rules:[{e:12249648E5,s:12068208E5},{e:12564144E5,
s:12382704E5},{e:12884688E5,s:126972E7},!1,!1,!1,!1]},{name:"Asia/Vladivostok",rules:[{e:12249504E5,s:12068064E5},{e:12564E8,s:1238256E6},{e:12884544E5,s:12697056E5},!1,!1,!1,!1]},{name:"Asia/Yakutsk",rules:[{e:1224954E6,s:120681E7},{e:12564036E5,s:12382596E5},{e:1288458E6,s:12697092E5},!1,!1,!1,!1]},{name:"Asia/Yekaterinburg",rules:[{e:12249684E5,s:12068244E5},{e:1256418E6,s:1238274E6},{e:12884724E5,s:12697236E5},!1,!1,!1,!1]},{name:"Asia/Yerevan",rules:[{e:1224972E6,s:1206828E6},{e:12564216E5,s:12382776E5},
{e:1288476E6,s:12697272E5},{e:13199256E5,s:13011768E5},!1,!1,!1]},{name:"Australia/Lord_Howe",rules:[{e:12074076E5,s:12231342E5},{e:12388572E5,s:12545838E5},{e:12703068E5,s:12860334E5},{e:13017564E5,s:1317483E6},{e:1333206E6,s:13495374E5},{e:13652604E5,s:1380987E6},{e:139671E7,s:14124366E5}]},{name:"Australia/Perth",rules:[{e:12068136E5,s:12249576E5},!1,!1,!1,!1,!1,!1]},{name:"Europe/Helsinki",rules:[{e:12249828E5,s:12068388E5},{e:12564324E5,s:12382884E5},{e:12884868E5,s:1269738E6},{e:13199364E5,
s:13011876E5},{e:1351386E6,s:13326372E5},{e:13828356E5,s:13646916E5},{e:14142852E5,s:13961412E5}]},{name:"Europe/Minsk",rules:[{e:12249792E5,s:12068352E5},{e:12564288E5,s:12382848E5},{e:12884832E5,s:12697344E5},!1,!1,!1,!1]},{name:"Europe/Moscow",rules:[{e:12249756E5,s:12068316E5},{e:12564252E5,s:12382812E5},{e:12884796E5,s:12697308E5},!1,!1,!1,!1]},{name:"Pacific/Apia",rules:[!1,!1,!1,{e:13017528E5,s:13168728E5},{e:13332024E5,s:13489272E5},{e:13652568E5,s:13803768E5},{e:13967064E5,s:14118264E5}]},
{name:"Pacific/Fiji",rules:[!1,!1,{e:12696984E5,s:12878424E5},{e:13271544E5,s:1319292E6},{e:1358604E6,s:13507416E5},{e:139005E7,s:1382796E6},{e:14215032E5,s:14148504E5}]},{name:"Europe/London",rules:[{e:12249828E5,s:12068388E5},{e:12564324E5,s:12382884E5},{e:12884868E5,s:1269738E6},{e:13199364E5,s:13011876E5},{e:1351386E6,s:13326372E5},{e:13828356E5,s:13646916E5},{e:14142852E5,s:13961412E5}]}]};(function(b,g){"object"==typeof module&&module.exports?module.exports=g():"function"==typeof define&&define.amd?define(g):b.Spinner=g()})(this,function(){function b(a,d){a=document.createElement(a||"div");for(var c in d)a[c]=d[c];return a}function g(a){for(var d=1,c=arguments.length;d<c;d++)a.appendChild(arguments[d]);return a}function f(a,d,c,b){var e=["opacity",d,~~(100*a),c,b].join("-");c=.01+c/b*100;b=Math.max(1-(1-a)/d*(100-c),a);var f=q.substring(0,q.indexOf("Animation")).toLowerCase();p[e]||
(u.insertRule("@"+(f&&"-"+f+"-"||"")+"keyframes "+e+"{0%{opacity:"+b+"}"+c+"%{opacity:"+a+"}"+(c+.01)+"%{opacity:1}"+(c+d)%100+"%{opacity:"+a+"}100%{opacity:"+b+"}}",u.cssRules.length),p[e]=1);return e}function e(a,d){a=a.style;var c,b;d=d.charAt(0).toUpperCase()+d.slice(1);if(void 0!==a[d])return d;for(b=0;b<n.length;b++)if(c=n[b]+d,void 0!==a[c])return c}function c(a,d){for(var c in d)a.style[e(a,c)||c]=d[c];return a}function a(a){for(var d=1;d<arguments.length;d++){var c=arguments[d],b;for(b in c)void 0===
a[b]&&(a[b]=c[b])}return a}function d(a,d){return"string"==typeof a?a:a[d%a.length]}function h(d){this.opts=a(d||{},h.defaults,v)}function l(){function a(a,d){return b("<"+a+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',d)}u.addRule(".spin-vml","behavior:url(#default#VML)");h.prototype.lines=function(b,e){function f(){return c(a("group",{coordsize:n+" "+n,coordorigin:-l+" "+-l}),{width:n,height:n})}function h(b,h,n){g(p,g(c(f(),{rotation:360/e.lines*b+"deg",left:~~h}),g(c(a("roundrect",
{arcsize:e.corners}),{width:l,height:e.scale*e.width,left:e.scale*e.radius,top:-e.scale*e.width>>1,filter:n}),a("fill",{color:d(e.color,b),opacity:e.opacity}),a("stroke",{opacity:0}))))}var l=e.scale*(e.length+e.width),n=2*e.scale*l,w=-(e.width+e.length)*e.scale*2+"px",p=c(f(),{position:"absolute",top:w,left:w});if(e.shadow)for(w=1;w<=e.lines;w++)h(w,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(w=1;w<=e.lines;w++)h(w);return g(b,p)};h.prototype.opacity=
function(a,d,c,b){a=a.firstChild;b=b.shadow&&b.lines||0;a&&d+b<a.childNodes.length&&(a=(a=(a=a.childNodes[d+b])&&a.firstChild)&&a.firstChild)&&(a.opacity=c)}}var n=["webkit","Moz","ms","O"],p={},q,u,v={lines:12,length:7,width:5,radius:10,scale:1,corners:1,color:"#000",opacity:.25,rotate:0,direction:1,speed:1,trail:100,fps:20,zIndex:2E9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"};h.defaults={};a(h.prototype,{spin:function(a){this.stop();var d=this,e=d.opts,f=
d.el=b(null,{className:e.className});c(f,{position:e.position,width:0,zIndex:e.zIndex,left:e.left,top:e.top});a&&a.insertBefore(f,a.firstChild||null);f.setAttribute("role","progressbar");d.lines(f,d.opts);if(!q){var h=0,l=(e.lines-1)*(1-e.direction)/2,n,g=e.fps,w=g/e.speed,p=(1-e.opacity)/(w*e.trail/100),y=w/e.lines;(function P(){h++;for(var a=0;a<e.lines;a++)n=Math.max(1-(h+(e.lines-a)*y)%w*p,e.opacity),d.opacity(f,a*e.direction+l,n,e);d.timeout=d.el&&setTimeout(P,~~(1E3/g))})()}return d},stop:function(){var a=
this.el;a&&(clearTimeout(this.timeout),a.parentNode&&a.parentNode.removeChild(a),this.el=void 0);return this},lines:function(a,e){function h(a,d){return c(b(),{position:"absolute",width:e.scale*(e.length+e.width)+"px",height:e.scale*e.width+"px",background:a,boxShadow:d,transformOrigin:"left",transform:"rotate("+~~(360/e.lines*l+e.rotate)+"deg) translate("+e.scale*e.radius+"px,0)",borderRadius:(e.corners*e.scale*e.width>>1)+"px"})}for(var l=0,n=(e.lines-1)*(1-e.direction)/2,w;l<e.lines;l++)w=c(b(),
{position:"absolute",top:1+~(e.scale*e.width/2)+"px",transform:e.hwaccel?"translate3d(0,0,0)":"",opacity:e.opacity,animation:q&&f(e.opacity,e.trail,n+l*e.direction,e.lines)+" "+1/e.speed+"s linear infinite"}),e.shadow&&g(w,c(h("#000","0 0 4px #000"),{top:"2px"})),g(a,g(w,h(d(e.color,l),"0 0 1px rgba(0,0,0,.1)")));return a},opacity:function(a,d,c){d<a.childNodes.length&&(a.childNodes[d].style.opacity=c)}});if("undefined"!==typeof document){u=function(){var a=b("style",{type:"text/css"});g(document.getElementsByTagName("head")[0],
a);return a.sheet||a.styleSheet}();var y=c(b("group"),{behavior:"url(#default#VML)"});!e(y,"transform")&&y.adj?l():q=e(y,"animation")}return h});var CTATConfig={Options:{},addProperty:function(b,g,f,e){f=f||g[0];Object.defineProperty(CTATConfig,b,{enumerable:!0,configurable:!1,writable:!e,value:f.toLowerCase()});var c={};g.forEach(function(a){c[a]=a.toLowerCase();Object.defineProperty(CTATConfig,b+"_is_"+a,{enumerable:!1,writable:!1,value:function(){return CTATConfig[this.prop].toLowerCase()==this.val}.bind({prop:b,val:c[a]})})});CTATConfig.Options[b]=c}};CTATConfig.addProperty("platform",["CTAT","Google","Undefined"],"CTAT",!0);
CTATConfig.addProperty("external",["Google","LTI","SCORM","noUI","None"],"None");CTATConfig.setExternal=function(b){CTATConfig.external=b};CTATConfig.addProperty("parserType",["XML","JSON"],"XML");"undefined"!==typeof module&&(module.exports=CTATConfig);var CTATGlobals={tutorRunning:!1,Tab:{Tracker:1,Focus:null,previousFocus:null},NameSpace:{svg:"http://www.w3.org/2000/svg",xml:"http://www.w3.org/2000/xmlns/",xlink:"http://www.w3.org/1999/xlink",ev:"http://www.w3.org/2001/xml-events",mathml:"http://www.w3.org/1998/Math/MathML"},EncodedParams:{authenticity_token:"authenticity_token",info:"info",question_file:"question_file"},CommDisabled:!1,orientation:"portrait",ignoreInterfaceDescriptions:!0},useDebugging;void 0===useDebugging&&(useDebugging=!1);
var useDebuggingBasic;void 0===useDebuggingBasic&&(useDebuggingBasic=!1);var version="4.8.0",ctatcontainer="container",movieclips=[],canvasCalibrate=5,flashVars=null,mobileAPI=null,aVars=null;CTATGlobals.interfaceElement=null;var commMessageHandler=CTATGlobals.selectedTextInput=null,commLoggingLibrary=null,logHintSAI=null,logHintStepID="",nameTranslator=null,hints=[],hintIndex=0;CTATGlobals.suppressStudentFeedback=!1;CTATGlobals.confirmDone=!1;var incompatibleBrowserMessage="Your browser does not support CTAT. Please update or replace your browser.";var CTATSandboxDriver={};function getSafeElementById(b){return document.getElementById(b)};var CTATGlobalFunctions={};function unhighlightall(b){if(CTATShellTools.component_descriptions){b=CTATShellTools.getAllComponents();for(var g=0;g<b.length;g++){var f=b[g];f.setHintHighlight&&f.setHintHighlight(!1,null)}}}CTATGlobalFunctions.stringToBoolean=function(b){switch(String(b).toLowerCase()){case "true":case "yes":case "1":return!0;case "false":case "no":case "0":case "":case null:return!1;default:return!!b}};
CTATGlobalFunctions.isInstructorMode=function(){var b=flashVars?flashVars.getRawFlashVars():null;return b&&b.deliverymode?"delivery"==b.deliverymode?!1:!0:!1};CTATGlobalFunctions.getLoggingLibrary=function(b){null==commLoggingLibrary&&(commLoggingLibrary=new CTATLoggingLibrary(!0));return commLoggingLibrary};CTATGlobalFunctions.setPreviewMode=function(b,g){CTATGlobalFunctions.isCTATObject(b)?b.setPreviewMode(g):b.previewMode=g};
CTATGlobalFunctions.setCenterTutor=function(b,g){CTATGlobalFunctions.isCTATObject(b)?b.setCenterTutor(g):b.centerTutor=g};CTATGlobalFunctions.setTutorWidth=function(b,g){CTATGlobalFunctions.isCTATObject(b)?b.setTutorWidth(g):b.width=g};CTATGlobalFunctions.setTutorHeight=function(b,g){CTATGlobalFunctions.isCTATObject(b)?b.setTutorHeight(g):b.height=g};CTATGlobalFunctions.setTutorDimensions=function(b,g,f){CTATGlobalFunctions.isCTATObject(b)?b.setTutorDimensions(g,f):(b.width=g,b.height=f)};
CTATGlobalFunctions.setTutorValue=function(b,g,f){CTATGlobalFunctions.isCTATObject(b)?b.setTutorValue(g,f):b[g]=f};CTATGlobalFunctions.setCommunicationMode=function(b,g){CTATGlobalFunctions.isCTATObject(b)?b.setCommunicationMode(g):b.tutoring_service_communication=g};CTATGlobalFunctions.setRemoteSocketURL=function(b,g){CTATGlobalFunctions.isCTATObject(b)?b.setRemoteSocketURL(g):b.remoteSocketURL=g};
CTATGlobalFunctions.setRemoteSocketPort=function(b,g){CTATGlobalFunctions.isCTATObject(b)?b.setRemoteSocketPort(g):b.remoteSocketPort=g};CTATGlobalFunctions.setProblemSummary=function(b){};CTATGlobalFunctions.isCTATObject=function(b){return"object"==typeof testConfig&&testConfig.getClassName?!0:!1};CTATGlobalFunctions.getCTATClassname=function(b){return"object"==typeof testConfig&&testConfig.getClassName?testConfig.getClassName():"object"};
CTATGlobalFunctions.toBoolean=function(b){return"boolean"===typeof b?b:"string"===typeof b?CTATGlobalFunctions.stringToBoolean(b):"number"===typeof b?0!==b:b?!0:!1};function noenter(b){if(CTATConfig.platform_is_Google())return 0;b=b||window.event;return 13!==(b.keyCode||b.charCode)}CTATGlobalFunctions.isBlank=function(b){return!b||/^\s*$/.test(b)};function componentToHex(b){b=b.toString(16);return 1==b.length?"0"+b:b}
function rgbToHex(b,g,f){return"#"+componentToHex(b)+componentToHex(g)+componentToHex(f)}function hexToRgb(b){return(b=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(b))?{r:parseInt(b[1],16),g:parseInt(b[2],16),b:parseInt(b[3],16)}:null}
function parseQueryStringArgs(b){ctatdebug("parseQueryStringArgs ()");ctatdebug("Query String: "+b);var g="?"==b.charAt(0)?b.substring(1):b;b={};if(g)for(var g=g.split("&"),f=0;f<g.length;f++){var e=g[f].split("=");b[decodeURIComponent(e[0])]=decodeURIComponent(e[1].replace(/\+/g," "))}return b}
function setOrientation(b){ctatdebug("setOrientation ("+b+")");switch(b){case -90:case 90:mobileAPI&&mobileAPI.processOrientationChange("landscape");break;default:mobileAPI&&mobileAPI.processOrientationChange("portrait")}}Object.hasOwnProperty("create")||(Object.create=function(){function b(){}return function(g){if(1!=arguments.length)throw Error("Object.create implementation only accepts one parameter.");b.prototype=g;return new b}}());
function thisMovie(b){return-1!=navigator.appName.indexOf("Microsoft")?window[b]:document[b]}function introspect(b,g,f,e){f=f||"";"number"!==this.typeOf(e)&&(e=1);var c=this.typeOf(g);b=[f,b," ",c," :"].join("");if("object"===c){if(0<e){f=[f,"  "].join("");for(var a in g)c=this.introspect(a,g[a],f,e-1),b=[b,"\n",c].join("");return b}return[b," ..."].join("")}return"null"===c?[b," null"].join(""):[b," ",g].join("")}
function findPointOfAttachment(b){ctatdebug("findPointOfAttachment ("+b+")");for(var g=0;g<movieclips.length;g++){var f=movieclips[g];ctatdebug("Examining: "+f.getName()+"...");if(!0===f.isRegistered(b))return f}return null}function findMovieClip(b){b=b.trim();ctatdebug("findMovieClip ("+b.trim()+")");for(var g=0;g<movieclips.length;g++){var f=movieclips[g];ctatdebug("Examining: "+f.getName()+"...");if(f.getName()==b)return f}return null}
function colName(b,g){ctatdebug("colName ("+b+")");for(var f="";0<=b;)f=String.fromCharCode(b%26+97)+f,b=Math.floor(b/26)-1;!0===g&&f.toUpperCase();return f}function selectText(b){}function urldecode(b){return decodeURIComponent((""+b).replace(/\+/g,"%20"))}function detectIE(){var b=window.navigator.userAgent,g=b.indexOf("MSIE "),f=b.indexOf("Trident/");return 0<g?parseInt(b.substring(g+5,b.indexOf(".",g)),10):0<f?(g=b.indexOf("rv:"),parseInt(b.substring(g+3,b.indexOf(".",g)),10)):!1}
function listProperties(b){ctatdebug("listProperties (l: "+b.length+")");for(var g in b)ctatdebug("["+g+"]")}function listPropertiesKV(b,g){ctatdebug("listPropertiesKV (size: "+b.length+")");if(1==g)for(g=0;g<b.length;g++)ctatdebug("["+g+"]: "+b[g]);else for(var f in b)ctatdebug("["+f+"]: "+b[f])}function listAllDivAttributes(b){ctatdebug("listAllDivAttributes ()");var g=0;b=b.attributes;for(var f=b.length;g<f;g++)pointer.ctatdebug("Attribute: "+b[g].nodeName+", with value: "+b[g].nodeValue)}
var getBackgroundDimensions=function(b){ctatdebug("Using url: "+$(b).css("background-image"));var g=new Image;g.src=$(b).css("background-image").replace(/url\(|\)$|"/ig,"");return g.width+" "+g.height},getBackgroundWidth=function(b){ctatdebug("Using url: "+$(b).css("background-image"));var g=new Image;g.src=$(b).css("background-image").replace(/url\(|\)$|"/ig,"");return g.width},getBackgroundHeight=function(b){ctatdebug("Using url: "+$(b).css("background-image"));var g=new Image;g.src=$(b).css("background-image").replace(/url\(|\)$|"/ig,
"");return g.height};function getIndicesOf(b,g,f){var e=0,c=b.length,a=[];f||(g=g.toLowerCase(),b=b.toLowerCase());for(;-1<(f=g.indexOf(b,e));)a.push(f),e=f+c;return a}CTATGlobalFunctions.formatColor=function(b){if(/^#[0-9a-f]{6}$/i.test(b))return b;var g=b.match(/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/i);if(null!==g)return rgbToHex(Number(g[1]),Number(g[2]),Number(g[3]));g=b.match(/^#?([0-9a-f]{0,6})$/i);if(null!==g){for(b=g[1];6>b.length;)b="0"+b;return"#"+b}return b};
CTATGlobalFunctions.Gensym=function(){this.make_gensym=function(){var b="",e=0;return{set_prefix:function(c){b=String(c)},set_index:function(c){e=c},gensym:function(){var c=b+e;e+=1;return c}}};var b=this.make_gensym();b.set_index(2);var g=this.make_gensym();g.set_index(1);g.set_prefix("ctatdiv");return{z_index:b.gensym,div_id:g.gensym}};CTATGlobalFunctions.gensym=CTATGlobalFunctions.Gensym();var CTATBase=function(b,g){function f(a,d,c){null===a&&(a="unknownclass");if(null===d)d="nullinstance";else if(void 0===d||"undefined"===d)d="";return"["+a+":"+d+"] "+c}var e=b,c=g,a=this,d=!0;"undefined"!=CTATBase.DebuggingFilter[e]&&CTATBase.DebuggingFilter[e]&&(d=!1);this.getClassName=function(){return e};this.getClassname=function(){return e};this.setClassName=function(a){e=a};this.setName=function(a){c=a};this.getName=function(){return c};this.getUseDebugging=function(){return useDebugging};
this.setUseDebugging=function(a){useDebugging=a};this.toHHMMSS=function(a){var d=parseInt(a,10);a=Math.floor(d/3600);var c=Math.floor((d-3600*a)/60),d=d-3600*a-60*c;10>a&&(a="0"+a);10>c&&(c="0"+c);10>d&&(d="0"+d);return a+":"+c+":"+d};this.ctatdebug=function(c){if(d){var b=c;useDebuggingBasic?a.ctatdebugInternal(b,a.getClassName()||"UnknownClass"):(null===c&&(b="No message provided"),useDebugging&&a.ctatdebugInternal(b,a.getClassName()))}};this.ctatdebugObject=function(a){var d=0,c;for(c in a)this.ctatdebug("("+
d+")"+c+": "+a[c]),d++};this.ctatdebugInternal=function(d,c){if(null===d||void 0===d)d="No message!";""===d&&(d="Empty message!");if(useDebuggingBasic)c=f(c||"Unknown","undefined",d),CTATBase.customconsole||(CTATBase.customconsole=getSafeElementById("customconsole")),CTATBase.customconsole?(CTATBase.customconsole.innerHTML+=c+"<br>",CTATBase.customconsole.scrollTop=CTATBase.customconsole.scrollHeight):console.log(c);else{null===c&&(c="UndefinedClass");null===d&&(d="No message");c=f(c,a.getName(),
d);try{console.trace(c)}catch(n){}"google"==CTATConfig.platform?Logger.log(c):(CTATBase.customconsole||(CTATBase.customconsole=getSafeElementById("customconsole")),null!==CTATBase.customconsole&&(CTATBase.customconsole.innerHTML+=c+"<br>",CTATBase.customconsole.scrollTop=CTATBase.customconsole.scrollHeight))}};this.ctatdebugObjectShallow=function(d){var c="",b;for(b in d)c+=b+", ";a.ctatdebugInternal("Object: "+c,"Global")};this.urldecode=function(a){return decodeURIComponent((a+"").replace(/\+/g,
"%20"))};this.entitiesConvert=function(a){this.ctatdebug("entitiesConvert ()");return this.urldecode(unescape(a))};this.entitiesGenerate=function(a){return a}};function formatLogMessageGoogle(b,g,f){f=(new CTATBase(b,g)).htmlEncode(f);return"["+b+":"+g+"] "+f}
function ctatdebug(b){(useDebugging||useDebuggingBasic)&&null!==b&&("google"==CTATConfig.platform?Logger.log(formatLogMessageGoogle("CTATTutor","tutor",b)):(ctatdebug.debugPointer||(ctatdebug.debugPointer=new CTATBase("CTATTutor","tutor")),ctatdebug.debugPointer.ctatdebug(b,"CTATTutor")))}Object.defineProperty(CTATBase,"DebuggingFilter",{enumerable:!1,configurable:!1,writable:!0,value:[]});"undefined"!==typeof module&&(module.exports=CTATBase);var CTATXML=function(){CTATBase.call(this,"CTATXML","xmlparser");this.parse=function(b){return this.parseXML(b)};this.parseXML=function(b){this.ctatdebug("parseXML ()");var g=null;try{"undefined"!==typeof $?g=$.parseXML(b):"undefined"!==typeof XMLParser?g=(new XMLParser).parseFromString(b):this.ctatdebug("Bottoming out, no parser configured!")}catch(f){return null!=g?this.ctatdebug("JQuery could not process the provided XML: "+f.message+" ("+g.parseError.errorCode+") ("+g.parseError.reason+") ("+
g.parseError.line+")"):this.ctatdebug("JQuery could not process the provided XML (xmlDoc==null): "+f.message),null}return null==g?(this.ctatdebug("Unspecified error parsing xml message. xmlDoc is null"),null):g.documentElement};this.getElementName=function(b){return b.nodeName};this.getElementValue=function(b){return b.nodeValue};this.getElementChildren=function(b){for(var g=[],f=0;f<b.childNodes.length;f++)1==b.childNodes[f].nodeType&&g.push(b.childNodes[f]);return g};this.getNodeTextValue=function(b){if(null==
b)return"";if(null==b.childNodes)return b.nodeValue;if(0==b.childNodes.length)return"";for(var g=b.childNodes,f=0;f<g.length;f++){var e=g[f];if("value"==e.nodeName||"Value"==e.nodeName){if(1==e.childNodes.length)return e.childNodes[0].nodeValue;if(0==e.childNodes.length)break;else return e.childNodes[1].nodeValue}}return b.childNodes[0].nodeValue};this.getValueNodesAsText=function(b){var g=this;return this.getElementChildren(b).reduce(function(b,e){"value"===g.getElementName(e)&&b.push(g.getNodeTextValue(e));
return b},[])};this.setNodeTextValue=function(b,g){if(null==b)return null;if(null==b.childNodes)return b.nodeValue;if(0==b.childNodes.length)return"";for(var f=b.childNodes,e=0;e<f.length;e++){var c=f[e];if("value"==c.nodeName||"Value"==c.nodeName){if(1==c.childNodes.length)return c.childNodes[0].nodeValue=g;if(0==c.childNodes.length)break;else return c.childNodes[1].nodeValue=g}}return b.childNodes[0].nodeValue=g};this.addElement=function(b,g,f,e){return b instanceof Element&&(g=String(g))?(f="<"+
g+">"+(e?"<![CDATA[":"")+String(f),f+=e?"]]\x3e":"",f+="</"+g+">",$(b).append(f).children().last().get()[0]):null};this.getElementAttr=function(b,g){if(!b.attributes)return this.ctatdebug("Warning: Element "+b.nodeName+" does not have any attributes"),"";for(var f=0;f<b.attributes.length;f++)if(b.attributes[f].nodeName==g)return b.attributes[f].nodeValue;return""};this.listElementAttr=function(b){this.ctatdebug("Listing "+b.attributes.length+" attributes for element "+b.nodeName+" ...");for(var g=
0;g<b.attributes.length;g++)this.ctatdebug(g+" name: "+b.attributes[g].nodeName+", value: "+b.attributes[g].nodeValue)};this.stringify=function(b){return this.xmlToString(b)};this.xmlToString=function(b){this.ctatdebug("xmlToString ()");return null==b?(this.ctatdebug("Error: xml data is null"),null):(new XMLSerializer).serializeToString(b)}};
CTATXML.escape=function(b){for(var g={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"},f=/([^&<>"]*)([&<>"])?/g,e,c="";null!=(e=f.exec(b))&&!(c+=e[1],e[2]&&(c+=g[e[2]]),f.lastIndex>=b.length););return c};CTATXML.prototype=Object.create(CTATBase.prototype);CTATXML.prototype.constructor=CTATXML;"undefined"!==typeof module&&(module.exports=CTATXML);var CTATLogger=function(b){var g={},f=0;b&&(b.split&&b.split(/ *, */)||Array.from(b)).forEach(function(b){return g[b]=!1});(new URLSearchParams(location.search)).forEach(function(b,c){return/^logger$/i.test(c)&&(b||"").split(/ *, */).forEach(function(a){return null!=g[a]&&(g[a]=!0)})});this.addFlag=function(b,c){null==g[b]?g[b]=null==c?!1:!!c:null!=c&&(g[b]=!!c);return g[b]};this.isSet=function(b){return!!g[b]};this.set=function(b){if(!(b in g))return!1;f++;return g[b]=!0};this.unset=function(b){if(!(b in
g))return!1;f--;return!(g[b]=!1)};this.getFlags=function(){return g};this.getNFlagsSet=function(){return f};this.log=function(b,c){for(var a=[],d=1;d<arguments.length;++d)a[d-1]=arguments[d];if(g[b])d="["+b+"]:";else if("override"===b)d="";else return;2>a.length?console.log(d+(d?" ":"")+a[0]):console.log.apply(console,[].concat([d],$jscomp.arrayFromIterable(a)))}};var CTATDefaultLanguagePack={HORIZONTAL:"LR",VERTICAL:"TB",LOADING:"Please wait while the tutor is being loaded",NEXTPROBLEM:"Retrieving the Next Problem...",CONGRATULATIONS_YOU_ARE_DONE:"Congratulations, you are done with this problem.",DONE_WITH_PROBLEM_SET:"You are done with this problem set.",SURE_YOU_ARE_DONE:"Are you sure you are done?",TUTORDISCONNECTED:"The tutor has disconnected. Please refresh the page.",OUTOFORDER:"You need to do other steps first, before doing the step you just worked on. You might request a hint for more help.",
DONE:"Done",HINT:"Hint",NEXT:"Next",REPLAY:"Replay",PREVIOUS:"Previous",HIGHLIGHTEDSTEP:"Instead of the step you are working on, please work on the highlighted step.",NO_HINT_AVAILABLE:"No hint is available at this step.",DEFAULT_HINT_PREFIX_TEXT:'Please enter "',DEFAULT_HINT_SUFFIX_TEXT:'" in the highlighted field.',DEFAULT_HINT_PREFIX_SELECT:'Please select "',DEFAULT_HINT_SUFFIX_SELECT:'" from the highlighted menu.',DEFAULT_HINT_BUTTON:"Please click the highlighted button.",DEFAULT_HINT_PREFIX:'Please answer "',
DEFAULT_HINT_SUFFIX:'" on the highlighted element.',NOTDONE:"I'm sorry, but you are not done yet. Please continue working.",UNABLE_TO_LOAD:"Unable to load: ",FILE_IS_MISSING:" - Either the file is missing, you are trying to use the file:// protocol, there is a network barrier, or the URL is in a different domain and permission to retrieve data from that server is denied.",AUTHORPLEASECLOSE:"Authoring Tools disconnected. Please close this page.",ERROR_502:"Error contacting the server, please refresh the page and try again (HTTP status 502: gateway response).",
ERROR_CONN_TS:"Connection refused by tutoring service, please check your server or contact an administrator.",ERROR_CONN_LS:"Connection refused by the logging server, please check your connection or contact an administrator.",AWAITING_OTHER_COLLABORATORS:"Waiting for other team members...",YOUR_COLLABORATOR:"Your team member ",COLLABORATOR_QUIT_CLICK_OK:"has quit. Please click OK to exit, then restart the problem.",COLLABORATOR_QUIT_CLICK_X:"has quit. Please click the red X at top right to exit, then restart the problem.",
TYPING:"Typing...",YOUR_STUDENT:"Your student ",EXIT_BECAUSE_COACHED_STUDENT_JOINED_OK:"has resumed work. Please click OK to exit, then restart the problem to join that session.",EXIT_BECAUSE_COACHED_STUDENT_JOINED_X:"has resumed work. Please click the red X at top right to exit, then restart the problem to join that session."},CTATLanguageManager=function(){function b(){e=new CTATFormulaParser(new CTATVariableTable);e.addFunction("markStart",function(a,c,b){var f=e.getCurrentTagPos();a={type:"start",
name:a,componentIDs:c,data:b||null};d[f]&&d[f].push(a)||(d[f]=[a]);return""});e.addFunction("markEnd",function(a,c,b){var f=e.getCurrentTagPos();a={type:"end",name:a,componentIDs:c,data:b||null};d[f]&&d[f].push(a)||(d[f]=[a]);return""})}function g(a){function b(a,b){c.log("mark","\treplaceAllUpTo, upTo is",a,"replaceWith is",b,"mdKeys are ",JSON.stringify(e));for(v[b]=[];e[0]&&a>e[0];)v[b]=v[b].concat(d[e[0]]),delete d[e[0]],e.shift();c.log("mark","\tmdKeys after are",JSON.stringify(e))}var e=Array.prototype.slice.call(Object.keys(d)).filter(function(a){return!isNaN(a)}).sort(function(a,
d){return+a-+d}),f=/\b\w/g,h,g=-1,v={start:[],end:[]};c.log("mark","setMarkDataKeys: "+a);for(c.log("mark","markData before: "+JSON.stringify(d));e.length&&(h=f.exec(a));){c.log("mark","\tmatch at "+h.index+", lastMatchIdx is ",g);if(0<=g)b(h.index,g);else for(;e[0]<h.index;)v.start=v.start.concat(d[e[0]]),delete d[e.shift()];g=h.index}b(a.length,g);e.forEach(function(a){v.end=v.end.concat(d[a]);delete d[a]});d=v;c.log("mark","markData after: "+JSON.stringify(d))}function f(c,b,f){d={start:[],end:[]};
e.setVariableTable(b);if(!c)return"";b=f.getSelection();var h=f.getAction();f=CTATVariableTable.standardizeType(f.getInput());c=e.interpolate(c,b,h,f);g(c);a[c]=d;return c}CTATBase.call(this,"CTATLanguageManager","theLanguagePack");var e;this.logger=new CTATLogger(["mark"]);var c=this;this.log=c.logger.log;var a={},d;this.getMarkData=function(){return a};this.getString=function(a){c.ctatdebug("getString ("+a+") -> "+typeof CTATLanguagePack);if("undefined"!==typeof CTATLanguagePack){if(CTATLanguagePack[a])return CTATLanguagePack[a]}else c.ctatdebug("No custom language pack defined, using default...");
return CTATDefaultLanguagePack[a]};this.filterString=function(a){c.ctatdebug("filterString ("+a+") -> "+typeof CTATLanguagePack);if("undefined"!==typeof CTATLanguagePack){if(CTATLanguagePack[a])return c.ctatdebug("Found tag in provided language pack, returning: "+CTATLanguagePack[a]),CTATLanguagePack[a]}else c.ctatdebug("No custom language pack defined, using default...");return"undefined"!==typeof CTATDefaultLanguagePack&&CTATDefaultLanguagePack[a]?(c.ctatdebug("Found tag in default language pack, returning: "+
CTATDefaultLanguagePack[a]),CTATDefaultLanguagePack[a]):a};this.interpolateString=function(d,c,n){e||b();a={};return f(d,c,n)};this.interpolateStrings=function(d,c,n){e||b();a={};return d.map(function(a){return f(a,c,n)})}};CTATLanguageManager.prototype=Object.create(CTATBase.prototype);CTATLanguageManager.prototype.constructor=CTATLanguageManager;CTATLanguageManager.theSingleton=new CTATLanguageManager;var CTATMsgType=function(){CTATBase.call(this,"CTATMsgType","")};CTATMsgType.findProperty=function(b,g){var f=b.toLowerCase(),e="<"+g.toLowerCase()+">";b=f.indexOf(e)+e.length;g=f.indexOf("</"+g.toLowerCase()+">");if(b<e.length||0>g)return null;e={};e.start=b;e.end=g;return e};
CTATMsgType.makeValues=function(b){if(null==b)return"";if("string"==typeof b)return b;if(b.constructor&&"Array"==b.constructor.name){if(!b.length)return"";for(var g=0,f,e="<value>"+(null==(f=b[g++])?"":f.toString());g<b.length;)e+="</value><value>"+(null==(f=b[g++])?"":f.toString());return e+"</value>"}return b.outerHTML?b.outerHTML:b.toString()};
CTATMsgType.setProperty=function(b,g,f){var e=CTATMsgType.findProperty(b,g),c;e?(c=b.slice(0,e.start),c+=CTATMsgType.makeValues(f),c+=b.slice(e.end,b.length)):(e=b.indexOf("</properties>"),c=b.slice(0,e),c+="<"+g+">"+CTATMsgType.makeValues(f)+"</"+g+">",c+=b.slice(e,b.length));return c};CTATMsgType.getProperty=function(b,g){return(g=CTATMsgType.findProperty(b,g))?b.slice(g.start,g.end):""};
CTATMsgType.valueToArray=function(b){if(!b.startsWith("<value>")||!b.endsWith("</value>"))return null;var g=new CTATXML;try{for(var f=g.getElementChildren(g.parse('<?xml version="1.0" encoding="UTF-16"?><root>'+b+"</root>")),e=[],c=0;c<f.length;++c)"value"==g.getElementName(f[c]).toLowerCase()&&e.push(g.getNodeTextValue(f[c]));return e}catch(a){return console.log("Error in CTATMsgType.valueToArray("+b+")",a),null}};
CTATMsgType.getValue=function(b,g){b=CTATMsgType.valueToArray(b);return!b||b.length<=g?null:b[g]};CTATMsgType.getMessageType=function(b){return CTATMsgType.getProperty(b,"MessageType")};CTATMsgType.getTransactionID=function(b){return CTATMsgType.getProperty(b,CTATMessage.TRANSACTION_ID_TAG)};CTATMsgType.setTransactionID=function(b,g){return CTATMsgType.setProperty(b,CTATMessage.TRANSACTION_ID_TAG,g)};
CTATMsgType.isCorrectOrIncorrect=function(b){return"string"==typeof b?CTATMsgType.CorrectTypes[b.toLowerCase()]?!0:!1:!1};CTATMsgType.hasTextFeedback=function(b){return"string"==typeof b?CTATMsgType.TextFeedbackTypes[b.toLowerCase()]?!0:!1:!1};CTATMsgType.isHintResponse=function(b){return"string"==typeof b?CTATMsgType.HintResponseTypes[b.toLowerCase()]?!0:!1:!1};
CTATMsgType.isDoneMessage=function(b){var g=CTATMsgType.getProperty(b,"Selection");b=CTATMsgType.getProperty(b,"Action");if(!g||!b)return!1;g=g.toString().toLowerCase();b=b.toString().toLowerCase();var f=CTATMsgType.DONE.toLowerCase();if(f!=g&&f!=CTATMsgType.getValue(g,0))return!1;g=CTATMsgType.BUTTON_PRESSED.toLowerCase();return g!=b&&g!=CTATMsgType.getValue(b,0)?!1:!0};CTATMsgType.getPropertyFromElement=function(b,g,f){b=g.getElementChildren(b);for(var e=0;e<b.length;e++){var c=b[e];if(f==g.getElementName(c))return g.getNodeTextValue(c)}return null};
CTATMsgType.getSAIArraysFromElement=function(b,g){var f={selection:[],action:[],input:[]};b=g.getElementChildren(b);for(var e=0;e<b.length;e++){var c=b[e];switch(g.getElementName(c)){case "Selection":for(var c=g.getElementChildren(c),a=0;a<c.length;a++)f.selection.push(g.getNodeTextValue(c[a]));break;case "Action":c=g.getElementChildren(c);for(a=0;a<c.length;a++)f.action.push(g.getNodeTextValue(c[a]));break;case "Input":c=g.getElementChildren(c);for(a=0;a<c.length;a++)f.input.push(g.getNodeTextValue(c[a]));
break;case "properties":return CTATMsgType.getSAIArraysFromElement(c,g)}}return f};Object.defineProperty(CTATMsgType,"CorrectTypes",{enumerable:!1,configurable:!1,writable:!1,value:{correctaction:1,incorrectaction:1,lispcheckaction:1}});Object.defineProperty(CTATMsgType,"TextFeedbackTypes",{enumerable:!1,configurable:!1,writable:!1,value:{showhintsmessage:"HintsMessage",successmessage:"SuccessMsg",buggymessage:"BuggyMsg",highlightmsg:"HighlightMsgText"}});
CTATMsgType.getFeedbackTexts=function(b){var g=CTATMsgType.TextFeedbackTypes[(b&&CTATMsgType.getMessageType(b)||"").toLowerCase()];switch(g){case "SuccessMsg":case "BuggyMsg":case "HintsMessage":return CTATMsgType.valueToArray(CTATMsgType.getProperty(b,g));case "HighlightMsgText":return[CTATMsgType.getProperty(b,g)||""];default:return[]}};Object.defineProperty(CTATMsgType,"HintResponseTypes",{enumerable:!1,configurable:!1,writable:!1,value:{showhintsmessage:1,nohintmessage:1,showhintsmessagefromlisp:1}});
Object.defineProperty(CTATMsgType,"BUGGY_MSG",{enumerable:!1,configurable:!1,writable:!1,value:"BuggyMsg"});Object.defineProperty(CTATMsgType,"DONE",{enumerable:!1,configurable:!1,writable:!1,value:"Done"});Object.defineProperty(CTATMsgType,"BUTTON_PRESSED",{enumerable:!1,configurable:!1,writable:!1,value:"ButtonPressed"});Object.defineProperty(CTATMsgType,"DEFAULT_STUDENT_ACTOR",{enumerable:!1,configurable:!1,writable:!1,value:"Student"});
Object.defineProperty(CTATMsgType,"DEFAULT_TOOL_ACTOR",{enumerable:!1,configurable:!1,writable:!1,value:"Tutor"});Object.defineProperty(CTATMsgType,"UNGRADED_TOOL_ACTOR",{enumerable:!1,configurable:!1,writable:!1,value:"Tutor (unevaluated)"});Object.defineProperty(CTATMsgType,"DEFAULT_ACTOR",{enumerable:!1,configurable:!1,writable:!1,value:CTATMsgType.DEFAULT_STUDENT_ACTOR});Object.defineProperty(CTATMsgType,"ANY_ACTOR",{enumerable:!1,configurable:!1,writable:!1,value:"Any"});
Object.defineProperty(CTATMsgType,"SHOW_ALL_FEEDBACK",{enumerable:!1,configurable:!1,writable:!1,value:"Show All Feedback"});Object.defineProperty(CTATMsgType,"SHOW_FEEDBACK_AS_QUIZ",{enumerable:!1,configurable:!1,writable:!1,value:"Show Feedback As Quiz"});Object.defineProperty(CTATMsgType,"DELAY_FEEDBACK",{enumerable:!1,configurable:!1,writable:!1,value:"Delay Feedback"});Object.defineProperty(CTATMsgType,"HIDE_ALL_FEEDBACK",{enumerable:!1,configurable:!1,writable:!1,value:"Hide All Feedback"});
Object.defineProperty(CTATMsgType,"HIDE_BUT_COMPLETE",{enumerable:!1,configurable:!1,writable:!1,value:"Hide feedback but require all steps"});Object.defineProperty(CTATMsgType,"HIDE_BUT_ENFORCE",{enumerable:!1,configurable:!1,writable:!1,value:"Hide feedback but enforce constraints"});Object.defineProperty(CTATMsgType,"DEFAULT_FEEDBACK",{enumerable:!1,configurable:!1,writable:!1,value:CTATMsgType.SHOW_ALL_FEEDBACK});
CTATMsgType.FeedbackPolicies=[CTATMsgType.SHOW_ALL_FEEDBACK,CTATMsgType.SHOW_FEEDBACK_AS_QUIZ,CTATMsgType.DELAY_FEEDBACK,CTATMsgType.HIDE_ALL_FEEDBACK,CTATMsgType.HIDE_BUT_COMPLETE,CTATMsgType.HIDE_BUT_ENFORCE];Object.defineProperty(CTATMsgType,"DEFAULT_OUT_OF_ORDER_MESSAGE",{enumerable:!1,configurable:!1,writable:!1,value:CTATLanguageManager.theSingleton.filterString("HIGHLIGHTEDSTEP")});Object.defineProperty(CTATMsgType,"NOT_DONE_MSG",{enumerable:!1,configurable:!1,writable:!1,value:CTATLanguageManager.theSingleton.filterString("NOTDONE")});
Object.defineProperty(CTATMsgType,"TRACE_OUTCOME",{enumerable:!1,configurable:!1,writable:!1,value:"TraceOutcome"});Object.defineProperty(CTATMsgType,"PREVIOUS_FOCUS",{enumerable:!1,configurable:!1,writable:!1,value:"PreviousFocus"});Object.defineProperty(CTATMsgType,"ASSOCIATED_RULES",{enumerable:!1,configurable:!1,writable:!1,value:"AssociatedRules"});Object.defineProperty(CTATMsgType,"BEGIN_RESTORE",{enumerable:!1,configurable:!1,writable:!1,value:"BeginRestore"});
Object.defineProperty(CTATMsgType,"BEGIN_GO_TO_STATE",{enumerable:!1,configurable:!1,writable:!1,value:"BeginGoToState"});Object.defineProperty(CTATMsgType,"END_GO_TO_STATE",{enumerable:!1,configurable:!1,writable:!1,value:"EndGoToState"});Object.defineProperty(CTATMsgType,"BUGGY_MESSAGE",{enumerable:!1,configurable:!1,writable:!1,value:"BuggyMessage"});Object.defineProperty(CTATMsgType,"CORRECT_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"CorrectAction"});
Object.defineProperty(CTATMsgType,"HINT_REQUEST",{enumerable:!1,configurable:!1,writable:!1,value:"HintRequest"});Object.defineProperty(CTATMsgType,"INCORRECT_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"InCorrectAction"});Object.defineProperty(CTATMsgType,"INTERFACE_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"InterfaceAction"});Object.defineProperty(CTATMsgType,"INTERFACE_IDENTIFICATION",{enumerable:!1,configurable:!1,writable:!1,value:"InterfaceIdentification"});
Object.defineProperty(CTATMsgType,"SEND_WIDGET_LOCK",{enumerable:!1,configurable:!1,writable:!1,value:"SendWidgetLock"});Object.defineProperty(CTATMsgType,"PROBLEM_RESTORE_END",{enumerable:!1,configurable:!1,writable:!1,value:"ProblemRestoreEnd"});Object.defineProperty(CTATMsgType,"PROBLEM_SUMMARY_REQUEST",{enumerable:!1,configurable:!1,writable:!1,value:"ProblemSummaryRequest"});Object.defineProperty(CTATMsgType,"PROBLEM_SUMMARY_RESPONSE",{enumerable:!1,configurable:!1,writable:!1,value:"ProblemSummaryResponse"});
Object.defineProperty(CTATMsgType,"SET_PREFERENCES",{enumerable:!1,configurable:!1,writable:!1,value:"SetPreferences"});Object.defineProperty(CTATMsgType,"SHOW_HINTS_MESSAGE",{enumerable:!1,configurable:!1,writable:!1,value:"ShowHintsMessage"});Object.defineProperty(CTATMsgType,"SUCCESS_MESSAGE",{enumerable:!1,configurable:!1,writable:!1,value:"SuccessMessage"});Object.defineProperty(CTATMsgType,"START_STATE_END",{enumerable:!1,configurable:!1,writable:!1,value:"StartStateEnd"});
Object.defineProperty(CTATMsgType,"STATE_GRAPH",{enumerable:!1,configurable:!1,writable:!1,value:"StateGraph"});Object.defineProperty(CTATMsgType,"UNTUTORED_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"UntutoredAction"});Object.defineProperty(CTATMsgType,"GO_TO_STATE",{enumerable:!1,configurable:!1,writable:!1,value:"GoToState"});Object.defineProperty(CTATMsgType,"INTERFACE_REBOOT",{enumerable:!1,configurable:!1,writable:!1,value:"InterfaceReboot"});
Object.defineProperty(CTATMsgType,"CompletionValue",{enumerable:!1,configurable:!1,writable:!1,value:["incomplete","complete"]});CTATMsgType.prototype=Object.create(CTATBase.prototype);CTATMsgType.prototype.constructor=CTATMsgType;"undefined"!==typeof module&&(module.exports=CTATMsgType);var CTATVersionComparator=function(){CTATBase.call(this,"CTATVersionComparator","");this.compare=function(b,g){if(null===b||"undefined"===typeof b)return null===g||"undefined"===typeof g?0:-1;if(null===g||"undefined"===typeof g)return 1;var f=0,e=b.split("."),c=g.split("."),a;for(a=0;a<Math.min(e.length,c.length);a++)try{var d=parseInt(e[a]),h=parseInt(c[a]),f=d<h?-1:d>h?1:0;if(0!==f)return f}catch(l){if(f=e[a].toString()<c[a].toString()?-1:e[a].toString()>c[a].toString()?1:0,0!==f)return f}return a<
e.length?1:a<c.length?-1:b.toString()<g.toString()?-1:b.toString()>g.toString()?1:0}};CTATVersionComparator.prototype=Object.create(CTATBase.prototype);CTATVersionComparator.prototype.constructor=CTATVersionComparator;CTATVersionComparator.vc=new CTATVersionComparator;"undefined"!==typeof module&&(module.exports=CTATVersionComparator);var CTATExampleTracerSkill=function(b,g,f,e,c,a,d,h){CTATBase.call(this,"CTATExampleTracerSkill",g);var l=this,n=0,p=CTATExampleTracerSkill.SKILL_BAR_DELIMITER_v2_11;this.skillName=null==b||""==b.trim()?g:g+" "+b;this.pGuess=Number(f);Number.isNaN(l.pGuess)&&(l.pGuess=CTATExampleTracerSkill.DEFAULT_P_GUESS);this.pKnown=Number(e);Number.isNaN(l.pKnown)&&(l.pKnown=CTATExampleTracerSkill.DEFAULT_P_KNOWN);this.pLearn=Number(a);Number.isNaN(l.pLearn)&&(l.pLearn=CTATExampleTracerSkill.DEFAULT_P_LEARN);
this.pSlip=Number(c);Number.isNaN(l.pSlip)&&(l.pSlip=CTATExampleTracerSkill.DEFAULT_P_SLIP);this.history=/^0*[xX]([0-9a-fA-F]+)$/.test(d)?parseInt(d,16):/^(\-|\+)?[0-9]+$/.test(d)?parseInt(d,10):CTATExampleTracerSkill.DEFAULT_HISTORY;this.opportunityCount=Number.parseInt(h);Number.isNaN(l.opportunityCount)&&(l.opportunityCount=0);this.masteryThreshold=CTATExampleTracerSkill.DEFAULT_MASTERY_THRESHOLD;this.description=this.label=null;var q=function(a,d,c,b,e,f,h){this.skillName=a;this.pGuess=d;this.pKnown=
c;this.pLearn=b;this.pSlip=e;this.history=f;this.opportunityCount=h;this.getSkillName=function(){return this.skillName}};q.prototype.constructor=q;var u=[];this.getSkillName=function(){return l.skillName};this.getCategory=function(a){null==a&&(a=l.skillName);var d=a.indexOf(" ");return 0>d?"":a.substring(d+1)};this.getName=function(a){if(""==a||null==a)a=l.skillName;var d=a.indexOf(" ");return 0>d?a:a.substring(0,d)};this.getCategory=function(a){if(""==a||null==a)a=l.skillName;var d=a.indexOf(" ");
return 0>d?"":a.substring(d+1)};this.setTransactionNumber=function(a){n=a};this.getUpdates=function(){return u};this.updatesToJSONforTutorshop=function(){return u.map(function(a){return l.toJSONforTutorshop(a)})};this.addUpdate=function(a){u.push(new q(a.skillName,a.pGuess,a.pKnown,a.pLearn,a.pSlip,a.history,a.opportunityCount))};this.recordUpdate=function(a){l.updatePKnown(a);l.updateHistory(a);l.changeOpportunityCount(1);u.push(new q(l.skillName,l.pGuess,l.pKnown,l.pLearn,l.pSlip,l.history,l.opportunityCount))};
this.updatePKnown=function(a){l.pKnown=CTATExampleTracerSkill.updatePKnownStatic(a,l.pGuess,l.pKnown,l.pSlip,l.pLearn);return l.pKnown};this.updateHistory=function(a){l.history=CTATExampleTracerSkill.updateHistoryStatic(a,l.history);return l.history};this.changeOpportunityCount=function(a){l.opportunityCount+=a;return l.opportunityCount};this.getTransactionNumber=function(){return n};this.getSkillBarString=function(a){var d=this.getSkillName(),d=d+this.getSkillBarDelimiter()+l.pKnown,d=d+this.getSkillBarDelimiter()+
(this.hasReachedMastery()?"1":"0");!0===a&&(d=d+this.getSkillBarDelimiter()+this.getLabel());return d.toString()};this.getSkillBarDelimiter=function(){return p};this.toXML=function(a){var d;d=""+(' name="'+CTATXML.escape(CTATExampleTracerSkill.getName(l.skillName))+'"');d+=' category="'+CTATXML.escape(l.getCategory())+'"';d+=' label="'+CTATXML.escape(l.getLabel())+'"';d+=' description="'+CTATXML.escape(l.getDescription())+'"';d+=' pKnown="'+Number(l.pKnown).toString()+'"';d+=' pLearn="'+Number(l.pLearn).toString()+
'"';d+=' pGuess="'+Number(l.pGuess).toString()+'"';d+=' pSlip="'+Number(l.pSlip).toString()+'"';d+=' history="'+l.history+'"';d+=' opportunityCount="'+l.opportunityCount+'"';return a?"&lt;Skill"+d+" /&gt;":"<Skill"+d+" />"};this.toJSONforTutorshop=function(a){var d={};a||(a=l);d.name=CTATExampleTracerSkill.getName(a.getSkillName());d.category=CTATExampleTracerSkill.getCategory(a.getSkillName());d.p_known=a.pKnown;d.p_learn=a.pLearn;d.p_guess=a.pGuess;d.p_slip=a.pSlip;d.history=a.history;d.opportunity_count=
a.opportunityCount;return d};this.toProductionRuleObject=function(){return{name:l.getName(),category:l.getCategory(),label:l.getLabel(),description:l.getDescription(),opportunity_count:l.getOpportunityCount()}};this.toXMLForBRD=function(a){return CTATExampleTracerSkill.toXMLForBRDStatic(l.toProductionRuleObject(),a)};this.getPKnown=function(){return l.pKnown};this.getPLearn=function(){return l.pLearn};this.getPGuess=function(){return l.pGuess};this.getPSlip=function(){return l.pSlip};this.getHistory=
function(){return l.history};this.getOpportunityCount=function(){return l.opportunityCount};this.setOpportunityCount=function(a){l.opportunityCount=Number(a)||0};this.hasReachedMastery=function(){return null===l.pKnown||"undefined"===typeof l.pKnown?!1:l.pKnown>=l.masteryThreshold};this.getLabel=function(){return!l.label||1>l.label.length?CTATExampleTracerSkill.getName(l.skillName):l.label};this.getDescription=function(){return!l.description||1>l.description.length?l.skillName:l.description};this.setVersion=
function(a){null!==a&&"undefined"!==typeof a&&0<a.length&&(p=CTATExampleTracerSkill.versionToSkillBarDelimiter(a))};this.setLabel=function(a){l.label=a};this.setDescription=function(a){l.description=a}};
CTATExampleTracerSkill.toXMLForBRDStatic=function(b,g){var f;f=b.opportunity_count;f=""+(g+"<productionRule"+(f?' opportunities="'+f+'"':"")+">\n")+(g+"    <ruleName><![CDATA["+b.name+"]]\x3e</ruleName>\n");f+=g+"    <productionSet><![CDATA["+b.category+"]]\x3e</productionSet>\n";f+=g+"    <label><![CDATA["+b.label+"]]\x3e</label>\n";f+=g+"    <description><![CDATA["+b.description+"]]\x3e</description>\n";return f+(g+"</productionRule>")};
CTATExampleTracerSkill.makeStepID=function(b,g){for(var f="",e=0,c=b;2>e++;c=g)if(!(null===c||"undefined"===typeof c||1>c.length)){for(var a=!1,d=0;d<c.length;d++)if(null!==c[d]&&"undefined"!==typeof c[d]){var h=c[d].toString();1>h.length||c===b&&("hint".toString().toUpperCase()===h.toString().toUpperCase()||"help".toString().toUpperCase()===h.toString().toUpperCase())||c===g&&CTATMsgType.PREVIOUS_FOCUS.toString().toUpperCase()===h.toString().toUpperCase()||(f=f+(a?",":"[")+h,a=!0)}!0===a&&(f+="]")}return f.toString()};
CTATExampleTracerSkill.updateHistoryStatic=function(b,g){var f=1<<CTATExampleTracerSkill.MAX_INTEGER_SHIFT;b=g<<1|(b.toString().toUpperCase()===CTATExampleTracerSkill.CORRECT.toString().toUpperCase()?1:0);return b&f?b^f:b};
CTATExampleTracerSkill.updatePKnownStatic=function(b,g,f,e,c){var a=0;if(b.toString().toUpperCase()===CTATExampleTracerSkill.CORRECT.toString().toUpperCase())b=+(f*(1-e)),a=+(b/(b+ +(g*(1-f))));else if(b.toString().toUpperCase()===CTATExampleTracerSkill.INCORRECT.toString().toUpperCase()||b.toString().toUpperCase()===CTATExampleTracerSkill.HINT.toString().toUpperCase())b=+(f*e),a=+(b/(b+ +((1-f)*(1-g))));return+(a+c*(1-a))};
CTATExampleTracerSkill.makeKey=function(b,g){return""==b||null==b?"":String(b)+(""==g||null==g?"":" "+String(g))};CTATExampleTracerSkill.getName=function(b){var g=b.indexOf(" ");return 0>g?b:b.substring(0,g)};CTATExampleTracerSkill.getCategory=function(b){b=null==b?"":String(b);var g=b.indexOf(" ");return 0>g?"":b.substring(g+1)};
CTATExampleTracerSkill.versionToSkillBarDelimiter=function(b){return null===b||"undefined"===typeof b?CTATExampleTracerSkill.SKILL_BAR_DELIMITER_v2_10:0<=CTATVersionComparator.vc.compare(b,"2.11")?CTATExampleTracerSkill.SKILL_BAR_DELIMITER_v2_11:CTATExampleTracerSkill.SKILL_BAR_DELIMITER_v2_10};CTATExampleTracerSkill.fromJSON=function(b){if(!b)return null;var g=new CTATExampleTracerSkill("",""),f;for(f in b)b.hasOwnProperty(f)&&"function"!=typeof b[f]&&(g[f]=b[f]);return g};
Object.defineProperty(CTATExampleTracerSkill,"MAX_INTEGER_SHIFT",{enumerable:!1,configurable:!1,writable:!1,value:31});Object.defineProperty(CTATExampleTracerSkill,"HINT",{enumerable:!1,configurable:!1,writable:!1,value:"hint"});Object.defineProperty(CTATExampleTracerSkill,"CORRECT",{enumerable:!1,configurable:!1,writable:!1,value:"correct"});Object.defineProperty(CTATExampleTracerSkill,"INCORRECT",{enumerable:!1,configurable:!1,writable:!1,value:"incorrect"});
Object.defineProperty(CTATExampleTracerSkill,"SKILL_BAR_DELIMITER_v2_10",{enumerable:!1,configurable:!1,writable:!1,value:"="});Object.defineProperty(CTATExampleTracerSkill,"SKILL_BAR_DELIMITER_v2_11",{enumerable:!1,configurable:!1,writable:!1,value:"`"});Object.defineProperty(CTATExampleTracerSkill,"DEFAULT_MASTERY_THRESHOLD",{enumerable:!1,configurable:!1,writable:!1,value:.95});Object.defineProperty(CTATExampleTracerSkill,"DEFAULT_P_GUESS",{enumerable:!1,configurable:!1,writable:!1,value:.2});
Object.defineProperty(CTATExampleTracerSkill,"DEFAULT_P_KNOWN",{enumerable:!1,configurable:!1,writable:!1,value:.3});Object.defineProperty(CTATExampleTracerSkill,"DEFAULT_P_SLIP",{enumerable:!1,configurable:!1,writable:!1,value:.3});Object.defineProperty(CTATExampleTracerSkill,"DEFAULT_P_LEARN",{enumerable:!1,configurable:!1,writable:!1,value:.15});Object.defineProperty(CTATExampleTracerSkill,"DEFAULT_HISTORY",{enumerable:!1,configurable:!1,writable:!1,value:0});CTATExampleTracerSkill.prototype=Object.create(CTATBase.prototype);
CTATExampleTracerSkill.prototype.constructor=CTATExampleTracerSkill;"undefined"!==typeof module&&(module.exports=CTATExampleTracerSkill);var CTATProblem=function(){CTATBase.call(this,"CTATProblem","problem");var b="",g="",f="tutor",e="",c="",a=[],d=[],h=0,l=0;this.setCompletedCount=function(a){h=a};this.getCompletedCount=function(){return h};this.setProblemContext=function(a){l=a};this.getProblemContext=function(){return l};this.setLabel=function(a){b=a};this.getLabel=function(){return b};this.setDescription=function(a){g=a};this.getDescription=function(){return g};this.setTutorFlag=function(a){f=a};this.getTutorFlag=function(){return f};
this.setProblemFile=function(a){e=a};this.getProblemFile=function(){return e};this.setStudentInterface=function(a){c=a};this.getStudentInterface=function(){return c};this.addSkillOpps=function(c){a.push(c);d.push(new CTATExampleTracerSkill(c.category,c.name))};this.getSkillOpps=function(){return a};this.getSkills=function(){return d}};CTATProblem.prototype=Object.create(CTATBase.prototype);CTATProblem.prototype.constructor=CTATProblem;
CTATProblem.prototype.toString=function(){return this.getProblemFile()+" on "+this.getStudentInterface()};var CTATGuid={s4:function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},guid:function(){return this.s4()+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+this.s4()+this.s4()}};var CTATConfiguration=function(){CTATBase.call(this,"CTATConfiguration","config");var b=this,g=0,f=null,e=null,c=null,a=null;this.raw={admit_code:"ies",authenticity_token:"",auth_token:"none",BehaviorRecorderMode:"AuthorTimeTutoring",class_name:"DefaultClass",curriculum_service_url:"",connection:"javascript",dataset_level_name:"none",dataset_level_type:"ProblemSet",dataset_name:"none",expire_logout_url:"none",info:"",instructor_name:"none",instrumentation_log:"off",lcId:"none",Logging:"None",log_service_url:"http://pslc-qa.andrew.cmu.edu/log/server",
log_to_disk_directory:".",problem_name:"none",problem_position:"none",problem_started_url:"",problem_state_status:"empty",question_file:"",refresh_session_url:"",remoteSocketPort:"20080",remoteSocketSecurePort:"20443",remoteSocketURL:"127.0.0.1",restore_problem_url:"",reuse_swf:"false",run_problem_url:"",school_name:"none",SessionLog:"true",session_id:CTATGuid.guid(),session_timeout:"none",show_debug_traces:"false",skills:"",source_id:"PACT_CTAT_HTML5",student_interface:"none",student_problem_id:"none",
study_condition_name:"none",study_condition_type:"none",study_condition_description:"none",study_name:"Study1",target_frame:"_parent",TutorShopDeliveryMethod:"sendandload",tutoring_service_communication:"javascript",user_guid:"none",wmode:"opaque",ssl:"off",sui:"",centerTutor:!1,previewMode:!1,width:550,height:450};this.assignRawFlashVars=function(a){b.ctatdebug("assignRawFlashVars() raw['session_id'] "+b.raw.session_id+", aData['session_id'] "+a.session_id);b.raw=a;b.preParse()};this.getRawFlashVars=
function(){return b.raw};this.getSingleParameterValues=function(a){var d=[];if(!a)return d;var c=b.getRawFlashVars(),e;for(e in a){var f=a[e];c[f]&&"none"!=c[f]&&d.push(c[f])}return d};this.usingFlash=function(){return this.getSingleParameterValues(["student_interface","swf_name"]).some(function(a){return 0<=a.search(/[.]swf$/i)})};this.generateDefaultConfiguration=function(a,c){var d={},e=0,f=0;if(a)for(var h in a)d[h]=a[h],e++;b.ctatdebug("generateDefaultConfiguration() nDefaults "+e+", result['session_id'] "+
d.session_id);if("undefined"!=typeof c&&null!=c)for(h in c)d[h]=c[h],f++;b.ctatdebug("generateDefaultConfiguration() nLocalVars "+f);c=a=null;if(window&&window.frameElement&&(c=window.frameElement.getAttribute("data-params"))){a=JSON.parse(c);console.log("setting data params from iframe attr");for(var g in a)"object"==typeof a[g]&&(a[g]=JSON.stringify(a[g])),d[g]=CTATGlobals.EncodedParams[g]?decodeURIComponent(a[g].replace(/\+/g,"%20")):a[g],console.log("set "+g+" to "+d[g])}if(null===a)for(g=$('object param[name="flashvars"]'),
b.ctatdebug("generateDefaultConfiguration() objs "+g),a=0;a<g.length;++a)if(c=$(g[a]).attr("value"),b.ctatdebug("generateDefaultConfiguration() fVarsAsString "+c),c&&(c=parseQueryStringArgs(c))&&c.question_file)for(var v in c)d[v]=c[v];if(window===parent){v=d||{};try{if(localStorage&&"function"==typeof localStorage.getItem){var y=localStorage.getItem(CTATConfiguration.cachedParamsName),w;for(w in y=JSON.parse(y))v[w]=y[w];localStorage.removeItem(CTATConfiguration.cachedParamsName)}}catch(D){console.log("Error parsing",
CTATConfiguration.cachedParamsName,D)}}ctatdebug("tutorPrep ("+d+")");y={};if(null===d||void 0===d)ctatdebug("tutorPrep(): Internal error: null argument passed");else{ctatdebug("parseQueryString ()");w=location.search;ctatdebug("Query String: "+w);v="?"==w.charAt(0)?w.substring(1):w;w={};if(v)for(v=v.split("&"),g=0;g<v.length;g++){a=v[g].split("=");ctatdebug("Setting flashvar "+a[0]+", to: "+decodeURIComponent(a[1].replace(/\+/g," ")));w[decodeURIComponent(a[0])]="";for(c=1;c<a.length;c++)w[decodeURIComponent(a[0])]+=
(1<c?"=":"")+decodeURIComponent(a[c].replace(/\+/g," "));ctatdebug("Decoded args: "+w[decodeURIComponent(a[0])])}null!==w&&(ctatdebug("tutorPrep(): Assigning parsed arguments ..."),y=w);w=!1;for(var A in y)if(y.hasOwnProperty(A))switch(ctatdebug("Processing external FlashVar "+A+"("+y[A]+")"),A){case "GENERATED":"on"==y[A]&&(d.session_id=CTATGuid.guid(),w=!0);break;case "BRD":d.question_file=y[A];break;case "BRMODE":d.BehaviorRecorderMode=y[A];break;case "PROBLEM":d.problem_name=y[A];break;case "DATASET":d.dataset_name=
y[A];break;case "LEVEL1":d.dataset_level_name1=y[A];break;case "TYPE1":d.dataset_level_type1=y[A];break;case "LEVEL2":d.dataset_level_name2=y[A];break;case "TYPE2":d.dataset_level_type2=y[A];break;case "LEVEL3":d.dataset_level_name3=y[A];break;case "TYPE3":d.dataset_level_type3=y[A];break;case "LEVEL4":d.dataset_level_name4=y[A];break;case "TYPE4":d.dataset_level_type4=y[A];break;case "USER":d.user_guid=y[A];break;case "SESSION":!1===w&&(d.session_id=y[A]);break;case "SOURCE":d.source_id=y[A];break;
case "LOGTYPE":d.Logging=y[A];break;case "PORT":d.remoteSocketPort=y[A];break;case "REMOTEURL":d.remoteSocketURL=y[A];break;case "DISKDIR":d.log_to_disk_directory=y[A];break;case "log_service_url":d.log_service_url=y[A];break;case "URL":d.log_service_url=y[A];break;case "LOGURL":d.log_service_url=y[A];break;case "CONNECTION":d.tutoring_service_communication=y[A];break;case "SUI":d.sui=y[A];break;case "VAR1":d.var1=y[A];break;case "VAL1":d.val1=y[A];break;case "VAR2":d.var2=y[A];break;case "VAL2":d.val2=
y[A];break;case "VAR3":d.var3=y[A];break;case "VAL3":d.val3=y[A];break;case "VAR4":d.var4=y[A];break;case "VAL4":d.val4=y[A];break;case "SLOG":case "SessionLog":d.SessionLog=y[A];break;case "KEYBOARDGROUP":"Disabled"==y[A]&&(d.keyboard="disabled");"Auto"==y[A]&&(d.keyboard="auto");"On"==y[A]&&(d.keyboard="on");break;default:d[A]=y[A]}}A=d||{};try{if(sessionStorage&&"function"==typeof sessionStorage.getItem){var z=sessionStorage.getItem(CTATConfiguration.INIT_PARAMS),C;for(C in z=JSON.parse(z))A[C]=
z[C];sessionStorage.removeItem("Init-Params")}}catch(D){console.log("Error parsing",CTATConfiguration.INIT_PARAMS,D)}return d};this.addCustomField=function(a,c){a&&(++g,b.raw["custom_field_name"+g]=String(a),b.raw["custom_field_value"+g]=c);return g};this.getCustomFields=function(){var a={},c;for(c in b.raw){var e=/^custom_field_name([0-9]+)$/.exec(c),f=b.raw[c];e&&f&&(a[f]=b.raw["custom_field_value"+e[1]])}return a};this.setTimeZone=function(a){b.ctatdebug("setTimeZone ("+a+")");null==a||""==a||
void 0==a?(a=jstz.determine(),b.ctatdebug("Assigning detected timezone: "+a.name()),a=a.name()):(50<a.length&&(a=a.substr(0,50)),3!=a.length&&4!=a.length||b.ctatdebug("3 and 4 letter time zone abbreviations are deprecated. See list of tz database zone names for better options"));null!=b.raw&&(b.raw.timezone=a)};this.getTimeZone=function(){return null!=b.raw&&b.raw.timezone?b.raw.timezone:"UTC"};this.listWithAmpersands=function(){var a="",c;for(c in b.raw)var e=c+"="+encodeURIComponent(b.raw[c]),a=
""!=a?a+"&"+e:e;b.ctatdebug("CTATConfiguration.listWithAmpersands() result "+a.substring(0,25)+"...");return a};this.listFlashVars=function(){ctatdebug("listFlashVars ()");for(var a in b.raw)ctatdebug("["+a+"]: "+b.raw[a])};this.preParse=function(){ctatdebug("preParse ()");if(void 0==b.raw.dataset_name||void 0==b.raw.dataset_name)b.raw.dataset_name="DefaultDataset";var a=null;do a=!1,void 0!=b.raw["custom_field_name"+(g+1)]&&(a=!0,++g);while(a);["VAR","var"].forEach(function(d){"undefined"!=typeof(a=
b.raw[d])&&b.addCustomField(d,a)})};this.getDatasetNames=function(){b.ctatdebug("getDatasetNames ()");if(null!=f)return f;f={};f=[];for(var a=0,c=!0;1==c;){var c=!1,e="dataset_level_name"+(a+1);null!=b.raw[e]&&(b.ctatdebug("Adding: "+e+","+b.raw[e]),f[a]=b.raw[e],c=!0,a++)}return f};this.getDatasetTypes=function(){b.ctatdebug("getDatasetTypes ()");if(null!=e)return e;e=[];for(var a=0,c=!0;1==c;){var c=!1,f="dataset_level_type"+(a+1);null!=b.raw[f]&&(b.ctatdebug("Adding: "+f+","+b.raw[f]),e[a]=b.raw[f],
c=!0,a++)}return e};this.getConditionNames=function(){var a=[],c=0;void 0!=b.raw.study_condition_name&&""!=b.raw.study_condition_name&&(a.push(b.raw.study_condition_name),c++);for(var e=0,f=!0;1==f;){var f=!1,g="study_condition_name"+(e+1);null!=b.raw[g]&&(b.ctatdebug("Adding: "+g+","+b.raw[g]),a[e+c]=b.raw[g],f=!0,e++)}return a};this.getConditionTypes=function(){c=[];var a=0;void 0!=b.raw.study_condition_type&&""!=b.raw.study_condition_type&&(c.push(b.raw.study_condition_type),a++);for(var e=0,f=
!0;1==f;){var f=!1,g="study_condition_type"+(e+1);null!=b.raw[g]&&(b.ctatdebug("Adding: "+g+","+b.raw[g]),c[e+a]=b.raw[g],f=!0,e++)}return c};this.getConditionDescriptions=function(){b.ctatdebug("getConditionDescriptions ()");a=[];var d=0;b.raw.study_condition_description&&""!==b.raw.study_condition_description&&(b.ctatdebug("Adding study_condition_description: "+b.raw.study_condition_description),a.push(b.raw.study_condition_description),d++);for(var c=0,e=!0;!0===e;){var e=!1,f="study_condition_description"+
(c+1);null!=b.raw[f]&&(b.ctatdebug("Adding: "+f+","+b.raw[f]),a[c+d]=b.raw[f],e=!0,c++)}return a};this.get=function(a){return b.raw[a]};this.set=function(a,c){a&&(b.raw[a]=c)};this.setParams=function(a){if(a)for(var d in a)b.set(d,a[d])};this.isInstructorMode=function(){var a=this.getRawFlashVars();return a&&a.deliverymode?"delivery"==a.deliverymode?!1:!0:!1};this.getLoggingLibrary=function(){null===commLoggingLibrary&&(commLoggingLibrary=new CTATLoggingLibrary(!0));return commLoggingLibrary};this.setPreviewMode=
function(a,c){b.raw.previewMode=c};this.setCenterTutor=function(a,c){b.raw.centerTutor=c};this.setTutorWidth=function(a,c){b.raw.width=c};this.setTutorHeight=function(a,c){b.raw.height=c};this.setTutorDimensions=function(a,c,e){b.raw.width=c;b.raw.height=e};this.setTutorValue=function(a,c,e){b.raw[c]=e};this.setCommunicationMode=function(a,c){b.raw.tutoring_service_communication=c};this.setRemoteSocketURL=function(a,c){b.raw.remoteSocketURL=c};this.setRemoteSocketPort=function(a,c){b.raw.remoteSocketPort=
c}};CTATConfiguration.INIT_PARAMS="Init-Params";CTATConfiguration.prototype=Object.create(CTATBase.prototype);CTATConfiguration.prototype.constructor=CTATConfiguration;flashVars=CTATConfiguration.theConfObject=null;
CTATConfiguration.generateDefaultConfigurationObject=function(b,g){if(!CTATConfiguration.theConfObject){CTATConfiguration.theConfObject=new CTATConfiguration;var f=CTATConfiguration.theConfObject.generateDefaultConfiguration(CTATConfiguration.theConfObject.raw,b);CTATConfiguration.theConfObject.assignRawFlashVars(f);"none"==CTATConfiguration.theConfObject.get("session_id")&&CTATConfiguration.theConfObject.set("session_id",CTATGuid.guid());flashVars=CTATConfiguration.theConfObject;console.log("CTATConfiguration.generateDefaultConfigurationObject() flashVars.getRawFlashVars()['session_id'] "+
flashVars.getRawFlashVars().session_id);console.log("flashVars.getRawFlashVars()['remoteSocketPort'] "+flashVars.getRawFlashVars().remoteSocketPort)}"Default"!=g&&"OLI"!=g||CTATConfiguration.theConfObject.setParams(b);return CTATConfiguration.theConfObject};CTATConfiguration.getRawFlashVars=function(){CTATConfiguration.generateDefaultConfigurationObject();return CTATConfiguration.theConfObject.getRawFlashVars()};
CTATConfiguration.get=function(b){CTATConfiguration.generateDefaultConfigurationObject();return CTATConfiguration.theConfObject.get(b)};CTATConfiguration.set=function(b,g){CTATConfiguration.generateDefaultConfigurationObject();CTATConfiguration.theConfObject.set(b,g)};CTATConfiguration.getCustomFields=function(){CTATConfiguration.generateDefaultConfigurationObject();return CTATConfiguration.theConfObject.getCustomFields()};
CTATConfiguration.addCustomField=function(b,g){CTATConfiguration.generateDefaultConfigurationObject();return CTATConfiguration.theConfObject.addCustomField(b,g)};CTATConfiguration.setParams=function(b){CTATConfiguration.generateDefaultConfigurationObject();CTATConfiguration.theConfObject.setParams(b)};CTATConfiguration.getSingleParameterValues=function(b){CTATConfiguration.generateDefaultConfigurationObject();return CTATConfiguration.theConfObject.getSingleParameterValues(b)};
CTATConfiguration.usingFlash=function(){CTATConfiguration.generateDefaultConfigurationObject();return CTATConfiguration.theConfObject.usingFlash()};CTATConfiguration.cachedParamsName="CTATCconfiguration_"+location.origin+location.pathname;CTATConfiguration.prototype.set=CTATConfiguration.prototype.set;CTATConfiguration.prototype.get=CTATConfiguration.prototype.get;var CTATTutorMessageBuilder=function(){CTATBase.call(this,"CTATTutorMessageBuilder","__undefined__")};CTATTutorMessageBuilder.isHint=function(b){return null===b||"undefined"===typeof b?!1:0===b.toString().toLowerCase().indexOf(CTATTutorMessageBuilder.HINT.toLowerCase())};CTATTutorMessageBuilder.isCorrect=function(b){if(null===b||"undefined"===typeof b)return!1;b=b.toString().toLowerCase();return 0===b.indexOf(CTATTutorMessageBuilder.CORRECT.toLowerCase())?!0:0===b.indexOf(CTATExampleTracerLink.SUCCESS.toLowerCase())};
CTATTutorMessageBuilder.prototype=Object.create(CTATBase.prototype);CTATTutorMessageBuilder.prototype.createInCorrectActionMessage=function(b,g){this.ctatdebug("createInCorrectActionMessage ()");b="<message><verb>SendNoteProperty</verb><properties><MessageType>InCorrectAction</MessageType>"+("<transaction_id>"+b+"</transaction_id>");this.ctatdebug("In CTATTutorMessageBuilder "+g);b+=g.toXMLString(!1);return b+"</properties></message>"};
CTATTutorMessageBuilder.prototype.createCorrectActionMessage=function(b,g){this.ctatdebug("createCorrectActionMessage ()");b="<message><verb>SendNoteProperty</verb><properties><MessageType>CorrectAction</MessageType>"+("<transaction_id>"+b+"</transaction_id>")+g.toXMLString(!1);return b+"</properties></message>"};
CTATTutorMessageBuilder.prototype.createAssociatedRulesMessageForHint=function(b,g,f,e,c,a,d,h,l,n){this.ctatdebug("TMB.createAssociatedRulesMessageForHint "+(g&&g.toString()));d=void 0==d?b.length:d;h=void 0==h?1:h;g="<message><verb>SendNoteProperty</verb><properties><MessageType>AssociatedRules</MessageType><Indicator>Hint</Indicator>"+(g?g:new CTATSAI("","","")).toXMLString();g+="<TutorAdvice>";for(var p=0;p<b.length;p++)g+="<value><![CDATA["+b[p]+"]]\x3e</value>";g=g+("</TutorAdvice><TotalHintsAvailable>"+
d+"</TotalHintsAvailable><CurrentHintNumber>"+h+"</CurrentHintNumber>")+("<Actor>"+f+"</Actor>")+this.fmtSkillBarVector(e);g+="<skillBarDelimiter><![CDATA[`]]\x3e</skillBarDelimiter>";if(c||0===c)g+="<StepID>"+c+"</StepID>";g+="<transaction_id>"+a+"</transaction_id>";g+="<LogAsResult>true</LogAsResult>";g=this.formatOptions(g,n);g+=this.formatCustomFields(l);return g+="</properties></message>"};
CTATTutorMessageBuilder.prototype.createAssociatedRulesMessageForAction=function(b,g,f,e,c,a,d,h,l,n,p){this.ctatdebug("TMB.createAssociatedRulesMessageForAction(indicator "+b+", sai "+g+", actor "+f+", studentSAI "+e+",\n  skillBarVector "+c+", stepID "+a+", transactionID "+d+",\n  tutorAdvice >"+h+"<"+typeof h+", outOfOrder "+l);var q="<message><verb>SendNoteProperty</verb><properties><MessageType>AssociatedRules</MessageType>",q=q+("<Indicator>"+(CTATTutorMessageBuilder.isCorrect(b)?"Correct":
"InCorrect")+"</Indicator>"),q=q+(g?g:new CTATSAI("","","")).toXMLString();b=e.toXMLString().replace("<Selection>","<StudentSelection>").replace("<Action>","<StudentAction>").replace("<Input>","<StudentInput>");b=b.replace("</Selection>","</StudentSelection>").replace("</Action>","</StudentAction>").replace("</Input>","</StudentInput>");q+=b;q+="<Actor>"+f+"</Actor>";q+=this.fmtSkillBarVector(c);q+="<skillBarDelimiter><![CDATA[`]]\x3e</skillBarDelimiter>";q+="<StepID>"+a+"</StepID>";q+="<transaction_id>"+
d+"</transaction_id>";h&&h.toString()&&(h=h instanceof Array?h:[h],q+="<TutorAdvice>",h.forEach(function(a){return q+="<value><![CDATA["+a+"]]\x3e</value>"}),q+="</TutorAdvice>",q+="<TotalHintsAvailable>"+h.length+"</TotalHintsAvailable><CurrentHintNumber>1</CurrentHintNumber>");q+="<LogAsResult>true</LogAsResult>";q+="<end_of_transaction>"+(h?!1:!0)+"</end_of_transaction>";q+="undefined"!=typeof l&&l?"<OutOfOrder>true</OutOfOrder>":"";q=this.formatOptions(q,p);q+=this.formatCustomFields(n);return q+=
"</properties></message>"};CTATTutorMessageBuilder.prototype.formatCustomFields=function(b){var g="";if(b)for(var f in b)if(b.hasOwnProperty(f))var e=null==b[f]?"":b[f].toString(),g=g+("<custom_field><name>"+f+"</name><value>"+(""===e?"":/info/i.test(f)?"<![CDATA["+e+"]]\x3e":e)+"</value></custom_field>");return g?"<custom_fields>"+g+"</custom_fields>":""};
CTATTutorMessageBuilder.prototype.isDoneStep=function(b,g){g[0]=!1;var f=b.getIndicator();if(!f)return!1;var e=b.getStudentSelection();e||(e=b.getProperty("tool_selection"));g[0]=CTATTutorMessageBuilder.isCorrect(indicator);b="done"==e;this.ctatdebug("isDoneStep() indicatorObj "+f+", selectionObj "+e+", correct[0] "+g[0]+", result "+b);return b};
CTATTutorMessageBuilder.prototype.createHintMessage=function(b,g,f,e){f="<message><verb>SendNoteProperty</verb><properties><MessageType>ShowHintsMessage</MessageType><HintsMessage>";for(var c=0;c<b.length;c++)f+="<value><![CDATA["+b[c]+"]]\x3e</value>";f+="</HintsMessage>";g&&g.toXMLString&&(f+=g.toXMLString());return f+("<transaction_id>"+e+"</transaction_id>")+"</properties></message>"};
CTATTutorMessageBuilder.prototype.createErrorMessage=function(b,g){b="<message><verb>SendNoteProperty</verb><properties><MessageType>TutoringServiceError</MessageType><ErrorType>"+b+"</ErrorType><Details>"+(g?g:"");return b+="</Details></properties></message>"};
CTATTutorMessageBuilder.prototype.createSuccessMessage=function(b,g){g=g instanceof Array?g:[g];var f="<message><verb>SendNoteProperty</verb><properties><MessageType>SuccessMessage</MessageType>",f=f+"<SuccessMsg>";g.forEach(function(b){return f+="<value><![CDATA["+b+"]]\x3e</value>"});f+="</SuccessMsg>";f+="<transaction_id>"+b+"</transaction_id>";f+="<end_of_transaction>true</end_of_transaction>";return f+="</properties></message>"};
CTATTutorMessageBuilder.prototype.createBuggyMessage=function(b,g){g=g instanceof Array?g:[g];var f="<message><verb>SendNoteProperty</verb><properties><MessageType>BuggyMessage</MessageType>",f=f+"<BuggyMsg>";g.forEach(function(b){return f+="<value><![CDATA["+b+"]]\x3e</value>"});f+="</BuggyMsg>";f+="<transaction_id>"+b+"</transaction_id>";f+="<end_of_transaction>true</end_of_transaction>";return f+="</properties></message>"};
CTATTutorMessageBuilder.prototype.createLockWidgetMsg=function(b){return"<message><verb>SendNoteProperty</verb><properties><MessageType>SendWidgetLock</MessageType>"+("<WidgetLockFlag>"+b+"</WidgetLockFlag>")+"</properties></message>"};
CTATTutorMessageBuilder.prototype.createMessage=function(b,g){var f="<message><verb>SendNoteProperty</verb><properties><MessageType>"+b+"</MessageType>";if(g)for(var e in g)f+="<"+e+">"+g[e]+"</"+e+">";f+="</properties></message>";this.ctatdebug("CTATTutorMessageBuilder.createMessage("+b+", "+g+") returns "+f);return f};
CTATTutorMessageBuilder.prototype.createStateGraphMessage=function(b,g,f,e,c,a,d){b="<message><verb>SendNoteProperty</verb><properties><MessageType>StateGraph</MessageType>"+("<caseInsensitive>"+b+"</caseInsensitive>")+("<unordered>"+g+"</unordered>")+("<lockWidget>"+f+"</lockWidget>");b+="<suppressStudentFeedback>"+e+"</suppressStudentFeedback>";b+="<highlightRightSelection>"+c+"</highlightRightSelection>";b+="<confirmDone>"+a+"</confirmDone>";b+="<skillBarDelimiter><![CDATA[`]]\x3e</skillBarDelimiter>";
b+=this.fmtSkillBarVector(d);return b+="</properties></message>"};CTATTutorMessageBuilder.prototype.fmtSkillBarVector=function(b){var g="";if(void 0!==b&&null!==b&&0<b.length){for(var g=g+"<Skills>",f=0;f<b.length;f++)g+="<value><![CDATA["+b[f]+"]]\x3e</value>";g+="</Skills>"}return g};
CTATTutorMessageBuilder.prototype.formatOptions=function(b,g){for(var f in g||(g={})){var e=/(.)(.*)/.exec(f),e=e[1].toUpperCase()+(e[2]||""),c="",a="";""!==g[f]&&/info/i.test(e)&&(c="<![CDATA[",a="]]\x3e");b+="<"+e+">"+c+g[f]+a+"</"+e+">"}return b};
CTATTutorMessageBuilder.prototype.createHighlightWidgetMessage=function(b,g,f,e){b="<message><verb>SendNoteProperty</verb><properties><MessageType>HighlightMsg</MessageType>"+("<HighlightMsgText>"+f+"</HighlightMsgText>")+("<Selection><value>"+b+"</value></Selection>")+("<Action><value>"+g+"</value></Action>");b+="<transaction_id>"+e+"</transaction_id>";b+="<end_of_transaction>true</end_of_transaction>";return b+="</properties></message>"};
Object.defineProperty(CTATTutorMessageBuilder,"TRIGGER",{enumerable:!1,configurable:!1,writable:!1,value:"trigger"});Object.defineProperty(CTATTutorMessageBuilder,"SUBTYPE",{enumerable:!1,configurable:!1,writable:!1,value:"subtype"});Object.defineProperty(CTATTutorMessageBuilder,"TUTOR_PERFORMED",{enumerable:!1,configurable:!1,writable:!1,value:"tutor-performed"});Object.defineProperty(CTATTutorMessageBuilder,"HINT",{enumerable:!1,configurable:!1,writable:!1,value:"Hint"});
Object.defineProperty(CTATTutorMessageBuilder,"CORRECT",{enumerable:!1,configurable:!1,writable:!1,value:"Correct"});CTATTutorMessageBuilder.prototype.constructor=CTATTutorMessageBuilder;"undefined"!==typeof module&&(module.exports=CTATTutorMessageBuilder);var CTAT=function(){};"undefined"!=typeof window&&null!=window&&(window.CTAT=CTAT);"undefined"!==typeof module&&(module.exports=CTAT);CTAT.ToolTutor={interfaceMessages:[],tutorMessages:[]};
Object.defineProperty(CTAT.ToolTutor,"message_handler",{enumerable:!0,get:function(){if(window.hasOwnProperty("getInterfaceObject")&&"function"===typeof window.getInterfaceObject)return window.getInterfaceObject();if(window.hasOwnProperty("interfaceObject"))return window.interfaceObject;this.hasOwnProperty("_interface")||(this._interface=null);return this._interface},set:function(b){window.hasOwnProperty("interfaceObject")?window.interfaceObject=b:this._interface=b;return b}});
Object.defineProperty(CTAT.ToolTutor,"tutor",{enumerable:!0,get:function(){if(window.hasOwnProperty("getTutorObject")&&"function"===typeof window.getTutorObject)return window.getTutorObject();if(window.hasOwnProperty("tutorObject"))return window.tutorObject;this.hasOwnProperty("_tutor")||(this._tutor=null);return this._tutor},set:function(b){window.hasOwnProperty("tutorObject")?window.tutorObject=b:this._tutor=b;return b}});
CTAT.ToolTutor.registerTutor=function(b){if(window.hasOwnProperty("registerTutor")&&"function"===typeof window.registerTutor)return window.registerTutor(b);if(this.tutor=b)for(;0<this.tutorMessages.length;)this.sendToTutor(this.tutorMessages.shift())};
CTAT.ToolTutor.sendToInterface=function(b){var g=CTATConfiguration.get("post_tracer_output");g&&window.parent.postMessage({command:"message",id:CTATConfiguration.getCustomFields()["Team ID"]||"",user_guid:CTATConfiguration.get("user_guid"),data:b,dest:g},location.origin);return window.hasOwnProperty("sendToInterface")&&"function"===typeof window.sendToInterface?window.sendToInterface.apply(null,arguments):this.message_handler?this.message_handler.receiveFromTutor(b):commMessageHandler?commMessageHandler.processMessage(b):
this.interfaceMessages.push(b)};CTAT.ToolTutor.registerInterfaceMessageHandler=function(b){"string"===typeof b&&(b=document.getElementById(b));if(this.message_handler=b)for(;0<this.interfaceMessages.length;)this.sendToInterface(this.interfaceMessages.shift())};CTAT.ToolTutor.registerInterface=function(b){if(window.hasOwnProperty("registerInterface")&&"function"===typeof window.registerInterface)return window.registerInterface(b);this.registerInterfaceMessageHandler(b)};
CTAT.ToolTutor.sendToTutor=function(b){return window.hasOwnProperty("sendToTutor")&&"function"===typeof window.sendToTutor?window.sendToTutor(b):this.tutor?this.tutor.receiveFromInterface(b):this.tutorMessages.push(b)};
CTAT.ToolTutor.reboot=function(b,g,f,e){var c="undefined"!=typeof location&&location&&location.href?location.href:null;console.warn("ToolTutor.reboot( reason",b,"immediate",g,"initParams",f,"force",e,"): href",c);if(c&&(e||!CTATConfiguration.get("editorMode")&&!CTATConfiguration.get("post_tracer_output"))){try{f&&sessionStorage.setItem(CTATConfiguration.INIT_PARAMS,JSON.stringify(f))}catch(a){console.error("CTAT.ToolTutor.reboot() error storing initParams in sessionStorage",a)}g?location.replace(c):
setTimeout(location.replace.bind(location),600,c);return!0}return!1};var CTATLMS={identifier:null,initLMSConnection:function(){},closeLMSConnection:function(){},setValue:function(b,g){},getValue:function(b){return null},saveProblemState:function(b){if(CTATConfiguration.get("restoreProblemUrl")&&CTATConfiguration.get("curriculum_service_url")){var g=[],f;for(f in b)g.push(f+"="+encodeURIComponent(b[f]));$.post(CTATConfiguration.get("curriculum_service_url"),g.join("&"),null,"application/x-www-form-urlencoded")}},getProblemState:function(b){CTATConfiguration.get("restoreProblemUrl")?
$.get(CTATConfiguration.get("restoreProblemUrl"),"",null,"text").done(function(g){b(g)}).fail(function(g,f,e){b(null);g=(new CTATTutorMessageBuilder).createErrorMessage("Load ProblemState Error",f+" "+e);CTAT.ToolTutor.sendToInterface(g,!0)}):b(null)},gradeStudent:function(b,g){},logEvent:function(b){},processProblemSummary:function(b){},visibilityChange:function(b){},exitTutor:null,makeCurriculumServiceUrl:function(b){return CTATConfiguration.get("curriculum_service_url").replace(/[/][0-9]*$/,"/"+
b)},getProblemSetName:function(){for(var b=1,g;g=CTATConfiguration.get("dataset_level_type"+b);++b)if(/^Problem ?Set$/i.test(g)){if(b=CTATConfiguration.get("dataset_level_name"+b))return b;break}return CTATConfiguration.get("problem_set")||"problem_set"},getDatasetLevelsName:function(b,g){for(var f="",e=1,c;c=CTATConfiguration.get("dataset_level_name"+e);++e)f+=(f&&"\t")+c;f+="\t"+(b||CTATConfiguration.get("problem_name"));return f+="\t"+(g||CTATConfiguration.get("problem_context"))},postProblemSummary:function(b){try{parent.postMessage({command:"ProblemSummary",
name:CTATLMS.getDatasetLevelsName(),problemSummary:b},location.origin)}catch(g){console.error("CTATLMS.postProblemSummary error from postMessage:",g)}},is:{},init:{}};
CTATLMS.init.StandAlone=function(){CTATLMS.identifier=null;CTATLMS.initLMSConnection=function(){};CTATLMS.closeLMSConnection=function(){};CTATLMS.commit=function(){};CTATLMS.setValue=function(){};CTATLMS.getValue=function(){return null};CTATLMS.logEvent=function(b){};CTATLMS.saveProblemState=function(){};CTATLMS.getProblemState=function(b){return b(null)};CTATLMS.gradeStudent=function(){};CTATLMS.processProblemSummary=function(){CTATLMS.postProblemSummary(ps)}};
CTATLMS.is.SCORM=function(){return window.location.search&&/[?&;]mode=SCORM/i.test(window.location.search)};
CTATLMS.init.SCORM=function(){var b=!1;CTATLMS.identifier="SCORM";CTATLMS.initLMSConnection=function(){if(!0!==b){window.parent.doLMSInitialize();var g=CTATLMS.getValue("cmi.core.lesson_status");CTATConfiguration.set("problem_state_status",g);"not attempted"==g&&CTATConfiguration.set("problem_state_status","incomplete");"passed"==g&&CTATConfiguration.set("problem_state_status","completed");"failed"==g&&CTATConfiguration.set("problem_state_status","incomplete");"browsed"==g&&CTATConfiguration.set("problem_state_status",
"incomplete");CTATLMS.setValue("cmi.core.lesson_status","incomplete");b=!0}};CTATLMS.commit=window.parent.doLMSCommit;CTATLMS.closeLMSConnection=window.parent.doLMSFinish;CTATLMS.setValue=window.parent.doLMSSetValue;CTATLMS.getValue=window.parent.doLMSGetValue;CTATLMS.logEvent=function(b){};CTATLMS.saveProblemState=function(b){return CTATLMS.setValue("cmi.suspend_data",b.problem_state)};CTATLMS.getProblemState=function(b){var f=CTATLMS.getValue("cmi.suspend_data");if(!f&&window.parent&&"function"==
typeof window.parent.doLMSGetLastError){var e=window.parent.doLMSGetLastError();if(0!=e)return console.log("Empty result with error "+e+" from LMS.getValue('cmi.suspend_data'):",window.parent.doLMSGetErrorString?window.parent.doLMSGetErrorString(e):""),b(null)}return b(f)};CTATLMS.gradeStudent=function(b,f){CTATLMS.setValue("cmi.core.score.min",0);CTATLMS.setValue("cmi.core.score.max",100);return CTATLMS.setValue("cmi.core.score.raw",Number((b/f).toFixed(2).replace(/[.]/,"")))};CTATLMS.processProblemSummary=
function(b){b=b.getXMLObject();["cmi.core.lesson_status","cmi.core.score.raw","cmi.core.exit","cmi.core.session_time"].forEach(function(b){var e=this.getElementsByTagName(b);CTATLMS.setValue(b,$("<div>").html(e[0].innerHTML).text())},b);CTATLMS.commit();CTATLMS.closeLMSConnection()};CTATLMS.initLMSConnection()};CTATLMS.is.XBlock=function(){return window.location.search&&/[?&;]mode=XBlock/i.test(window.location.search)};
CTATLMS.init.XBlock=function(){var b=document.referrer?(new URL(document.referrer)).origin:"";CTATLMS.identifier="XBlock";CTATLMS.initLMSConnection=function(){};CTATLMS.closeLMSConnection=function(){};CTATLMS.commit=function(){};CTATLMS.setValue=function(b,f){};CTATLMS.getValue=function(b){return null};CTATLMS.saveProblemState=function(g){parent.postMessage({action:"save_problem_state",input:window.btoa(g.problem_state)},b)};CTATLMS.getProblemState=function(b){return b(window.atob(CTATConfiguration.get("saveandrestore")))};
CTATLMS.gradeStudent=function(g,f){parent.postMessage({action:"grade",input:{value:g,max:f}},b)};CTATLMS.logEvent=function(g){parent.postMessage({action:"log",input:g},b)};CTATLMS.processProblemSummary=function(b){}};CTATLMS.is.Authoring=function(){return window.location.search&&/[?&;]mode=AUTH(ORING)?/i.test(window.location.search)};CTATLMS.is.ToolsListener=function(){return window.location.search&&/[?&;]mode=ctatAsListener/i.test(window.location.search)};
CTATLMS.is.OLI=function(){return window.frameElement&&window.frameElement.getAttribute("data-superactivityserver")||"undefined"!=typeof CTATTarget&&"OLI"==CTATTarget};CTATLMS.is.TutorShop=function(){return window.frameElement&&/"LMS":\s*"TutorShop"/i.test(window.frameElement.getAttribute("data-params"))};
CTATLMS.init.TutorShop=function(){CTATLMS.identifier="TutorShop";CTATLMS.initLMSConnection=function(){};CTATLMS.closeLMSConnection=function(){};CTATLMS.commit=function(){};CTATLMS.setValue=function(b,g){};CTATLMS.getValue=function(b){return null};CTATLMS.logEvent=function(b){};CTATLMS.lastSaveTime=Date.now();CTATLMS.lastSave=Promise.resolve("CTATLMS.lastSaveTime "+Date(CTATLMS.lastSaveTime));CTATLMS.getProblemSetName=function(){for(var b=1,g;g=CTATConfiguration.get("dataset_level_type"+b);++b)if("ProblemSet"==
g)return CTATConfiguration.get("dataset_level_name"+b);return""};CTATLMS.saveProblemState=function(b,g,f){return CTATLMS.lastSave=CTATLMS.lastSave.then(function(e){if((g=g||CTATConfiguration.get("curriculum_service_url"))&&(f||CTATConfiguration.get("restoreProblemUrl"))){var c=CTATLMS.lastSaveTime;console.log("CTATLMS elapsed",(CTATLMS.lastSaveTime=Date.now())-c,"r: "+e+"; data",b);b.session_id=b.session_id?b.session_id:"dummySession";var a=new FormData,d;for(d in b)a.append(d,b[d]);return new Promise(function(c,
d){var b=new XMLHttpRequest;b.open("POST",g);b.onload=function(a){return 200==b.status?c(a):d(a)};b.send(a)})}return Promise.resolve("not saving: restoreProblemUrl or curriculum_service_url null")},function(b){var c=CTATLMS.lastSaveTime;console.log("CTATLMS error on lastSaveTime",Date(c),"e: "+b+";");CTATLMS.lastSaveTime=Date.now();return Promise.reject("CTATLMS error on lastSaveTime "+Date(c)+": "+(b&&b.toString()))})};CTATLMS.getProblemState=function(b){CTATConfiguration.get("restoreProblemUrl")?
$.get(CTATConfiguration.get("restoreProblemUrl"),"",null,"text").done(function(g){b(g)}).fail(function(g,f,e){b(null);g=(new CTATTutorMessageBuilder).createErrorMessage("Load ProblemState Error",f+" "+e);CTAT.ToolTutor.sendToInterface(g,!0)}):b(null)};CTATLMS.gradeStudent=function(){};CTATLMS.processProblemSummary=function(b){b=b.getXMLObject().getElementsByTagName("ProblemSummaryJSON");CTATLMS.postProblemSummary(b[0].textContent);b=CTATCurriculumService.formatProblemSummary(b[0].textContent);var g=
CTATConfiguration.get("curriculum_service_url");return CTATLMS.saveProblemState(b,g,"problemsummary")};CTATLMS.visibilityChange=function(b){"visibilitychange"==b.type&&"hidden"==document.visibilityState&&CTATCurriculumService.sendProblemSummary(CTAT.ToolTutor.tutor.getProblemSummary(),!0)};CTATLMS.exitTutor=function(b){try{console.log("CTATLMS.exitTutor",typeof this,b),b&&parent.document.getElementsByTagName("body")[0].setAttribute("data-tutors-confirm-exit-value","false"),parent.document.getElementById("close").click()}catch(g){(console.trace||
console.log)("Error calling close():",g)}}};CTATLMS.is.Assistments=function(){return CTATTarget&&"ASSISTMENTS"==CTATTarget};var evt=new Event("ctatlms");try{parent.dispatchEvent(evt),console.log('CTATLMS.js return from dispatchEvent("ctatlms") evt',evt)}catch(b){console.log("CTATLMS.js error on parent.dispatchEvent",b)};var CTATProblemSet=function(b,g){CTATBase.call(this,"CTATProblemSet","problemset");g=g||new CTATXML;var f=this;this.log=(new CTATLogger("problemset")).log;var e=[];this.makeSelectionCmd=function(c,a,d){var b={sequential:f.nextSequential,random:f.nextRandom},e=/external|remote/i.test(c)?a.getElementAttr(d,"selection_command"):"";return e?/^http/i.test(e)?Promise.resolve(f.remoteSelection.bind(this,e)):fetch(e).then(function(a){f.log("problemset","makeSelectionCmd resp",a);if(!a.ok)throw Error("bad fetch Response {ok: "+
a.ok+", status: "+a.status+", statusText: "+a.statusText+", url: "+a.url+"}");return a.text()}).then(function(a){f.log("problemset","makeSelectionCmd extFnTxt.length, [0,80)",a.length,a.substring(0,80));var c=a.split("\n");c.map(function(a,c){return/^[^a-zA-Z0-9_]*export(s\s*[.]\s*[a-zA-Z0-9_]+)?[^a-zA-Z0-9_]/.test(a)&&c||-1}).filter(function(a,c){return 0<=a}).forEach(function(a,d){if(/[^a-zA-Z0-9_]?exports *[.]/.test(c[a]))c[a]=c[a].replace(/([^a-zA-Z0-9_]?)exports *[.]/,"$1");else if(/[^a-zA-Z0-9_]?export( +default)?[^a-zA-Z0-9_]?/.test(c[a]))c[a]=
c[a].replace(/([^a-zA-Z0-9_]?)export +(default)?([^a-zA-Z0-9_]?)/,"$1 $2");else throw Error("CTATProblemSet: cannot edit export in line "+a+" of "+e+":\n"+c[a]);});a=c.join("\n");(0,eval)(a);if("function"!=typeof selectProblem)throw Error("makeSelectionCmd: selectProblem not found in external selection algorithm "+e);return selectProblem}).catch(function(a){console.error("CTATProblemSet.makeSelectionCmd: error importing selection_command "+e,a);return null}):Promise.resolve(b[c]||null)};this.addProblem=
function(c,a){null==a||isNaN(Number(a))?e.push({problem:c,completion_status:"empty"}):e[Number(a)]={problem:c,problem_context:Number(a),completion_status:"empty"};f.ctatdebug("addProblem("+c+", "+a+") new length "+e.length)};this.updateProblemFromProblemSummary=function(c,a){a&&/^complete/i.test(c.completion_status)&&a.setCompletedCount(a.getCompletedCount()+1);if(a=e[c.problem_context])a.completion_status=c.completion_status;else throw Error("CTATProblemSet.updateProblemFromProblemSummary problem_context "+
c.problem_context+" matches no position");};this.getProblemDescriptors=function(){return e};this.getProblemSize=function(){return e.length};this.getNextProblem=function(c,a,d){f.log("problemset","getNextProblem("+c+") problems.length "+e.length);return"function"==typeof f.selectionFunction?f.selectionFunction(c,a):f.nextSequential()};this.nextSequential=function(){f.log("problemset","nextSequential problems",e);var c=e.findIndex(function(a,c){return a&&a.problem&&!/sequencer/i.test(a.problem.getName())&&
!/^complete/i.test(a.completion_status)});return 0<=c?Promise.resolve({problem:e[c].problem,position:e[c].problem_context}):Promise.resolve({problem:null,position:null})};this.remoteSelection=function(c,a){return fetch(c,{method:"POST",mode:"cors",body:a,headers:{"Content-Type":"application/json",Accept:"application/json"}}).then(function(a){return a.json()}).catch(function(a){console.error("CTATProblemSet.remoteSelection error",a);return null})};this.getOldestCachedUnsent=function(){for(var c=[],
a=1;a<e.length;++a){var d=localStorage.getItem(CTATLMS.getDatasetLevelsName(a));d&&!JSON.parse(d).replaced_time&&c.push({psJson:d,pos:a})}c.sort(function(a,c){a=JSON.parse(a.psJson);c=JSON.parse(c.psJson);if(a.time)return c.time?(a=(new Date(a.time)).getTime(),c=(new Date(c.time)).getTime(),a<c?-1:c<a?1:0):-1;if(c.time)return 1});return c[0]||null};f.setName(g.getElementAttr(b,"name"));f.label=g.getElementAttr(b,"label")||f.getName();f.description=g.getElementAttr(b,"description")||f.getName();f.status=
g.getElementAttr(b,"status")||"active";f.selectionAlgorithm=g.getElementAttr(b,"selection_algorithm")||"sequential";f.makeSelectionCmd(f.selectionAlgorithm,g,b).then(function(c){return f.selectionFunction=c||f.nextSequential})};
CTATProblemSet.isFullCachedPS=function(b){var g=null;try{return g=localStorage.getItem(b),pointer.log("problemset","isFullCachedPS psJson[1st80] "+g.substring(0,80)),void 0==JSON.parse(g).replaced_time}catch(f){return console.error("error parsing cached problem summary at",b,g),null}};
CTATProblemSet.replaceCachedPS=function(b){b=CTATLMS.getDatasetLevelsName(b);var g=null;try{var f=JSON.parse(g=localStorage.getItem(b));pointer.log("problemset","replaceCachedPS psJson[1st80] "+g.substring(0,80));/^complete/i.test(f.completion_status)&&(f.replaced_time=new Date,localStorage.setItem(b,g=JSON.stringify(f)));return g}catch(e){return console.error("error parsing cached problem summary at",b,g),null}};CTATProblemSet.prototype=Object.create(CTATBase.prototype);
CTATProblemSet.prototype.constructor=CTATProblemSet;var CTATPackage=function(){CTATBase.call(this,"CTATPackage","packagemanager");var b=this,g=new CTATXML,f="",e="",c="",a=new Map,d=[],h=new Map,l=new Map;this.serviceWorker=this.serviceWorkerRegistration=null;this.init=function(a){b.ctatdebug("init ()");if(null==a)b.ctatdebug("Error: document root to be parsed is null.");else{var d=g.getElementName(a);b.ctatdebug("Root name: "+d);if(!/Package/i.test(d))return a=f.substring(f.lastIndexOf("/")+1),b.addProblem(f,c,a,a,a,1);a=g.getElementChildren(a);for(d=
0;d<a.length;d++){var e=a[d],h=g.getElementName(e);b.ctatdebug("Examining element: "+g.getElementName(e));switch(h){case "Problems":b.processProblemsElement(e);break;case "ProblemSets":b.processProblemSetsElement(e);break;case "Assets":l=b.processAssetsElement(e,l),b.initServiceWorker(l)}}}};this.initServiceWorker=function(a){return navigator.serviceWorker&&window.packageServiceWorkerUrl?fetch(window.packageServiceWorkerUrl,{method:"HEAD"}).then(function(a){console.log("r",a);return a.ok},function(a){console.error("e",
a);return!1}).then(function(c){console.log("found",c);return c?b.startServiceWorker(a):Promise.reject(null)},function(a){console.log("e2",a);return Promise.reject(null)}):Promise.reject(null)};this.startServiceWorker=function(a){navigator.serviceWorker.register(window.packageServiceWorkerUrl).then(function(a){console.log("reg",a);b.serviceWorkerRegistration=a;return new Promise(function(c){return a.onupdatefound=c})},function(a){console.trace("err",a);return null}).then(function(a){console.log("updatefound",
a,b.serviceWorkerRegistration);return b.serviceWorkerRegistration.installing}).then(function(a){console.log("sw",a);var c=new MessageChannel;c.port1.onmessage=function(a){return console.log("CTATPackage received from sw channel:",a)};a.postMessage({command:"assetPaths",assetPaths:Array.from(l.values()).filter(function(a){return/[\/]/.test(a)})},[c.port2]);return b.serviceWorker=a})};this.processProblemsElement=function(a){a=g.getElementChildren(a);b.ctatdebug("CTATPackage.processProblemsElement ... nChildren="+
a.length);for(var c=[],d=0;d<a.length;d++){var e=a[d],f=g.getElementAttr(e,"model_file"),h=g.getElementAttr(e,"student_interface"),l=g.getElementAttr(e,"name"),n=g.getElementAttr(e,"label"),z=g.getElementAttr(e,"description");b.ctatdebug("Problem ["+d+"] desc: "+z+", ui: "+h+", brd: "+f);f=b.addProblem(f,h,l,n,z,d+1);f.setTutorFlag(g.getElementAttr(e,"tutor_flag"));e=g.getElementChildren(e);for(h=0;h<e.length;h++)if("Skills"==g.getElementName(e[h]))for(l=g.getElementChildren(e[h]),n=0;n<l.length;n++){var z=
l[n],C=0;f.addSkillOpps({name:g.getElementAttr(z,"name"),category:g.getElementAttr(z,"category"),opportunities:Number.isNaN(C=Number.parseInt(g.getElementAttr(z,"occurrences")),10)?0:C})}c.push(f)}console.log("CTATPackage.processProblemsElement result",c);return c};this.processProblemSetsElement=function(c){c=g.getElementChildren(c);b.ctatdebug("CTATPackage.processProblemSetsElement ... nChildren="+c.length);for(var d=0;d<c.length;d++){for(var e=new CTATProblemSet(c[d],g),f=0,l=g.getElementChildren(c[d]);f<
l.length;++f)if("Problems"==g.getElementName(l[f])){for(var n=0,f=g.getElementChildren(l[f]);n<f.length;++n)e.addProblem(a.get(g.getElementAttr(f[n],"name")),g.getElementAttr(f[n],"position"));break}h.set(e.getName(),e)}};this.processAssetsElement=function(a,c){a=g.getElementChildren(a);b.ctatdebug("CTATPackage.processAssetsElement ... nChildren="+a.length);for(var d=0;d<a.length;d++){var e=a[d],f="";"Asset"==g.getElementName(e)&&"undefined"!=(f=g.getElementAttr(e,"name"))&&null!=f&&(e=g.getElementAttr(e,
"path"),c.set(f,("undefined"!=e&&null!=e&&""!=e?e+"/":"")+f))}return c};this.addProblem=function(c,e,f,h,l,g){var n=new CTATProblem;n.setProblemFile(c);n.setStudentInterface(e);n.setName(f?f:c);n.setLabel(h?h:c);n.setDescription(l?l:c);n.setProblemContext(g);b.ctatdebug("Adding problem ...");a.set(n.getName(),n);d.push(n);return n};this.getRelativePath=function(a,c){return c?CTATPackage.makeRelativePath(l.get(a),l.get(c)):l.get(a)};this.getAssetPaths=function(){return l};this.setURLPrefix=function(a){e=
a};this.getURLPrefix=function(){return e};this.setPackageURL=function(a){f=a};this.getPackageURL=function(){return f};this.setDefaultStudentInterface=function(a){c=a};this.getDefaultStudentInterface=function(){return c};this.getProblem=function(c){return a.get(c)||null};this.getProblemList=function(){return d};this.getProblemSets=function(){return h}};CTATPackage.prototype=Object.create(CTATBase.prototype);CTATPackage.prototype.constructor=CTATPackage;
CTATPackage.makeRelativePath=function(b,g){if(!g)return b;if(!b)return g;b=String(b).split("/");g=String(g).split("/");for(var f=0,e=0,c="";f<b.length&&e<g.length&&b[f]==g[e];)e=++f;for(;f++<b.length-1;)c+="../";for(;e<g.length-1;)c=c+g[e++]+"/";return c+g[e]};var CTATConnectionBase=function(b,g){CTATBase.call(this,"CTATConnectionBase","ctatconnection");var f=-1,e="",c="http";this.setURL=function(a){e=a};this.getURL=function(){return e};this.setID=function(a){f=a};this.getID=function(){return f};this.setSocketType=function(a){c=a};this.getSocketType=function(){return c}};CTATConnectionBase.prototype=Object.create(CTATBase.prototype);CTATConnectionBase.prototype.constructor=CTATConnectionBase;var CTATConnection=function(b){function g(){d.ctatdebug("init ()");var a=flashVars?flashVars.getRawFlashVars():f?f:{},a=a.session_id?a.session_id:"dummySession";if(null!==e){"dummySession"==a&&d.ctatdebug("Unable to find CTAT session information from environment, trying OLI ...");try{e.setRequestHeader("Content-type",c.contentType),e.setRequestHeader("ctatsession",a)}catch(n){alert("HTTP object creation error: "+n.message)}}else"undefined"==typeof $?alert("Internal error: http object is null right after creation"):
c.headers.ctatsession=a;d.ctatdebug("init () done")}CTATConnectionBase.call(this,"CTATConnection");var f=b,e=null,c={contentType:"text/plain",data:null,processData:!1,method:"POST",mimeType:"text/html",headers:{}},a=!1,d=this,h=null;d.setSocketType("http");this.setContentType=function(a){c.contentType=a};this.getContentType=function(){return c.contentType};this.setConsumed=function(c){a=c;d.ctatdebug("consumed: "+a)};this.getConsumed=function(){d.ctatdebug("consumed: "+a);return a};this.assignReceiveFunction=
function(a){h=a;e&&"undefined"!=typeof e.onreadystatechange&&(e.onreadystatechange=a)};this.assignFailFunction=function(a){c.error=a;e&&"function"==typeof e.error&&e.error(a)};this.setData=function(a){c.data=a};this.getData=function(){return c.data};this.getHTTPObject=function(){return e};this.getMethod=function(){return c.method};this.setMethod=function(a){c.method=a};this.send=function(){d.ctatdebug("send ()");var a=d.getHTTPObject(),b=function(){d.ctatdebug("Networking error!")};a&&(a.onerror=
b);try{a&&a.open(d.getMethod(),d.getURL(),!0)}catch(p){d.ctatdebug("Error in newConnection.httpObject.open: "+p.message);return}g();try{"undefined"!=typeof $?e=a=$.ajax(d.getURL(),c).done(h).fail(b):c.data?a.send(c.data):a.send()}catch(p){this.ctatdebug("Error in newConnection.httpObject.send: "+p.message)}};this.then=function(a,c){var b=e&&"function"==typeof e.then;d.ctatdebug("CTATConnection.then() supported "+b+", done & fail:\n  "+a+",\n  "+c);return b?e.then(a,c):Promise.resolve("CTATConnection.then() not supported").then(a,
c)};d.ctatdebug("createHTTPObject ()");e=new XMLHttpRequest;if("undefined"!=typeof $)e=null;else if(window.XMLHttpRequest)d.ctatdebug("Creating regular XMLHttpRequest ..."),e=new XMLHttpRequest,e.overrideMimeType&&e.overrideMimeType("text/html");else if(d.ctatdebug("Trying alternative HTTP object creation ..."),window.ActiveXObject){d.ctatdebug("Detected window.ActiveXObject ...");try{d.ctatdebug("Creating Msxml2.XMLHTTP ..."),e=new ActiveXObject("Msxml2.XMLHTTP")}catch(l){try{d.ctatdebug("Creating Microsoft.XMLHTTP ..."),
e=new ActiveXObject("Microsoft.XMLHTTP")}catch(n){alert("Error: Unable to create HTTP Request Object: "+n.message)}}}else alert("Internal error: an HTTP connection object could not be created")};CTATConnection.prototype=Object.create(CTATConnectionBase.prototype);CTATConnection.prototype.constructor=CTATConnection;var CTATWSConnection=function(b){CTATConnectionBase.call(this,"CTATWSConnection");var g="",f=!1,e=this,c=null,a=[],d=!1,h=0,l=0,n=null,p=null;e.setSocketType("ws");this.setConsumed=function(a){f=a;e.ctatdebug("consumed: "+f)};this.getConsumed=function(){e.ctatdebug("consumed: "+f);return f};this.assignReceiveFunction=function(a){n=a};this.assignCloseFunction=function(a){p=a};this.setData=function(a){g=a};this.getData=function(){return g};this.init=function(){ctatdebug("init ("+e.getURL()+"); websocket "+
c);null==c&&(c=new WebSocket(e.getURL()),c.addEventListener("open",function(b){ctatdebug("STATUS: open");d=!0;ctatdebug("Connection open, flushing outgoing queue ...");h=(new Date).getTime();if(0<a.length){for(b=0;b<a.length;b++)c.send(a[b]);a=[]}}),c.addEventListener("message",function(a){l=(new Date).getTime();ctatdebug("STATUS: message after "+(l-h)+" ms");ctatdebug("Received: "+a.data);n?n(a.data):ctatdebug("Error: no processing function provided")}),c.addEventListener("close",function(a){ctatdebug("STATUS: close; "+
(a?"code "+a.code+", reason "+a.reason:"no event"));d=!1;c.close(1E3,a?a.reason?a.reason:"received close code "+a.code:"no close event received");p&&p(a)}),c.addEventListener("error",function(a){ctatdebug("STATUS: error; "+(a?a.type:"no event"));d=!1;c.close(1E3,"client closing in response to error")}),ctatdebug("init () done"))};this.send=function(){ctatdebug("send ()");e.init();!1===d?(ctatdebug("Connection not ready yet, storing ..."),a.push(g)):(ctatdebug("Connection ready, sending data ..."),
h=(new Date).getTime(),c.send(g))};this.getWebSocket=function(){return c};this.close=function(a,b){d=!1;p=b||p;c.close(1E3,a||"no reason")}};CTATWSConnection.prototype=Object.create(CTATConnectionBase.prototype);CTATWSConnection.prototype.constructor=CTATWSConnection;var CTATCanvasComponent=function(b){var g=this,f=[];this.addShape=function(b){f.push(b)};this.hideShape=function(b){for(var c=0;c<f.length;c++)if(f[c].getName()==b){f[c].modifyCanvasCSS("visibility","hidden");break}};this.showShape=function(b){for(var c=0;c<f.length;c++)if(f[c].getName()==b){f[c].modifyCanvasCSS("visibility","visible");break}};this.hideComponent=function(){for(var b=0;b<f.length;b++)f[b].modifyCanvasCSS("visibility","hidden")};this.showComponent=function(){for(var b=0;b<f.length;b++)f[b].modifyCanvasCSS("visibility",
"visible")};this.moveShape=function(b,c,a){for(var d=0;d<f.length;d++)if(f[d].getName()==b){f[d].modifyCanvasCSS("left",c+"px");f[d].modifyCanvasCSS("top",a+"px");break}};this.moveComponent=function(b,c){for(var a=0;a<f.length;a++)f[a].modifyCanvasCSS("left",b+"px"),f[a].modifyCanvasCSS("top",c+"px")};this.removeShape=function(b){for(var c=0,a=0;a<f.length;a++)if(f[a].getName()==b){c=a;break}f[c].detatchCanvas();f.splice(c,1)};this.removeComponent=function(){for(;0<f.length;)g.removeShape(f[0].getName())}};var scrimIsUp=!1,errorScrim=!1,waitScrim=!0,warnScrim=!1,connectionScrim=!1,authorTimeSet=!0,inAuthorTime=!0,CTATScrim=function(){function b(){warnScrim=!1;w.scrimDown()}function g(a){"google"!=CTATConfig.platform&&(!0===scrimIsUp&&w.scrimDownForced(),w.ctatdebug("errScrimUp ("+a+")"),!0===errorScrim?!0===d&&(d=!1,getSafeElementById(ctatcontainer).removeChild(v)):!0===warnScrim&&(d=!0),w.scrimUp(a))}function f(a,c){w.ctatdebug("makeHTMLButton ()");var d=document.createElement("input");d.type="button";
d.value=c;a?(w.ctatdebug("clickHandle!=null"),d.onclick=a):(w.ctatdebug("clickHandle==null"),d.onclick=w.defaultClickHandler);d.id=c;d.setAttribute("class","scrimButton");return d}CTATBase.call(this,"CTATScrim","__undefined__");var e="",c=!1,a=!1,d=!1,h=null,l=null,n=new CTATCanvasComponent("CTAT Scrim"),p=[],q=null,u=null,v=null,y=null,w=this;this.scrimUp=function(g,p){if("google"!=CTATConfig.platform){w.ctatdebug("scrimUp ("+g+", "+p+")");if(p)return setTimeout(w.scrimUp.bind(w,g),p);g=CTATGlobals.languageManager.filterString(g);
w.ctatdebug("Message: "+g);!0===scrimIsUp?(e=!0===waitScrim?g:e+(" \n "+g),n.removeComponent(),w.removeHTMLElements()):(e=g,scrimIsUp=!0);w.ctatdebug("scrimUp() to call drawScrim() scrimIsUp "+scrimIsUp);w.ctatdebug("drawScrim ()");if("google"==CTATConfig.platform)w.ctatdebug("This is not available for now when we're in this environment");else if($('<div id="scrim" class="ctatpageoverlay"></div>').appendTo("body"),$("#scrim").css("z-index",1E3),"google"!=CTATConfig.platform&&($("#scrimpanel").empty(),
$("#scrim").append('<div class="css3-windows-7"><div class="fenster"><h4 class="titel">CTAT Info Panel</h4><div id="scrimpanel" class="inhalt"><br>'+e+"<br><br></div></div></div>"),!0===d&&(waitScrim=!1,v=f(b,"close"),$(v).appendTo("#scrimpanel")),!0===c&&(waitScrim=!1,q=f(h,"yes"),$(q).appendTo("#scrimpanel"),c=!1),!0===a&&(waitScrim=!1,u=f(l,"no"),$(u).appendTo("#scrimpanel"),a=!1),!0===waitScrim)){w.ctatdebug("Adding spinner ...");$("#scrimpanel").append("<br>");g=$('<div id="scrim_spin">');g.css("width",
"100%");g.css("position","relative");$("#scrimpanel").append(g);try{var A=(new Spinner({className:"scrim_spinner"})).spin();$("#scrim_spin").append(A.el)}catch(D){(D instanceof ReferenceError||D instanceof TypeError)&&w.ctatdebug('Spinner is not available, please include it in the build or add <script src="node_modules/spin.js/spin.min.js">\x3c/script> to the html file.',D,typeof D)}}}};this.waitScrimUp=function(a){w.ctatdebug("waitScrimUp () CTATConfig.platform "+CTATConfig.platform+", scrimIsUp "+
scrimIsUp);"google"!=CTATConfig.platform&&(!0===scrimIsUp&&w.scrimDownForced(),waitScrim=!0,w.scrimUp(CTATGlobals.languageManager.filterString(a||"LOADING")),w.ctatdebug("return from waitScrimUp(): scrimIsUp "+scrimIsUp))};this.nextProblemScrimUp=function(){"google"!=CTATConfig.platform&&(!0===scrimIsUp&&w.scrimDownForced(),w.ctatdebug("nextProblemScrimUp ()"),w.scrimUp(CTATGlobals.languageManager.getString("NEXTPROBLEM")))};this.OKScrimUp=function(b,e){"google"!=CTATConfig.platform&&(!0===scrimIsUp&&
w.scrimDownForced(),w.ctatdebug("OKScrimUp ("+b+","+e+")"),waitScrim=a=c=d=warnScrim=errorScrim=!1,w.scrimUp(b),y=f(e,"OK"),$(y).appendTo("#scrimpanel"))};this.confirmScrimUp=function(d,b,e){"google"!=CTATConfig.platform&&(!0===scrimIsUp&&w.scrimDownForced(),w.ctatdebug("confirmScrimUp ("+d+","+b+","+e+")"),a=c=!0,l=e,h=b,w.scrimUp(d))};this.errorScrimUp=function(a){"google"!=CTATConfig.platform&&(!0===scrimIsUp&&w.scrimDownForced(),!1===authorTimeSet?(w.ctatdebug("we don't know if we're in authorTime or not yet so we're just going to hold onto the messasge"),
p.push("ERROR: "+a),errorScrim=!0):!1===inAuthorTime?w.ctatdebug("We're not in authorTime, student's don't need to see our design mistakes"):(errorScrim=!0,g("ERROR: "+a)))};this.warningScrimUp=function(a){"google"!=CTATConfig.platform&&(!0===scrimIsUp&&w.scrimDownForced(),!1===authorTimeSet?(w.ctatdebug("we don't know if we're in authorTime or not yet so we're just going to hold onto the messasge"),p.push("WARNING: "+a),warnScrim=!0):!1===inAuthorTime?w.ctatdebug("We're not in authorTime, student's don't need to see our design mistakes"):
(warnScrim=!0,g("WARNING: "+a)))};this.handleTSDisconnect=function(){connectionScrim=!0;w.scrimUp(CTATGlobals.languageManager.getString("TUTORDISCONNECTED"))};this.removeHTMLElements=function(){};this.scrimDown=function(){"google"!=CTATConfig.platform&&(!1===scrimIsUp?w.ctatdebug("The scrim isn't up, returning"):!0===errorScrim?w.ctatdebug("The scrim is up to describe errors to the user, leave it up!"):!0===warnScrim?w.ctatdebug("The scrim is up to display warnings to the user, leave it up!"):!0===
connectionScrim?w.ctatdebug("The scrim is up for a connection issue leave it up!"):w.scrimDownForced())};this.scrimDownForced=function(){w.ctatdebug("enter scrimDownForced() scrimIsUp "+scrimIsUp);$("#scrim").remove();n.removeComponent();w.removeHTMLElements();waitScrim=scrimIsUp=!1;e="";w.ctatdebug("exit scrimDownForced() scrimIsUp "+scrimIsUp)};this.defaultClickHandler=function(){w.ctatdebug("defaultClickHandler ()");w.scrimDown()};this.setInAuthorTime=function(a){w.ctatdebug("setting inAuthorTime = "+
a);authorTimeSet=!0;inAuthorTime=a;if(!a)warnScrim=errorScrim=!1,d&&null.removeChild(v);else if(errorScrim||warnScrim)for(var c in p)g(c)};this.getInAuthorTime=function(){return inAuthorTime}};CTATScrim.prototype=Object.create(CTATBase.prototype);CTATScrim.prototype.constructor=CTATScrim;CTATGlobals.languageManager=CTATLanguageManager.theSingleton;CTATScrim.scrim=new CTATScrim;var bundleFormatter="",inBundle=!1,useBundling=!1,useOLIEncoding=!1,CTATCommLibrary=function(b,g){CTATBase.call(this,"CTATCommLibrary",b);var f=authenticityToken="",e=0,c=[],a=null,d=b?b:null,h=null==g?!0:g,l=!0,n=null,p=this,q="http",u="ERROR_CONN_TS",v="",y=0;this.teamMembers={};this.lastTeamMembers={};this.log=(this.logger=new CTATLogger(["commlibrary","collaborate"])).log;this.logger.set("collaborate");this.setUseCommSettings=function(a){l=a};this.getUseCommSettings=function(){return l};this.setConnectionRefusedMessage=
function(a){u=a};this.sendTutorReady=function(a){a=a||p.teamMembers;var c=CTATConfiguration.get("collaborators")||"",d=CTATConfiguration.get("user_guid"),b=CTATCommShell.commShell.getGotProblemRestoreEnd();p.log("collaborate","sendTutorReady collaborators",c,"otm",a,"teamMembers",p.teamMembers,"gotProblemRestoreEnd",b);if(b){if(b=p.teamMembers[d]||{},!b.subscribed||0>b.subscribed)b.username=d,b.subscribed=Date.now(),p.teamMembers[d]=b}else return a;var d=0,e;for(e in p.teamMembers)p.teamMembers[e].subscribed!=
(p.lastTeamMembers[e]&&p.lastTeamMembers[e].subscribed)&&++d;p.log("collaborate","sendTutorReady diff count for duplicate check",d);if(!(1>d)){e={command:"tutorready",id:CTATCommLibrary.makeTeamID(),username:CTATConfiguration.get("user_guid"),display_name:CTATConfiguration.get("display_name")||CTATConfiguration.get("user_guid"),teamMembers:p.lastTeamMembers=p.teamMembers};if(!CTATConfiguration.get("editorMode")){p.log("commlibrary","sending tutorready to parent",e);window.parent.postMessage(e,location.origin);
try{parent.parent!==parent&&(p.log("commlibrary","sending tutorready to parent.parent",e),window.parent.parent.postMessage(e,parent.parent.location.origin))}catch(F){console.log("Error trying access to parent.parent",F)}}p.allEssentialPresent()?CTATScrim.scrim.scrimDownForced():(c=c.split(/,/).filter(function(a){return CTATCommLibrary.teamMemberEssential(a)&&(!p.teamMembers[a]||0>p.teamMembers[a].subscribed)}),CTATScrim.scrim.waitScrimUp("Waiting for "+c.join(", ")+" to join"));return a}};this.isPresent=
function(a){return p.teamMembers[a]&&0<p.teamMembers[a].subscribed};this.allEssentialPresent=function(){var a=CTATConfiguration.get("collaborators"),a=a&&a.split(/,/)||[];return 1>a.length||a.every(function(a){return a&&(!CTATCommLibrary.teamMemberEssential(a)||p.teamMembers[a]&&0<p.teamMembers[a].subscribed)})||CTATConfiguration.get("instructor_mode")&&a.every(function(a){return!a||!p.teamMembers[a]||0>p.teamMembers[a].subscribed})};this.interpretCollab=function(a){p.log("collaborate","Interpret collab:",
a.command,a);var c=null,d=CTATConfiguration.get("user_guid");if("tutorready"==a.command&&a.username!=d){var b=CTATConfiguration.get("collaborators"),e="";p.log("collaborate","interpretCollab",b,"teamMembers",p.teamMembers,p.tutorbeginListener);if(CTATConfiguration.get("instructor_mode")&&CTATCommLibrary.teamMemberEssential(a.username)&&p.tutorbeginListener){p.tutorbeginListener(a);return}if(CTATConfiguration.get("instructor_mode")&&p.teamMembers[d]&&0<p.teamMembers[d].subscribed&&(!p.teamMembers[a.username]||
0>p.teamMembers[a.username].subscribed)&&CTATCommLibrary.teamMemberEssential(a.username)){a=CTATGlobals.languageManager.filterString("YOUR_STUDENT")+(a.display_name||a.from)+" ";"function"==typeof CTATLMS.exitTutor?(a+=CTATGlobals.languageManager.filterString("EXIT_BECAUSE_COACHED_STUDENT_JOINED_OK"),p.log("collaborate","OKScrimUp("+a+")",new Date,CTATLMS.exitTutor),CTATScrim.scrim.OKScrimUp(a,CTATLMS.exitTutor.bind(this,"force"))):(a+=CTATGlobals.languageManager.filterString("EXIT_BECAUSE_COACHED_STUDENT_JOINED_X"),
p.log("collaborate","scrimUp("+a+")",new Date,typeof CTATLMS.exitTutor),CTATScrim.scrim.scrimUp(a,y));return}for(e in a.teamMembers||{})b=a.teamMembers[e],e!=d&&(p.teamMembers[e]=b),0>b.subscribed&&p.log("collaborate","collaborator quit:",b,new Date);p.sendTutorReady(p.teamMembers);document.dispatchEvent(new CustomEvent("teamchange",{detail:p.teamMembers}))}else"tutordone"==a.command?(p.log("collaborate","tutordone listener calling tutordoneListener"),p.tutordoneListener&&p.tutordoneListener(a)):
"message"==a.command?a.from!=d?c=a.data:ctatdebug("Own message echoed: "+a.data):"unsubscribed"==a.command?(e=p.teamMembers[a.from]||(p.teamMembers[a.from]={}),e.username=a.from,e.subscribed=-1,e=CTATGlobals.languageManager.filterString("YOUR_COLLABORATOR")+(a.display_name||a.from||"")+" ",a.from==d?p.log("collaborate","interpretCollab: own unsubscribe received",a):CTATCommLibrary.teamMemberEssential(a.from)?"function"==typeof CTATLMS.exitTutor?(d=e+CTATGlobals.languageManager.filterString("COLLABORATOR_QUIT_CLICK_OK"),
p.log("collaborate","OKScrimUp("+d+")",new Date,CTATLMS.exitTutor),CTATScrim.scrim.OKScrimUp(d,CTATLMS.exitTutor.bind(this,"force"))):(d=e+CTATGlobals.languageManager.filterString("COLLABORATOR_QUIT_CLICK_X"),p.log("collaborate","scrimUp("+d+")",new Date,typeof CTATLMS.exitTutor),CTATScrim.scrim.scrimUp(d,y)):p.log("collaborate","interpretCollab: optional member unsubscribed",a),document.dispatchEvent(new CustomEvent("teamchange",{detail:p.teamMembers}))):"subscribed"==a.command?a.team_members?(p.log("collaborate",
"subscribed from "+a.from+": teamMembers",p.teamMembers,"data.team_members",a.team_members,"allEssentialPresent()",p.allEssentialPresent()),(!CTATConfiguration.get("instructor_mode")||p.allEssentialPresent())&&p.commReady&&p.commReady.dispatchEvent(new CustomEvent("subscribed",{detail:a})),a.from!=d&&p.sendTutorReady(p.teamMembers)):console.err("collaborate","interpretCollab: subscribed with team_members property missing",a):"requestexit"==a.command&&(d=a.data,p.log("collaborate","OKscrimUp or scrimUp("+
d+")",new Date,typeof CTATLMS.exitTutor),"function"==typeof CTATLMS.exitTutor?CTATScrim.scrim.OKScrimUp(d,CTATLMS.exitTutor.bind(this,!1)):CTATScrim.scrim.scrimUp(d,y));"function"==typeof document.dispatchEvent&&document.dispatchEvent(new CustomEvent("receiveFromCollaborator",{detail:a}));return c};this.setSocketType=function(a){q=a;CTAT.ToolTutor.commReadyPromise=CTATLMS.is.TutorShop()?new Promise(function(a,c){(p.commReady=new EventTarget).addEventListener("subscribed",function(c){p.log("collaborate",
"commReady listener received",c,"\n calling resolve",a);a(c)});p.log("collaborate","commReadyPromise defined listener commReady",p.commReady)}):Promise.resolve("no channel needed");if(p.hasWebSocket()||p.hasPostMessage()||CTATConfiguration.get("post_tracer_output")||CTATLMS.is.TutorShop())p.log("commlibrary","setSocketType: connecting message listener",a),$(window).on("message",function(a){if(a.originalEvent.origin===window.location.origin&&(a=a.originalEvent?a.originalEvent.data:null,p.log("commlibrary",
"message from "+a.from+":",a),a))if(d){if(a=p.interpretCollab(a))d.processMessage(a),p.hasPostMessage()||CTAT.ToolTutor.sendToTutor(a)}else console.log("No http handler defined for websocket listener.")})};this.getSocketType=function(){return q};this.setScrimWait=function(a){y=a};this.hasSecureSocket=function(){return/https/i.test(q)||/wss/i.test(q)};this.hasJavaScriptConnection=function(){return/javascript/i.test(q)};this.hasWebSocket=function(){return/websocket/i.test(q)};this.hasPostMessage=function(){return/postmessage/i.test(q)};
this.assignHandler=function(a){d=a};this.assignMessageListener=function(a){n=a};this.encodeVariables=function(a){p.ctatdebug("encodeVariables ()");for(var c="",d=0;d<a.length;d++){var b=a[d];0<d&&(c+="&");c+=b.name;c+="=";c+=encodeURIComponent(b.value)}return c};this.encodeVariablesOLI=function(a){p.ctatdebug("encodeVariablesOLI ()");for(var c="",d=0;d<a.length;d++){var b=a[d];0<d&&(c+="&");c+=b.name;c+="=";c+=encodeURIComponent(b.value)}return c};this.createConnection=function(d,b,f){p.ctatdebug("createConnection () canBeWebSocket "+
f);f="undefined"==typeof f?!0:!1!==f;if(!b)return new CTATConnection(d);if(f&&p.hasWebSocket())return f=p.findWSConnection(b),f||(f=new CTATWSConnection(d),f.setID(e),f.setURL(b),f.assignReceiveFunction(p.processWSReply),f.assignCloseFunction(p.processWSClose),c.push(f),e++),f;f=new CTATConnection(d);f.setID(e);f.setURL(b);f.assignReceiveFunction(p.processReply);c.push(f);e++;return a=f};this.findWSConnection=function(a){ctatdebug("findWSConnection( "+a+" )");a=p.editSocketURLForHTTPS(a);for(var d=
0;d<c.length;d++){var b=c[d];ctatdebug("checking: socketType = "+b.getSocketType()+" URL = "+b.getURL());if("ws"==b.getSocketType()&&b.getURL()==a)return b}return null};this.startBundle=function(){p.ctatdebug("startBundle ()");!1===useBundling?p.ctatdebug("Not using bundling, bump"):(bundleFormatter='<?xml version="1.0" encoding="UTF-8"?><message><verb/><properties><MessageType>MessageBundle</MessageType><messages>',inBundle=!0)};this.endBundle=function(){p.ctatdebug("endBundle ()");!1===useBundling?
p.ctatdebug("Not using bundling, bump"):(inBundle=!1,bundleFormatter+="</messages></properties></message>",p.sendXML(bundleFormatter))};this.setFixedURL=function(a){f=a};this.getURL=function(){p.ctatdebug("getURL ()");if(""!==f)return p.ctatdebug("Returning fixedURL: "+f),f;var a=flashVars.getRawFlashVars(),c="http://";p.hasSecureSocket()&&(c="https://");c=c+a.remoteSocketURL+":"+a.remoteSocketPort;a.remoteSocketURL&&-1!=a.remoteSocketURL.indexOf("http")&&(c=a.remoteSocketURL+":"+a.remoteSocketPort);
return c};this.sendXML=function(a,c){p.ctatdebug("Sending: "+a);p.ctatdebug("sendXML ("+a+")");d.updateLastActionTimestamp&&d.updateLastActionTimestamp();if(!0===useBundling&&!0===inBundle)p.ctatdebug("Bundling ..."),bundleFormatter+=a;else{bundleFormatter=a;flashVars.getRawFlashVars();a=p.getURL();var b=bundleFormatter;-1==bundleFormatter.indexOf("<?xml")&&(b='<?xml version="1.0" encoding="UTF-8"?>'+bundleFormatter);p.getUseCommSettings()&&p.hasJavaScriptConnection()?(p.sendToToolsOrCollaborators(a,
b,c),CTATConfiguration.get("noLocalTrace")||CTAT.ToolTutor.sendToTutor(b)):p.send_post(a,b)}};this.sendToToolsOrCollaborators=function(a,c,d){return!p.hasWebSocket()||"ctatAsListener"!=CTATConfiguration.get("mode")&&"undefined"!=typeof d&&!1===d?!1:(p.send_post(a,c),!0)};this.sendXMLNoBundle=function(a){p.ctatdebug("sendXMLNoBundle ("+a+")");bundleFormatter=a;d.updateLastActionTimestamp&&d.updateLastActionTimestamp();var c=p.getURL(),b=a;-1==a.indexOf("<?xml")&&(b='<?xml version="1.0" encoding="UTF-8"?>'+
a);flashVars.getRawFlashVars();p.getUseCommSettings()&&p.hasJavaScriptConnection()?(p.sendToToolsOrCollaborators(c,b),CTAT.ToolTutor.sendToTutor(b)):p.send_post(c,b)};this.sendXMLURL=function(a,c,b){ctatdebug("sendXMLURL ("+c+", "+b+")");var e=a;-1==a.indexOf("<?xml")&&(e='<?xml version="1.0" encoding="UTF-8"?>'+a);flashVars.getRawFlashVars();p.ctatdebug("Sending: "+e);d.updateLastActionTimestamp&&d.updateLastActionTimestamp();p.getUseCommSettings()&&p.hasJavaScriptConnection()?(p.sendToToolsOrCollaborators(c,
e),b||CTAT.ToolTutor.sendToTutor(e)):p.send_post(c,e)};this.send_post_variables=function(a,c){p.ctatdebug("send_post_variables ("+a+")");flashVars.getRawFlashVars();c=!1===useOLIEncoding?p.encodeVariables(c):p.encodeVariablesOLI(c);this.ctatdebug("Sending: "+c);d.updateLastActionTimestamp&&d.updateLastActionTimestamp();if(!0===CTATGlobals.CommDisabled)return p.ctatdebug("Communications globally disabled, please check your settings"),Promise.reject("Communications globally disabled, please check your settings");
var b=p.createConnection(CTATConfiguration.getRawFlashVars(),a,!1);b.setContentType("application/x-www-form-urlencoded");p.ctatdebug("CTATCommLibrary.send_post_variables() data to send:\n  "+c);null!==n&&n.processOutgoing(c);b.setURL(a);b.setData(c);b.assignReceiveFunction(p.processReply);b.send();return b};this.formPostMessage=function(a){return{command:"message",id:CTATCommLibrary.makeTeamID(),user_guid:CTATConfiguration.get("user_guid"),data:a}};this.send_post=function(a,c){ctatdebug("send_post ("+
a+")");if(CTATConfiguration.get("editorMode")||!0===CTATGlobals.CommDisabled)p.ctatdebug("Communications globally disabled, please check your settings");else{ctatdebug("Outgoing on wire, "+(p.hasPostMessage()?"to post":"no post")+"; data "+c);var d=flashVars.getRawFlashVars(),b=a;if(p.hasPostMessage())c=p.formPostMessage(c),c.dest="sendToTutor",p.log("commlibrary","send_post haspostmessage sending sendToTutor to parent",c),window.parent.postMessage(c,location.origin);else{if(p.hasWebSocket()){if(CTATCommShell.commShell.hasTutorShopCable()){c=
p.formPostMessage(c);p.log("commlibrary","send_post hasWebSocket not sendToTutor to parent",c);window.parent.postMessage(c,location.origin);return}a&&(ctatdebug("opening websocket connection: url "+a),b=a.replace(/https?:/,"ws:"),b=p.editSocketURLForHTTPS(b),ctatdebug("opening websocket connection to "+b))}a=p.createConnection(d,b);a.setData(c);null!==n&&n.processOutgoing(c);a.send()}}};this.processReply=function(a,b,e){p.ctatdebug("processReply ("+c.length+","+a+", ...)");"undefined"==typeof e&&
"function"==typeof p.getHTTPObject&&p.getHTTPObject();b=0;a=[];var f;for(f=0;f<c.length;f++){var g=c[f];if(g&&"function"==typeof g.getHTTPObject){var l=g.getHTTPObject();p.ctatdebug("Testing connection entry["+f+"]: readyState & status: "+(l?l.readyState+" & "+l.status:"null")+", consumed: "+g.getConsumed());l&&(4==l.readyState&&!1===g.getConsumed()?(p.ctatdebug("Investigating request response: "+b+" -> "+l.status+", for: "+g.getURL()),e=!1,0===l.status&&(e=!0,p.ctatdebug("Received message (status 0): ("+
l.responseText+"), status: "+l.status),h&&CTATScrim.scrim.errorScrimUp(CTATGlobals.languageManager.filterString(u))),408==l.status&&(e=!0,p.ctatdebug("Received message (status 408): "+l.responseText),CTATScrim.scrim.scrimDown()),502==l.status&&(e=!0,p.ctatdebug("Received message (status 502): "+l.responseText),h&&CTATScrim.scrim.errorScrimUp(CTATGlobals.languageManager.filterString(ERROR_502))),200==l.status?(e=!0,p.ctatdebug("Processing 200 response ..."),null!==d?(a.push(l.responseText),null!==
n&&n.processIncoming(l.responseText)):p.ctatdebug("Error: httphandler is null, can't process response!")):d&&d.processError&&(e=!0,p.ctatdebug("Processing non-200 response, status "+l.status),d.processError(l.status,l.responseText)),!1===e&&p.ctatdebug("Error: status not handled for: "+l.status),p.ctatdebug("Marking connection as consumed ..."),g.setConsumed(!0)):(0===l.readyState&&p.ctatdebug("Received message (status 0, request not initialized)"),1===l.readyState&&p.ctatdebug("Received message (status 1, server connection established)"),
2===l.readyState&&p.ctatdebug("Received message (status 2, request received)"),3===l.readyState&&p.ctatdebug("Received message (status 3, processing request)")),b++)}}p.cleanup();for(b=0;b<a.length;b++)p.ctatdebug("Processing incoming message: "+b),e=a[b],-1!=e.indexOf("status=success")?p.ctatdebug("Info: logging success message received, not propagating to message handler"):d&&d.processMessage&&(p.ctatdebug("Processing incoming message: "+e),d.processMessage(e))};this.processWSReply=function(a){p.ctatdebug("processWSReply() length "+
(null===a?null:a.toString().length));"string"==typeof a&&(null!==n&&n.processIncoming(a),-1!=a.indexOf("status=success")?p.ctatdebug("processWSReply() logging success message received, not propagating to message handler: "+a):(p.ctatdebug("Processing incoming message: "+a),d.processMessage(a)))};this.processWSClose=function(a){p.ctatdebug("processWSClose("+a+")");a instanceof CloseEvent&&p.ctatdebug("CloseEvent: code "+a.code+", reason "+a.reason+", wasClean "+a.wasClean);CTATLMS.is.Authoring()||
CTATLMS.is.ToolsListener()?CTATScrim.scrim.scrimUp(CTATGlobals.languageManager.filterString("AUTHORPLEASECLOSE")):CTATScrim.scrim.handleTSDisconnect()};this.cleanup=function(){p.ctatdebug("cleanup ()");p.ctatdebug("checkEntries() httprequests.length "+c.length);for(var a=0,d=c.length-1;0<=d;d--){var b=c[d];if(b)if(!0===b.getConsumed())p.ctatdebug("checkEntries() removing["+d+"] ID: "+b.getID()),c.splice(d,1),a++;else if("function"==typeof b.getHTTPObject){var e=b.getHTTPObject();p.ctatdebug("checkEntries() checking["+
d+"], readyState: "+(e?e.readyState:"null")+", consumed: "+b.getConsumed())}}p.ctatdebug("Removed "+a+" entries")};this.retrieveProblemFile=function(a,c,d,b,e,f){"function"==typeof CTATScrim&&CTATScrim.scrim&&h&&CTATScrim.scrim.waitScrimUp();var l=/\.([A-z]*)([?].*)?$/.exec(a);l&&l[1]&&"nools"===l[1].toLowerCase()?(console.log("got a nools file:",a),d.processNools(a,b,e,f)):(console.log("got an xml file, maybe:",a),p.retrieveXMLFile(a,c,d,b,e,f))};this.getFileRequest=function(a,c,d){var b=-1!=(location.href?
location.href:a).indexOf("file://")?!0:!1;location.href||p.ctatdebug("We can't check location.href in the current configuration");if(b)d=(new CTATTutorMessageBuilder).createErrorMessage("","Unable to load: "+a+" - You are trying to use the file:// protocol, which is not allowed in this browser."),p.ctatdebug("onerror GET for fileName "+d),CTAT.ToolTutor.sendToInterface(d,!0);else return v=a,a=new CTATConnection,a.assignReceiveFunction(function(a,d,b){"undefined"==typeof b&&(b="function"==typeof p.getHTTPObject&&
p.getHTTPObject());p.ctatdebug("onready... GET for xmlFile xmlhttp "+b+", .readyState & .status "+(b?b.readyState+" & "+b.status:""));b&&4!=b.readyState||(b&&200==b.status&&c(b),b&&404==b.status&&(a=(new CTATTutorMessageBuilder).createErrorMessage("Unable to download file","("+v+") not found"),p.ctatdebug("Error loading xmlFile "+v+": "+a),CTAT.ToolTutor.sendToInterface(a,!0)))}),a.assignFailFunction(d),a};this.retrieveXMLFile=function(a,c,d,b,e,f){p.ctatdebug("retrieveXMLFile ("+a+")");c=p.getFileRequest(a,
function(a){a.responseXML?(p.ctatdebug("parsing brd xml using something else"),a=a.responseXML.documentElement):(p.ctatdebug("parsing brd xml using node"),a=(new CTATXML).parseXML(a.responseText));if(null===a){var c=(new CTATTutorMessageBuilder).createErrorMessage("Error: empty or null xmlFile "+v);p.ctatdebug("Error parsing xmlFile "+v+": "+c);CTAT.ToolTutor.sendToInterface(c,!0)}d.processXML(a,b,e,f)},function(){var a=(new CTATTutorMessageBuilder).createErrorMessage("",CTATGlobals.languageManager.getString("UNABLE_TO_LOAD")+
v+CTATGlobals.languageManager.getString("FILE_IS_MISSING"));p.ctatdebug("onerror GET for xmlFile "+a);CTAT.ToolTutor.sendToInterface(a,!0);d.processXML(null,b,e)});c.setMethod("GET");c.setURL(a);c.setContentType("text/plain");c.send()};this.retrieveJSONFile=function(a,c){p.ctatdebug("retrieveJSONFile ("+a+")");var d=p.getFileRequest(a,function(){4==d.readyState&&200==d.status&&(p.ctatdebug("Successfully retrieved file: "+a),c(JSON.parse(d.responseText)))},function(){var a=(new CTATTutorMessageBuilder).createErrorMessage("",
"Unable to load: "+v+" - Either you are trying to use the  file:// protocol, there is a firewall between the tutor and BRD, or the BRD is on a different domain and permission to retrieve data from that server is denied.");p.ctatdebug("onerror GET for xmlFile "+a);CTAT.ToolTutor.sendToInterface(a,!0)});d.open("GET",a,!0);d.setRequestHeader("Content-type","text/plain");d.send()};this.retrieveFile=function(a,c){p.ctatdebug("retrieveFile ("+a+")");var d=p.getFileRequest(a,function(){4==d.readyState&&
200==d.status&&(p.ctatdebug("Successfully retrieved file: "+a),c(d.responseText))},function(){var a=(new CTATTutorMessageBuilder).createErrorMessage("","Unable to load: "+v+" - Either you are trying to use the  file:// protocol, there is a firewall between the tutor and BRD, or the BRD is on a different domain and permission to retrieve data from that server is denied.");p.ctatdebug("onerror GET for xmlFile "+a);CTAT.ToolTutor.sendToInterface(a,!0)});d.open("GET",a,!0);d.setRequestHeader("Content-type",
"text/plain");d.send()};this.then=function(c,d){return a&&"function"==typeof a.then?a.then(c,d):Promise.resolve("CTATCommLibrary.then() not supported").then(c,d)}};CTATCommLibrary.setAuthenticityToken=function(b){Array.isArray(b)&&(b=0<b.length?b[0]:"");b&&(CTATCommLibrary.authenticityToken=decodeURIComponent(b))};CTATCommLibrary.getAuthenticityToken=function(b){return CTATCommLibrary.authenticityToken};
CTATCommLibrary.addAuthenticityToken=function(b){return CTATCommLibrary.authenticityToken&&(""===b||0>b.search(/authenticity_token=/)&&0<=b.search(/^[?]?[^?&=><]+=?[^&=]*(&[^?&=><]+=?[^&=]*)*$/))?""+b+(b?"&":"")+"authenticity_token="+encodeURIComponent(CTATCommLibrary.authenticityToken):b};
CTATCommLibrary.prototype.editSocketURLForHTTPS=function(b){if(b&&!/[^0-9]127[.]0[.]0[.]1[^0-9]/.test(b)&&"https:"===window.top.location.protocol){ctatdebug("We're embedded in an https window, using wss...");b=b.replace("ws:","wss:");var g=CTATConfiguration.get("remoteSocketSecurePort");g&&(b=b.replace(/(wss:\/\/[^:]{1,}:)\d{1,}/,"$1"+g));ctatdebug("url after replace: "+b)}return b};CTATCommLibrary.makeTeamID=function(){return CTATConfiguration.getCustomFields()["Team ID"]||""};
CTATCommLibrary.teamMemberEssential=function(b){var g=(CTATConfiguration.get("collaborators")||"").split(",").findIndex(function(f){return f==b});return 0==g||-1<g&&CTATConfiguration.get("whole_team_required")};CTATCommLibrary.prototype=Object.create(CTATBase.prototype);CTATCommLibrary.prototype.constructor=CTATCommLibrary;var CTATArgument=function(){var b="",g="Undefined",f="String",e="text";this.setValue=function(c){g=c};this.getValue=function(){return g};this.setName=function(c){b=c};this.getName=function(){return b};this.setType=function(c){f=c};this.getType=function(){return f};this.setFormat=function(c){e=c};this.getFormat=function(){return e}};CTATArgument.prototype.clone=function(){var b=new CTATArgument;b.setValue(this.getValue());b.setType(this.getType());b.setFormat(this.getFormat());return b};
"undefined"!==typeof module&&(module.exports=CTATArgument);var CTATHTMLManager=function(){var b=null,g="";this.urldecode=function(b){return decodeURIComponent((b+"").replace(/\+/g,"%20"))};this.showEntities=function(){ctatdebug("showEntities ()");for(var f,e=0;e<b.length;e++)f=b[e],ctatdebug(f)};this.initEntities=function(){null==b&&(b=[],b["&amp;"]="*!*",b["&nbsp;"]="\u00a0",b["&iexcl;"]="\u00a1",b["&cent;"]="\u00a2",b["&pound;"]="\u00a3",b["&curren;"]="\u00a4",b["&yen;"]="\u00a5",b["&brvbar;"]="\u00a6",b["&sect;"]="\u00a7",b["&uml;"]="\u00a8",b["&copy;"]=
"\u00a9",b["&reg;"]="\u00ae",b["&deg;"]="\u00b0",b["&plusmn;"]="\u00b1",b["&sup1;"]="\u00b9",b["&sup2;"]="\u00b2",b["&sup3;"]="\u00b3",b["&acute;"]="\u00b4",b["&micro;"]="\u00b5",b["&frac14;"]="\u00bc",b["&frac12;"]="\u00bd",b["&frac34;"]="\u00be",b["&iquest;"]="\u00bf",b["&Agrave;"]="\u00c0",b["&Aacute;"]="\u00c1",b["&Acirc;"]="\u00c2",b["&Atilde;"]="\u00c3",b["&Auml;"]="\u00c4",b["&Aring;"]="\u00c5",b["&AElig;"]="\u00c6",b["&Ccedil;"]="\u00c7",b["&Egrave;"]="\u00c8",b["&Eacute;"]="\u00c9",b["&Ecirc;"]=
"\u00ca",b["&Euml;"]="\u00cb",b["&Igrave;"]="\u00cc",b["&Iacute;"]="\u00cd",b["&Icirc;"]="\u00ce",b["&Iuml;"]="\u00cf",b["&ETH;"]="\u00d0",b["&Ntilde;"]="\u00d1",b["&Ograve;"]="\u00d2",b["&Oacute;"]="\u00d3",b["&Ocirc;"]="\u00d4",b["&Otilde;"]="\u00d5",b["&Ouml;"]="\u00d6",b["&Oslash;"]="\u00d8",b["&Ugrave;"]="\u00d9",b["&Uacute;"]="\u00da",b["&Ucirc;"]="\u00db",b["&Uuml;"]="\u00dc",b["&Yacute;"]="\u00dd",b["&THORN;"]="\u00de",b["&szlig;"]="\u00df",b["&agrave;"]="\u00e0",b["&aacute;"]="\u00e1",b["&acirc;"]=
"\u00e2",b["&atilde;"]="\u00e3",b["&auml;"]="\u00e4",b["&aring;"]="\u00e5",b["&aelig;"]="\u00e6",b["&ccedil;"]="\u00e7",b["&egrave;"]="\u00e8",b["&eacute;"]="\u00e9",b["&ecirc;"]="\u00ea",b["&euml;"]="\u00eb",b["&igrave;"]="\u00ec",b["&iacute;"]="\u00ed",b["&icirc;"]="\u00ee",b["&iuml;"]="\u00ef",b["&eth;"]="\u00f0",b["&ntilde;"]="\u00f1",b["&ograve;"]="\u00f2",b["&oacute;"]="\u00f3",b["&ocirc;"]="\u00f4",b["&otilde;"]="\u00f5",b["&ouml;"]="\u00f6",b["&oslash;"]="\u00f8",b["&ugrave;"]="\u00f9",b["&uacute;"]=
"\u00fa",b["&ucirc;"]="\u00fb",b["&uuml;"]="\u00fc",b["&yacute;"]="\u00fd",b["&thorn;"]="\u00fe",b["&yuml;"]="\u00ff",b["&gt;"]=">",b["&lt;"]="<",b["&#61;"]="=",b["&361;"]="=",b["&quot;"]='"');ctatdebug("(singleQuoteEscape==true) Replacing &apos; with: \\'");b["&apos;"]="\\'"};this.entitiesConvert=function(b){ctatdebug("entitiesConvert ()");return this.urldecode(unescape(b))};this.entitiesGenerate=function(b){return g=b};this.htmlEncode=function(b){return b};this.htmlDecode=function(b){return"undefined"!==
typeof $?$("<div/>").html(b).text():"undefined"!==typeof Entities?(new Entities).decode(b):b}};"undefined"!==typeof module&&(module.exports=CTATHTMLManager);var CTATStringUtil=function(){this.String2Boolean=function(b){switch(b){case "0":case "false":case "no":case "FALSE":case "NO":case "No":return!1}return!0};this.replaceString=function(b,g,f){return b.replace(g,f)}};"undefined"!==typeof module&&(module.exports=CTATStringUtil);var CTATSAI=function(b,g,f,e){CTATBase.call(this,"CTATSAI","sai");var c=new CTATStringUtil,a="undefined",d=[],h=[],l=[],n=[],p=null,q=this,p="xml"==CTATConfig.parserType?new CTATXML:new CTATJSON;this.getArguments=function(){return l};this.getArgument=function(a){if(0==l.length){var c=new CTATArgument;l.push(c)}return l[a]};this.getArgumentsTyped=function(){q.ctatdebug("getArgumentsTyped");var a,d=[];for(a=0;a<l.length;a++){var b=l[a];"Boolean"===b.getType()?(q.ctatdebug("Adding Boolean argument ("+
b.getValue()+") ..."),d.push(c.String2Boolean(b.getValue()))):"Number"===b.getType()?(q.ctatdebug("Adding Number argument ("+b.getValue()+") ..."),d.push(Number(b.getValue()))):"String"===b.getType()?"No_Value"===b.getValue()?(q.ctatdebug("Detected default argument ("+b.getValue()+"), setting contents to null instead"),d.push(null)):d.push(String(b.getValue())):q.ctatdebug("Unrecognized argument type: "+b.getType()+" in "+q.toSerializedString()+" IGNORING IT!!!")}q.ctatdebug("Resulting arguments: "+
d);return d};this.addSelection=function(a,c){var b=new CTATArgument;b.setValue(a);void 0!=c&&null!=c&&b.setType(c);d.push(b)};this.addAction=function(a){h.push(a)};this.checkDefaultArgument=function(){q.ctatdebug("checkDefaultArgument ()");if(0===l.length){q.ctatdebug("Adding default argument ...");var a=new CTATArgument;l.push(a)}};this.setArgument=function(a,c){q.checkDefaultArgument();for(var d=l.length;d<=a;++d)l.push(new CTATArgument);a=l[a];a.setValue(c);return a};this.addArgument=function(a,
c,d){this.ctatdebug("addArgument ("+a+","+c+","+d+")");var b=new CTATArgument;b.setValue(a);b.setType(c);b.setFormat(d);l.push(b);return b};this.addExistingArgument=function(a){l.push(a);return a};this.setSAI=function(c,d,b,e,f){q.setSelection(Array.isArray(c)?0<c.length?c[0]:"":c);q.setAction(Array.isArray(d)?0<d.length?d[0]:"":d);q.setInput(Array.isArray(b)?0<b.length?b[0]:"":b);q.setType(e);a=f};this.setInput=function(a){q.ctatdebug("setInput("+a+")");q.checkDefaultArgument();q.getArgument(0).setValue(a)};
this.getInputObject=function(){return 0===l.length?null:l[0]};this.getInput=function(){return 0===l.length?"":q.getArgument(0).getValue()};this.setType=function(a){q.checkDefaultArgument();q.getArgument(0).type=a};this.getType=function(){return 0===l.length?"":q.getArgument(0).type};this.setFormat=function(a){q.checkDefaultArgument();q.getArgument(0).setFormat(a)};this.getFormat=function(){return 0===l.length?"":q.getArgument(0).getFormat()};this.toString=function(){return"["+String(q.getSelection())+
","+String(q.getAction())+","+String(q.getInput())+"]"};this.setSelection=function(a,c){var b=new CTATArgument;b.setValue(a);void 0!=c&&null!=c&&b.setType(c);null==q.getSelectionObject()?d.push(b):d[0]=b};this.getSelectionObject=function(){return 0==d.length?null:d[0]};this.getSelection=function(){if(0==d.length)return null;var a=d[0];return"object"===typeof a?a.getValue():a};this.setAction=function(a){0<h.length?h[0]=a:h.push(a)};this.getAction=function(){return 0==h.length?null:h[0]};this.appendToSelectionArray=
function(a,c){var b=new CTATArgument;b.setValue(String(a));void 0!=c&&null!=c&&b.setType(c);d.push(b)};this.setSelectionArray=function(a){d=[];for(var c=0;c<a.length;c++)q.appendToSelectionArray(a[c],"String")};this.getSelectionArray=function(){for(var a=[],c=0;c<d.length;c++){var b=d[c];"object"===typeof b?a.push(d[c].getValue()):a.push(b)}return a};this.appendToActionArray=function(a){null==a?h.push(""):h.push(String(a))};this.setActionArray=function(a){h=null==a?[]:Array.isArray(a)?a.slice():[String(a)]};
this.getActionArray=function(){return h};this.appendToInputArray=function(a){q.ctatdebug("appendToInputArray ("+a+")");null==a?q.addArgument("","String","text"):q.addArgument(a,"String","text")};this.setInputArray=function(a){l=[];if(null!=a)for(var c=0;c<a.length;c++)q.appendToInputArray(a[c])};this.getInputArray=function(){q.ctatdebug("getInputArray ("+l.length+")");n=[];for(var a=0;a<l.length;a++){var c=l[a];"object"===typeof c?(q.ctatdebug("Adding object value ("+c.getValue()+") to temp input array"),
n.push(c.getValue())):(q.ctatdebug("Adding string value ("+c+") to temp input array"),n.push(c))}return n};this.setPrompt=function(c){a=c};this.getPrompt=function(){return a};this.propagate=function(a){q.ctatdebug("propagate ()");a=a.getArguments();for(var c=0;c<a.length;c++){var d=a[c],b=l[c];if(null===d||null===b){q.ctatdebug("Internal error: argument lists do not align between received SAI and source SAI");break}b.setValue(d.getValue())}};this.fromString=function(a){a=p.parse(a);q.fromXML(a)};
this.fromXML=function(a){q.ctatdebug("fromXML ()");l=[];a=p.getElementChildren(a);for(var c,d=0;d<a.length;d++){var b=a[d];if("selection"==p.getElementName(b)||"Selection"==p.getElementName(b)){for(var e=p.getElementChildren(b),f=!1,h=0;h<e.length;h++)c=e[h],"value"==p.getElementName(c)&&(c=p.getNodeTextValue(c),1>h?q.setSelectionArray(c):q.appendToSelectionArray(c),f=!0,q.setSelection(c));!1===f&&(c=p.getNodeTextValue(b),q.setSelectionArray(c),q.setSelection(c))}if("action"==p.getElementName(b)||
"Action"==p.getElementName(b)){e=p.getElementChildren(b);f=!1;for(h=0;h<e.length;h++)c=e[h],"value"==p.getElementName(c)&&(c=p.getNodeTextValue(c),1>h?q.setActionArray(c):q.appendToActionArray(c),f=!0,q.setAction(c));!1===f&&(c=p.getNodeTextValue(b),q.setActionArray(c),q.setAction(c))}if("inputArray"==p.getElementName(b)||"value"==p.getElementName(b)||"Input"==p.getElementName(b)){c=p.getElementChildren(b);var g;l=[];e=new CTATHTMLManager;f=new CTATArgument;h=0;l.push(f);for(var n=0;n<c.length;n++){var u=
c[n];"value"==p.getElementName(u)&&(g=p.getElementChildren(u),null!==g?(q.ctatdebug("Parsing SAI input ..."),q.ctatdebug("Childnodes: "+g.length),1===g.length?(g=e.htmlDecode(p.getNodeTextValue(u)),q.ctatdebug("Setting new value to: "+g),f.setValue(g)):(g=e.htmlDecode(p.getNodeTextValue(u)),q.ctatdebug("Setting new value to: "+g),f.setValue(g),f.setName(u.attributes.getNamedItem("name").value),f.setType(u.attributes.getNamedItem("type").value),f.setFormat(u.attributes.getNamedItem("format").value),
h++),1>n?q.setInputArray(g):q.appendToInputArray(g)):(u=e.htmlDecode(p.getNodeTextValue(u)),q.ctatdebug("Setting new value to: "+u),f.setValue(u),1>n?q.setInputArray(u):q.appendToInputArray(u)))}}if("prompt"==p.getElementName(b)||"Prompt"==p.getElementName(b))q.ctatdebug("Parsing prompt ..."),q.setPrompt(p.getNodeTextValue(b))}q.checkDefaultArgument()};this.appendFromElement=function y(a,c,d,b,e){q.ctatdebug("appendFromElement ()");b=String(p.getElementName(c)).toLowerCase();if(b==a||"value"==b)if(b=
p.getElementChildren(c),!Array.isArray(b)||1>b.length)0==e?d.push(p.getNodeTextValue(c)):q.appendToInputArray(p.getNodeTextValue(c));else for(c=0;c<b.length;++c)y(a,b[c],d,c,e)};this.setArrayFromElements=function(a){q.ctatdebug("setArrayFromElements ()");if(!a||!Array.isArray(a)||1>a.length)q.ctatdebug("can't get name: don't know whether selection, action or input");else{var c,b=String(p.getElementName(a[0])).toLowerCase();switch(b){case "selection":q.ctatdebug("Processing selection field ...");d=
[];for(c=0;c<a.length;++c)q.appendFromElement(b,a[c],d,c,!1);break;case "action":q.ctatdebug("Processing action field ...");h=[];for(c=0;c<a.length;++c)q.appendFromElement(b,a[c],h,c,!1);break;case "input":q.ctatdebug("Processing input field ...");l=[];for(c=0;c<a.length;++c)q.appendFromElement(b,a[c],l,c,!0);break;default:console.log('CTATSAI.setArrayFromElements(): unexpected element name "'+b+'"');return}q.ctatdebug("CTATSAI.setArrayFromElements() eltName "+b+", length "+c+", selectionArray "+
q.getSelectionArray()+", actionArray "+q.getActionArray()+", inputArray "+q.getInputArray())}};this.fromXMLInternal=function(a){q.ctatdebug("fromXMLInternal ()");new CTATXML;l=[];a=p.getElementChildren(a);for(var c,d=0;d<a.length;d++){var b=a[d];if("selection"==p.getElementName(b)||"Selection"==p.getElementName(b)){for(var e=p.getElementChildren(b),f=!1,h=0;h<e.length;h++)c=e[h],"value"==p.getElementName(c)&&(c=p.getNodeTextValue(c),1>h?q.setSelectionArray(c):q.appendToSelectionArray(c),f=!0,q.setSelection(c));
!1===f&&(c=p.getNodeTextValue(b),q.setSelectionArray(c),q.setSelection(c))}if("action"==p.getElementName(b)||"Action"==p.getElementName(b)){e=b.childNodes;f=!1;for(h=0;h<e.length;h++)c=e[h],"value"==p.getElementName(c)&&(c=p.getNodeTextValue(c),1>h?q.setActionArray(c):q.appendToActionArray(c),f=!0,q.setAction(c));!1===f&&(c=p.getNodeTextValue(b),q.setActionArray(c),q.setAction(c))}if("inputArray"==p.getElementName(b)||"Input"==p.getElementName(b)){c=b.childNodes;l=[];var e=new CTATHTMLManager,f=new CTATArgument,
h=0,g;l.push(f);for(var n=0;n<c.length;n++)if(g=c[n],"value"==p.getElementName(g)){var u=p.getElementChildren(g);null!==u?(q.ctatdebug("Parsing SAI input ..."),q.ctatdebug("Childnodes: "+u.length),1===u.length?(g=e.htmlDecode(p.getNodeTextValue(g)),q.ctatdebug("Setting new value to: "+g),f.setValue(g)):(g=e.htmlDecode(p.getNodeTextValue(g)),q.ctatdebug("Setting new value to: "+g),f.setValue(g),f.setName(p.getElementAttr("name")),f.setType(p.getElementAttr("type")),f.setFormat(p.getElementAttr("format")),
h++)):(g=e.htmlDecode(p.getNodeTextValue(g)),q.ctatdebug("Setting new value to: "+g),f.setValue(g));1>n?q.setInputArray(g):q.appendToInputArray(g)}}if("prompt"==p.getElementName(b)||"Prompt"==p.getElementName(b))q.ctatdebug("Parsing prompt ..."),q.setPrompt(p.getNodeTextValue(b))}q.checkDefaultArgument()};this.toXMLDoc=function(){return p.parse('<?xml version="1.0" ?><SAI>'+m.getSAI().toXMLString()+"</SAI>")};this.toXMLString=function(a){q.ctatdebug("toXMLString ()");return a?q.toLSxmlString():q.toTSxmlString()};
this.toLSxmlString=function(){q.ctatdebug("toLSxmlString ()");for(var a="",c=0;c<d.length;c++){var b=d[c];"object"===typeof b?(a="String"!=b.getType()?a+('<selection type="'+b.getType()+'">'):a+"<selection>",a+=b.getValue()+"</selection>"):a+="<selection>"+b+"</selection>"}a+="<action>"+q.getAction();for(c=1;c<h.length;c++)a+="</action><action>"+h[c];a+="</action>";for(c=0;c<l.length;c++)b=l[c],a="object"===typeof b?"String"!=b.getType()?a+('<input type="'+b.getType()+'"><![CDATA['+b.getValue()+"]]\x3e</input>"):
a+("<input><![CDATA["+b.getValue()+"]]\x3e</input>"):a+("<input><![CDATA["+b+"]]\x3e</input>");return a};this.toTSxmlString=function(){q.ctatdebug("toTSxmlString ()");var a;a="<Selection><value>"+q.getSelection();for(var c=1;c<d.length;c++){var b=d[c];a="object"===typeof b?a+("</value><value>"+b.getValue()):a+("</value><value>"+b)}a+="</value></Selection><Action><value>"+q.getAction();for(c=1;c<h.length;c++)a+="</value><value>"+h[c];a+="</value></Action><Input>";if(1<l.length)for(c=0;c<l.length;c++)b=
l[c],a+='<value fmt="text" name="'+b.getName()+'" type="'+b.getType()+'"><![CDATA['+b.getValue()+"]]\x3e</value>";else a+="<value><![CDATA["+q.getInput()+"]]\x3e</value>";return a+"</Input>"};this.toSerializedString=function(){var a;a=""+("<selection>"+q.getSelection()+"</selection><action>"+q.getAction()+"</action><inputArray>");for(var c=0;c<l.length;c++){var d=l[c];a+='<value fmt="text" name="'+d.getName()+'" type="'+d.getType()+'">'+d.getValue()+"</value>"}return a+"</inputArray>"};this.clone=
function(){q.ctatdebug("clone ()");for(var a=new CTATSAI(q.getSelection(),q.getAction(),q.getInput(),q.getPrompt()),c=0;c<q.getArguments().length;++c)a.setArgument(c,q.getArgument(c).clone());a.setSelectionArray(q.getSelectionArray().slice());a.setActionArray(q.getActionArray().slice());a.setInputArray(q.getInputArray().slice());q.ctatdebug("CTATSAI.clone() this "+q+", clone "+a+", clone inputArray "+a.getInputArray());return a};this.isDone=function(){var a=q.getSelection(),c=q.getAction();return null==
a||null==c?!1:/^done$/i.test(a.toString())&&/^buttonpressed/i.test(c.toString())};var u=!1;if(Array.isArray(b)&&Array.isArray(g)&&(Array.isArray(f)||null==f)&&(q.setSelectionArray(b),q.setActionArray(g),q.setInputArray(f),u=!0,0<b.length&&0<g.length)){q.setSAI(b[0],g[0],null==f?null:f[0],"String",e);return}null!==b&&""!==b&&q.setSelection(b);null!==b&&(q.setSAI(b,g,f,"String",e),u||(q.setSelectionArray(Array.isArray(b)?b:[b]),q.setActionArray(Array.isArray(g)?g:[g]),q.setInputArray(Array.isArray(f)?
f:[f]),u=!0))};CTATSAI.prototype=Object.create(CTATBase.prototype);CTATSAI.prototype.constructor=CTATSAI;CTATSAI.delayedActionRegExp=/^([^:]+):([0-9]+)$/;"undefined"!==typeof module&&(module.exports=CTATSAI);var CTATSkill=function(){CTATBase.call(this,"CTATSkill","skill");var b="",g="",f="",e="",c=0,a="",d=!1,h="",l="",n="",p="",q=0,u=0;this.setSkillName=function(a){b=a};this.setDisplayName=function(a){g=a};this.setModelName=function(a){e=a};this.setCategory=function(a){f=a};this.setLevel=function(a){!0===isNaN(a)?ctatdebug("Error: attempting to set a level to NaN"):(c=a,this.setPKnown(String(c)))};this.setDescription=function(c){a=c};this.getSkillName=function(){return b};this.getDisplayName=function(){return g};
this.hasDisplayName=function(){return""!==g&&null!==g};this.getModelName=function(){return e};this.hasCategory=function(){return""!==f};this.hasModelName=function(){return""!==e};this.getCategory=function(){return f};this.getLevel=function(){return c};this.getDescription=function(){return a};this.setTouched=function(a){d=a};this.getTouched=function(){return d};this.toXMLString=function(){return""};this.toSetPreferencesXMLString=function(){return'<skill name="'+CTATXML.escape(b)+'" category="'+CTATXML.escape(f)+
'" label="'+CTATXML.escape(g)+'" description="'+CTATXML.escape(a)+'" pSlip="'+l+'" pKnown="'+n+'" pLearn="'+p+'" pGuess="'+h+'" history="'+q+'" opportunityCount="'+u+'" />'};this.setPGuess=function(a){h=a};this.getPGuess=function(){return h};this.setPSlip=function(a){l=a};this.getPSlip=function(){return l};this.setPLearn=function(a){p=a};this.getPLearn=function(){return p};this.setPKnown=function(a){n=a};this.getPKnown=function(){return n};this.setSkillHistory=function(a){q=Number(a)||0};this.getSkillHistory=
function(){return q};this.setSkillOpportunityCount=function(a){u=Number(a)||0};this.getSkillOpportunityCount=function(){return u}};CTATSkill.prototype=Object.create(CTATBase.prototype);CTATSkill.prototype.constructor=CTATSkill;var CTATSkillSet=function(){CTATBase.call(this,"CTATSkillSet","skills");this.internalSkillSet=[];var b=this,g=!1;this.fromJSONforTutorshop=function(f){try{this.internalSkillSet=[],JSON.parse(f,function(e,c){if(Number.isInteger(Number(e))&&c.name)b.addSkill(c.name,c.p_known,.95,c.description,c.label,c.category,c.p_guess,c.p_learn,c.p_slip,c.history,c.opportunity_count);else switch(e){case "skills":case "":break;default:return c}})}catch(e){console.log("Error parsing as JSON",e,"\n  jsonStr",f)}g=!0};
this.fromDataParams=function(f){this.ctatdebug("CTATSkillSet.fromDataParams() Raw: "+f);if(f)return f="%"==f.charAt(0)?decodeURIComponent(f.replace(/\+/g," ")):f,f=f.startsWith("<")?b.fromXMLString(f):b.fromJSONforTutorshop(f),g=!0,f;this.ctatdebug("Warning: skill object is null or empty.")};this.fromXMLString=function(b){this.ctatdebug("fromXMLString () aSkills: "+b);if(null!==/\/<value>.+<\/value>/.exec(b))this.parseByValue(b);else{var e=(new CTATXML).parseXML(b);this.parseByAttributes(e,b)}g=!0;
this.ctatdebug("fromXMLString () done")};this.fromXMLData=function(b,e){this.ctatdebug("fromXMLData ()");null!==/\/<value>.+<\/value>/.exec(e)?this.parseByValue(e):this.parseByAttributes(b);g=!0;this.ctatdebug("fromXMLData () done")};this.parseByValue=function(f){this.ctatdebug("parseByValue()");if(f){f=f.childNodes;for(var e=new CTATXML,c=0;c<f.length;c++){var a=e.getNodeTextValue(f[c]).split("`"),d=a[0].split(" ");4==a.length?this.addSkill(d[0],a[1],a[2],a[3],a[3],d[1]):this.addSkill(d[0],a[1],
a[2],a[3],a[4],d[1])}g=!0}else b.ctatdebug("Error: aSkills is null")};this.parseDOM=function(b){this.ctatdebug("parseDOM()");var e=new CTATXML;b=e.getElementChildren(b);for(var c=0;c<b.length;c++){var a=e.getNodeTextValue(b[c]).split("`"),d=a[0].split(" ");4==a.length?this.addSkill(d[0],a[1],a[2],a[3],a[3],d[1]):this.addSkill(d[0],a[1],a[2],a[3],a[4],d[1])}g=!0};this.parseByAttributes=function(f){this.ctatdebug("parseByAttributes()");if(f)if(f=f.childNodes){for(var e=0;e<f.length;e++){var c=f[e];
if("Skill"==c.nodeName||"skill"==c.nodeName){this.ctatdebug("Parsing node ("+e+"): "+c.nodeName+" -> "+c.nodeValue);var a=c.attributes.getNamedItem("name");if(a=a?a.value:""){var d=c.attributes.getNamedItem("pKnown"),d=d?d.value:"",h=c.attributes.getNamedItem("description"),h=h?h.value:"",l=c.attributes.getNamedItem("label"),l=l?l.value:"",n=c.attributes.getNamedItem("category"),n=n?n.value:"",p=c.attributes.getNamedItem("pGuess"),p=p?p.value:"",q=c.attributes.getNamedItem("pLearn"),q=q?q.value:"",
u=c.attributes.getNamedItem("pSlip"),u=u?u.value:"",v=c.attributes.getNamedItem("history"),v=v?v.value:"",c=(c=c.attributes.getNamedItem("opportunityCount"))?c.value:"";this.addSkill(a,d,.95,h,l,n,p,q,u,v,c)}}}g=!0}else this.ctatdebug("Error: list of skill xml elements is null");else b.ctatdebug("Error: aSkills is null")};this.getSkillSet=function(){return this.internalSkillSet};this.getSize=function(){return this.internalSkillSet.length};this.addSkill=function(b,e,c,a,d,h,g,n,p,q,u){this.ctatdebug("addSkill() name = "+
b+" level = "+e+" mastery = "+c+" aDescription = "+a+" adisplayName = "+d+" aCategory = "+h+" pguess= "+g+" plearn = "+n+" pslip = "+p+" history = "+q+" oppCt = "+u);b=this.setSkillLevel(b,e,c);this.ctatdebug("Configuring "+b.getDisplayName());a&&b.setDescription(a);d&&b.setDisplayName(d);h&&b.setCategory(h);(g||0===g)&&b.setPGuess(g);(n||0===n)&&b.setPLearn(n);(p||0===p)&&b.setPSlip(p);b.setSkillHistory(q);b.setSkillOpportunityCount(u);return b};this.addSkillAsObject=function(b){this.addSkill(b.name,
b.level,b.mastery,b.description,b.label,b.category,b.pGuess,b.pLearn,b.pSlip,"","")};this.setSkillLevel=function(b,e,c){this.ctatdebug("setSkillLevel ("+b+","+e+","+c+")");c=this.getSkill(b);null===c?(this.ctatdebug("Skill not found, creating new one ..."),c=new CTATSkill,c.setSkillName(b),c.setLevel(e),this.internalSkillSet.push(c)):(this.ctatdebug("Skill found, adjusting ..."),c.setLevel(1),c.setLevel(e));c.setTouched(!0);return c};this.getSkill=function(b){this.ctatdebug("getSkill ("+b+") -> "+
this.internalSkillSet.length);if(!b)return null;for(var e=0;e<this.internalSkillSet.length;e++){var c=this.internalSkillSet[e];if(c.getSkillName()==b)return this.ctatdebug("Returning: "+e),c}return null};this.getSkillLevel=function(b){if(!b)return-1;for(var e in this.internalSkillSet)if(e.getSkillName()==b)return e.getLevel();return-1};this.getTouched=function(){this.ctatdebug("getTouched ()");for(var b=[],e=0;e<this.internalSkillSet.length;e++){var c=this.internalSkillSet[e];!0===c.getTouched()&&
(this.ctatdebug("Adding touched skill: "+c.getSkillName()),b.push(c))}return b};this.untouchSkills=function(){this.ctatdebug("untouchSkills ()");for(var b=0;b<this.internalSkillSet.length;b++)this.internalSkillSet[b].setTouched(!1)};this.toSetPreferencesXMLString=function(){var b=this.internalSkillSet.length;this.ctatdebug("toSetPreferencesXMLString (): nSkills "+b);if(1>b&&!g)return"";for(var e="<skills>",c=0;c<b;c++)e+=this.internalSkillSet[c].toSetPreferencesXMLString();return e+"</skills>"};this.toLogString=
function(){this.ctatdebug("toLogString ("+this.internalSkillSet.length+")");for(var b="",e=0;e<this.internalSkillSet.length;e++){var c=this.internalSkillSet[e],b=b+('<skill probability="'+c.getLevel()+'"><name>'+c.getSkillName()+"</name>");c.hasCategory()&&(b+="<category>"+c.getCategory()+"</category>");c.hasModelName()&&(b+="<model_name>"+c.getModelName()+"</model_name>");b+="</skill>"}return b}};CTATSkillSet.prototype=Object.create(CTATBase.prototype);CTATSkillSet.prototype.constructor=CTATSkillSet;
CTATSkillSet.skills=null;"undefined"!==typeof module&&(module.exports=CTATSkillSet);function CTATJSONObject(b,g){this.name=b||"";this.value=g||null}
var transformArray=[],CTATJSON=function(){CTATBase.call(this,"CTATJSON","json");var b=null,g=0;this.isJSONObject=function(b){return b.ctat?!0:!1};this.parse=function(b){return this.parseJSON(b)};this.parseJSON=function(f){this.ctatdebug("parseJSON ()");b=null;if("string"==typeof f){this.ctatdebug("Parsing JSON as a string ... ");try{b=JSON.parse(f)}catch(c){return this.ctatdebug("Error parsing JSON message: "+c.message),b=null}this.ctatdebug("Successfully parsed JSON string")}this.ctatdebug("JSON string has already been parsed, assigning as an object ...");for(var e in b)return this.ctatdebug("Creating internal JSON object with name: "+
e),f=new CTATJSONObject,f.name=e,f.value=b[e],f;return null};this.getElementName=function(b){return"object"!=typeof b?(this.ctatdebug("Internal error, the provided element is not of type CTATJSONObject, instead we found: "+typeof b),null):b.name};this.getElementValue=function(b){return null==b?(this.ctatdebug("Error: anElement is null"),null):"object"!=typeof b?(this.ctatdebug("Internal error, the provided element is not of type CTATJSONObject, instead we found: "+typeof b),null):b.value};this.getElementChildren=
function(b){if(null==b)return this.ctatdebug("Error: anElement is null"),null;if("object"!=typeof b)return this.ctatdebug("Internal error, the provided element is not of type CTATJSONObject, instead we found: "+typeof b),null;var e=b.value,c=[],a;for(a in e){var d=e[a];if("string"==typeof d)b=new CTATJSONObject,b.name=a,b.value=d,c.push(b);else if(null==d[0]||void 0==d[0])b=new CTATJSONObject,b.name=a,b.value=d,c.push(b);else for(var f in d)b=new CTATJSONObject,b.name=a,b.value=d[f],c.push(b)}return c};
this.getNodeTextValue=function(b){if("string"!=typeof b.value){var e=null;for(e in b.value)if("content"==e)return b.value[e].toString();for(e in b.value)if("value"==e)return b.value[e].toString()}return b.value};this.getElementAttr=function(b,e){b=b.value;for(var c in b)if(c==e)return b[c];return null};this.isArray=function(b){return"[object Array]"===Object.prototype.toString.call(b)};this.walkDOM=function(b){this.ctatdebug("walkDOM () >>>>>>>>>>>>>>>>>>");g=0;this.walk(b);this.ctatdebug("walkDOM () <<<<<<<<<<<<<<<<<<")};
this.walk=function(b){g++;if(!(5<g)){var e=0,c;for(c in b){var a=b[c];this.ctatdebug("("+e+") typeof (key): "+typeof c+" -> typeof(value): "+typeof a+"("+a.length+")");"string"!=typeof a?(this.ctatdebug("walk ("+c+")"),this.walk(a)):this.ctatdebug("walk ("+c+") : "+a);e++}}};this.stringify=function(b){return this.toJSONString(b)};this.toJSONString=function(b){return JSON.stringify(b,null,2)};this.syntaxHighlight=function(b){"string"!=typeof b&&(b=JSON.stringify(b,void 0,2));b=b.replace(/&/g,"&amp;").replace(/</g,
"&lt;").replace(/>/g,"&gt;");return b.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,function(b){var c="number";/^"/.test(b)?c=/:$/.test(b)?"key":"string":/true|false/.test(b)?c="boolean":/null/.test(b)&&(c="null");return'<span class="'+c+'">'+b+"</span>"})}};CTATJSON.prototype=Object.create(CTATBase.prototype);CTATJSON.prototype.constructor=CTATJSON;"undefined"!==typeof module&&(module.exports=CTATJSON);var CTATMessage=function(b){function g(a){var c=[],d=h.getElementChildren(a);this.ctatdebug("CTATMessage.parseCustomFields("+h.stringify(a)+"): valueElts.length "+d.length);for(a=0;a<d.length;++a){var b=d[a];"value"!=h.getElementName(b)?console.log("CTATMessage.parseRules(): unexpected element name "+h.getElementName(b)+" at custom_fields["+a+"]"):(b=h.getNodeTextValue(b))&&c.push(b)}return c}function f(a){var c={},d=h.getElementChildren(a);this.ctatdebug("CTATMessage.parseCustomFields("+h.stringify(a)+
"): cfElts.length "+d.length);for(a=0;a<d.length;++a){var b=d[a];if("custom_field"==h.getElementName(b)){for(var e=null,f=null,b=h.getElementChildren(b),g=0,l=0;g<b.length&&2>l;++g){var n=b[g];switch(h.getElementName(n)){case "name":e=h.getNodeTextValue(n);l++;break;case "value":f=h.getNodeTextValue(n),l++}}e&&(c[e]=f?f:"",this.ctatdebug("CTATMessage.parseCustomFields(): result["+e+"]="+c[e]+";"))}}return c}CTATBase.call(this,"CTATMessage","message");CTATMessage.makeTransactionId=function(){return CTATGuid.guid()};
var e=this,c=b,a=null,d=null,h=null;void 0==b&&(c=null);h="xml"==CTATConfig.parserType?new CTATXML:new CTATJSON;c&&(this.ctatdebug("messageParser "+h+", messageObj "+c),c.children&&this.ctatdebug(c.children));var l="ungraded",n=!1,p=!1,q=new CTATSkillSet,u="",v="",y="",w="",A="",z=!0,C,D=null,F=null,G=null,x=!1;this.setURL=function(a){C=a};this.getURL=function(){return C};this.assignSAI=function(a){p=!0;D=a};this.setTransactionID=function(a){v=a};this.getTransactionID=function(){return v};this.setGradeResult=
function(a){l=a};this.getGradeResult=function(){return l};this.getXMLObject=function(){return c};this.getSkillsObject=function(){return q};this.getCustomFields=function(){return F};this.getRules=function(){return G};this.getSuccessMessage=function(){return y};this.getBuggyMsg=function(){return w};this.getHighlightMsg=function(){return A};this.parse=function(){this.ctatdebug("parse ()");if(null!==c){this.ctatdebug("messageParser: "+h);this.ctatdebug("Root name: "+h.getElementName(c));"tool_message"==
h.getElementName(c)?(this.ctatdebug("Detected tool message"),u="tool_message"):"message"!=h.getElementName(c)?(this.ctatdebug("Detected log message"),n=!0,u=h.getElementName(c)):(this.ctatdebug("Detected regular message"),n=!1,this.parseMessageType());this.parseTransactionID();this.parseSAI();for(var b=h.getElementChildren(c),e=0;e<b.length;e++){var f=b[e];"properties"==h.getElementName(f)&&(ctatdebug("Found a 'properties' element ... "),a=f,d=h.getElementChildren(f))}this.ctatdebug("Message "+u+
", with transaction id: "+v)}};this.parseSAI=function(){this.ctatdebug("parseSAI ()");var a="",d="",b="",e="",l=[],v=[],r=[];if("tool_message"==u){this.ctatdebug("Parsing s, a and i");a=h.getElementChildren(c);for(d=0;d<a.length;d++)if(b=a[d],"tool_message"==h.getElementName(b))for(b=h.getElementChildren(b),e=0;e<b.length;e++)l=b[e],"event_descriptor"==h.getElementName(l)&&(D=new CTATSAI,D.fromXMLInternal(l));p=!0}else{if(n){this.ctatdebug("isLogMessage ...");for(var z=h.getElementChildren(c),x=0;x<
z.length;x++){var N=z[x];if("event_descriptor"==h.getElementName(N))for(var N=h.getElementChildren(N),Q=0;Q<N.length;Q++){var R=N[Q];"selection"==h.getElementName(R)&&(a=h.getNodeTextValue(R),l.push(R));"action"==h.getElementName(R)&&(d=h.getNodeTextValue(R),v.push(R));"input"==h.getElementName(R)&&(b=h.getNodeTextValue(R),r.push(R));"prompt"==h.getElementName(R)&&(e=h.getNodeTextValue(R))}}}else for(this.ctatdebug("!isLogMessage ..."),z=h.getElementChildren(c),x=0;x<z.length;x++)if(N=z[x],"properties"==
h.getElementName(N))for(N=h.getElementChildren(N),Q=0;Q<N.length;Q++){var R=N[Q],aa=h.getElementName(R);this.ctatdebug("Nodename: "+aa);switch(aa){case "URL":C=h.getNodeTextValue(R);break;case "Skills":q.parseByValue(R);break;case "SuccessMsg":y=h.getValueNodesAsText(R);y instanceof Array&&1>y.length&&(y=[h.getNodeTextValue(R)]);break;case "BuggyMsg":w=h.getValueNodesAsText(R);w instanceof Array&&1>w.length&&(w=[h.getNodeTextValue(R)]);break;case "Selection":a=h.getNodeTextValue(R);l.push(R);break;
case "Action":d=h.getNodeTextValue(R);v.push(R);break;case "Input":b=h.getNodeTextValue(R);r.push(R);break;case "prompt":e=h.getNodeTextValue(R);break;case "HighlightMsgText":A=h.getNodeTextValue(R);break;case "custom_fields":F=f(R);break;case "Rules":G=g(R)}}this.ctatdebug("SAI: "+a+","+d+","+b);""!==a&&null!==a?(D=new CTATSAI(a,d,b,e),D.setArrayFromElements(l),D.setArrayFromElements(v),D.setArrayFromElements(r),p=!0):(this.ctatdebug("No SAI found"),p=!1);this.ctatdebug("parseSAI () done, hassai: "+
p+", ("+a+","+d+","+b+","+e+")")}};this.parseTransactionID=function(){this.ctatdebug("parseTransactionID()");if("tool_message"!=u){if(!n)for(var a=h.getElementChildren(c),d=0;d<a.length;d++){var b=a[d];if("properties"==h.getElementName(b))for(var b=h.getElementChildren(b),e=0;e<b.length;e++){var f=b[e];"transaction_id"==h.getElementName(f)&&(v=h.getNodeTextValue(f))}}this.ctatdebug("parseTransactionID() done, id: "+v)}};this.parseMessageType=function(){this.ctatdebug("parseMessageType()");for(var a=
h.getElementChildren(c),d=0;d<a.length;d++){var b=a[d];if("properties"==h.getElementName(b))for(var b=h.getElementChildren(b),e=0;e<b.length;e++){var f=b[e];"MessageType"==h.getElementName(f)&&(u=h.getNodeTextValue(f))}}this.ctatdebug("parseMessageType() -> "+u)};this.getMessageType=function(){return u};this.getTransactionID=function(){return v};this.getSAI=function(){return p?D:new CTATSAI};this.getSelection=function(){return p?D.getSelection():""};this.getAction=function(){return p?D.getAction():
""};this.getInput=function(){return p?D.getInput():""};this.getSelectionArray=function(){return p?D.getSelectionArray():[]};this.getActionArray=function(){return p?D.getActionArray():[]};this.getInputArray=function(){return p?D.getInputArray():[]};this.getXML=function(){return c};this.getXMLString=function(a){if(c.xml)return c.xml;if(XMLSerializer)return(new XMLSerializer).serializeToString(c);alert("ERROR: Extremely old browser");return""};this.getIndicator=function(){return"AssociatedRules"!=u?
"":this.getProperty("Indicator")};this.getIndicatorSub=function(){return"AssociatedRules"!=u?"":this.getProperty("IndicatorSub")};this.setProperty=function(c,b){this.ctatdebug("setProperty ("+c+","+b+")");if(null!==d){for(var e=0;e<d.length;e++){var f=d[e];if(h.getElementName(f)==c)return h.setNodeTextValue(f,b)}c=h.addElement(a,c,b);d.push(c);return b}this.ctatdebug("Internal error: no messageProperties object available");return null};this.getProperty=function(a){if(!n)if(null!==d)for(var c=0;c<
d.length;c++){var b=d[c];if(h.getElementName(b)==a)return h.getNodeTextValue(b)}else this.ctatdebug("Internal error: no messageProperties object available");return""};this.hasProperty=function(a){a=this.getProperty(a);return!n&&""!==a};this.hasSAI=function(){return p};this.isEndOfTransaction=function(){return"true"==this.getProperty("end_of_transaction")?!0:!1};this.isLogMessageType=function(){return n};this.hasStudentSAI=function(){return!1};this.getStudentSelection=function(){return null.getSelection()};
this.getStudentAction=function(){return null.getAction()};this.getStudentInput=function(){return null.getInput()};this.getStudentSAI=function(){return null};this.getToolSelection=function(){return""};v=CTATMessage.makeTransactionId();this.parse();this.init=function(a){this.setMessageType(a)};this.setSelection=function(a){D&&D.setSelection(a);e.setProperty("Selection",a)};this.setAction=function(a){D&&D.setAction(a);e.setProperty("Action",a)};this.setInput=function(a){D&&D.setInput(a);e.setProperty("Input",
a)};this.lockTransactionId=function(a){if(null===a||"undefined"===typeof a||1>a.length)throw new CTATExampleTracerException("lockTranactionId() argument "+a+" must be a valid id");this.setProperty(CTATMessage.TRANSACTION_ID_TAG,a);x=!0};this.setMessageType=function(a){this.setProperty(CTATMessage.MESSAGE_TYPE,a);u=a};this.setTransactionId=function(a){if(!x){if(null===a||"undefined"===typeof a||1>a.length)a=CTATMessage.makeTransactionId();this.setProperty(CTATMessage.TRANSACTION_ID_TAG,a)}};this.suppressLogging=
function(){z=!1};this.isLoggingSuppressed=function(){return!z};CTATMessage.create=function(a,c){c=new CTATMessage;c.init(a);return c}};CTATMessage.fromString=function(b){try{var g=(new CTATXML).parseXML(b);return new CTATMessage(g)}catch(f){return console.log("CTATMessage.fromString: error ",f,"str:\n",b),null}};Object.defineProperty(CTATMessage,"MESSAGE_TYPE",{enumerable:!1,configurable:!1,writable:!1,value:"MessageType"});
Object.defineProperty(CTATMessage,"TRANSACTION_ID_TAG",{enumerable:!1,configurable:!1,writable:!1,value:"transaction_id"});CTATMessage.prototype=Object.create(CTATBase.prototype);CTATMessage.prototype.constructor=CTATMessage;"undefined"!==typeof module&&(module.exports=CTATMessage);var CTATVariable=function(){this.value=this.name=""};var CTATCurriculumService=function(b){CTATBase.call(this,"CTATCurriculumService","curriculum_service");this.tutordoneListener=null;this.log=(this.logger=new CTATLogger("curriculumservice")).log;var g=this;this.sendSummary=function(f,e){g.log("curriculumservice","sendSummary()",f);try{if(!f||"function"!=typeof f.getProperty)throw Error("bad argument aMessage");var c=f.getProperty("ProblemSummaryJSON"),a=JSON.parse(c).completion_status;CTATLMS.is.TutorShop()||(c=f.getProperty("ProblemSummary"));CTATLMS.postProblemSummary(c);
var d=CTATConfiguration.get("curriculum_service_url");if(d){var h=CTATCurriculumService.formatProblemSummary(c),c=null;a&&a.toLowerCase().startsWith("complete")&&(CTATScrim.scrim.nextProblemScrimUp(),c=g.processIncoming.bind(g,e),b.assignMessageListener(g),b.assignHandler(g));return e?e.then(c):b.send_post_variables(d,h)}if("complete"==a){var l=CTATGlobals.languageManager.getString("CONGRATULATIONS_YOU_ARE_DONE");CTATScrim.scrim.OKScrimUp(l,function(){var a=CTATShellTools.getAllComponents(),c=a.find(function(a){return"CTATHintWindow"===
a.getClassName()});c&&c.showFeedback(l);a.forEach(function(a){return a.lock()});CTATScrim.scrim.scrimDown()})}return Promise.resolve(c)}catch(n){return console.error("CTATCurriculumService.sendSummary aMessage",f,n),Promise.reject(n)}};this.processOutgoing=function(b){g.log("curriculumservice",'CTATCurriculumService.processOutgoing("'+b+'")')};this.processIncoming=function(b){var e={command:"tutordone",id:CTATCommLibrary.makeTeamID(),username:CTATConfiguration.get("user_guid"),teamMembers:g.teamMembers};
window.parent.postMessage(e,location.origin);g.loadNextProblem(b)};this.loadNextProblem=function(f){var e=CTATConfiguration.get("run_problem_url");g.log("curriculumservice","CTATCurriculumService.processIncoming(",f,"), parent.location.replace "+parent.location.replace+', runProblemUrl "'+e+'"');e&&parent&&parent.location&&(f=f&&"function"==typeof f.then?f:b)&&f.then(function(c){g.log("curriculumservice","loggingLib resolve arg",c);parent.location.replace(e)},function(c){g.log("curriculumservice",
"CTATCurriculumService: error from loggingLib",c,"now",Date.now(),"msElapsed",Date.now()-Number(c),"\n***proceeding to next problem",e);parent.location.replace(e)})};this.processMessage=function(b){g.log("curriculumservice","CTATCurriculumService.processMessage("+(b?b.substring(0,30)+"...":"")+")")};this.checkProtocol=function(b){return"localhost"==b||"127.0.0.1"==b?!0:null===/^http[s]?:\/\/([^\/]+)\//.exec(b)||4096<=b.length?!1:!0};CTATConfiguration.get("instructor_mode")&&b&&(g.tutordoneListener=
new Promise(function(f,e){b.tutordoneListener=function(c){g.log("curriculumservice","tutordone listener creating tutorBegin, r1",c);b.tutorbeginListener=function(a){return g.log("curriculumservice","tutorbegin listener calling resolve",f,"r2",a),f(a)};return c}}),g.tutordoneListener.then(g.loadNextProblem.bind(g)))};CTATCurriculumService.prototype=Object.create(CTATBase.prototype);CTATCurriculumService.prototype.constructor=CTATCurriculumService;
CTATCurriculumService.formatProblemSummary=function(b){var g={};["user_guid","session_id","authenticity_token","school_name"].forEach(function(b){return g[b]=CTATConfiguration.get(b)});g.summary=b;g.targetFrame=CTATConfiguration.get("target_frame");g.reuseSWF=CTATConfiguration.get("reuse_swf");return g};
CTATCurriculumService.sendProblemSummary=function(b,g){var f=CTATConfiguration.get("curriculum_service_url");if(!f||!b)return Promise.reject("no curriculum_service_url or problem summary");b=CTATLMS.is.TutorShop()?b.toJSONforTutorshop():b.toXML(!0);b=CTATCurriculumService.formatProblemSummary(b);if(g){g=new FormData;for(var e in b)g.set(e,b[e]);return Promise.resolve(navigator.sendBeacon(f,g))}return $.post(f,b)};var CTATSkills=function(b){CTATBase.call(this,"CTATSkills",b?String(b.length):"");var g={},f=0;b.forEach(function(a){g[a.getSkillName().toLowerCase()]=a});var e=new Set,c=!1,a=this;this.toXML=function(a,c){c||(c="");var d=a?"&lt;Skills&gt;":"<Skills>",b=d.length,e;for(e in g)g.hasOwnProperty(e)&&g[e]&&(d+=c+g[e].toXML(a));d+=c&&d.length>b?"\n":"";return d+(a?"&lt;/Skills&gt;":"</Skills>")};this.getAllSkills=function(){var a=[],c;for(c in g)g.hasOwnProperty(c)&&g[c]&&a.push(g[c]);return a};this.addSkill=
function(c,b){var d=a.getSkill(c.getSkillName());return!d||b?g[c.getSkillName().toLowerCase()]=c:d};this.removeSkill=function(c,b){c=b?c+" "+b:c;(b=a.getSkill(c))&&delete g[c];return b};this.updateSkill=function(c,b,g){var d=null,h=a.getSkill(b);null!==h&&"undefined"!==typeof h&&(h.setTransactionNumber(f),b=g+" "+b,e.has(b)||(e.add(b),h.recordUpdate(c)),CTATExampleTracerSkill.CORRECT.toString().toUpperCase()===c.toString().toUpperCase()&&e.delete(b),d=h);return d};this.startTransaction=function(){++f};
this.getSkill=function(c){var d=null===c||"undefined"===typeof c?null:c.toLowerCase(),d=g[d]||null;a.ctatdebug("CTATSkills.getSkill("+c+") returns "+d);return d};this.getSkillBarVector=function(a,c){var d=[],b;for(b in g)!0===g.hasOwnProperty(b)&&(!0!==c&&g[b].getTransactionNumber()!==f||d.push(g[b].getSkillBarString(a)));return d};this.setExternallyDefined=function(a){c=!!a};this.getExternallyDefined=function(){return c};this.setVersion=function(a){for(var c in g)!0===g.hasOwnProperty(c)&&g[c].setVersion(a)};
this.toJSONforTutorshop=function(){var a=[],c;for(c in g)!0===g.hasOwnProperty(c)&&a.push(g[c].toJSONforTutorshop());return a};this.toJSON=function(c){a.ctatdebug("CTATSkills.toJSON("+c+") to return "+("pSummarySkills"==c?a.getAllSkills():a[c]));if(!c)return a;switch(c){case "pSummarySkills":return a.getAllSkills();case "pSummaryUpdates":return a.getAllUpdates();case "psSkills":var d=[];e.forEach(function(a){return d.push(a)});return d;default:return a[c]}};this.getSkillUpdates=function(c){var d=
a.getSkill(c),d=d?d.getUpdates():[];a.ctatdebug("CTATSkills.getSkillUpdates("+c+") returns length "+d.length);return d};this.getAllUpdates=function(){var c=[];a.getAllSkills().forEach(function(a){return c=c.concat(a.getUpdates())});a.ctatdebug("CTATSkills.getAllUpdates() returns length "+c.length);return c};this.updatesToJSONforTutorshop=function(){var c=[];a.getAllSkills().forEach(function(a){return c=c.concat(a.updatesToJSONforTutorshop())});a.ctatdebug("CTATSkills.getAllUpdates() returns length "+
c.length);return c};this.restoreUpdates=function(c){c&&c.forEach(function(c){var d=a.getSkill(c.skillName);d&&d.addUpdate(c)})};this.fromJSON=function(c){c instanceof Array&&c.forEach(function(a){return e.add(a)});return a}};
CTATSkills.fromJSONforTutorshop=function(b,g){switch(b){case "name":case "category":case "p_known":case "p_learn":case "p_guess":case "p_slip":case "history":case "opportunity_count":return g;case "skills":return b=new CTATSkills(g),b.setExternallyDefined(!0),b;case "":return g}if(Number.isInteger(Number(b)))return new CTATExampleTracerSkill(g.category,g.name,g.p_guess,g.p_known,g.p_slip,g.p_learn,g.history,g.opportunity_count)};
CTATSkills.parseSkills=function(b,g){var f=[];g||(g=new CTATXML);try{for(var e=g.getElementChildren(b),c={},a=0;a<e.length;c={category:c.category,name$29:c.name$29,label:c.label,description:c.description},a++){var d=g.getElementName(e[a]);if(/^skill$/i.test(d)){var h=g.getElementAttr(e[a],"name");if(h&&""!=h.trim()){var l=g.getElementAttr(e[a],"label"),n=g.getElementAttr(e[a],"pSlip"),p=g.getElementAttr(e[a],"description"),q=g.getElementAttr(e[a],"pKnown"),u=g.getElementAttr(e[a],"category"),v=g.getElementAttr(e[a],
"pLearn"),y=g.getElementAttr(e[a],"pGuess"),w=g.getElementAttr(e[a],"history"),A=new CTATExampleTracerSkill(u,h,y,q,n,v,w);A.setOpportunityCount(g.getElementAttr(e[a],"opportunityCount"));A.setLabel(l);A.setDescription(p);f.push(A)}}else if(/^productionrule$/i.test(d)){var z=e[a];c.name$29=null;c.category="";c.label=null;c.description=null;g.getElementChildren(z).forEach(function(a){return function(c){switch(g.getElementName(c)){case "productionSet":a.category=g.getNodeTextValue(c);break;case "ruleName":a.name$29=
g.getNodeTextValue(c);break;case "label":a.label=g.getNodeTextValue(c);break;case "description":a.description=g.getNodeTextValue(c)}}}(c));if(c.name$29){var C=new CTATExampleTracerSkill(c.category,c.name$29);C.setLabel(c.label||c.name$29);C.setDescription(c.description);C.setOpportunityCount(g.getElementAttr(z,"opportunities"));f.push(C)}}}}catch(D){console.log("Error in CTATSkills.parseSkills",D,"\n skillsElt",b)}return f};CTATSkills.prototype=Object.create(CTATBase.prototype);
CTATSkills.prototype.constructor=CTATSkills;"undefined"!==typeof module&&(module.exports=CTATSkills);var CTATExampleTracerException=function(b){CTATBase.call(this,"CTATExampleTracerException","");this.toString=function(){return b}};CTATExampleTracerException.prototype=Object.create(CTATBase.prototype);CTATExampleTracerException.prototype.constructor=CTATExampleTracerException;"undefined"!==typeof module&&(module.exports=CTATExampleTracerException);var CTATStep=function(b,g){CTATBase.call(this,"CTATStep",b);this.id=b;this.result=g;this.nFirstHints=0;this.lastResult=null;this.nErrors=this.nCorrect=0;var f=this;f.ctatdebug("entering CTATStep("+b+", "+g+") constructor");this.incrementFirstHints=function(){f.nFirstHints++};this.incrementNCorrect=function(){f.nCorrect++};this.incrementErrors=function(){f.nErrors++};this.setLastResult=function(b){f.lastResult=b};this.getLastResult=function(){return f.lastResult};this.getResult=function(){return f.result};
this.getNCorrect=function(){return f.nCorrect};this.getNErrors=function(){return f.nErrors};this.getNFirstHints=function(){return f.nFirstHints};f.ctatdebug("in CTATStep("+b+", "+g+") constructor");switch(g){case CTATStep.StepResult[3]:f.incrementNCorrect();break;case CTATStep.StepResult[1]:f.incrementErrors();break;case CTATStep.StepResult[2]:f.incrementFirstHints()}f.ctatdebug("exiting CTATStep constructor")};
CTATStep.fromJSON=function(b){if(!b)return null;var g=new CTATStep("",""),f;for(f in b)b.hasOwnProperty(f)&&"function"!=typeof b[f]&&(g[f]=b[f]);return g};Object.defineProperty(CTATStep,"StepResult",{enumerable:!1,configurable:!1,writable:!1,value:["UNTRIED","INCORRECT","HINT","CORRECT"]});CTATStep.prototype=Object.create(CTATBase.prototype);CTATStep.prototype.constructor=CTATStep;"undefined"!==typeof module&&(module.exports=CTATStep);var CTATProblemSummary=function(b,g,f){CTATBase.call(this,"CTATProblemSummary","");var e=this;if(null===b||"undefined"===typeof b||1>b.length)throw new CTATExampleTracerException("givenProblemName null or empty");this.showCounts=!0;this.requiredSteps=Number.MAX_VALUE;this.problemName=b;this.problemContext=1;this.psSkills="undefined"==typeof g?null:g;this.psUpdateHistory={toJSON:function(a){var c=e.getSkills();return"psUpdateHistory"==a?c?c.getAllUpdates():[]:this}};this.countOnlyLastResults="undefined"==
typeof f?null:f;this.timeElapsed=this.initialErrorsOnly=this.initialHintsOnly=0;var c=new Date;this.stepMap={};this.correct=0;this.scoreLabels={};this.uniqueErrors=this.uniqueCorrectUnassisted=this.uniqueCorrect=this.uniqueHints=this.errors=this.hints=0;this.completionStatus=CTATMsgType.CompletionValue[0];this.time=new Date;this.getCountOnlyLastResults=function(){return e.countOnlyLastResults};this.setCountOnlyLastResults=function(a){e.countOnlyLastResults=a};this.getTimeElapsed=function(){return e.timeElapsed};
this.getUniqueErrors=function(){if(!e.getCountOnlyLastResults())return e.uniqueErrors;var a=0,c;for(c in e.stepMap)e.stepMap[c].getLastResult()==CTATStep.StepResult[1]&&a++;return a};this.getUniqueCorrect=function(){if(!e.getCountOnlyLastResults())return e.uniqueCorrect;var a=0,c;for(c in e.stepMap)e.stepMap[c].getLastResult()==CTATStep.StepResult[3]&&a++;return a};this.getUniqueCorrectUnassisted=function(){return e.uniqueCorrectUnassisted};this.getHintsOnly=function(){var a=e.initialHintsOnly,c;
for(c in e.stepMap)CTATStep.StepResult[2]==e.stepMap[c].getResult()&&1>e.stepMap[c].getNErrors()&&++a;return a};this.getErrorsOnly=function(){var a=e.initialErrorsOnly,c;for(c in e.stepMap)CTATStep.StepResult[1]==e.stepMap[c].getResult()&&1>e.stepMap[c].getNFirstHints()&&++a;return a};this.getUniqueSteps=function(){var a=0,c;for(c in e.stepMap)a++;return a};this.getRequiredSteps=function(){return e.requiredSteps==Number.MAX_VALUE?0:e.requiredSteps};this.setRequiredSteps=function(a){e.requiredSteps=
a};this.getCorrect=function(){return e.correct};this.getScoreLabels=function(){return e.scoreLabels};this.fromJSON=function(a){if(!a)return e;for(var c in a)if(a.hasOwnProperty(c)&&"function"!=typeof a[c])switch(c){case "stepMap":e[c]={};for(var b in a[c])e[c][b]=CTATStep.fromJSON(a[c][b]);break;case "psSkills":e[c]=(e.psSkills||(e.psSkills=new CTATSkills([]))).fromJSON(a[c]);break;case "psUpdateHistory":e.getSkills().restoreUpdates(a[c]);break;case "time":e[c]=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3}Z$/.test(a[c])?
new Date(Date.parse(a[c])):new Date;break;default:e[c]=a[c]}return e};this.toJSON=function(a){if(!a)return e;var c=e.getSkills();switch(a){case "psSkills":return c?c.getAllSkills():[];case "psUpdateHistory":return c?c.getAllUpdates():[];default:return e[a]}};this.toJSONforTutorshop=function(){var a={};a.problem_name=e.problemName;a.problem_context=e.problemContext;a.completion_status=e.completionStatus;e.showCounts&&(a.correct=e.correct,a.score_labels=e.scoreLabels,a.unique_correct=e.getUniqueCorrect(),
a.unique_correct_unassisted=e.uniqueCorrectUnassisted,a.hints=e.hints,a.unique_hints=e.uniqueHints,a.hints_only=e.getHintsOnly(),a.errors=e.errors,a.unique_errors=e.getUniqueErrors(),a.errors_only=e.getErrorsOnly(),a.unique_steps=e.getUniqueSteps(),a.required_steps=e.getRequiredSteps());a.time_elapsed=e.timeElapsed;a.time=new Date;var c=e.getSkills();e.showCounts&&c?(a.skills=c.toJSONforTutorshop(),a.skill_history=c.updatesToJSONforTutorshop()):(a.skills=[],a.skill_history=[]);return JSON.stringify(a)};
this.toXML=function(a){var c,b="";c=""+(' ProblemName="'+e.problemName+'"');c+=' ProblemContext="'+e.problemContext+'"';c+=' CompletionStatus="'+e.completionStatus+'"';e.showCounts&&(c+=' Correct="'+e.correct+'"',c+=' UniqueCorrect="'+e.getUniqueCorrect()+'"',c+=' UniqueCorrectUnassisted="'+e.uniqueCorrectUnassisted+'"',c+=' Hints="'+e.hints+'"',c+=' UniqueHints="'+e.uniqueHints+'"',c+=' HintsOnly="'+e.getHintsOnly()+'"',c+=' Errors="'+e.errors+'"',c+=' UniqueErrors="'+e.getUniqueErrors()+'"',c+=
' ErrorsOnly="'+e.getErrorsOnly()+'"',c+=' UniqueSteps="'+e.getUniqueSteps()+'"',c+=' RequiredSteps="'+e.getRequiredSteps()+'"');c+=' TimeElapsed="'+e.timeElapsed+'"';c+=" Time="+JSON.stringify(new Date);e.showCounts&&(b=e.getSkills()?e.getSkills().toXML(a):"");return a?"&lt;ProblemSummary"+c+"&gt;"+b+"&lt;/ProblemSummary&gt;":"<ProblemSummary"+c+">"+b+"</ProblemSummary>"};this.getSkills=function(){return e.psSkills};this.setSkills=function(a){e.psSkills=a};this.getSkill=function(a,c){if(!a||!e.psSkills)return null;
var d=a;a instanceof CTATExampleTracerSkill?d=a.getSkillName():null!=c&&""!=String(c).trim()&&(d=CTATExampleTracerSkill.makeKey(a,c));return e.psSkills.getSkill(d)};this.removeSkill=function(a,c){if(!a||!e.psSkills)return null;if(a instanceof CTATExampleTracerSkill)return e.psSkills.removeSkill(a.getName(),a.getCategory());if(null==c||""==c)c=CTATExampleTracerSkill.getCategory(a),a=CTATExampleTracerSkill.getName(a);return e.psSkills.removeSkill(a,c)};this.addSkill=function(a,c,b){if(a){var d=a;if(!(a instanceof
CTATExampleTracerSkill)){if(null==c||""==c)c=CTATExampleTracerSkill.getCategory(a),a=CTATExampleTracerSkill.getName(a);d=new CTATExampleTracerSkill(c,a)}e.psSkills||(e.psSkills=new CTATSkills([]));d=e.psSkills.addSkill(d);b&&b.trim&&b.trim()&&d.setLabel(b);return d}};this.stopTimer=function(){var a=new Date;e.timeElapsed+=a.getTime()-c.getTime();return a};this.restartTimer=function(){c=e.stopTimer();return e.timeElapsed};this.addHint=function(a){e.ctatdebug("addHint("+a+")");var c=e.stepMap[a];null!==
c&&"undefined"!==typeof c?(1>c.getNFirstHints()&&++e.uniqueHints,c.incrementFirstHints()):(c=new CTATStep(a,CTATStep.StepResult[2]),e.stepMap[a]=c,e.uniqueHints++);e.hints++;c.setLastResult(CTATStep.StepResult[2]);e.ctatdebug("exiting addHint() hint count "+e.hints+", trial "+c)};this.addError=function(a){e.ctatdebug("addError("+a+")");var c=e.stepMap[a];null!==c&&"undefined"!==typeof c?(1>c.getNCorrect()&&1>c.getNErrors()&&++e.uniqueErrors,c.incrementErrors()):(c=new CTATStep(a,CTATStep.StepResult[1]),
e.stepMap[a]=c,e.uniqueErrors++);e.errors++;c.setLastResult(CTATStep.StepResult[1]);e.ctatdebug("exiting addError() error count "+e.errors+", trial "+c)};this.addCorrect=function(a,c){var d=e.stepMap[a];e.ctatdebug("entering addCorrect("+a+") trial "+d);d?(1>d.getNCorrect()&&1>d.getNErrors()&&(++e.uniqueCorrect,1>d.getNFirstHints()&&e.uniqueCorrectUnassisted++),d.incrementNCorrect()):(e.ctatdebug("to call CTATStep("+a+", StepResult "+CTATStep.StepResult[3]),d=new CTATStep(a,CTATStep.StepResult[3]),
e.stepMap[a]=d,e.uniqueCorrect++,e.uniqueCorrectUnassisted++);e.correct++;Array.isArray(c)&&c.forEach(function(a){return e.scoreLabels[a]?e.scoreLabels[a]++:e.scoreLabels[a]=1});d.setLastResult(CTATStep.StepResult[3]);e.ctatdebug("exiting addCorrect() correct count "+e.correct+", trial "+d)};this.setShowCounts=function(a){e.showCounts=a};this.setCompletionStatus=function(a,c){e.ctatdebug("setCompletionStatus("+a+", "+c+") old value "+e.completionStatus);if(!e.completionStatus.startsWith(CTATMsgType.CompletionValue[1])||
c)e.completionStatus=a};this.getCompletionStatus=function(){return e.completionStatus}};CTATProblemSummary.prototype=Object.create(CTATBase.prototype);CTATProblemSummary.prototype.constructor=CTATProblemSummary;"undefined"!==typeof module&&(module.exports=CTATProblemSummary);var CTATSequencer=function(b,g){CTATBase.call(this,"CTATSequencer","sequencer");"undefined"!=typeof location&&"basic"==location.search.replace(/.*[?&]show_debug_traces=([^&]*)&?.*/,"$1")&&(useDebuggingBasic=!0);CTATLMS.is.OLI()&&(useDebuggingBasic=!0);var f=this;this.log=(new CTATLogger("sequencer,problemset")).log;var e=new CTATPackage,c=new CTATXML,a=null,d=null,h=g||function(a){console.log("CTATSequencer default CTATLMSListener",a)},l=new CTATSkills([]);this.currentPSetName=CTATLMS.getProblemSetName();
this.iframeId="ctat_inner_frame";this.dsCacheQueueKey="dsCacheQueue"+CTATLMS.getDatasetLevelsName();this.tsGate=Promise.resolve("initial tsGate");this.dsGate=Promise.resolve("initial dsGate");this.dsCacheEnqueue=function(a){a={key:CTATGuid.guid(),next:null,msg:a};try{var c=JSON.parse(localStorage.getItem(f.dsCacheQueueKey))||{head:"",tail:"",length:0};if(c.tail){var d=JSON.parse(localStorage.getItem(c.tail));d.next=a.key;localStorage.setItem(d.key,JSON.stringify(d))}else c.head=a.key;c.tail=a.key;
c.length++;localStorage.setItem(a.key,JSON.stringify(a));localStorage.setItem(f.dsCacheQueueKey,JSON.stringify(c));console.log("dsCacheEnqueue",c)}catch(u){console.error("dsCacheEnqueue error",u)}};this.dsCacheDequeue=function(){try{var a=JSON.parse(localStorage.getItem(f.dsCacheQueueKey));if(!a)return console.log("dsCacheDequeue: no queue"),null;if(a.head){var c=JSON.parse(localStorage.getItem(a.head));if(c)return a.length--,console.log("dsCacheDequeue",a),c.key==a.tail?localStorage.removeItem(f.dsCacheQueueKey):
(a.head=c.next,localStorage.setItem(f.dsCacheQueueKey,JSON.stringify(a))),localStorage.removeItem(c.key),c}console.error("dsCacheDequeue queue "+a+" or result null");return null}catch(q){console.error("dsCacheEnqueue error",q)}};this.dsCacheGetHead=function(){var a=JSON.parse(localStorage.getItem(f.dsCacheQueueKey));console.log("dsCacheGetHead",a);return a&&a.head?JSON.parse(localStorage.getItem(a.head)):null};this.sendDataShopMessage=function(a){console.log("sendDataShopMessage",a&&a.substring(0,
80));var c=CTATConfiguration.get("log_service_url");return c&&"ClientToLogServer"==CTATConfiguration.get("Logging")?new Promise(function(d){return fetch(c,{method:"POST",body:a,mode:"cors"}).then(function(a){if(!a.ok)throw Error("sendDataShopMessage !resp.ok",{cause:a});return a.text().then(function(a){return d(a)})}).catch(function(a){var c="sendDataShopMessage error: "+(a&&a.toString?a.toString():a);console.error(c,a);return c})}):Promise.reject("logging not enabled")};this.sendCachedDatashopMessages=
function(){var a=f.dsCacheGetHead();if(!a)return Promise.resolve("sendCachedDatashopMessages: queue empty");try{return f.sendDataShopMessage(a.msg).then(function(a){console.log("sendCachedDatashopMessages r",a);f.dsCacheDequeue();return f.sendCachedDatashopMessages()},function(a){console.log("sendCachedDatashopMessages e",a);throw Error("sendCachedDatashopMessages",{cause:a});})}catch(p){return a="sendCachedDatashopMessages: "+(p&&p.toString?p.toString():p),console.error(a),a}};this.getPackageManager=
function(){return e};this.handlePackageRetrieval=function(a){var c=Number(CTATConfiguration.get("problem_context"));f.log("sequencer","handlePackageRetrieval(), problem_context",c);e.init(a);try{f.dsGate=Promise.resolve("start dsGate").then(function(a){return f.sendCachedDatashopMessages()})}catch(q){console.error("online listener error from sendCachedDatashopMessages",q)}try{f.tsGate=Promise.resolve("start tsGate").then(function(a){return f.sendCachedTutorshopResults()})}catch(q){console.error("online listener error from sendCachedDatashopMessages",
q)}f.tsGate=f.tsGate.then(function(a){return d&&d(e,c)},function(a){console.error("handlePackageRetrieval: reject from sendCachedTutorshopResults",a);return d&&d(e,c)})};this.processXML=function(a){f.log("sequencer","parseXML ()");return f.handlePackageRetrieval(a)};this.init=function(b,h,g,l,v,y){null==y&&(y=Number(CTATConfiguration.get("problem_context")));f.log("sequencer","CTATSequencer.init ("+b+", "+h+", "+g+", "+l+", "+v+", "+y+")");f.iframeId=l||f.iframeId;e.setPackageURL(b);e.setURLPrefix(g);
e.setDefaultStudentInterface(v);d=h||f.runNextProblem.bind(f);localStorage.setItem(CTATConfiguration.cachedParamsName,JSON.stringify(CTATConfiguration.getRawFlashVars()));a=new CTATCommLibrary(null,!1);a.retrieveXMLFile(b,c,this);addEventListener("message",function(a){f.log("sequencer","CTATSequencer@message",a);var c=document.getElementById(f.iframeId);f.log("problemset","CTATSequencer.init() iframe "+c+", evt.data "+a.data);if(a.data&&/tutorInitialized/i.test(a.data.command))try{c.contentWindow.postMessage({command:"subscribed",
team_members:[CTATConfiguration.get("user_guid")]},location.origin)}catch(z){throw Error("CTATSequencer.init() error posting subscribed to iframe '"+f.iframeId+": "+z);}else if(a.data&&/tutorready/i.test(a.data.command))try{c.contentWindow.CTATCommShell.commShell.assignDoneProcessor(f.advanceToNextProblem.bind(f))}catch(z){throw Error("CTATSequencer.init() error adding listener to iframe '"+f.iframeId+": "+z);}else if(a.data&&/problemsummary/i.test(a.data.command)){a.data.name.replace(/.*[\t]([\S])/,
"$1");localStorage.setItem(a.data.name,a.data.problemSummary);try{f.sendCachedTutorshopResults()}catch(z){console.error("problemsummary listener error",z)}}else a.data&&/datashopLogMessage/i.test(a.data.command)&&f.handleDatashopLogMessage(a.data.payload)});window.addEventListener("online",function(a){f.log("sequencer","online event",Date(),a);try{f.dsGate=Promise.resolve("dsGate on online").then(function(a){return f.sendCachedDatashopMessages()})}catch(A){console.error("online listener error from sendCachedDatashopMessages",
A)}try{f.tsGate=Promise.resolve("tsGate on online").then(function(a){return f.sendCachedTutorshopResults()})}catch(A){console.error("online listener error from sendCachedTutorshopResults",A)}});f.log("sequencer","CTATSequencer@message installed")};this.sendTutorshopResult=function(a,c){f.log("sequencer","sendTutorshopResult entry online",navigator.onLine,"pos",c,"psJson[1st80]",String(a).substring(0,80));a=CTATCurriculumService.formatProblemSummary(a);var d=new FormData,b;for(b in a)d.set(b,a[b]);
return new Promise(function(a){return fetch(CTATLMS.makeCurriculumServiceUrl(c),{method:"POST",headers:new Headers({Accept:"","X-CSRF-Token":CTATConfiguration.get("authenticity_token")}),body:d,redirect:"error",mode:"same-origin"}).then(function(c){f.log("sequencer","sendTutorshopResult fetch resp",c);if(!c.ok)throw Error("sendTutorshopResult resp not ok "+c.status+" "+c.statusText);return c.text().then(function(c){return a(c)})}).catch(function(a){var d="sendTutorshopResult error on pos "+c+": "+
(a&&a.toString?a.toString():a);console.error(d,a);return d})})};this.sendCachedTutorshopResults=function(){var a=e.getProblemSets(),c=(a=a&&a.get(f.currentPSetName))&&a.getOldestCachedUnsent();if(!c)return Promise.resolve("sendCachedTutorshopResults: queue empty");try{return f.sendTutorshopResult(c.psJson,c.pos).then(function(a){f.log("sequencer","sendCachedTutorshopResults r",a);return CTATProblemSet.replaceCachedPS(c.pos)?f.sendCachedTutorshopResults():null},function(a){f.log("sequencer","sendCachedTutorshopResults e",
a);throw Error("sendCachedTutorshopResults",{cause:a});})}catch(q){return a="sendCachedTutorshopResults: "+(q&&q.toString?q.toString():q),console.error(a),a}};this.advanceToNextProblem=function(a,c){f.log("problemset","advanceToNextProblem()psResp\n ",a,"\n cbk\n",c);f.processProblemSummaryResponse(a);"function"==typeof c&&c();return f.runNextProblem()};this.processProblemSummaryResponse=function(a){a=new CTATMessage(c.parse(a));f.processProblemSummary(a&&(a.getProperty("ProblemSummaryJSON")||a.getProperty("ProblemSummary")))};
this.processProblemSummary=function(a){try{f.log("sequencer","processProblemSummary typeof(psText)",typeof a,"psText[1st80]",a&&a.substring(0,80));if(!a)throw Error("CTATSequencer.processProblemSummary() null psText");var d={},b=[];if(/^\s*[[{]/.test(a))(d=JSON.parse(a,CTATSkills.fromJSONforTutorshop))&&d.skills instanceof CTATSkills&&(b=d.skills.getAllSkills()),d=JSON.parse(a);else{for(var h=c.parse(a),g=c.getElementChildren(h),n=0;n<g.length;++n)if(/^skills$/i.test(c.getElementName(g[n]))){b=CTATSkills.parseSkills(g[n],
c);break}d={problem_name:c.getElementAttr(h,"ProblemName"),problem_context:c.getElementAttr(h,"ProblemContext"),completion_status:c.getElementAttr(h,"CompletionStatus"),time_elapsed:c.getElementAttr(h,"TimeElapsed"),time:c.getElementAttr(h,"Time")}}f.log("problemset","processProblemSummary skillList.length "+(b?b.length:null));b.forEach(function(a){return l.addSkill(a,!0)});var w=e.getProblemSets().get(f.currentPSetName);f.log("sequencer","processProblemSummary current problem set name, obj",f.currentPSetName,
w);if(w)w.updateProblemFromProblemSummary(d,e.getProblem(d.problem_name));else{var A=e.getProblem(d.problem_name);A&&A.setCompletedCount(/^complete/i.test(d.completion_status)?1:0)}}catch(z){console.error("sequencer","Error in processProblemSummary(\n"+a+"\n)",z)}};this.postOwnProblemSummary=function(a){a=a&&a.completionStatus;var c=CTATConfiguration.get("problem_name"),d=CTATConfiguration.get("problem_context"),b=new CTATProblemSummary(c);b.problemContext=d;b.setCompletionStatus(a||"incomplete");
self.postMessage({command:"ProblemSummary",name:CTATLMS.getDatasetLevelsName(c,d),problemSummary:b.toJSONforTutorshop()},location.origin)};this.runNextProblem=function(){f.getNextProblem().then(function(a){f.log("problemset","CTATSequencer.runNextProblem()",a);return f.runProblem(a.problem,a.position)})};this.runProblem=function(a,c){var d=document.getElementById(f.iframeId);f.log("problemset","CTATSequencer.runProblem("+a+") iframe "+d);if(!d)return Promise.reject("CTATSequencer.runProblem("+a+"): iframe '"+
f.iframeId+"' not found");if(!a)return f.postOwnProblemSummary({completionStatus:"complete"}),Promise.resolve("CTATSequencer.runProblem DONE_WITH_PROBLEM_SET").then(function(a){return d.contentWindow&&d.contentWindow.CTATScrim.scrim.scrimUp(CTATLanguageManager.theSingleton.filterString("DONE_WITH_PROBLEM_SET")),a});var b={};Object.assign(b,CTATConfiguration.getRawFlashVars());b.dataset_level_name1||(b.dataset_level_name1=a.getProblemFile(),b.dataset_level_type1="Activity");b.problem_name=a.getName()||
a.getProblemFile();b.problem_context=c||a.getProblemContext();b.curriculum_service_url="";b.log_service_url="parent";b.question_file=encodeURIComponent(e.getRelativePath(a.getStudentInterface(),a.getProblemFile()));b.student_interface=a.getStudentInterface();b.skills=encodeURIComponent(f.getRevisedSkills(a.getSkills()).toXML());b.LMS="TutorShop";d.setAttribute("data-params",JSON.stringify(b));var h=[];(new URLSearchParams(location.search)).forEach(function(a,c){return/^logger$/i.test(c)&&h.push(c+
"="+a)});b.mode&&h.push("MODE="+b.mode);d.src=e.getURLPrefix()+e.getRelativePath(a.getStudentInterface())+(0<h.length?"?"+h.join("&"):"");f.updateCaption(c);return Promise.resolve(a)};this.updateCaption=function(a){var c=parent.document.getElementById("caption");if(c){var c=c.getElementsByTagName("p"),d=/^Activity ([0-9]+) of ([0-9]+)$/i.exec(0<c.length&&c[0].textContent);d&&(c[0].textContent="Activity "+a+" of "+d[2])}};this.getRevisedSkills=function(a,c){a.forEach(function(a){l.addSkill(a,c)});
return l};this.getNextProblem=function(){f.log("problemset","getNextProblem() pointer.currentPSetName",f.currentPSetName);var a=e.getProblemSets();if(0==a.size||!f.currentPSetName){if(f.log("problemset","Error: no problem sets available, trying list of problems directly ..."),a=e.getProblemList().find(function(a,c){return 1>a.getCompletedCount()}))return Promise.resolve({problem:a,position:a.getProblemContext()})}else if(a.get(f.currentPSetName))return a.get(f.currentPSetName).getNextProblem();return Promise.resolve({problem:null,
position:null})};this.handleDatashopLogMessage=function(a){f.log("sequencer","handleDatashopLogMessage",a&&a.substring(40,120));f.dsCacheEnqueue(a);try{f.dsGate=f.dsGate.then(function(a){return f.sendCachedDatashopMessages()})}catch(p){console.error("online listener error from sendCachedDatashopMessages",p)}};CTATConfiguration.generateDefaultConfigurationObject(b,"undefined"==typeof CTATTarget?void 0:CTATTarget);addEventListener("ctatlms",function(a){f.log("sequencer","CTATSequencer ctatlms listener evt",
a);h(a)})};CTATSequencer.prototype=Object.create(CTATBase.prototype);CTATSequencer.prototype.constructor=CTATSequencer;Object.defineProperty(CTATSequencer,"PackageListURI",{enumerable:!1,configurable:!1,writable:!1,value:/^([^?]*\/)?package[.]xml$/i});var CTATActionEvaluationData=function(b){CTATBase.call(this,"CTATActionEvaluationData","actionevaluation");var g=0,f=0,e="",c=b;this.setClassification=function(a){this.classification=a};this.isHint=function(){return"HINT"==c};this.hasClassification=function(){return!0};this.setCurrentHintNumber=function(a){g=a};this.setTotalHintsAvailable=function(a){f=a};this.setHintID=function(a){e=a};this.getClassification=function(){return""};this.setEvaluation=function(a){c=a};this.getEvaluation=function(){return c};
this.getAttributeString=function(){var a="";if(!this.isHint())return a;a+='current_hint_number="'+g+'" ';a+='total_hints_available="'+f+'" ';""!==e&&(a+='hint_id="'+e+'" ');return a}};CTATActionEvaluationData.prototype=Object.create(CTATBase.prototype);CTATActionEvaluationData.prototype.constructor=CTATActionEvaluationData;var CTATLogMessageBuilder=function(){CTATBase.call(this,"CTATLogMessageBuilder","logmessagebuilder");var b=this,g=[],f=[],e="";this.getStepID=function(){return e};this.setContextName=function(c){CTATLogMessageBuilder.contextGUID=c};this.getContextName=function(){return CTATLogMessageBuilder.contextGUID};this.makeSessionElement=function(){var c=flashVars.getRawFlashVars();return void 0!=c.log_session_id&&null!=c.log_session_id?"<session_id>"+c.log_session_id+"</session_id>":"<session_id>"+c.session_id+
"</session_id>"};this.createContextMessage=function(c){b.ctatdebug("createContextMessage()");var a=new Date,d=flashVars.getRawFlashVars(),e='<context_message context_message_id="'+this.getContextName()+'" name="START_PROBLEM">';c||(e+=this.makeMetaElement(a));void 0!=d.class_name?""!=d.class_name?(c="<class>"+("<name>"+d.class_name+"</name>"),void 0!=d.school_name&&(c+="<school>"+d.school_name+"</school>"),void 0!=d.period_name&&(c+="<period>"+d.period_name+"</period>"),void 0!=d.class_description&&
(c+="<description>"+d.class_description+"</description>"),void 0!=d.instructor_name&&(c+="<instructor>"+d.instructor_name+"</instructor>"),c+="</class>"):c="<class />":c="<class />";e+=c;c=flashVars.getDatasetTypes();var f=flashVars.getDatasetNames();b.ctatdebug("Check: "+c.length+", "+f.length);if(null!=c&&null!=f){b.ctatdebug("We have valid data set names and types, adding to message ...");for(var a="<dataset>"+("<name>"+d.dataset_name+"</name>"),g=0;g<c.length;g++)b.ctatdebug("Adding ..."),a+=
'<level type="'+c[g]+'">',a+="<name>"+f[g]+"</name>";a+="<problem ";b.ctatdebug('Checking vars ["problem_tutorflag"]: '+d.problem_tutorflag);b.ctatdebug('Checking vars ["problem_otherproblemflag"]: '+d.problem_otherproblemflag);if(void 0!=d.problem_tutorflag||void 0!=d.problem_otherproblemflag)void 0!=d.problem_tutorflag?a+=' tutorFlag="'+d.problem_tutorflag+'"':void 0!=d.problem_otherproblemflag&&(a+='tutorFlag="'+d.problem_otherproblemflag+'"');a=a+">"+("<name>"+d.problem_name+"</name>");a=void 0!=
d.problem_context?a+("<context>"+d.problem_context+"</context>"):a+"<context />";a+="</problem>";for(d=0;d<c.length;d++)a+="</level>";e+=a+"</dataset>"}d="";c=flashVars.getConditionNames();a=flashVars.getConditionTypes();f=flashVars.getConditionDescriptions();if(0<c.length)for(g=0;g<c.length;g++)d+="<condition><name>"+c[g]+"</name>",d+=""==a[g]?"":"<type>"+a[g]+"</type>",d+=""==f[g]?"":"<desc>"+f[g]+"</desc>",d+="</condition>";var e=e+d,d=flashVars.getCustomFields(),p;for(p in d)d.hasOwnProperty(p)&&
(c=String(d[p]),c=0>c.indexOf("<![CDATA[")?"<![CDATA["+c+"]]\x3e":c,e+="<custom_field>",e+="<name>"+p+"</name>",e+="<value>"+c+"</value>",e+="</custom_field>");e+="</context_message>";b.ctatdebug("messageString = "+e);return e};this.createSemanticEventToolMessage=function(c,a,d,e,l,n){b.ctatdebug("createSemanticEventToolMessage("+n+")");var h=new Date;flashVars.getRawFlashVars();var q='<tool_message context_message_id="'+this.getContextName()+'">';l||(q+=this.makeMetaElement(h));a='<semantic_event transaction_id="'+
a+'" name="'+d+'"';""!=e&&(a+=' subtype="'+e+'"');void 0!=n&&""!=n&&(a+=' trigger="'+n+'"');q+=a+"/>";e="<event_descriptor>";c=c.toXMLString(!0);q+=e+c+"</event_descriptor>";q+=this.createCustomFields(g,f);q+="</tool_message>";b.ctatdebug("messageString = "+q);return q};this.createUIEventToolMessage=function(c,a,d,e){b.ctatdebug("createUIEventToolMessage()");var h=new Date;flashVars.getRawFlashVars();var n='<tool_message context_message_id="'+this.getContextName()+'">';e||(n+=this.makeMetaElement(h));
n+='<ui_event name="'+a+'">'+d+"</ui_event>";c="<event_descriptor>"+c.toSerializedString();n=n+(c+"</event_descriptor>")+this.createCustomFields(g,f);n+="</tool_message>";b.ctatdebug("messageString = "+n);return n};this.createTutorMessage=function(c,a,d,e,l,n,p,q){b.ctatdebug("createTutorMessage()");var h=new Date;flashVars.getRawFlashVars();var v='<tutor_message context_message_id="'+this.getContextName()+'">';q||(v+=this.makeMetaElement(h));a='<semantic_event transaction_id="'+a+'" name="'+d+'"';
""!==n&&(a+=' subtype="'+n+'"');v+=a+"/>";c="<event_descriptor>"+c.toXMLString(!0);v+=c+"</event_descriptor>";c="<action_evaluation ";e.hasClassification()&&null!=e.getAttributeString()&&(c+=e.getAttributeString());c+=">"+e.getEvaluation()+"</action_evaluation>";v+=c;""!=l&&(v+="<tutor_advice>"+l+"</tutor_advice>");null!=p&&(b.ctatdebug("Adding skills to log message ..."),v+=p.toLogString());v+=this.createCustomFields(g,f);v+="</tutor_message>";b.ctatdebug("messageString = "+v);return v};this.createGenericMessage=
function(c,a){b.ctatdebug("createGenericMessage()");flashVars.getRawFlashVars();a='<message context_message_id="'+this.getContextName()+'">';a=a+c+"</message>";b.ctatdebug("messageString = "+a);return a};this.makeMetaElement=function(c){b.ctatdebug("makeMetaElement ()");var a=flashVars.getRawFlashVars(),d;d="<meta>"+("<user_id>"+a.user_guid+"</user_id>");d+="<session_id>"+a.session_id+"</session_id>";d+="<time>"+this.formatTimeStamp(c)+"</time>";return d+="<time_zone>"+flashVars.getTimeZone()+"</time_zone></meta>"};
this.createLogSessionStart=function(){b.ctatdebug("createLogSessionStart ()");var c=new Date;b.ctatdebug("Date: "+c);var a='<log_session_start timezone="'+flashVars.getTimeZone()+'" ',d=flashVars.getRawFlashVars(),a=a+('date_time="'+CTATLogMessageBuilder.formatTimeStampOLI(c)+'" '),a=a+('auth_token="'+d.auth_token+'" '),a=a+('session_id="'+d.session_id+'" '),a=a+('user_guid="'+d.user_guid+'" ');return a+'class_id="" treatment_id="" assignment_id="" info_type="tutor_message.dtd"/>'};this.formatTimeStamp=
function(c){b.ctatdebug("formatTimeStamp ("+c+")");var a="",d=c.getUTCFullYear(),a=a+(d+"-"),d=c.getUTCMonth();d++;a+=(10>d?"0"+d:d)+"-";d=c.getUTCDate();a+=(10>d?"0"+d:d)+" ";d=c.getUTCHours();a+=(10>d?"0"+d:d)+":";d=c.getUTCMinutes();a+=(10>d?"0"+d:d)+":";d=c.getUTCSeconds();a+=(10>d?"0"+d:d)+".";c=c.getUTCMilliseconds();return a+((10>c?"00":100>c?"0":"")+c)};this.resetCustomFields=function(){b.ctatdebug("resetCustomFields ()");g=[];f=[]};this.createCustomFields=function(c,a){b.ctatdebug("createCustomFields ()");
if(null==c||null==a)return b.ctatdebug("No custom fields provided"),"";b.ctatdebug("Processing "+c.length+" custom fields ...");for(var d="",f=0;f<c.length;f++){b.ctatdebug("Adding custom field: ["+c[f]+"],["+a[f]+"]");var g=String(a[f]);/step[-_.]?id/i.test(c[f])&&(e=g);g=0>g.indexOf("<![CDATA[")?"<![CDATA["+g+"]]\x3e":g;d+="<custom_field>";d+="<name>"+c[f]+"</name>";d+="<value>"+g+"</value>";d+="</custom_field>"}return d};this.addCustomFields=function(c,a){b.ctatdebug("addCustomFields () "+(c?c.length:
"null"));if(void 0!=c)for(var d=0;d<c.length;d++)g.push(c[d]),f.push(a[d])};this.addCustomField=function(c,a){b.ctatdebug("addCustomfield ("+c+","+a+")");g.push(c);f.push(a)};this.getCustomFieldNames=function(){return g};this.getCustomFieldValues=function(){return f}};CTATLogMessageBuilder.prototype=Object.create(CTATBase.prototype);CTATLogMessageBuilder.prototype.constructor=CTATLogMessageBuilder;CTATLogMessageBuilder.contextGUID="";
CTATLogMessageBuilder.formatTimeStampOLI=function(b){ctatdebug("formatTimeStampOLI ("+b+")");var g="",f=b.getUTCFullYear(),g=g+(f+"/"),f=b.getUTCMonth();f++;g+=(10>f?"0"+f:f)+"/";f=b.getUTCDate();g+=(10>f?"0"+f:f)+" ";f=b.getUTCHours();g+=(10>f?"0"+f:f)+":";f=b.getUTCMinutes();g+=(10>f?"0"+f:f)+":";f=b.getUTCSeconds();g+=(10>f?"0"+f:f)+".";b=b.getUTCMilliseconds();return g+((10>b?"00":100>b?"0":"")+b)};
CTATLogMessageBuilder.wrapForOLI=function(b){ctatdebug("wrapForOLI ()");var g=new Date,f=flashVars.getRawFlashVars();b=encodeURIComponent(b);var e;e='<?xml version="1.0" encoding="UTF-8"?><log_action '+('auth_token="'+encodeURIComponent(f.auth_token)+'" ');e=void 0!=f.log_session_id&&null!=f.session_id?e+('session_id="'+f.log_session_id+'" '):e+('session_id="'+f.session_id+'" ');e=e+'action_id="EVALUATE_QUESTION" '+('user_guid="'+f.user_guid+'" ');e+='date_time="'+CTATLogMessageBuilder.formatTimeStampOLI(g)+
'" ';e+='timezone="'+flashVars.getTimeZone()+'" ';e+='source_id="'+f.source_id+'" ';e=f.activity_context_guid?e+('external_object_id="'+f.activity_context_guid+'" info_type="tutor_message.dtd">'):e+'external_object_id="" info_type="tutor_message.dtd">';return e+b+"</log_action>"};var CTATCustomLogElementObject=function(){this.reset=function(){};this.addCustomLogElement=function(b,g){customElementsNames.push(b);customElementsTypes.push(b)};this.getCustomElementNames=function(){return customElementsNames};this.getCustomElementTypes=function(){return customElementsTypes}};var loggingDisabled=!1,CTATLoggingLibrary=function(b,g){CTATBase.call(this,"CTATLoggingLibrary","logginglibrary");var f=this,e=!0,c="undefined"==typeof b?!0:b,a=!1,d=[],h="undefined",l="undefined",n="undefined",p="undefined",q="undefined",u="undefined",v="undefined",y="undefined",w="UnassignedDataset",A="UnassignedLevelName",z="UnassignedLevelType",C=null,D=null,F=null,y=CTATGuid.guid(),G=new CTATCommLibrary;G.setName("commLoggingLibrary");G.setUseCommSettings(!1);G.setConnectionRefusedMessage("ERROR_CONN_LS");
G.assignHandler(this);G.setFixedURL(CTATConfiguration.get("log_service_url"));this.extCommLogMessageBuilder=g;this.getLastSAI=function(){return D};this.assignLogListener=function(a){C=a};this.generateSession=function(){d.session_id="ctat_session_"+CTATGuid.guid();return d.session_id};this.setLogClassName=function(a){h=a};this.setDatasetName=function(a){w=a};this.setDatasetLevelName=function(a){A=a};this.setDatasetLevelType=function(a){z=a};this.setSchool=function(a){l=a};this.setPeriod=function(a){n=
a};this.setDescription=function(a){p=a};this.setInstructor=function(a){q=a};this.setProblemName=function(a){u=a};this.setProblemContext=function(a){v=a};this.setUserID=function(a){y=a};this.getLoggingCommLibrary=function(){return G};this.setUseSessionLog=function(a){e=a};this.setLoggingURL=function(a){f.getLoggingCommLibrary().setFixedURL(a)};this.getSessionIdentifierBundle=function(){var a=[];a.class_name=h;a.school_name=l;a.period_name=n;a.class_description=p;a.instructor_name=q;a.dataset_name=
w;a.problem_name=u;a.problem_context=v;a.auth_token="";a.user_guid=y;a.session_id=d.session_id;a.source_id="tutor";a.dataset_level_name1=A;a.dataset_level_type1=z;return a};this.setupExternalLibraryUsage=function(){f.ctatdebug("setupExternalLibraryUsage ()");d.class_name=h;d.school_name=l;d.period_name=n;d.class_description=p;d.instructor_name=q;d.dataset_name=w;d.problem_name=u;d.problem_context=v;d.auth_token="";d.user_guid=y;d.session_id="ctat_session_"+CTATGuid.guid();d.source_id="tutor";d.dataset_level_name1=
A;d.dataset_level_type1=z;flashVars=CTATConfiguration.generateDefaultConfigurationObject();flashVars.assignRawFlashVars(d)};this.initCheck=function(){f.ctatdebug("initCheck ()");0==c&&0==a&&(f.setupExternalLibraryUsage(),a=!0)};this.sendMessage=function(a,c){f.ctatdebug("sendMessage ()");f.ctatdebug("Raw log message to send (info "+c+"): "+a);this.sendMessageInternal(a,c);null!=C&&C(a)};this.sendMessageInternal=function(a,d){f.ctatdebug("sendMessageInternal ()");if(!0===loggingDisabled)f.ctatdebug("Warning: loggingDisabled==true");
else if(1==c){var b=CTATConfiguration.get("Logging");if("ClientToService"!=b&&"ClientToLogServer"!=b)f.ctatdebug("Logging is turned off, as per: "+b);else{var e=CTATConfiguration.get("tutoring_service_communication");"ClientToService"!=b||"http"!=e&&"https"!=e||(b=CTATConfiguration.get("remoteSocketURL")+":"+CTATConfiguration.get("remoteSocketPort"),f.setLoggingURL(b),f.ctatdebug("Reconfigured the logging url to be: "+b));f.ctatdebug("Pre encoded log message: "+a);b=a;0>a.indexOf("<log_session_start")&&
(b=CTATLogMessageBuilder.wrapForOLI('<?xml version="1.0" encoding="UTF-8"?><tutor_related_message_sequence version_number="4">'+a+"</tutor_related_message_sequence>"));f.ctatdebug("Encoded log message: "+b);F=CTATLMS.logEvent(b,a,d);(a=CTATConfiguration.get("log_service_url"))&&(/parent/i.test(a)?parent.postMessage({command:"datashopLogMessage",payload:b},location.origin):navigator.sendBeacon(a,b))}}else f.ctatdebug("Use internal: "+c)};this.startProblem=function(){f.ctatdebug("startProblem ()");
f.initCheck();f.logSessionStart();var a=f.extCommLogMessageBuilder||new CTATLogMessageBuilder;f.sendMessage(a.createContextMessage(!0),{datashopType:"context"})};this.logSessionStart=function(){f.ctatdebug("logSessionStart ()");f.initCheck();var a=CTATConfiguration.getRawFlashVars();void 0!=a.SessionLog&&("false"==a.SessionLog||"boolean"==typeof a.SessionLog&&!1===a.SessionLog?(f.ctatdebug("Turning SessionLog off ..."),e=!1):(f.ctatdebug("Turning SessionLog on ..."),e=!0));!0===e&&(a=f.extCommLogMessageBuilder||
new CTATLogMessageBuilder,this.sendMessage(a.createLogSessionStart(),{datashopType:"sessionStart"}))};this.logSemanticEvent=function(a,c,d,b,e,h,g){f.ctatdebug("logSemanticEvent ("+g+")");f.initCheck();D=c;var l=new Date,n=f.extCommLogMessageBuilder||new CTATLogMessageBuilder;n.resetCustomFields();n.addCustomFields(e,h);n.addCustomField("tool_event_time",n.formatTimeStamp(l)+" UTC");a=n.createSemanticEventToolMessage(c,a,d,b,!0,g);this.sendMessage(a,{datashopType:"tool",semanticName:d,sai:c})};this.logTutorResponse=
function(a,c,d,b,e,h,g,l,n){f.ctatdebug("logTutorResponse ()");f.initCheck();D=c;var w=new Date,p=f.extCommLogMessageBuilder||new CTATLogMessageBuilder;p.resetCustomFields();p.addCustomFields(l,n);p.addCustomField("tutor_event_time",p.formatTimeStamp(w)+" UTC");f.ctatdebug("Formatting feedback ...");void 0!=h&&null!=h?h="<![CDATA["+CTATGlobals.languageManager.filterString(h)+"]]\x3e":(f.ctatdebug("No feedback provided, using empty string"),h="");f.ctatdebug("Creating tutor message ...");a=p.createTutorMessage(c,
a,d,e,h,b,g,!0);this.sendMessage(a,{datashopType:"tutor",semanticName:d,stepID:p.getStepID(),sai:c,evaluation:e&&e.getEvaluation?e.getEvaluation():"",tutorAdvice:h});return a};this.processMessage=function(a){f.ctatdebug("processMessage ()");f.ctatdebug("Response from log server: "+a)};this.start=function(){f.ctatdebug("start ()");var a=f.generateSession();f.startProblem();return a};this.logInterfaceAttempt=function(a,c,d,b){f.ctatdebug("logInterfaceAttempt ()");b=CTATGuid.guid();a=new CTATSAI(a,c,
d);a.setInput(d);D=a;this.logSemanticEvent(b,a,"ATTEMPT","");return b};this.logInterfaceAttemptSAI=function(a,c){f.ctatdebug("logInterfaceAttemptSAI ()");D=a;c=CTATGuid.guid();this.logSemanticEvent(c,a,"ATTEMPT","");return c};this.logResponse=function(a,c,d,b,e,h,g,l){f.ctatdebug("logResponse ()");c=new CTATSAI(c,d,b);c.setInput(b);b=new CTATActionEvaluationData("");b.setEvaluation(h);void 0==l?this.logTutorResponse(a,c,e,"",b,g):this.logTutorResponse(a,c,e,"",b,g,null,l.getCustomElementNames(),l.getCustomElementTypes())};
this.logResponseSAI=function(a,c,d,b,e,h){f.ctatdebug("logResponse ()");var g=new CTATActionEvaluationData("");g.setEvaluation(b);void 0==h?this.logTutorResponse(a,c,d,"",g,e):this.logTutorResponse(a,c,d,"",g,e,null,h.getCustomElementNames(),h.getCustomElementTypes())};this.endSession=function(){this.generateSession()};this.then=function(a,c,d){var b=[];G&&"function"==typeof G.then&&b.push(G);F&&"function"==typeof F.then&&b.push(F);if(0<(d=Number(d))){var e=Date.now();b.push(new Promise(function(a,
c){setTimeout(c,d,e)}))}return Promise.race(b).then(a,c)}};CTATLoggingLibrary.prototype=Object.create(CTATBase.prototype);CTATLoggingLibrary.prototype.constructor=CTATLoggingLibrary;var CTATComponentDescription=function(){CTATBase.call(this,"CTATComponentDescription","");this.groupName=this.name=this.type="Unknown";this.height=this.width=this.y=this.x=0;this.tabIndex=this.zIndex=-1;this.styles={};this.params={};this.componentPointer=null;this.setComponentPointer=function(b){this.componentPointer=b};this.getComponentPointer=function(){return this.componentPointer};this.setGenericDefaults=function(){this.name="Generic name";this.styles={BackgroundColor:null,BorderColor:null,FontName:null,
FontSize:null,FontColor:null,FontBold:null,FontItalic:!1,FontUnderlined:!1,TextAlign:null,ShowHintHighlight:!1,blockOnCorrect:!1,disabledBackgroundColor:"#999999",disabledTextColor:"#999999",tutorComponent:null};return this}};CTATComponentDescription.prototype=Object.create(CTATBase.prototype);CTATComponentDescription.prototype.constructor=CTATComponentDescription;var CTATShellTools={ctat_base:new CTATBase("CTATShellTools","shelltools"),component_descriptions:{},registerComponentDescription:function(b){CTATShellTools.ctat_base.ctatdebug("registerComponentDescription ("+b.name+","+b.type+")");CTATShellTools.component_descriptions[b.name]=b},listComponents:function(){CTATShellTools.ctat_base.ctatdebug("listComponents ()");var b=CTATShellTools.component_descriptions,g;for(g in b){var f=b[g];CTATShellTools.ctat_base.ctatdebug("Obtaining component for "+f.name+
" with type: "+f.type);f=f.getComponentPointer();null!==f?CTATShellTools.ctat_base.ctatdebug("Component: "+f.getName()+" of instance: "+f.getClassName()):CTATShellTools.ctat_base.ctatdebug("Error: component pointer is null")}},feedback_components:[],registerFeedbackComponent:function(b,g,f,e,c){CTATShellTools.feedback_components.push({component:b,next:g,prev:f,showHints:e,showFeedback:c})},showNextHint:function(){CTATShellTools.feedback_components.forEach(function(b){b.next&&b.next.bind(b.component)()})},
showPrevHint:function(){CTATShellTools.feedback_components.forEach(function(b){b.prev&&b.prev.bind(b.component)()})},showFeedback:function(b,g){0==CTATShellTools.feedback_components.length?CTATScrim.scrim.OKScrimUp(b,null):CTATShellTools.feedback_components.forEach(function(f){f.showFeedback&&f.showFeedback.call(f.component,b,g)})},showHints:function(b){CTATShellTools.feedback_components.forEach(function(g){g.showHints&&g.showHints.call(g.component,b)})},getCurrentMs:function(){return(new Date).valueOf()},
getAllComponents:function(){var b=[];$(".CTATComponent").each(function(){b.push($(this).data("CTATComponent"))});return b},getNameFromGroup:function(b){CTATShellTools.ctat_base.ctatdebug("getNameFromGroup ("+b+")");var g=b.split(" ");return 1==g.length?b:g[0].substring(0,g[0].length-1)},findComponent:function(b){var g=CTATShellTools.component_descriptions,f=[],e=null;CTATShellTools.ctat_base.ctatdebug("findComponent("+b+")");if(!b)return[];for(var c=['div[data-ctat-component]:has(input[name="'+b+
'"])',"done"==b.toLowerCase()?".CTATDoneButton":"","hint"==b.toLowerCase()||"help"==b.toLowerCase()?".CTATHintButton":""],e=$('[id="'+b+'"]'),a=0;0===e.length&&a<c.length;a++)e=$(c[a]);if(0<e.length&&(e.each(function(){$(this).data("CTATComponent")&&f.push($(this).data("CTATComponent"))}),0<f.length))return f;CTATShellTools.ctat_base.ctatdebug("JQuery couldn't find the component, let's try our internal list ...");for(var d in g){e=g[d];if(!e||!e.name||!e.getComponentPointer())return CTATShellTools.ctat_base.ctatdebug("Internal error parsing component at index "+
d+(e?e.name?"(no component pointer)":"(no name attribute)":"")),null;CTATShellTools.ctat_base.ctatdebug("Comparing "+e.name+" to: "+b);if(e.name==b)return CTATShellTools.ctat_base.ctatdebug("Found a component description for ["+e.name+"], returning pointer ("+e.getComponentPointer()+") ..."),f.push(e.getComponentPointer()),f;e.groupName==b&&(CTATShellTools.ctat_base.ctatdebug("Found the component group ("+e.groupName+"), adding component instance for "+e.name+" ..."),f.push(e.getComponentPointer()))}return 0===
f.length&&(CTATShellTools.ctat_base.ctatdebug("Info (groupArray.length==0), no appropriate component found, perhaps this is a group component"),-1!=b.indexOf("."))?(b=b.split("."),this.findComponent(b[0])):f},findComponentInstance:function(b,g){b=CTATShellTools.findComponent(b,g);return 1==b.length?b[0]:b},findComponentByClass:function(b){var g=CTATShellTools.component_descriptions,f;for(f in g){var e=g[f];if(null===e)return null;if(null!==e.getComponentPointer()&&e.getComponentPointer().getClassName()==
b)return e.getComponentPointer()}b=$("."+b);return 0<b.length?b.first().data("CTATComponent"):null}};CTATShellTools.reservedSelections={nextButton:{name:"nextButton",executeSAI:CTATShellTools.showNextHint},previousButton:{name:"previousButton",executeSAI:CTATShellTools.showPrevHint}};CTATShellTools.execReservedSelection=function(b){var g=b.getSelection(),f=b.getAction(),e=b.getInput();return(b=CTATShellTools.reservedSelections[g])?(b.executeSAI(g,f,e),!0):!1};
CTATShellTools.getReservedSelection=function(b){return CTATShellTools.reservedSelections[b&&b.getSelection()]};var CTATTutoringServiceMessageBuilder=function(){CTATBase.call(this,"CTATTutoringServiceMessageBuilder","__undefined__");this.createStartProblemMessage=function(b){this.ctatdebug("createStartProblemMessage ()");return"<message><verb>NotePropertySet</verb><properties><MessageType>StartProblem</MessageType><ProblemName>"+b+"</ProblemName></properties></message>"};this.createInterfaceIdentificationMessage=function(b){this.ctatdebug("createInterfaceIdentificationMessage ("+b+")");return"<message><verb>NotePropertySet</verb><properties><MessageType>InterfaceIdentification</MessageType><Guid>"+
b+"</Guid></properties></message>"};this.createInterfaceDescriptionMessage=function(b){this.ctatdebug("createInterfaceDescriptionMessage ()");var g=b.getSAI&&b.getSAI();message="<message><verb>NotePropertySet</verb><properties><MessageType>InterfaceDescription</MessageType>";message+="<WidgetType>"+b.getClassName()+"</WidgetType>";message+="<CommName>"+(g?g.getSelection():b.getName())+"</CommName>";message+="<Action>"+(g?g.getAction():"")+"</Action>";message+="<UpdateEachCycle>false</UpdateEachCycle>";
message+="<serialized>";message+="<"+b.getClassName()+' name="'+b.getName()+'" x="0" y="0" width="50" height="30" scaleX="1" scaleY="1" originalWidth="50" originalHeight="30" zIndex="-1" tabIndex="-1">';message+="<Parameters><selection>";if("CTATRadioButton"==b.getClassName()||"CTATCheckBox"==b.getClassName())message+="<CTATComponentParameter>",message+="<name>group</name>",message+='<value fmt="text" name="Group Name" type="String" includein="sparse">'+b.getComponentGroup()+"</value>",message+="</CTATComponentParameter>";
message+="</selection></Parameters>";message+="</"+b.getClassName()+">";message+="</serialized>";return message+="</properties></message>"};this.createSetPreferencesMessage=function(b,g){this.ctatdebug("createSetPreferencesMessage ()");var f=CTATConfiguration.getRawFlashVars(),e;e="<message><verb>NotePropertySet</verb><properties><MessageType>SetPreferences</MessageType>"+("<log_service_url>"+f.log_service_url+"</log_service_url>");var c=!1,a=!1,d=f.Logging;this.ctatdebug("Parsing and processing logMethod: "+
d);switch(d){case "ServiceToLogServer":c=!0;break;case "ServiceToDisk":a=!0;break;case "ServiceToDiskAndLogServer":a=c=!0;break;case "ClientToLogServer":a=c=!1;break;case "ClientToService":a=c=!0}e=e+("<log_to_remote_server>"+c+"</log_to_remote_server><log_to_disk>"+a+"</log_to_disk>")+("<log_to_disk_directory>"+f.log_to_disk_directory+"</log_to_disk_directory>");e+="<logging>"+f.Logging+"</logging>";e+="<user_guid>"+f.user_guid+"</user_guid>";e+="<problem_name>"+f.problem_name+"</problem_name>";
e+="<question_file><![CDATA["+f.question_file+"]]\x3e</question_file>";e+="<class_name>"+f.class_name+"</class_name>";e+="<school_name>"+f.school_name+"</school_name>";e+="<instructor_name>"+f.instructor_name+"</instructor_name>";e+="<session_id>"+f.session_id+"</session_id>";e+="<source_id>"+f.source_id+"</source_id>";e+="<sui><![CDATA["+f.sui+"]]\x3e</sui>";e+="<problem_state_status>"+f.problem_state_status+"</problem_state_status>";e+="<curriculum_service_url>"+f.curriculum_service_url+"</curriculum_service_url>";
e+="<restore_problem_url>"+f.restore_problem_url+"</restore_problem_url>";e+="<tutoring_service_communication>"+f.tutoring_service_communication+"</tutoring_service_communication>";e+="<mode>"+f.mode+"</mode>";e+="<collaborators>"+f.collaborators+"</collaborators>";null!==CTATSkillSet.skills&&(e+=CTATSkillSet.skills.toSetPreferencesXMLString());e+="<CommShellVersion>"+b+"</CommShellVersion>";g&&(e+="<interface_descriptions>"+g+"</interface_descriptions>");return""+(e+"</properties></message>")};this.createTracerActionMessage=
function(b,g){this.ctatdebug("createTracerActionMessage ()");b="<message><verb>NotePropertySet</verb><properties><MessageType>TracerAction</MessageType>"+("<transaction_id>"+b+"</transaction_id>")+g.toXMLString(!1);return""+(b+"</properties></message>")};this.createInterfaceActionMessage=function(b,g,f,e,c){this.ctatdebug("createInterfaceActionMessage ()");b="<message><verb>NotePropertySet</verb><properties><MessageType>InterfaceAction</MessageType>"+("<transaction_id>"+b+"</transaction_id>")+g.toXMLString(!1);
f&&(b+="<trigger>"+f+"</trigger>","user"!=f.toLowerCase()&&(b+="<actor>tutor</actor>"));!1===e&&(b+="<shouldLog>false</shouldLog>");null!=c&&(b+="<saveForRestore>"+(new Boolean(c)).toString()+"</saveForRestore>");return""+(b+"</properties></message>")};this.createUntutoredActionMessage=function(b,g,f,e,c){this.ctatdebug("createUntutoredActionMessage ("+b+")");b="<message><verb>NotePropertySet</verb><properties><MessageType>UntutoredAction</MessageType>"+("<transaction_id>"+b+"</transaction_id>")+
g.toXMLString(!1);f&&(b+="<trigger>"+f+"</trigger>","user"!=f.toLowerCase()&&(b+="<actor>tutor</actor>"));!1===e&&(b+="<shouldLog>false</shouldLog>");null!=c&&(b+="<saveForRestore>"+(new Boolean(c)).toString()+"</saveForRestore>");return""+(b+"</properties></message>")};this.createProblemSummaryRequestMessage=function(){return"<message><verb>NotePropertySet</verb><properties><MessageType>ProblemSummaryRequest</MessageType></properties></message>"};this.createProblemRestoreEndMessage=function(){return"<message><verb>NotePropertySet</verb><properties><MessageType>ProblemRestoreEnd</MessageType></properties></message>"};
this.createInterfaceConfigurationEnd=function(){return"<message><verb>NotePropertySet</verb><properties><MessageType>InterfaceConfigurationEnd</MessageType></properties></message>"};this.createInCorrectActionMessage=function(b,g){this.ctatdebug("createInCorrectActionMessage ()");b="<message><verb>SendNoteProperty</verb><properties><MessageType>InCorrectAction</MessageType>"+("<transaction_id>"+b+"</transaction_id>")+g.toXMLString(!1);return""+(b+"</properties></message>")};this.createURLResponse=
function(b,g){CTATGlobal.debug(classType,"createURLResponse ()");return"<message><verb>NotePropertySet</verb><properties><MessageType>GetURLResponse</MessageType><URL><![CDATA[ "+b+" ]]\x3e</URL><content><![CDATA[ "+btoa(g)+" ]]\x3e</content></properties></message>"};this.createCorrectActionMessage=function(b,g){this.ctatdebug("createCorrectActionMessage ()");b="<message><verb>SendNoteProperty</verb><properties><MessageType>CorrectAction</MessageType>"+("<transaction_id>"+b+"</transaction_id>")+g.toXMLString(!1);
return""+(b+"</properties></message>")}};CTATTutoringServiceMessageBuilder.prototype=Object.create(CTATBase.prototype);CTATTutoringServiceMessageBuilder.prototype.constructor=CTATTutoringServiceMessageBuilder;var CTATMessageHandler=function(b){function g(a){var c=a&&a.getProperty("WidgetLockFlag");switch(String(c).toLowerCase()){case "no":case "off":case "false":a=!1;break;default:a=!0}e.ctatdebug("processSendWidgetLock() wlFlag "+c+", result"+a);return a}CTATBase.call(this,"CTATMessageHandler","messagehandler");var f=null,e=this,c=!0,a=null,d=0;this.inStartState=!1;a=CTATConfig.parserType_is_XML()?new CTATXML:new CTATJSON;this.assignHandler=function(a){e.ctatdebug("assignHandler ()");f=a};this.reset=
function(){e.ctatdebug("reset ()")};this.getInStartState=function(){return e.inStartState};var h=!1;this.receiveFromTutor=function(a){this.processMessage(a)};this.processMessage=function(c){e.ctatdebug("Incoming message: "+c);if(!0!==h)if(CTATConfig.parserType_is_JSON()&&-1!=c.indexOf("<?xml"))alert("Error: CTAT is configured to parse JSON but it received an XML message, disabling comm capabilities ..."),h=!0;else if(CTATConfig.parserType_is_XML()&&0===c.indexOf("{"))alert("Error: CTAT is configured to parse XML but it received a JSON message, disabling comm capabilities ..."),
h=!0;else{var d;e.ctatdebug("Attempting parse ...");d=a.parse(c);null===d?e.ctatdebug("Error parsing message: "+c):this.parseElement(d,c)}};this.parseElement=function(c,d){var b=a.getElementName(c);e.ctatdebug("parseElement ("+b+")");"CTATResponseMessages"!=b&&"StartStateMessages"!=b&&"MessageBundle"!=b||this.processMessageBundle(c);"message"==b&&this.processSingleMessage(c,d)};this.processMessageBundle=function(c,d){d=a.getElementName(c);e.ctatdebug("processMessageBundle ("+d+")");c=a.getElementChildren(c);
if(null===c)e.ctatdebug("Error parsing bundle");else for(ctatdebug("Processing "+c.length+" objects in bundle"),d=0;d<c.length;d++)this.parseElement(c[d])};this.processSingleMessage=function(h,n){e.ctatdebug("processSingleMessage ("+a.getElementName(h)+")");b.sendToTools(n);n=new CTATMessage(h);var l=n.getProperty("Actor")||n.getProperty("subtype"),l=!l||/tutor/i.test(l)?"tutor":l;f.updateLastActionTimestamp&&f.updateLastActionTimestamp();h=a.getElementChildren(h);e.ctatdebug("Generated CTATMessage, now doing regular processing ...");
for(var q=0;q<h.length;q++){var u=h[q];if("properties"==a.getElementName(u)){e.ctatdebug("Parsing properties ...");for(var v=a.getElementChildren(u),y=0;y<v.length;y++){var w=v[y];if("MessageType"==a.getElementName(w)){w=a.getNodeTextValue(w);e.ctatdebug("MessageType: "+w);switch(w){case "StateGraph":ctatdebug("Setting inStartState to true");e.inStartState=!0;b.setGotProblemRestoreEnd(!1);this.processStateGraph(u);b.propagateShellEvent("StateGraph",n);break;case "StartProblem":e.ctatdebug("Setting inStartState to true");
e.inStartState=!0;b.setGotProblemRestoreEnd(!1);this.processStartProblem(v);b.propagateShellEvent("StartProblem",n);break;case "InterfaceDescription":this.processInterfaceDescription(v);b.propagateShellEvent("InterfaceDescription",n);break;case "GetAllInterfaceDescriptions":b.sendInterfaceDescriptionMessages();b.propagateShellEvent("GetAllInterfaceDescriptions",n);break;case "SendWidgetLock":e.ctatdebug("Found: SendWidgetLock");!0===e.getInStartState()&&(c=g(n));b.propagateShellEvent("SendWidgetLock",
n);break;case "CorrectAction":e.ctatdebug("Found: CorrectAction");f.processCorrectAction(n);b.propagateShellEvent("CorrectAction",n);break;case "InCorrectAction":e.ctatdebug("Found: InCorrectAction");f.processInCorrectAction(n);b.propagateShellEvent("InCorrectAction",n);break;case "HighlightMsg":e.ctatdebug("Found: HighlightMsg");f.processHighlightMsg(n);b.propagateShellEvent("HighlightMsg",n);break;case "UnHighlightMsg":e.ctatdebug("Found: UnHighlightMsg");f.processUnHighlightMsg(n);b.propagateShellEvent("UnHighlightMsg",
n);break;case "AssociatedRules":e.ctatdebug("Found: AssociatedRules ("+v.length+")");for(var A="",z=w="",C=0;C<v.length;C++){var D=v[C];switch(a.getElementName(D)){case "TutorAdvice":A=a.getValueNodesAsText(D);D=a.getNodeTextValue(D);A=A&&A.length?A[0]:D?D:"";break;case "Actor":l=a.getNodeTextValue(D);break;case "Indicator":w=a.getNodeTextValue(D);break;case "StepID":a.getNodeTextValue(D);break;case "LogAsResult":a.getNodeTextValue(D);break;case "tool_selection":case "StudentSelection":z=a.getNodeTextValue(D);
break;case "Skills":e.ctatdebug("Processing skills ..."),null===CTATSkillSet.skills&&(e.ctatdebug("Interesting, there isn't a skillSet object yet. Creating ..."),CTATSkillSet.skills=new CTATSkillSet),CTATSkillSet.skills.parseByValue(D)}}f.processAssociatedRules(n,w,A,z);b.propagateShellEvent("AssociatedRules",n,l);break;case "BuggyMessage":e.ctatdebug("Found: BuggyMessage");f.processBuggyMessage(n);b.propagateShellEvent("BuggyMessage",n);break;case "SuccessMessage":e.ctatdebug("Found: SuccessMessage");
f.processSuccessMessage(n);b.propagateShellEvent("SuccessMessage",n);break;case "InterfaceAction":e.ctatdebug("Found: InterfaceAction");w=n.getSAI();-1!=w.getAction().indexOf(":")?(e.ctatdebug("Processing and storing timed interface action : "+w.getAction()),z=parseInt(w.getAction().substring(w.getAction().indexOf(":")+1)),e.ctatdebug("Target time: "+z),w.setAction(w.getAction().substring(0,w.getAction().indexOf(":"))),e.ctatdebug("Timing ..."),setTimeout(f.processInterfaceAction,z,n),setTimeout(b.propagateShellEvent,
z,"InterfaceAction",n,l)):(e.ctatdebug("Processing regular (non-timed) interface action"),f.processInterfaceAction(n,c),b.propagateShellEvent("InterfaceAction",n,l));break;case "UntutoredAction":e.ctatdebug("Found: UntutoredAction");w=n.getSAI();-1!=w.getAction().indexOf(":")?(e.ctatdebug("Processing and storing timed interface action : "+w.getAction()),z=parseInt(w.getAction().substring(w.getAction().indexOf(":")+1)),e.ctatdebug("Target time: "+z),w.setAction(w.getAction().substring(0,w.getAction().indexOf(":"))),
e.ctatdebug("Timing ..."),setTimeout(f.processUntutoredAction,z,n),setTimeout(b.propagateShellEvent,z,"UntutoredAction",n,l)):(e.ctatdebug("Processing regular (non-timed) untutored action"),f.processUntutoredAction(n,c),b.propagateShellEvent("UntutoredAction",n,l));break;case "InterfaceIdentification":e.ctatdebug("Found: InterfaceIdentification");b.propagateShellEvent("InterfaceIdentification",n);break;case "AuthorModeChange":e.ctatdebug("Found: AuthorModeChange");f.globalReset();b.propagateShellEvent("AuthorModeChange",
n);break;case "ResetAction":e.ctatdebug("Found: ResetAction");f.globalReset();b.propagateShellEvent("ResetAction",n);break;case "ShowHintsMessage":e.ctatdebug("Found: ShowHintsMessage");w=[];for(z=0;z<v.length;z++)C=v[z],"HintsMessage"==a.getElementName(C)&&(w=w.concat(a.getValueNodesAsText(C)));w.length?f.processHintResponse(n,w):e.ctatdebug("Error: incomplete hint message received");b.propagateShellEvent("ShowHintsMessage",n);break;case "ConfirmDone":e.ctatdebug("Found: ConfirmDone");f.processConfirmDone(n);
b.propagateShellEvent("ConfirmDone",n);break;case "VersionInfo":e.ctatdebug("Found: VersionInfo");f.processVersionInfo(v);b.propagateShellEvent("VersionInfo",n);break;case "TutoringServiceAlert":e.ctatdebug("Found: TutoringServiceAlert");f.processTutoringServiceAlert(v);b.propagateShellEvent("TutoringServiceAlert",n);break;case "TutoringServiceError":w=n.getProperty("Action");e.ctatdebug("Found: TutoringServiceError - actor "+l+", action "+w);var F;w&&(F=CTATSAI.delayedActionRegExp.exec(w))&&2<F.length&&
1<F[2]?(z=parseInt(F[2]),n.setProperty("Action",F[1]),e.ctatdebug("Delaying TutoringServiceError by "+z+" ..."),setTimeout(f.processTutoringServiceError,z,n),setTimeout(b.propagateShellEvent,z,"TutoringServiceError",n,l)):(f.processTutoringServiceError(n),b.propagateShellEvent("TutoringServiceError",n,l));break;case "ProblemSummaryResponse":e.ctatdebug("Found: ProblemSummaryResponse");f.processProblemSummaryResponse(n);b.propagateShellEvent("ProblemSummaryResponse",n);break;case "StartStateEnd":e.ctatdebug("Found: StartStateEnd");
CTATShellTools.listComponents();null!==f?(e.inStartState=!0,f.processStartState()):this.ctatdebug("Error: no message handler object available to process start state");try{e.processStartStateActions()}catch(G){e.ctatdebug("Caught in the act: "+G.message)}e.inStartState=!1;b.propagateShellEvent("StartStateEnd",n);break;case "ProblemRestoreEnd":e.ctatdebug("Found: ProblemRestoreEnd");f.processProblemRestoreEnd(n);b.propagateShellEvent("ProblemRestoreEnd",n);break;case "GetURL":e.ctatdebug("Found: GetURL");
f.processGetURL(n);b.propagateShellEvent("GetURL",n);break;case "SetPreferences":f.forwardToTutor(n);return;case "InterfaceReboot":d++;w=n.getProperty("Force");z=n.getProperty("TutorOnly");ctatdebug("Found: InterfaceReboot #"+d+" -- href "+(location?location.href:"(no location)"));z||!(w||1<d)||CTAT.ToolTutor.reboot(n.getProperty("Reason")||"InterfaceReboot from CTATMessageHandler",null,null,w)||(w="ws://"+CTATConfiguration.get("remoteSocketURL")+":"+CTATConfiguration.get("remoteSocketPort"),ctatdebug("closing connection w/ url: "+
w),b.closeWSConnection(w,function(){var a=window.frameElement.getAttribute("id");"function"==typeof CustomEvent&&(a=new CustomEvent("refreshIframe",{detail:a}),window.parent.document.dispatchEvent(a))},"interfaceReboot"));break;case "NoOp":l=n&&n.getTransactionID();n=n&&n.getSAI();ctatdebug("NoOp transactionID "+l+", SAI "+n);return}(w=/student[0-9]+/i.exec(l))&&w[0]==l&&f.forwardToTutor(n)}}}}};this.processStateGraph=function(c){e.ctatdebug("processStateGraph ()");if(void 0===c||null===c)e.ctatdebug("Error: state graph property list is undefined");
else if(e.ctatdebug("Processing node: "+c.nodeName),null===a.getElementChildren(c))e.ctatdebug("Error: state graph property list is undefined");else{c=a.getElementChildren(c);for(var d=0;d<c.length;d++){var b=c[d],h=a.getElementName(b),g=a.getNodeTextValue(b);e.ctatdebug("State graph attribute: "+h+" = "+g);"suppressStudentFeedback"==h&&(CTATGlobals.suppressStudentFeedback="false"==g?!1:!0);"confirmDone"==h&&(e.ctatdebug("Confirm done: "+g),CTATGlobals.confirmDone="true"==g?!0:!1);"Skills"==h&&(null===
CTATSkillSet.skills&&(CTATSkillSet.skills=new CTATSkillSet),CTATSkillSet.skills.parseByValue(b),f.updateSkillWindow())}}};this.processStartProblem=function(a){e.ctatdebug("processStartProblem ()");f.processStartProblem()};this.processInterfaceDescription=function(c){e.ctatdebug("processInterfaceDescription ("+c.length+")");for(var d="Unknown",b="Unknown",f=null,h=0;h<c.length;h++){var g=c[h];e.ctatdebug("Inspecting element: "+a.getElementName(g));"WidgetType"==a.getElementName(g)&&(e.ctatdebug("Widget type: "+
a.getNodeTextValue(g)),d=a.getNodeTextValue(g));"CommName"==a.getElementName(g)&&(e.ctatdebug("Instance name: "+a.getNodeTextValue(g)),b=a.getNodeTextValue(g));if("serialized"==a.getElementName(g)){e.ctatdebug("Prepareing to de-serialize component ...");for(var l=a.getElementChildren(g),w=0;w<l.length;w++){var A=l[w];-1!=a.getElementName(A).indexOf("CTAT")&&(f=A)}}"interface"==a.getElementName(g)&&(e.ctatdebug("Storing interface for post start-state reconstruction ..."),CTATGlobals.interfaceElement=
g);"script"==a.getElementName(g)&&(e.ctatdebug("Storing and loading main javascript code as defined by the BRD ..."),scriptElement=a.getNodeTextValue(g))}null!==f?this.deserializeComponent(d,b,f):e.ctatdebug("Error: unable to find CTAT serialization point of attachement");e.ctatdebug("processInterfaceDescription () done")};this.deserializeComponent=function(c,d,b){e.ctatdebug("deserializeComponent ("+c+","+d+")");if(!0===CTATGlobals.ignoreInterfaceDescriptions)e.ctatdebug("ignoreInterfaceDescriptions==true");
else if(null===a.getElementAttr(b,"x"))e.ctatdebug("Warning: this component does not have x,y information. Probably an older component");else{var f=a.getElementAttr(b,"x"),h=a.getElementAttr(b,"y"),g=a.getElementAttr(b,"width"),l=a.getElementAttr(b,"height"),n=a.getElementAttr(b,"tabIndex"),p=a.getElementAttr(b,"zIndex");null===n&&(n=-1);null===p&&(p=0);var z=new CTATComponentDescription;z.type=c;z.name=d;z.x=Math.floor(f);z.y=Math.floor(h);z.tabIndex=n;z.zIndex=p;z.width=Math.floor(g);z.height=Math.floor(l);
CTATShellTools.registerComponentDescription(z);b=a.getElementChildren(b);for(f=0;f<b.length;f++){h=b[f];a.getElementName(h);if("Parameters"==a.getElementName(h))for(this.ctatdebug("Processing component parameters ..."),g=a.getElementChildren(h)[0],g=a.getElementChildren(g),l=0;l<g.length;l++){var C=g[l];if("CTATComponentParameter"==a.getElementName(C)){this.ctatdebug("Processing parameter property (CTATComponentParameter) ...");for(var p=n=void 0,C=a.getElementChildren(C),D=0;D<C.length;D++){var F=
C[D];"name"==a.getElementName(F)&&(this.ctatdebug("Found parameter name: "+a.getNodeTextValue(F)),n=a.getNodeTextValue(F));"value"==a.getElementName(F)&&(this.ctatdebug("Found parameter value: "+a.getNodeTextValue(F)),p=a.getNodeTextValue(F).trim())}this.ctatdebug("Parameter name: "+n+", value: "+p);void 0!==n&&(z.params[n]=p,"group"==n&&(z.groupName=p))}}if("Styles"==a.getElementName(h))for(this.ctatdebug("Processing component styles ..."),h=a.getElementChildren(h)[0],h=a.getElementChildren(h),g=
0;g<h.length;g++)if(p=h[g],"CTATStyleProperty"==a.getElementName(p)){this.ctatdebug("Processing style property (CTATStyleProperty) ...");n=l="";p=a.getElementChildren(p);for(C=0;C<p.length;C++)D=p[C],"name"==a.getElementName(D)&&(l=a.getNodeTextValue(D)),"value"==a.getElementName(D)&&(n=a.getNodeTextValue(D).trim());this.ctatdebug("Style (name: "+l+", value: "+n+")");""!==l&&(z.styles[l]=n)}}e.ctatdebug("deserializeComponent ("+c+","+d+") done")}};this.processStartStateActions=function(){e.ctatdebug("processStartStateActions(), scriptElement "+
CTATMessageHandler.scriptElement);if(0<CTATMessageHandler.startStateHandlers.length)for(var a=0;a<CTATMessageHandler.startStateHandlers.length;a++)CTATMessageHandler.startStateHandlers[a].processStartStateActions(null);else if(""!==CTATMessageHandler.scriptElement)try{eval(CTATMessageHandler.scriptElement)}catch(n){alert("Error executing script from BRD: "+n.message)}};this.sleep=function(a){e.ctatdebug("sleep ("+a+")")}};CTATMessageHandler.prototype=Object.create(CTATBase.prototype);
CTATMessageHandler.prototype.constructor=CTATMessageHandler;CTATMessageHandler.startStateHandlers=[];CTATMessageHandler.scriptElement="";CTAT.SAI={};
function createSteps(){CTAT.SAI={help:function(){console.log("Enter steps.list() to see the list of steps;\n      steps.next() to do the next step;\n      steps.rest() to do the remaining steps;\n      steps.all() to do all\n      steps.send(n) to send the nth step\n")},nStored:0,msgs:[],storeForReplay:function(b){if(b&&"string"==typeof b&&!/visibilityChange|UpdateVariable/i.test(b)){try{sessionStorage&&"function"==typeof sessionStorage.setItem&&(sessionStorage.setItem("CTAT.SAI."+CTAT.SAI.nStored,b),
sessionStorage.setItem("CTAT.SAI.length",String(++CTAT.SAI.nStored)))}catch(c){console.log("CTAT.SAI.storeForReplay() error ",c,"\n  msg",b)}return CTAT.SAI.nStored}},format:function(b){var c=useDebuggingBasic;useDebuggingBasic=!1;var a=useDebugging;useDebugging=!1;b=(new CTATXML).parseXML(b);b=new CTATMessage(b);useDebuggingBasic=c;useDebugging=a;return sprintf("s: %-16s, a: %-16s, i: %s",b.getSelection(),b.getAction(),b.getInput())},list:function(){for(var b="",c=0;c<CTAT.SAI.msgs.length;++c)var a=
CTAT.SAI.format(CTAT.SAI.msgs[c]),b=sprintf("%s\n[%2d] %s",b,c,a);console.log("Number of steps: "+CTAT.SAI.msgs.length+b+"\n")},send:function(b){if(b>=CTAT.SAI.msgs.length)return"Already past last step "+b;b=CTAT.SAI.msgs[b];CTATCommShell.commShell.propagateShellEvent(CTATMsgType.getMessageType(b),b);CTATCommShell.commShell.getCommLibrary().sendXML(b);CTAT.SAI.storeForReplay(b)},last:-1,next:function(){return CTAT.SAI.send(++CTAT.SAI.last)},rest:function(){for(;CTAT.SAI.last<CTAT.SAI.msgs.length-
2;)CTAT.SAI.next();return CTAT.SAI.next()},all:function(){CTAT.SAI.last=-1;return CTAT.SAI.rest()}};try{for(var b=sessionStorage.getItem("CTAT.SAI.length"),b=b?Number(b):0,g=0;g<b;++g){var f="CTAT.SAI."+g;CTAT.SAI.msgs.push(sessionStorage.getItem(f));sessionStorage.removeItem(f)}sessionStorage.setItem("CTAT.SAI.length",String(b-g))}catch(e){console.log("CTAT.SAI load error ",e)}return CTAT.SAI}window.steps=createSteps();console.log("***To replay steps:");steps.help();var CTATSessionExpiry=function(b,g,f,e){function c(){var a=u&&u.getHTTPObject?u.getHTTPObject():null;h.ctatdebug("CTATSessionExpiry.processInactivityReply() refreshConnection "+u+", getHTTPObject "+a);u&&a&&h.ctatdebug("CTATSessionExpiry.processInactivityReply() readyState "+a.readyState+", status "+a.status+", responseText "+(4==a.readyState?a.responseText:null))}function a(){try{if(50>n)throw"No-op: time interval "+n+" too short: less than 50 ms";v=setInterval(function(){u.send.apply(u,[])},n);
return"ok"}catch(w){return w.toString()}}function d(){try{if(50>p)throw"No-op: time interval "+p+" too short: less than 50 ms";y=setInterval(function(){h.checkInactivity.apply(h,[])},p);return"ok"}catch(w){return w.toString()}}CTATBase.call(this,"CTATSessionExpiry",g);var h=this,l=1E3*g,n=1E3*(g-60),p=6E4,q=Date.now(),u=null,v=0,y=0;this.checkInactivity=function(){var a=Date.now(),d=q;h.ctatdebug("CTATSessionExpiry.checkInactivity() elapsed "+(a-d)+", limit "+l+",\n                 now "+Date(a)+
",\n lastActionTimestamp "+h.getLastActionTimestamp());if(!(a<d+l))try{h.cancelTimers();var b=new CTATConnection(CTATConfiguration.getRawFlashVars());b.setMethod("GET");b.setURL(f);b.assignReceiveFunction(c);b.send();return"ok"}catch(C){return C.toString()}};this.updateLastActionTimestamp=function(){q=Date.now()};this.getLastActionTimestamp=function(){return new Date(q)};this.toString=function(){return"CTATSessionExpiry sessionTimeoutMS "+l+", refreshIntervalMS "+n+", refreshTimer "+v+", inactivityTimer "+
y+",\n  expireLogoutURL "+f+",\n  refreshSessionURL "+e};this.getRefreshConnection=function(){return u};this.getSessionTimeoutMS=function(){return l};this.getRefreshIntervalMS=function(){return n};this.getInactivityIntervalMS=function(){return p};this.setSessionTimeoutMS=function(a){l=a};this.setRefreshIntervalMS=function(c){n=c;h.cancelRefreshTimer();a()};this.setInactivityIntervalMS=function(a){p=a;h.cancelInactivityTimer();d()};this.cancelRefreshTimer=function(){0!==v&&clearInterval(v);v=0};this.cancelInactivityTimer=
function(){0!==y&&clearInterval(y);y=0};this.cancelTimers=function(){h.cancelRefreshTimer();h.cancelInactivityTimer()};this.getRefreshTimer=function(){return v};this.getInactivityTimer=function(){return y};u=new CTATConnection(b);u.setMethod("GET");u.setURL(e);u.assignReceiveFunction(function(){var a=u&&u.getHTTPObject?u.getHTTPObject():null;h.ctatdebug("CTATSessionExpiry.processRefreshReply() refreshConnection "+u+", getHTTPObject "+a);u&&a&&h.ctatdebug("CTATSessionExpiry.processRefreshReply() readyState "+
a.readyState+", status "+a.status+", responseText "+(4==a.readyState?a.responseText:null))});a();d()};CTATSessionExpiry.prototype=Object.create(CTATBase.prototype);CTATSessionExpiry.prototype.constructor=CTATSessionExpiry;
CTATSessionExpiry.factory=function(b){var g=Number(b.session_timeout)||0,f=b.expire_logout_url,e=b.refresh_session_url;ctatdebug("CTATSessionExpiry.init() session_timeout "+g+", expire_logout_url "+f+", refresh_session_url "+e);return 60>=g||!f||!e?null:new CTATSessionExpiry(b,g,f,e)};"undefined"!==typeof module&&(module.exports=CTATSessionExpiry);var sprintf={};
!function(){function b(c){var a;a=c;if(e[a])a=e[a];else{for(var d=a,h,g=[],n=0;d;){if(null!==(h=f.text.exec(d)))g.push(h[0]);else if(null!==(h=f.modulo.exec(d)))g.push("%");else if(null!==(h=f.placeholder.exec(d))){if(h[2]){var n=n|1,p=[],q=h[2],u;if(null!==(u=f.key.exec(q)))for(p.push(u[1]);""!==(q=q.substring(u[0].length));)if(null!==(u=f.key_access.exec(q)))p.push(u[1]);else if(null!==(u=f.index_access.exec(q)))p.push(u[1]);else throw new SyntaxError("[sprintf] failed to parse named argument key");else throw new SyntaxError("[sprintf] failed to parse named argument key");
h[2]=p}else n|=2;if(3===n)throw Error("[sprintf] mixing positional and named placeholders is not (yet) supported");g.push({placeholder:h[0],param_no:h[1],keys:h[2],sign:h[3],pad_char:h[4],align:h[5],width:h[6],precision:h[7],type:h[8]})}else throw new SyntaxError("[sprintf] unexpected placeholder");d=d.substring(h[0].length)}a=e[a]=g}d=arguments;h=1;for(var g=a.length,p="",v,y,w,A,q=0;q<g;q++)if("string"===typeof a[q])p+=a[q];else if("object"===typeof a[q]){u=a[q];if(u.keys)for(n=d[h],v=0;v<u.keys.length;v++){if(void 0==
n)throw Error(b('[sprintf] Cannot access property "%s" of undefined value "%s"',u.keys[v],u.keys[v-1]));n=n[u.keys[v]]}else n=u.param_no?d[u.param_no]:d[h++];f.not_type.test(u.type)&&f.not_primitive.test(u.type)&&n instanceof Function&&(n=n());if(f.numeric_arg.test(u.type)&&"number"!==typeof n&&isNaN(n))throw new TypeError(b("[sprintf] expecting number but found %T",n));f.number.test(u.type)&&(w=0<=n);switch(u.type){case "b":n=parseInt(n,10).toString(2);break;case "c":n=String.fromCharCode(parseInt(n,
10));break;case "d":case "i":n=parseInt(n,10);break;case "j":n=JSON.stringify(n,null,u.width?parseInt(u.width):0);break;case "e":n=u.precision?parseFloat(n).toExponential(u.precision):parseFloat(n).toExponential();break;case "f":n=u.precision?parseFloat(n).toFixed(u.precision):parseFloat(n);break;case "g":n=u.precision?String(Number(n.toPrecision(u.precision))):parseFloat(n);break;case "o":n=(parseInt(n,10)>>>0).toString(8);break;case "s":n=String(n);n=u.precision?n.substring(0,u.precision):n;break;
case "t":n=String(!!n);n=u.precision?n.substring(0,u.precision):n;break;case "T":n=Object.prototype.toString.call(n).slice(8,-1).toLowerCase();n=u.precision?n.substring(0,u.precision):n;break;case "u":n=parseInt(n,10)>>>0;break;case "v":n=n.valueOf();n=u.precision?n.substring(0,u.precision):n;break;case "x":n=(parseInt(n,10)>>>0).toString(16);break;case "X":n=(parseInt(n,10)>>>0).toString(16).toUpperCase()}f.json.test(u.type)?p+=n:(!f.number.test(u.type)||w&&!u.sign?A="":(A=w?"+":"-",n=n.toString().replace(f.sign,
"")),v=u.pad_char?"0"===u.pad_char?"0":u.pad_char.charAt(1):" ",y=u.width-(A+n).length,y=u.width?0<y?v.repeat(y):"":"",p+=u.align?A+n+y:"0"===v?A+y+n:y+A+n)}return p}function g(c,a){return b.apply(null,[c].concat(a||[]))}var f={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,
key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/},e=Object.create(null);"undefined"!==typeof exports&&(exports.sprintf=b,exports.vsprintf=g);"undefined"!==typeof window&&(window.sprintf=b,window.vsprintf=g,"function"===typeof define&&define.amd&&define(function(){return{sprintf:b,vsprintf:g}}))}();var CTATTransactionListener=function(b){function g(a){return a&&"function"==typeof a.getTransactionID?a.getTransactionID():null}function f(a){l.ctatdebug("formatTimeStamp ("+a+")");return sprintf("%04d-%02d-%02d %02d:%02d:%02d.%03d UTC",a.getUTCFullYear(),a.getUTCMonth()+1,a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds(),a.getUTCMilliseconds())}function e(a,c){for(var d,b,e=1;;++e){var f=c+"_type"+e,h=c+"_name"+e;d=CTATConfiguration.get(f);b=CTATConfiguration.get(h);if(!d||!b)break;
a[f]=d;a[h]=b}1==e&&(d=CTATConfiguration.get(c+"_type"),b=CTATConfiguration.get(c+"_name"),a[f]=d?d:"",a[h]=b?b:"");return a}function c(){l.ctatdebug("CTATTransactionListener.createContextMessage()");var a={},c=new Date;l.ctatdebug("TX.makeMetaElement ()");var d={};d.date_time=f(c);d.session_id=CTATConfiguration.get("session_id");d.user_guid=CTATConfiguration.get("user_guid");a.meta=d;a.context={};c=a.context;d=CTATLogMessageBuilder.contextGUID;if(!d)throw Error("Context message ID not yet defined");
c.context_message_id=d;c=a.context;d=CTATConfiguration.get("class_name");c.class_name=d?d:"";d=CTATConfiguration.get("school_name");c.class_school=d?d:"";d=CTATConfiguration.get("period_name");c.class_period_name=d?d:"";d=CTATConfiguration.get("class_description");c.class_description=d?d:"";d=CTATConfiguration.get("instructor_name");c.class_instructor_name=d?d:"";c=a.context;d=CTATConfiguration.get("dataset_name");c.dataset_name=d?d:"";e(c,"dataset_level");prop=CTATConfiguration.get("problem_name");
c.problem_name=prop?prop:"";prop=CTATConfiguration.get("problem_context");c.problem_context=prop?prop:"";prop=CTATConfiguration.get("problem_tutorflag");c.problem_tutorFlag=prop?prop:"";e(c,"study_condition");var c=a.context,d=0,b=CTATConfiguration.getCustomFields();if(b){c.custom_fields={};for(var h in b)b.hasOwnProperty(h)&&(c.custom_fields[h]=b[h],++d)}l.ctatdebug("CTATTransactionListener.createCustomFields() nAdded "+d+", cfs "+b);return a}function a(a,c){if(a&&"function"==typeof a.toLowerCase&&
0<=a.toLowerCase().indexOf("hint"))return!0;if(!c)return!1;if(0<=c.getMessageType().toLowerCase().indexOf("hint"))return!0;a=c.getSelection().toLowerCase();return 0<=c.getAction().toLowerCase().indexOf("buttonpress")&&(0<=a.indexOf("hint")||0<=a.indexOf("help"))}function d(a,c){var d=(a=a.getProperty(c))?a.split(CTATTransactionListener.valueDelimiter):[];l.ctatdebug("CTATTransactionListener.getPropertyAsArray("+c+") withValues "+a+", result "+d);return d}function h(a,c){a=d(a,c);for(var b="",e=0;e<
a.length;++e)b+=a[e];l.ctatdebug("CTATTransactionListener.getProperty("+c+") valueElts "+a+", result "+b);return b}CTATBase.call(this,"CTATTransactionListener","");var l=this,n=null,p=!0,q=null,u={},v=0,y=CTATConfig.parserType_is_XML()?new CTATXML:new CTATJSON;this.getMailer=function(){return n};this.onmessage=function(a){l.ctatdebug("CTATTransactionListener.onmessage("+a.toString()+")");(a=a.data&&3<=a.data.length?new CTATSAI(a.data[0],a.data[1],a.data[2]):null)&&CTATCommShell.shell.processComponentAction(a,
!1,!0,null,"ATTEMPT","Detector")};if(!n)a:{if("undefined"!=typeof TransactionMailerUsers&&"function"==typeof TransactionMailerUsers.create)try{n=n=TransactionMailerUsers.create("Assets",b,CTATConfiguration.get("process_detectors_url"),CTATConfiguration.get("authenticity_token"),CTATConfiguration.get("detectors"),CTATConfiguration.get("provider_key"),CTAT.ToolTutor.tutor&&JSON.stringify(CTAT.ToolTutor.tutor.getProblemSummary().getSkills().toJSON("pSummarySkills"))||null,JSON.stringify({visibilitychangeSAI:CTATTransactionListener.visibilitychangeSAI}));
break a}catch(w){console.trace("Error creating transaction mailer: "+w);n=n=null;break a}n=void 0}this.isReady=function(){return null!=l.mailerProxy};this.toString=function(){return"transactions sent to ["+l.process_transactions_url+":]"};this.processCommShellEvent=function(b,e,z){l.ctatdebug("CTATTransactionListener.processCommShellEvent("+b+", "+e+", "+z+")");try{var w=null;switch(b){case "InterfaceAction":case "AssociatedRules":case "UntutoredAction":case "NextPressed":case "PreviousPressed":var A=
e;e&&e.constructor!=CTATMessage&&(A=e.constructor!=Element?y.parse(A):A,A=new CTATMessage(A));l.ctatdebug("CTATTransactionListener.makeOrCompleteTransaction("+b+") actor "+z+", txID "+g(A)+", problemInfo "+q);var F=e=null,G=!1;if(F=g(A)){!q&&(q=c());var x,H;b:switch(b){case "UntutoredAction":H=!1;break b;case "InterfaceAction":H="tutor-performed"!=h(A,"subtype").toLowerCase();break b;default:H=!0}if(x=!(G=!H)){var K;H=F;var I=u[H];I?(delete u[H],--v,l.ctatdebug("CTATTransactionListener.removeIncompleteTransaction("+
H+") count now "+v),K=I):K=null;x=(e=K)&&(G=!0)}x||(e={meta:q.meta,context:q.context});switch(b){case "AssociatedRules":case "NextPressed":case "PreviousPressed":z=e;z.tutor_data&&console.log("Warning: CTATTransactionListener.addTutorInfo("+b+") tx has tutor_data with time "+z.tutor_data.tutor_event_time);z.tutor_data={};z.tutor_data.tutor_event_time=f(new Date);z.tutor_data.selection=h(A,"Selection");z.tutor_data.action=h(A,"Action");z.tutor_data.input=h(A,"Input");z.tutor_data.action_evaluation=
A.getIndicator();0<=z.tutor_data.action_evaluation.toLowerCase().indexOf("hint")&&(z.tutor_data.current_hint_number=h(A,"CurrentHintNumber"),z.tutor_data.total_hints_available=h(A,"TotalHintsAvailable"));z.tutor_data.tutor_advice=h(A,"TutorAdvice");var L=z.tutor_data;x=[];var P=CTAT.ToolTutor.tutor&&CTAT.ToolTutor.tutor.getProblemSummary()?CTAT.ToolTutor.tutor.getProblemSummary().getSkills():null,B=A.getSkillsObject().getSkillSet();for(K=0;K<B.length;++K){var r=B[K],M=CTATSkillSet.skills?CTATSkillSet.skills.getSkill(r.getSkillName()):
null;if(M){I={};I.name=M.getSkillName();I.category=M.getCategory();var V=null==I.category||""==I.category.trim()?I.name:I.name+" "+I.category,N=P?P.getSkill(V):null,Q;N?(I.pKnown=isNaN(Q=N.getPKnown())?"":Q,I.pGuess=isNaN(Q=N.getPGuess())?"":Q,I.pSlip=isNaN(Q=N.getPSlip())?"":Q,I.pLearn=isNaN(Q=N.getPLearn())?"":Q,I.history=isNaN(Q=N.getHistory())?"":Q,I.opportunityCount=isNaN(Q=N.getOpportunityCount())?"":Q):(I.pKnown=isNaN(Q=M.getPKnown())?"":Q,I.pGuess=isNaN(Q=M.getPGuess())?"":Q,I.pSlip=isNaN(Q=
M.getPSlip())?"":Q,I.pLearn=isNaN(Q=M.getPLearn())?"":Q);l.ctatdebug("CTATTransactionListener.createSkills() ssSk "+M+", tracerSk "+N+", skElt "+I);x.push(I)}}L.skills=x;z.tutor_data.step_id=h(A,"StepID");z.tutor_data.rule_names=d(A,"Rules");var R=z.tutor_data,aa=A.getCustomFields();l.ctatdebug("CTATTransactionListener.createCustomFields() result "+aa);R.custom_fields=aa;break;default:e.meta.date_time=f(new Date);L=e;if(!(L.transaction_id=g(A)))throw Error("Message has no transaction_id: eventType "+
b+", msg\n  "+A);L.semantic_event="UntutoredAction"==b?"UNTUTORED-ACTION":a(b,A)?"HINT-REQUEST-HINTS":"ATTEMPT-RESULT";L.actor=/tutor/i.test(z)?"tutor":z||"student";L.tool_data&&l.ctatdebug("Warning: CTATTransactionListener.addToolInfo("+b+") tx has tool_data with time "+L.tool_data.tool_event_time);L.tool_data={};L.tool_data.tool_event_time=f(new Date);L.tool_data.selection=h(A,"Selection");L.tool_data.action=h(A,"Action");L.tool_data.input=h(A,"Input")}var E;if(G)E=e;else{var L=F,S=u[L];S&&(console.log("Warning: CTATTransactionListener.storeIncompleteTransaction() found tx with ID "+
L,S),--v);u[L]=e;++v;l.ctatdebug("CTATTransactionListener.storeIncompleteTransaction("+L+") count now "+v);E=null}w=E}else w=null;break;case "StateGraph":case "StartProblem":q=c();break;case "ProblemRestoreEnd":p=!1}w&&(p?parent.postMessage({command:"restoredTx",data:w},location.origin):n&&n.sendTransaction(w))}catch(W){console.log("Error in CTATTransactionListener.processCommShellEvent("+b+"): "+W,W.stack)}};ctatdebug("**<end of CTATTransactionListener constructor, process_transactions_url "+b+", mailerProxy "+
n)};Object.defineProperty(CTATTransactionListener,"scriptParam",{enumerable:!1,configurable:!1,writable:!1,value:"process_transactions_url"});Object.defineProperty(CTATTransactionListener,"valueDelimiter",{enumerable:!1,configurable:!1,writable:!1,value:/<\/?value>/});Object.defineProperty(CTATTransactionListener,"visibilitychangeSAI",{enumerable:!1,configurable:!1,writable:!1,value:{selection:"root",action:"visibilityChange",input:".*"}});CTATTransactionListener.prototype=Object.create(CTATBase.prototype);
CTATTransactionListener.prototype.constructor=CTATTransactionListener;"undefined"!==typeof module&&(module.exports=CTATTransactionListener);CTATTransactionListener.create=function(b){var g=null;try{g=new CTATTransactionListener(b)}catch(f){console.trace("Error creating or connecting to transaction listener",f),g=null}return g};var CTATNameTranslator=function(){CTATBase.call(this,"CTATNameTranslator","translator");var b=!1,g=this;this.setPassthrough=function(f){b=CTATGlobalFunctions.toBoolean(f)};this.getPassthrough=function(){return b};this.manufactorJSON=function(b,e){g.ctatdebug("manufactorJSON ("+b+","+e+")");b=b.split(":");if(1==b.length)return g.ctatdebug("No range in aRange, returning basic JSON ..."),"";var c=this.getA1Row(b[0]),a=this.getA1Col(b[0]),d=this.getA1Row(b[1]),f=this.getA1Col(b[1]);g.ctatdebug("Manufacturing json from: ["+
c+","+a+"] to: ["+d+","+f+"]");b="[";c=parseInt(d)-parseInt(c);a=parseInt(f)-parseInt(a);c++;a++;g.ctatdebug("X range: "+c+", Y range: "+a);for(d=0;d<c;d++){0<d&&(b+=",");b+="[";for(f=0;f<a;f++)0<f&&(b+=","),b+='"',b+=e,b+='"';b+="]"}return b+"]"};this.translateFromCTAT=function(f,e){if(!0===b)return f;f=f.toLowerCase();g.ctatdebug("translateFromCTAT ("+f+")");var c;if(-1!=f.indexOf(".r")){var a=f.split(".");c=a[1].split("r");0>=c.length&&(c=a[1].split("c"));0>=c.length?g.ctatdebug("Info: incoming name does not need translation"):
(f=c[1],c=c[0].substr(1),g.ctatdebug("Original row (1st format): "+c+" original col: "+f),f=!0===e?colName(f,!1)+c:a[0]+"."+colName(f,!1)+c,g.ctatdebug("Translated: "+f))}else{if(0===f.indexOf("r")){e=f.indexOf("c");var a=parseInt(f.substr(1,e-1)),d=parseInt(f.substr(e+1));c=a+1;f=d;g.ctatdebug("Original row (2nd format) (columnindex: "+e+"): "+a+" -> "+c+", original col: "+d+" -> "+f);f=colName(f,!1)+c;g.ctatdebug("Translated: "+f);return f}g.ctatdebug("Info: incoming name does not need translation")}return f};
this.translateToCTAT=function(f){if(!0===b)return f;var e=this.letterToColumn(f.substr(0,1))-1;return"R"+(parseInt(f.substr(1))-1)+"C"+e};this.columnToLetter=function(b){for(var e,c="";0<b;)e=(b-1)%26,c=String.fromCharCode(e+65)+c,b=(b-e-1)/26;return c};this.letterToColumn=function(b){for(var e=0,c=b.length,a=0;a<c;a++)e+=(b.charCodeAt(a)-64)*Math.pow(26,c-a-1);return e};this.getA1Row=function(b){return parseInt(b.substr(1))-1};this.getA1Col=function(b){return this.letterToColumn(b.substr(0,1))-1}};
CTATNameTranslator.prototype=Object.create(CTATBase.prototype);CTATNameTranslator.prototype.constructor=CTATNameTranslator;var CTATCommShell=function(){CTATBase.call(this,"CTATCommShell","theShell");var b=null,g=null,f=null,e=null,c=this,a=null,d=null,h={},l=null,n=null,p=null,q=null,u=[];u.named=new Map;var v=!1,y=!1;this.commLMSService=null;d="xml"==CTATConfig.parserType?new CTATXML:new CTATJSON;this.init=function(a){this.ctatdebug("init () tutoring_service_communication "+CTATConfiguration.get("tutoring_service_communication")+" is.Authoring "+CTATLMS.is.Authoring());CTATLMS.is.Authoring()&&(CTATConfiguration.set("tutoring_service_communication",
"websocket"),CTATConfiguration.set("question_file",""));var d=CTATConfiguration.getRawFlashVars(),h="http://";"https"==d.tutoring_service_communication&&(h="https://");var l=d.remoteSocketURL;l&&(l=String(l).toLowerCase(),0==l.indexOf("http")||0==l.indexOf("ws"))&&(h="");e=a;CTATLogMessageBuilder.contextGUID=CTATGuid.guid();c.ctatdebug("processSkills ()");CTATSkillSet.skills=new CTATSkillSet;a=flashVars.getRawFlashVars();null!=a.skills&&CTATSkillSet.skills.fromDataParams(a.skills);c.updateSkillWindow(null);
null==commMessageHandler&&(commMessageHandler=new CTATMessageHandler(this),CTAT.ToolTutor.registerInterface(commMessageHandler));commMessageHandler.assignHandler(this);f=new CTATTutoringServiceMessageBuilder;d.deliverymode&&"review"==d.deliverymode&&(d.Logging="None");g=CTATSessionExpiry.factory(d);b=new CTATCommLibrary(c);b.setConnectionRefusedMessage("ERROR_CONN_TS");b.setSocketType(d.tutoring_service_communication+(CTATConfiguration.getCustomFields()["Team ID"]||d.collaborators||CTATLMS.is.ToolsListener()?
" websocket":""));c.commLMSService=new CTATCurriculumService(b);null==commLoggingLibrary&&(commLoggingLibrary=new CTATLoggingLibrary(!0));commLoggingLibrary.getLoggingCommLibrary().setFixedURL(flashVars.getRawFlashVars().log_service_url);flashVars.setTimeZone(null);new CTATHTMLManager;this.ctatdebug("CTATCommShell.init() FlashVar info: "+d.info);if(null!=d.info)try{parent.javaScriptInfo&&parent.javaScriptInfo(decodeURIComponent(d.info))}catch(D){}else this.ctatdebug("There is no info flash var");
console.log("Connecting to: "+h+d.remoteSocketURL+":"+d.remoteSocketPort);a=f.createSetPreferencesMessage(version,this.getAllInterfaceDescriptions());c.hasTutorShopCable()?CTAT.ToolTutor.sendToTutor(a):b.sendXMLURL(a,h+d.remoteSocketURL+":"+d.remoteSocketPort,CTATConfiguration.get("collaborators"));h=CTATConfiguration.get("collaborators")||"";1<String(h).split(",").length&&(CTATScrim.scrim.scrimDown(),CTATScrim.scrim.scrimUp(CTATGlobals.languageManager.getString("AWAITING_OTHER_COLLABORATORS")));
c.addGlobalEventListener(CTATTransactionListener.create(d[CTATTransactionListener.scriptParam]));c.setVisibilityChangeListener()};this.statechanges=Array(10).fill(null);this.setVisibilityChangeListener=function(a){"undefined"!=typeof lifecycle&&lifecycle.addEventListener("statechange",function(a){c.statechanges.push({time:(new Date).toLocaleTimeString("en-US",{hour:"numeric",minute:"numeric",second:"numeric",fractionalSecondDigits:3,hour12:!1}),old:a.oldState,new:a.newState,event:a.originalEvent.type});
return c.statechanges.shift()});CTATConfiguration.get("process_detectors_url")&&document.addEventListener("visibilitychange",function(d){if(!y){var b=CTATTransactionListener.visibilitychangeSAI;c.processComponentAction(new CTATSAI(b.selection,b.action,document.visibilityState),!1);"function"==typeof a&&a(d)}})};this.getCommLibrary=function(){return b};this.forwardToTutor=function(a){b&&b.hasJavaScriptConnection()&&CTAT.ToolTutor.sendToTutor(a.getXMLString())};this.getLoggingLibrary=function(){return commLoggingLibrary};
this.propagateShellEvent=function(a,c,d,b){ctatdebug("propagateShellEvent ("+a+", "+typeof c+", actor "+d+", logmsg len "+("string"==typeof b?b.length:b)+")");u.named.forEach(function(e){return e.processCommShellEvent(a,c,d,b)});for(var e=0;e<u.length;e++)u[e].processCommShellEvent(a,c,d,b)};this.reset=function(){c.ctatdebug("reset ()");CTATGlobals.interfaceElement=null;commMessageHandler.reset()};this.getSessionExpiry=function(){return g};this.getMessageHandler=function(){return this.commMessageHandler};
this.addStartStateHandler=function(a){c.ctatdebug("addStartStateHandler ()");null==CTATMessageHandler.startStateHandlers&&(CTATMessageHandler.startStateHandlers=[]);CTATMessageHandler.startStateHandlers.push(a)};this.gradeComponent=function(a){this.ctatdebug("gradeComponent ("+a.getName()+","+a.getClassName()+")");var d=CTATShellTools.findComponentByClass("CTATDoneButton");null!=d&&d!=a?d.moveHintHighlight(!1,null):c.ctatdebug("Info: no done button available to reset");c.clearFeedbackComponents();
null!=nameTranslator?nameTranslator.translateFromCTAT(a.getName()):this.ctatdebug("Info: no name translator provided, using as-is");null==a?this.ctatdebug("Internal error, provided component is null"):(this.ctatdebug("Info: we have a valid component, grading ..."),"Do not tutor"==a.getTutorComponent()?c.processComponentAction(a.getSAI(),!1):(this.ctatdebug("Checking for back grading: "+a.getName()),"CTATTextArea"==a.getClassName()||"CTATTextInput"==a.getClassName()||"CTATTextField"==a.getClassName()?
(this.ctatdebug("Backgrading ..."),this.ctatdebug("Grading "+a.getClassName()+" with value: "+a.getValue()),!0===CTATGlobalFunctions.isBlank(a.getValue())?this.ctatdebug("Empty component, nothing to grade"):(a.updateSAI(),a=a.getSAI(),c.processComponentAction(a))):(a="CTATTableGoogle"==a.getClassName()?new CTATSAI(a.getCurrentSelection(),"UpdateTextArea",a.getCurrentValue()):a.getSAI(),c.processComponentAction(a))))};this.processMessage=function(a){this.ctatdebug("processMessage ()");commMessageHandler.processMessage(a);
this.ctatdebug("processMessage () done")};this.processStartProblem=function(){this.ctatdebug("processStartProblem ()");"google"==CTATConfig.external&&this.showFeedback("The tutor is starting, please wait ...");CTATLMS.initLMSConnection&&CTATLMS.initLMSConnection()};this.processStartState=function(){this.ctatdebug("processStartState ()");try{e?(this.ctatdebug("Calling tutor.createInterface () ..."),e.createInterface()):window.hasOwnProperty("createInterface")&&(this.ctatdebug("Error: no tutor object available, calling window.createInterface ..."),
window.createInterface())}catch(A){console.log("Error from "+(e?"tutorPointer":"window")+".createInterface",A)}this.ctatdebug("Logging start of problem ...");if(null!=commLoggingLibrary){CTATConfiguration.addCustomField("problem_file_url",location.origin+CTATConfiguration.get("question_file"));var a=CTATConfiguration.get("problem_context");a&&CTATConfiguration.addCustomField("problem_context",a);commLoggingLibrary.startProblem()}else this.ctatdebug("Info: no logging library available!");c.propagateShellEvent("StartProblem",
null);this.ctatdebug("End of start state, inspecting suppressStudentFeedback ...");!0===CTATGlobals.suppressStudentFeedback&&(this.ctatdebug("Hiding hint button ..."),a=CTATShellTools.findComponentByClass("CTATHintButton"),null!=a&&a.SetVisible(!1));"google"==CTATConfig.external?(c.ctatdebug("Calling google app script hint request driver ..."),addCall(new RPCObject("resetOnEditQueue","dummy","dummy"))):this.ctatdebug("processStartState () done")};this.sendStartProblemMessage=function(){c.ctatdebug("sendStartProblemMessage()")};
this.sendProblemSummaryRequest=function(a){c.ctatdebug("sendProblemSummaryRequest()");p=a;a=(new CTATTutoringServiceMessageBuilder).createProblemSummaryRequestMessage();b.sendXML(a,!1)};this.getAllInterfaceDescriptions=function(){c.ctatdebug("getAllInterfaceDescriptions ()");for(var a="<messages>",d=new CTATTutoringServiceMessageBuilder,b=CTATShellTools.getAllComponents(),e=0;e<b.length;e++){var f=b[e];c.ctatdebug("Getting component interface description message for: "+f.getName());a+=d.createInterfaceDescriptionMessage(f);
f.getConfigurationActions&&f.getConfigurationActions().forEach(function(c){a+=d.createInterfaceActionMessage(CTATGuid.guid(),c)})}return a+="</messages>"};this.sendInterfaceDescriptionMessages=function(){c.ctatdebug("sendInterfaceDescriptionMessages ()");var a;a='<?xml version="1.0" encoding="UTF-8"?><message><verb>NotePropertySet</verb><properties><MessageType>MessageBundle</MessageType>'+c.getAllInterfaceDescriptions();a+="</properties></message>";c.ctatdebug("Final bundle: "+a);b.sendXMLNoBundle(a)};
this.processSerialization=function(){c.ctatdebug("processSerialization()");c.setText(this.label)};this.processComponentAction=function(a,d,e,f,h,g,l,n){c.ctatdebug("processComponentAction("+a.getName()+" -> "+a.getSelection()+","+a.getAction()+","+a.getInput()+"), trigger "+g);this.showFeedback("");e=l||CTATGuid.guid();var p=g&&"data"==g.toLowerCase()?"tutor-performed":"";null!=commLoggingLibrary?v&&(c.ctatdebug("We're not in the start state, logging the action ..."),"scrim"==a.getSelection()?ctatdebug("Not logging any scrim actions (for now)"):
void 0!=h?!1!==h&&commLoggingLibrary.logSemanticEvent(e,a,h,p,"","",g):"hint"==a.getSelection()||"null.nextButton"==a.getSelection()||"null.previousButton"==a.getSelection()?commLoggingLibrary.logSemanticEvent(e,a,"HINT_REQUEST",p,"","",g):commLoggingLibrary.logSemanticEvent(e,a,"ATTEMPT",p,"","",g)):this.ctatdebug("Info: no logging library available!");f=new CTATTutoringServiceMessageBuilder;l="";var q=[],p="tutor-performed"==p?"tutor":"student";!1!==d&&d!==CTAT.Component.Base.Tutorable.Options.TutorComponent.DO_NOT_TUTOR?
(l=f.createInterfaceActionMessage(e,a,g,h,n),c.propagateShellEvent("InterfaceAction",l,p)):(q=CTATShellTools.findComponent(a.getSelection()),l=f.createUntutoredActionMessage(e,a,g,h,n),c.propagateShellEvent("UntutoredAction",l,p));b.sendXML(l);CTAT.SAI&&"function"==typeof CTAT.SAI.storeForReplay&&CTAT.SAI.storeForReplay(l);q.forEach(function(a){return a.setIsBeingGraded&&a.setIsBeingGraded(!1)})};this.onEditSuccess=function(a){c.ctatdebug("onEditSuccess ("+a+")");null==nameTranslator?c.ctatdebug("Error: CTAT name translator not available"):
-1!=a.indexOf(":")?(c.ctatdebug("Bump"),c.showFeedback("You're asking for a hint for multiple cells, please select only a single cell.")):(a=nameTranslator.translateToCTAT(a),c.ctatdebug("Info A1 notiation mapped to (if needed): "+a),a=new CTATSAI("hint","ButtonPressed",a),c.processComponentAction(a),c.propagateShellEvent("REQUESTHINT",null),c.ctatdebug("onEditSuccess () done"))};this.onFailure=function(a){c.ctatdebug("onFailure ("+a.message+")")};this.onNOPEditSuccess=function(a){c.ctatdebug("onNOPEditSuccess ("+
a+")")};this.onNOPFailure=function(a){c.ctatdebug("onNOPFailure ("+a.message+")")};this.requestHint=function(){c.ctatdebug("requestHint(external -> "+CTATConfig.external+")");var a;if("none"==CTATConfig.external)c.ctatdebug("Calling built-in hint request driver ..."),CTATGlobals.Tab.previousFocus?(a=new CTATSAI("hint","ButtonPressed","hint request"),CTATGlobals.Tab.previousFocus.getSAI?(a.addSelection(CTATGlobals.Tab.previousFocus.getSAI().getSelection()),a.addAction("PreviousFocus")):c.ctatdebug("Current focus is not a CTAT component, can't ask for a hint yet")):
(c.ctatdebug("CTATGlobals.Tab.previousFocus===null"),a=new CTATSAI("hint","ButtonPressed","hint request")),this.processComponentAction(a),this.propagateShellEvent("RequestHint",null);else if(c.clearFeedbackComponents(),"google"==CTATConfig.external){c.ctatdebug("Calling google app script hint request driver ...");try{google.script.run.withSuccessHandler(c.onEditSuccess).withFailureHandler(c.onFailure).getSheetSelectedRange()}catch(A){c.ctatdebug("google.script.run: "+A.message)}}else c.ctatdebug("'external' has configuration that doesn't match anything: "+
CTATConfig.external)};this.processDone=function(a){c.ctatdebug("processDone()");!0===CTATGlobals.confirmDone?CTATScrim.scrim.confirmScrimUp(CTATGlobals.languageManager.getString("SURE_YOU_ARE_DONE"),this.processDoneContinue,this.processDoneCancel):(a=new CTATSAI("done","ButtonPressed",a&&"string"==typeof a?a:"-1"),c.processComponentAction(a))};this.processDoneContinue=function(a){c.ctatdebug("processDoneContinue()");CTATScrim.scrim.scrimDown();a=new CTATSAI("done","ButtonPressed",a&&"string"==typeof a?
a:"-1");c.processComponentAction(a);c.propagateShellEvent("DonePressed",null)};this.processDoneCancel=function(a){c.ctatdebug("processDoneCancel()");CTATScrim.scrim.scrimDown();a=CTATGuid.guid();var d=new CTATSAI("ConfirmDone","ButtonPressed","no");commLoggingLibrary.logSemanticEvent(a,d,"ATTEMPT","")};this.processGetURL=function(a){c.ctatdebug("processGetURL()");-1!=a.getURL().indexOf("http://")?b.retrieveFile(a.getURL().substring(7),c.processClientBRDLoad):b.retrieveFile(a.getURL(),c.processClientBRDLoad)};
this.processClientBRDLoad=function(a){c.ctatdebug("processClientBRDLoad()");var d=b.getURL();b.sendXML("<message><verb>NotePropertySet</verb><properties><MessageType>GetURLResponse</MessageType><URL><![CDATA[ "+d+" ]]\x3e</URL><content><![CDATA[ "+window.btoa(a)+" ]]\x3e</content></properties></message>")};this.processCorrectAction=function(a){c.ctatdebug("processCorrectAction()");a.setGradeResult("correct");c.clearFeedbackComponents();null!=q&&(ctatdebug("Calling custom grading processor ..."),q("CORRECT",
a));var d=a.getSelection();if(h[d]&&null!=l)l("CORRECT",a),this.propagateShellEvent("CORRECT",a);else{var b=CTATShellTools.findComponent(d);if(null!=b)for(ctatdebug("Processing "+b.length+" components ..."),d=0;d<b.length;d++)ctatdebug("Check "+b[d].getName()),b[d]?b[d].setCorrect&&b[d].setCorrect(a):c.ctatdebug("Internal error, component pointer is null");else c.ctatdebug("Error: component is null for selection "+d)}};this.processInCorrectAction=function(a){c.ctatdebug("processInCorrectAction()");
a.setGradeResult("incorrect");null!=q&&(ctatdebug("Calling custom grading processor ..."),q("INCORRECT",a));var d=a.getSelection();if(h[d]&&null!=l)l("INCORRECT",a);else{var b=CTATShellTools.findComponent(d);if(null!==b)for(d=0;d<b.length;d++)ctatdebug("Calling setIncorrect on component ("+b[d].getClassName()+")..."),b[d].setIncorrect&&b[d].setIncorrect(a);else c.ctatdebug("Error: component is null for selection "+d)}};this.processHighlightMsg=function(a){c.ctatdebug("processHighlightMsg()");var d=
a.getSelection(),b=CTATShellTools.findComponent(d);if(null!=b)for(d=0;d<b.length;d++)"function"==typeof b[d].setHintHighlight&&b[d].setHintHighlight(!0,a);else c.ctatdebug("Error: component is null for selection "+d);this.showFeedback(a.getHighlightMsg())};this.processUnHighlightMsg=function(a){c.ctatdebug("processUnHighlightMsg()");var d=a.getSelection(),b=CTATShellTools.findComponent(d);if(null!=b)for(d=0;d<b.length;d++)"function"==typeof b[d].setHintHighlight&&b[d].setHintHighlight(!1,null,a);
else c.ctatdebug("Error: component is null for selection "+d)};this.processAssociatedRules=function(a,d,e,h){var g="";c.ctatdebug("processAssociatedRules()");if(0==commMessageHandler.getInStartState()){logHintSAI=a.getSAI();logHintStepID=a.getProperty("StepID");var l,n=new CTATActionEvaluationData("");c.ctatdebug("Found tutor advice: "+e);"Hint"==d||"HintWindow"==d?(ctatdebug("Preparing log message to indicate a hint response","commShell"),n.setCurrentHintNumber(hintIndex+1),n.setTotalHintsAvailable(hints.length),
n.setEvaluation("HINT"),l="HINT_MSG",hints[hintIndex]&&(e=hints[hintIndex])):("Correct"==a.getIndicator()?n.setEvaluation("CORRECT"):n.setEvaluation("INCORRECT"),l="RESULT");ctatdebug("Adding custom field names ...");var p=[],q=[];p.push("step_id");q.push(logHintStepID);var w=a.getInput();ctatdebug("CTATCommShell.processAssociatedRules() tutorInput: "+w);w&&(p.push("tutor_input"),q.push(w.toString()));if(w=a.getRules())p.push("rule_names"),q.push(w.toString());var w=a.getCustomFields(),u;for(u in w)p.push(u),
q.push(w[u]);u=a.getSkillsObject();c.updateSkillWindow(u);ctatdebug("Sending log message ...");null!=commLoggingLibrary?v?g=commLoggingLibrary.logTutorResponse(a.getTransactionID(),logHintSAI,l,"",n,e,u,p,q):a.suppressLogging():this.ctatdebug("Info: no logging library available!");"done"==logHintSAI.getSelection()&&"ButtonPressed"==logHintSAI.getAction()&&"Correct"==a.getIndicator()&&(l=f.createProblemSummaryRequestMessage(),b.sendXML(l,!1))}else c.updateSkillWindow(null);if((h=h&&CTATShellTools.findComponent(h))&&
h.length)for(l=0;l<h.length;l++)ctatdebug("Calling processAssociatedRules on component ("+h[l].getClassName()+")..."),h[l].processAssociatedRules&&h[l].processAssociatedRules(a,d,e,g);c.ctatdebug("processAssociatedRules() done");return g};this.processBuggyMessage=function(a){c.ctatdebug("processBuggyMessage()");this.showFeedback(a.getBuggyMsg(),"bug")};this.processSuccessMessage=function(a){c.ctatdebug("processSuccessMessage()");this.showFeedback(a.getSuccessMessage(),"success")};this.processUntutoredAction=
function(a,d){c.processInterfaceAction(a,d)};this.processInterfaceAction=function(a,d){c.ctatdebug('CTATCommShell.processInterfaceAction ("'+a.getMessageType()+'")');var b=a.getProperty("trigger"),b=a.getProperty("subtype")||(b&&"data"==b.toLowerCase()?"tutor-performed":"");null!=commLoggingLibrary?v&&"false"!==a.getProperty("shouldLog")&&commLoggingLibrary.logSemanticEvent(a.getTransactionID(),a.getSAI(),"ATTEMPT",b):this.ctatdebug("Info: no logging library available!");if("root"==a.getSelection()||
"_root"==a.getSelection()){c.ctatdebug("Info: selection is 'root', we'll call the function straight up ...");d=[window,CTATCommShell.commShell];b=a.getAction();a=a.getInput();for(var e=0;e<d.length&&"function"!=typeof d[e][b];++e);if(e>=d.length)c.ctatdebug("Internal error: unable to find function: "+b);else{c.ctatdebug("Calling as: "+b+"("+a+")");try{d[e][b](a)}catch(x){c.ctatdebug("Internal error: unable to execute function: "+x.message)}}}else if(!CTATShellTools.execReservedSelection(a))if(b=CTATShellTools.findComponent(a.getSelection()),
null===b)c.ctatdebug("Internal error: unable to find pointer to component object");else if(0==b.length)c.ctatdebug("Error: no component found to call interface action on");else{e=b.length;c.ctatdebug("Call the action on the component(s) -> ("+e+")...");for(var f=0;f<e;f++){c.ctatdebug("About to call "+a.getAction()+" ("+a.getInput()+") on: "+a.getSelection());var h=b[f];"function"==typeof h.executeSAI&&h.executeSAI(a);c.ctatdebug("Method executed, continuing with post-processing ...");if(1==commMessageHandler.getInStartState()){var g=
a.getAction()||"";/^(updatetext|updatecombobox|updatecheckbox)/i.test(g)&&!h.getDivWrap().className.includes("CTATTextField")&&h.setEnabled(!d)}}c.ctatdebug("processInterfaceAction() Done")}};this.removeComponent=function(a){CTATTutor.removeComponent(a)};this.processAuthorModeChange=function(a){c.ctatdebug("processAuthorModeChange()")};this.processShowHintsMessage=function(a){c.ctatdebug("processShowHintsMessage()")};this.processConfirmDone=function(a){c.ctatdebug("processConfirmDone()")};this.processVersionInfo=
function(a){c.ctatdebug("processVersionInfo()")};this.updateLastActionTimestamp=function(){g&&g.updateLastActionTimestamp()};this.processTutoringServiceAlert=function(a){c.ctatdebug("processTutoringServiceAlert()");for(var b="",e=0;e<a.length;e++){var f=a[e];"ErrorType"==d.getElementName(f)&&d.getNodeTextValue(f);"Details"==d.getElementName(f)&&(b=d.getNodeTextValue(f))}CTATScrim.scrim.scrimUp(b)};this.processTutoringServiceError=function(a){c.ctatdebug("processTutoringServiceError()");var d=a.getProperty("ErrorType");
a=a.getProperty("Details");CTATScrim.scrim.scrimDown();CTATScrim.scrim.errorScrimUp(d+" - "+a)};this.processProblemSummaryResponse=function(d){var b=null;CTATLMS.processProblemSummary&&(b=CTATLMS.processProblemSummary(d));CTATLMS.closeLMSConnection&&CTATLMS.closeLMSConnection();if(null!=p){var b=d.getXMLObject(),e=b.getElementsByTagName("ProblemSummary"),f=b.getElementsByTagName("cmi.core.lesson_status"),h=b.getElementsByTagName("cmi.core.score.raw");d=b.getElementsByTagName("cmi.core.exit");b=b.getElementsByTagName("cmi.core.session_time");
e=$("<div>").html(e[0].innerHTML).text();f="<cmi.core.lesson_status>"+$("<div>").html(f[0].innerHTML).text()+"</cmi.core.lesson_status>";h="<cmi.core.score.raw>"+$("<div>").html(h[0].innerHTML).text()+"</cmi.core.score.raw>";d="<cmi.core.exit>"+$("<div>").html(d[0].innerHTML).text()+"</cmi.core.exit>";b="<cmi.core.session_time>"+$("<div>").html(b[0].innerHTML).text()+"</cmi.core.session_time>";p(e,"<scorm>"+f+h+d+b+"</scorm>");p=null}else y=!0,null!=a?(e=new CTATXML,a(e.xmlToString(d.getXMLObject()),
c.commLMSService.sendSummary.bind(c.commLMSService,d,b))):c.commLMSService.sendSummary(d,b)};this.setGotProblemRestoreEnd=function(a){v=a};this.getGotProblemRestoreEnd=function(){return v};this.processProblemRestoreEnd=function(a){c.ctatdebug("processProblemRestoreEnd() scrimIsUp "+scrimIsUp);v=!0;c.getCommLibrary()&&c.getCommLibrary().sendTutorReady();c.hasTutorShopCable()||CTATScrim.scrim.scrimDownForced()};this.hasTutorShopCable=function(){var a=CTATConfiguration.getCustomFields();return CTATLMS.is.TutorShop()&&
a&&a["Team ID"]};this.clearFeedbackComponents=function(){c.ctatdebug("clearFeedbackComponents ()");CTATShellTools.showHints(null)};this.processHintResponse=function(a,d){c.ctatdebug("processHintResponse()");unhighlightall();CTATShellTools.showHints(d);d=a.getSAI();if(null!=d)if(d=d.getSelection(),null!=d)if(c.ctatdebug("Highlighting selection for hint: "+d),d=CTATShellTools.findComponent(d),null!=d)for(var b=0;b<d.length;b++)1==CTATCommShell.detailedFeedback&&"function"==typeof d[b].setHintHighlight&&
d[b].setHintHighlight(!0,a);else c.ctatdebug("Unable to find component name in list: "+d);else c.ctatdebug("Error: no highlight selection present in SAI");else c.ctatdebug("Warning: no SAI found in highlight message");CTATCommShell.detailedFeedback=!0;c.ctatdebug("processHintResponse() done")};this.showHighlightSelection=function(a,d){c.ctatdebug("showHighlightSelection ("+a+")");a=CTATShellTools.findComponent(a);if(null!=a)for(var b=0;b<a.length;b++)1==CTATCommShell.detailedFeedback&&(0===b?a[b].moveHintHightlight&&
a[b].moveHintHighlight(!0,d):a[b].setHintHighlight&&a[b].setHintHighlight(!0,d));else c.ctatdebug("Unable to find component name in list: "+a)};this.globalReset=function(){c.ctatdebug("globalReset ()");CTATMessageHandler.scriptElement=""};this.nextProblem=function(a){c.ctatdebug("nextProblem ()");if(CTATGlobalFunctions.isBlank(a))c.ctatdebug("Message is blank, requesting next problem ..."),(a=flashVars.getRawFlashVars().run_problem_url)&&b.send(a);else{c.ctatdebug("Message contains html data, writing ...");
try{document.close()}catch(A){alert("Error closing document: "+A.message)}try{document.write(a)}catch(A){alert("Error writing document: "+A.message)}}};this.updateSkillWindow=function(a){c.ctatdebug("updateSkillWindow()");CTATSkillSet.skills.untouchSkills();var d=CTATShellTools.findComponentByClass("CTATSkillWindow");null!==d?null!=a?d.updateSkillSet(a):d.drawComponent():c.ctatdebug("Info: no skill window available")};this.processComponentFocus=function(a){c.ctatdebug("processComponentFocus("+a.getName()+
","+a.getClassName()+")");"CTATTextInput"==a.getClassName()||"CTATTextField"==a.getClassName()||"CTATTextArea"==a.getClassName()?(CTATGlobals.selectedTextInput=a,null!==mobileAPI&&!0===mobileAPI.getEnabled()&&mobileAPI.processTextFocus(a.getX(),a.getY(),a.getWidth(),a.getHeight())):CTATGlobals.selectedTextInput=null;c.ctatdebug("processComponentFocus() done")};this.showFeedback=function(a,d){a&&(!(a instanceof Array)||a.length&&String(a[0]).trim())&&String(a).trim()?(c.ctatdebug("showFeedback("+a+
") -> l: "+a.length),CTATShellTools.showFeedback(a,d),null!=n&&n(a)):c.ctatdebug("showFeedback(): False alarm: empty message. This can happen when the commshell is trying to clear the hint window and there is no hint window.")};this.assignFeedbackHandler=function(a){c.ctatdebug("assignFeedbackHandler()");n=a};this.gradeSAI=function(a,d,b){c.ctatdebug("gradeSAI()");h[a]=b;a=new CTATSAI(a,d,b);c.processComponentAction(a,!0,!0)};this.assignGradingHandler=function(a){c.ctatdebug("assignGradingHandler()");
l=a};this.assignAnonymousGradingProcessor=function(a){q=a};this.assignDoneProcessor=function(c){a=c};this.addEventListener=function(a,c){};this.removeGlobalEventListener=function(a){var c;(c=u.named.get(a))?u.named.delete(a):(c=u[a])&&u.splice(a,1);return c};this.addGlobalEventListener=function(a,d){c.ctatdebug("addGlobalEventListener( "+a+")");return a?(a=a.processCommShellEvent?a:{processCommShellEvent:a},d?(u.named.set(d,a),d):u.push(a)-1):null};this.sendToTools=function(a){b&&b.sendToToolsOrCollaborators(b.getURL(),
a,!1)};this.closeWSConnection=function(a,c,d){(a=b.findWSConnection(a))?a.close(d,c):console.warn("connection not found")}};CTATCommShell.prototype=Object.create(CTATBase.prototype);CTATCommShell.prototype.constructor=CTATCommShell;CTATCommShell.commShell=null;CTATCommShell.detailedFeedback=!0;function enableDetailedFeedback(b){CTATCommShell.detailedFeedback=b};var CTATComponentReference=function(b,g){var f=b,e=g;this.setElement=function(c){f=c};this.getElement=function(){return f};this.setDiv=function(c){e=c};this.getDiv=function(){return e}};CTATComponentReference.components={};CTATComponentReference.list=function(){for(var b in CTATComponentReference.components){var g=CTATComponentReference.components[b];ctatdebug("Component: "+g.getElement().getName()+", with div: "+g.getDiv().id)}};
CTATComponentReference.getComponentFromID=function(b){var g=CTATComponentReference.components;return g.hasOwnProperty(b)?(b=g[b],b.getElement()?b.getElement():null):null};CTATComponentReference.add=function(b,g){b=new CTATComponentReference(b,g);return CTATComponentReference.components[b.getDiv().getAttribute("id")]=b};var CTATCompBase=function(b,g,f,e,c,a){CTATBase.call(this,b,g);var d=f||0,h=e||0,l=c||-2,n=a||-2,p=50,q=25,u=!1,v=!1,y="",w=!1,A=!0,z=null,C="",D=null;this.isTabIndexable=!0;var F=0,G=null,x=this,H=null,K="hidden",I=CTATGlobalFunctions.gensym.z_index(),L=CTATGlobalFunctions.gensym.div_id(),P=CTATGlobalFunctions.gensym.z_index(),B=CTATGlobalFunctions.gensym.div_id();this.setIsAbstractComponent=function(a){u=a};this.isAbstractComponent=function(){return u};this.setIsFeedbackComponent=function(a){v=
a};this.isFeedbackComponent=function(){return v};this.setTabIndex=function(a){!0===this.isTabIndexable?(D=a,0>D?(D=CTATGlobals.Tab.Tracker,CTATGlobals.Tab.Tracker++):CTATGlobals.Tab.Tracker=D):D=-1};this.getTabIndex=function(){return D||this.getComponent().getAttribute("tabindex")};this.setZIndex=function(a){x.ctatdebug("Setting z index to: "+a);F=a;null!==z&&(z.style.zIndex=a)};this.getZIndex=function(){return F};this.setDefaultWidth=function(a){p=a};this.getDefaultWidth=function(){return p};this.setDefaultHeight=
function(a){q=a};this.getDefaultHeight=function(){return q};this.processCommShellEvent=function(a,c){x.ctatdebug("processCommShellEvent ("+a+")")};this.makeDivWrapper=function(a){z=document.createElement("div");z.id=this.getName();z.setAttribute("onkeypress","return noenter(event)");z.setAttribute("data-ctat-component",this.getClassName());z.style.position="absolute";z.style.left=d+"px";z.style.top=h+"px";z.style.zIndex=I;z.style.width=x.getWidth()+"px";z.style.height=x.getHeight()+"px";$(z).data("CTATComponent",
this);a.appendChild(z)};this.setDivWrapper=function(a){(z=a)&&z.setAttribute("data-ctat-component",this.getClassName())};var r=this.setClassName;this.setClassName=function(a){r(a);z&&z.setAttribute("data-ctat-component",this.getClassName())};this.wrapComponent=function(a){x.ctatdebug("wrapComponent ()");x.makeDivWrapper(a);x.ctatdebug("wrapComponent () done")};this.createCanvas=function(){x.ctatdebug("createCanvas ()");H=document.createElement("canvas");H.setAttribute("id",B);H.setAttribute("onkeypress",
"return noenter(event)");H.setAttribute("width",l+canvasCalibrate+"px");H.setAttribute("height",n+canvasCalibrate+"px");H.setAttribute("style","border: 1px "+this.borderColor+" solid; "+("hidden"==K?"visibility: hidden; ":"")+"z-index:"+P+";");z.firstChild?z.insertBefore(H,z.firstChild):z.appendChild(H);return H};this.redraw=function(){var a=z.style.display;z.style.display="none";z.style.display=a};this.setCanvasVisibility=function(a){K=a};this.getSubCanvasCtx=function(){if(H)return H.getContext("2d")};
this.getSubCanvas=function(){return H};this.getX=function(){return d};this.getY=function(){return h};this.getWidth=function(){if(0>=l){var a;G?a=window.getComputedStyle(G):z&&(a=window.getComputedStyle(z));if(a)return parseFloat(a.width)}return l};this.getHeight=function(){if(0>=n&&z){var a=window.getComputedStyle(z);return parseFloat(a.getPropertyValue("height"))}return n};this.getText=function(){return y};this.GetEnabled=this.getEnabled=function(){return A};this.assignEnabled=function(a){A=a;z.setAttribute("data-ctat-enabled",
A)};this.SetEnabled=this.setEnabled=function(a){x.ctatdebug("setEnabled ("+a+")");x.assignEnabled(a);G?G.disabled=!A:x.ctatdebug("Error: component pointer is null")};this.lock=function(){this.setEnabled(!1)};this.unlock=function(){this.setEnabled(!0)};this.SetLocked=this.setLocked=function(a){return a?this.lock():this.unlock()};this.getDivWrap=function(){return z};this.getComponent=function(){return G};this.SetFocus=function(a){a=a?"focus":"blur";return x.getEnabled()&&"function"===typeof G[a]?(G[a](),
!0):!1};this.component=null;Object.defineProperty(this,"component",{get:function(){return G}});this.getCanvasZIndex=function(){return P};this.getComponentGroup=function(){return C};this.setComponent=function(a){G=a;this.setEnabled(this.getEnabled())};this.getTopDivZIndex=function(){return I};this.getTopDivID=function(){return L};this.setComponentGroup=function(a){C=a;G&&(G.name=a)};this.assignText=function(a){y=a};this.init=function(){x.ctatdebug("THIS IS THE BASE INIT METHOD")};this.initialize=function(){x.ctatdebug("initialize ()");
x.configFromDescription();x.init();x.processSerialization();x.render();x.processTabOrder();x.ctatdebug("initialize () done")};this.getInitialized=function(){return w};this.setInitialized=function(a){x.ctatdebug("setInitialized ("+a+")");w=a;!0!==w||z?x.ctatdebug("Not wrapping, initialized="+w+", divWrapper = "+z):(x.ctatdebug("Wrapping a component and appending it to the top container div if one was never set ..."),(a=findPointOfAttachment(this.getName()))?(x.ctatdebug("Attaching component to existing MovieClip ..."),
x.wrapComponent(a.getDivWrapper())):(x.ctatdebug("Attaching component to main div ..."),0<$("#"+ctatcontainer).length&&x.wrapComponent(getSafeElementById(ctatcontainer))));x.getDivWrap().classList.add("CTATComponent");x.ctatdebug("setInitialized () done")};this.addSafeEventListener=function(a,c,d){x.ctatdebug("addSafeEventListener ("+a+")");x.ctatdebug("Adding event listener to: "+d);d?d.addEventListener(a,c):(G?(x.ctatdebug("Adding eventlistener to component instead of target"),G.addEventListener(a,
c)):x.ctatdebug("Error: pointer to component is null, can't add event listener"),x.ctatdebug("addSafeEventListener () done"))};this.drawComponent=function(){};this.addComponentReference=function(a,c){x.ctatdebug("addComponentReference ("+a.getName()+" -> "+c.getAttribute("id")+")");CTATComponentReference.add(a,c);x.ctatdebug("addComponentReference ()")};this.getComponentFromID=function(a){return CTATComponentReference.getComponentFromID(a)};this.processSerialization=function(){x.ctatdebug("processSerialization()");
x.ctatdebug("implement in child class")};this.move=function(a,c){d=Number(a);h=Number(c);if(void 0===c||null===c||isNaN(h))0<=a.indexOf(",")?(a=a.split(","),d=Number(a[0]),h=Number(a[1])):h=0;d=isNaN(d)?0:d;h=isNaN(h)?0:h;z&&(z.style.left=d+"px",z.style.top=h+"px")};this.setSize=function(a,c){var d=Number(a),b=Number(c);(void 0===c||null===c||isNaN(b))&&0<=a.indexOf(",")&&(a=a.split(","),d=Number(a[0]),b=Number(a[1]));x.ctatdebug("setSize ("+d+","+b+")");isNaN(d)||x.setWidth(d);isNaN(b)||x.setHeight(b)};
this.SetVisible=this.setVisible=function(a){a=CTATGlobalFunctions.toBoolean(a);K=!0===a?"block":"hidden";H&&H.setAttribute("style","border: 0px; position: absolute; "+(a?"":"visibility:hidden; ")+"; left:"+d+"px; top:"+h+"px; z-index:"+P+";");!0===a?(z.style.visibility="unset",x.SetFocus(!0)):z.style.visibility="hidden"};this.FadeIn=function(a){x.SetVisible(!0)};this.FadeOut=function(a){x.SetVisible(!1)};this.reset=function(){};this.setX=function(a){this.x=a;z.style.left=this.x+"px";!0===w&&this.render()};
this.setY=function(a){this.y=a;z.style.top=this.y+"px";!0===w&&this.render()};this.setWidth=function(a){x.ctatdebug("setWidth ("+a+")");l=a;z?z.style.width=l+"px":x.ctatdebug("Internal error: no div wrapper available to set width")};this.setHeight=function(a){x.ctatdebug("setHeight ("+a+")");n=a;z?z.style.height=n+"px":x.ctatdebug("Internal error: no div wrapper available to set height")};this.setText=function(a){y=a;return this};this.getValue=function(){return G?G.value:""};this.backgrade=!1;this.unHighlightAll=
function(){$(".CTAT--hint").each(function(){for(var a=$(this),c=null;0<a.length&&null===c;)a.data("CTATComponent")?c=a.data("CTATComponent"):a=a.parent();c&&c.setHintHighlight&&c.setHintHighlight(!1,null)})};this.processOnFocus=function(){x.ctatdebug("processOnFocus ("+x.getName()+")");CTATGlobals.Tab.previousFocus=CTATGlobals.Tab.Focus;CTATGlobals.Tab.Focus!=x?(x.ctatdebug("CTATGlobals.Tab.Focus!=pointer, updating CTATGlobals.Tab.Focus ..."),CTATGlobals.Tab.Focus=x):x.ctatdebug("CTATGlobals.Tab.Focus==pointer");
x.ctatdebug("processOnFocus () done")};this.processFocus=function(a){x.ctatdebug("processFocus ()");x.ctatdebug("***processFocus("+a+"): comp.getName "+(x&&"function"==typeof x.getName?x.getName():x)+"\n  CTATGlobals.Tab.Focus "+(CTATGlobals.Tab.Focus&&"function"==typeof CTATGlobals.Tab.Focus.getName?CTATGlobals.Tab.Focus.getName():CTATGlobals.Tab.Focus)+"\n  CTATGlobals.Tab.Focus.isCorrect "+(CTATGlobals.Tab.Focus&&"function"==typeof CTATGlobals.Tab.Focus.isCorrect?CTATGlobals.Tab.Focus.isCorrect():
"no isCorrect")+"\n  CTATGlobals.Tab.Focus == comp "+(CTATGlobals.Tab.Focus==x)+"\n  CTATGlobals.Tab.Focus.backgrade "+(CTATGlobals.Tab.Focus&&"undefined"!=typeof CTATGlobals.Tab.Focus.backgrade?CTATGlobals.Tab.Focus.backgrade:"no backgrade")+"\n  comp.getClassName "+(x&&"function"==typeof x.getClassName?x.getClassName():x)+"\n  CTATGlobals.Tab.previousFocus "+CTATGlobals.Tab.previousFocus);if(x){mobileAPI&&!0===mobileAPI.getEnabled()&&x.hideKeyboard();CTATCommShell.commShell&&CTATCommShell.commShell.processComponentFocus(x);
if(CTATGlobals.Tab.Focus){x.ctatdebug("old focus: "+CTATGlobals.Tab.Focus.getName()+", new focus:"+x.getName()+", correct: "+("function"==typeof CTATGlobals.Tab.Focus.isCorrect?CTATGlobals.Tab.Focus.isCorrect():"[no isCorrect()]"));if("function"==typeof CTATGlobals.Tab.Focus.isCorrect&&1==CTATGlobals.Tab.Focus.isCorrect()){x.ctatdebug("Previous focus is a correct component, don't backgrade!");return}if(CTATGlobals.Tab.Focus==x){x.ctatdebug("We're already there!");return}CTATGlobals.Tab.Focus.backgrade&&
CTATGlobals.Tab.Focus.processAction()}else x.ctatdebug("No previously focused component yet, can't grade");"hint"==x.getClassName()||"CTATHintButton"==x.getClassName()?x.ctatdebug("Info: focus moved to hint, bump"):(CTATGlobals.Tab.previousFocus=CTATGlobals.Tab.Focus,CTATGlobals.Tab.Focus=x,x.ctatdebug("processFocus () done"))}else x.ctatdebug("Error: component reference is null")};this.processTabOrder=function(){x.ctatdebug("processTabOrder ("+D+")");!0===u?x.ctatdebug("Component is an abstract component, bump"):
G?(x.ctatdebug("We have a component, actually assigning to html component ..."),null!==D&&(G.tabIndex=D),G.onfocus=x.processOnFocus):x.ctatdebug("Error: we don't have an html component yet, can't assign tab index")};this.hideKeyboard=function(){document.activeElement.blur();$("input").blur()}};CTATCompBase.prototype=Object.create(CTATBase.prototype);CTATCompBase.prototype.constructor=CTATCompBase;var CTATCSS=function(){var b=0,g=[],f=0,e=[],c=0,a=[];this.resetSelectors=function(){f=0;e=[];e[f]=[]};this.resetCSSStringArray=function(){a=[];c=0};this.clearCSS=function(){this.resetSelectors();this.resetCSSStringArray();g=[];b=0};this.addStringCSS=function(d){a[c]=d;c++};this.addCSSAttribute=function(a,c){g[b]=a;g[b+1]=c;b+=2};this.removeStringCSS=function(c){c=a.indexOf(c);0<=c&&a.splice(c,1)};this.removeCSSAttribute=function(a){a=g.indexOf(a);0<=a&&g.splice(a,2)};this.modifyCSSAttribute=function(a,
c){var d=g.indexOf(a);-1==d?this.addCSSAttribute(a,c):g[d+1]=c};this.addSelector=function(a){e[f]=[];e[f][0]=a;f++};this.addSelectorAttribute=function(a,c,b){var d=1;a:if(0===f)a=0;else{for(var h=0;h<e.length&&null!==e[h][0];h++)if(e[h][0]==a){a=h;break a}a=-1}for(;void 0!==e[a][d];)d++;e[a][d]=c;e[a][d+1]=b};this.toCSSString=function(){for(var c="",b=0;b<e.length;b++){for(var c=c+(e[b][0]+" { "),f=1;f<e[b].length;f++)c+=e[b][f],c=0===f%2?c+"; ":c+": ";c+=" }; "}for(b=0;b<g.length;b++)c+=g[b],c=0===
b%2?c+": ":c+"; ";for(b=0;b<a.length;b++)c+=a[b]+" ";return c}};CTAT.Component={};CTAT.Component.Base={};
CTAT.Component.Base.Style=function(b,g,f,e,c,a){CTATCompBase.call(this,b,g,f,e,c,a);var d=new CTATCSS;this.addCSSAttribute=function(a,c){d.addCSSAttribute(a,c);this.render()};this.removeCSSAttribute=function(a){d.removeCSSAttribute(a);this.render()};this.addStringCSS=function(a){d.addStringCSS(a);this.render()};this.removeStringCSS=function(a){d.removeStringCSS(a);this.render()};this.modifyCSSAttribute=function(a,c){d.modifyCSSAttribute(a,c);this.render()};this.getCSS=function(){return d.toCSSString()};
this.render=function(){!0===this.isAbstractComponent()?this.ctatdebug("Component is an abstract component, bump"):this.getInitialized()&&(this.getComponent()?this.ctatdebug(d.toCSSString()):this.ctatdebug("Internal error, html component not available for rendering"))};this.setStyleAll=function(a,c){this.getSubCanvas()&&this.getSubCanvas().setAttribute(a,c);this.modifyCSSAttribute(a,c)}};CTAT.Component.Base.Style.prototype=Object.create(CTATCompBase.prototype);
CTAT.Component.Base.Style.prototype.constructor=CTAT.Component.Base.Style;CTAT.Component.Base.Graphical=function(b,g,f,e,c,a,d){CTAT.Component.Base.Style.call(this,b,g,e,c,a,d);var h=f||(new CTATComponentDescription).setGenericDefaults();this.getGrDescription=function(){return h};this.setGrDescription=function(a){h=a;this.processDescription(h)};var l={},n={};this.getDisplay=function(){return $(this.getDivWrap()).css("display")};this.getdisplay=this.getDisplay.bind(this);this.GetDisplay=this.getDisplay.bind(this);this.setDisplay=function(a){a=String(a);switch(a.toLowerCase()){case "false":a=
"none";break;case "true":case "null":case "undefined":a=""}$(this.getDivWrap()).css("display",a);return this};this.setdisplay=this.setDisplay.bind(this);this.SetDisplay=this.setDisplay.bind(this);this.getAlign=function(){return this.component?$(this.component).css("text-align"):$(this.getDivWrap()).css("text-align")};this.setAlign=function(a){this.component&&(this.component.style.textAlign=a);return this};this.getBackgroundColor=function(){return $(this.getComponent()).css("background-color")};this.setBackgroundColor=
function(a){a=a?CTATGlobalFunctions.formatColor(a):null;this.component&&(this.component.style.backgroundColor=a);return this};this.setDisabledBGColor=function(a){return this};this.setDisabledTextColor=function(a){return this};this.getBorderColor=function(){return $(this.getComponent()).css("border-color")};this.setBorderColor=function(a){a&&(a=CTATGlobalFunctions.formatColor(a),this.getComponent()?$(this.getComponent()).css("border-color",a):this.getDivWrap().style.borderColor=a);return this};this.getBorderRoundness=
function(){return $(this.getComponent()).css("border-radius")};this.setBorderRoundness=function(a){a=parseInt(a,10);isNaN(a)?a=l.roundness=0:l.roundness=a;a+="px";this.component&&this.getBorderRoundness()!==a&&($(this.component).css("border-radius",a),this.component.style.borderRadius=l.roundness);return this};this.getBorderStyle=function(){return $(this.getComponent()).css("borderStyle")};this.setBorderStyle=function(a){this.component&&(this.component.style.borderStyle=a);return this};this.getBorderWidth=
function(){return this.getComponent()?$(this.getComponent()).css("borderWidth"):l.width};this.setBorderWidth=function(a){l.width=a;/(\d*(px)? ?){1,3}(\d*(px)? ?)?/.test(a)||(a="0px",console.log("invalid width string"));this.component&&this.getBorderWidth()!==a&&$(this.component).css("borderWidth",a);return this};this.setPadding=function(a){a=parseInt(a);isNaN(a)&&(a=0);this.component&&(this.component.style.padding=a+"px");return this};this.getFontColor=function(){if(this.component)return $(this.component).css("color")};
this.setFontColor=function(a){console.log("setFontColor( )");n.color=CTATGlobalFunctions.formatColor(a);this.component&&(console.log("got comp"),this.getFontColor()!==n.color&&$(this.component).css("color",n.color));return n.color};this.setFontFamily=function(a){this.component&&(this.component.style.fontFamily=a);return this};this.getFontFamily=function(){if(this.component)return this.component.style.fontFamily;console.warn("component not found");return null};this.setFontSize=function(a){a=parseInt(a);
isNaN(a)?this.component.style.fontSize=null:(n.size=a,this.component&&(this.component.style.fontSize=a+"pt"));return this};this.setShowBorder=function(a){a=CTATGlobalFunctions.toBoolean(a);this.component&&(a?this.setBorderStyle("solid"):this.setBorderStyle("none"));return this};this.setUnderlined=function(a){p_underlined=CTATGlobalFunctions.toBoolean(a);this.component&&(this.component.style.textDecoration=p_underlined?"underline":null);return this};this.setBolded=function(a){a=CTATGlobalFunctions.stringToBoolean(a);
this.component&&(this.component.style.fontWeight=a?"bold":null);return this};this.setItalicized=function(a){CTATGlobalFunctions.toBoolean(a);this.component&&(this.component.style.fontStyle=n.italicized?"italic":null);return this};var p=this;b=function(a){var c=a||{};return{setHandler:function(a,d){c[a]=d},set:function(a){if(c.hasOwnProperty(a)){if(c[a]){var d=Array.prototype.slice.call(arguments,1);return c[a].apply(p,d)}p.ctatdebug("Error: NULL handler for "+a)}else p.ctatdebug("Error: No handler set for "+
a)}}};this.style_handlers=b({BackgroundColor:this.setBackgroundColor,BorderColor:this.setBorderColor,borderRoundness:this.setBorderRoundness,DrawBorder:this.setShowBorder,FontFace:this.setFontFamily,FontSize:this.setFontSize,FontBold:this.setBolded,FontItalic:this.setItalicized,FontUnderlined:this.setUnderlined,labelText:this.setText,padding:this.setPadding,showBorder:this.setShowBorder,TextAlign:this.setAlign,TextColor:this.setFontColor});this.setStyle=function(a,c){this.style_handlers.set(a,c)};
this.setStyleHandler=function(a,c){this.style_handlers.setHandler(a,c)};this.parameter_handlers=b({group:this.setComponentGroup});this.setParameter=function(a,c){this.parameter_handlers.set(a,c)};this.setParameterHandler=function(a,c){this.parameter_handlers.setHandler(a,c)};this.data_ctat_handlers={};this.processAttributes=function(){if(this.getDivWrap()){var a=$(this.getDivWrap()),c=parseInt(a.attr("tabindex"),10)||parseInt(a.attr("data-ctat-tabindex"),10);isNaN(c)||(this.setTabIndex(c),a.attr("tabindex",
null));c=a.attr("name");void 0!==c&&this.setComponentGroup(c);for(var d in this.data_ctat_handlers)c=a.data("ctat-"+d),void 0!==c&&this.data_ctat_handlers[d].apply(this,[c])}};this.data_ctat_handlers.enabled=function(a){this.setEnabled(CTATGlobalFunctions.toBoolean(a))};this.processParameters=function(a){if(a)if(a instanceof CTATComponentDescription){p.setName(a.name);a=a.params;for(var c in a)this.setParameter(c,a[c])}else this.ctatdebug("Error: Invalid description sent to CTAT.Components.Hierarchy.Graphical.processDescription: "+
a)};this.processStyles=function(a){if(a)if(a instanceof CTATComponentDescription){a=a.styles;for(var c in a)this.setStyle(c,a[c])}else this.ctatdebug("Error: Invalid description sent to CTAT.Components.Hierarchy.Graphical.processDescription: "+a)};this.processDescription=function(a){this.processParameters(a);this.processStyles(a)};this.configFromDescription=function(){this.processParameters(h)};this.processSerialization=function(){this.processStyles(h)};this.addClass=function(a){this.getDivWrap()&&
null!=this.getDivWrap()&&this.getDivWrap().classList.add(a)};this.removeClass=function(a){this.getDivWrap()&&null!=this.getDivWrap().classList&&this.getDivWrap().classList.remove(a)}};CTAT.Component.Base.Graphical.prototype=Object.create(CTAT.Component.Base.Style.prototype);CTAT.Component.Base.Graphical.prototype.constructor=CTAT.Component.Base.Graphical;CTAT.Component.Base.SAIHandler=function(b,g,f,e,c,a,d){CTAT.Component.Base.Graphical.call(this,b,g,f,e,c,a,d);var h=new CTATSAI(this.getName(),CTAT.Component.Base.SAIHandler.DefaultAction,CTAT.Component.Base.SAIHandler.DefaultInput,CTAT.Component.Base.SAIHandler.DefaultPrompt),l=this.setName;this.setName=function(a){l(a);h.setSelection(this.getName())};this.getSAI=function(){return h};this.setSAI=function(a,c,d){a instanceof CTATSAI?h=a:(a=null===a||void 0===a?this.getName():a,h=new CTATSAI(a,c,d,
CTAT.Component.Base.SAIHandler.DefaultPrompt));return this};this.setInput=function(a){h instanceof CTATSAI?h.setInput(a):h=new CTATSAI(this.getName(),CTAT.Component.Base.SAIHandler.DefaultAction,a,CTAT.Component.Base.SAIHandler.DefaultPrompt);return this};this.setAction=function(a){h instanceof CTATSAI?h.setAction(a):h=new CTATSAI(this.getName(),a,CTAT.Component.Base.SAIHandler.DefaultInput,CTAT.Component.Base.SAIHandler.DefaultPrompt);return this};this.setActionInput=function(a,c){this.setAction(a);
this.setInput(c);return this};this.setSelection=function(a){h instanceof CTATSAI?h.setSelection(a):h=new CTATSAI(a,CTAT.Component.Base.SAIHandler.DefaultAction,CTAT.Component.Base.SAIHandler.DefaultInput,CTAT.Component.Base.SAIHandler.DefaultPrompt)};this.updateSAI=function(){};this.executeSAI=function(a){this.ctatdebug("executeSAI ()");var c;c=a instanceof CTATMessage?a.getSAI():a;if(c instanceof CTATSAI){var d=c.getAction();this.ctatdebug("Processing "+d+"("+c.getInput()+") on: "+c.getSelection());
if("function"==typeof this[d]){var b=c.getArgumentsTyped();this.ctatdebug("JSON args: "+JSON.stringify(b));try{this.ctatdebug("Executing "+d+"("+b+","+typeof a+")..."),b.push(a),this[d].apply(this,b)}catch(v){return this.ctatdebug("ERROR: failed to execute action: "+v.message),!1}this.component&&(a=new CustomEvent("CTAT_EXECUTE_SAI",{detail:{sai:c,component:this},bubbles:!0,cancelable:!0}),this.component.dispatchEvent(a));return!0}this.ctatdebug("ERROR: Unsupported action: "+d+" from "+c.toLSxmlString());
return!1}this.ctatdebug("ERROR: Non-SAI sent to executeSAI("+typeof a+")");return!1}};CTAT.Component.Base.SAIHandler.DefaultAction="ButtonPressed";CTAT.Component.Base.SAIHandler.DefaultInput="-1";CTAT.Component.Base.SAIHandler.DefaultPrompt="";CTAT.Component.Base.SAIHandler.prototype=Object.create(CTAT.Component.Base.Graphical.prototype);CTAT.Component.Base.SAIHandler.prototype.constructor=CTAT.Component.Base.SAIHandler;CTAT.Component.Base.Tutorable=function(b,g,f,e,c,a,d){CTAT.Component.Base.SAIHandler.call(this,b,g,f,e,c,a,d);var h=!0,l=!0,n=!0,p=CTAT.Component.Base.Tutorable.Options.TutorComponent.TUTOR,q=this,u=!1;this.setTutorComponent=function(a){p=a;a=CTAT.Component.Base.Tutorable.Options.TutorComponent;switch(p){case a.TUTOR:n=h=l=!0;break;case a.TUTOR_NO_FEEDBACK:h=l=!0;n=!1;break;case a.DO_NOT_TUTOR:h=!1,l=!0}};this.setParameterHandler("tutorComponent",this.setTutorComponent);this.data_ctat_handlers.tutor=
function(a){h=CTATGlobalFunctions.toBoolean(a)};this.data_ctat_handlers["show-feedback"]=function(a){n=CTATGlobalFunctions.toBoolean(a)};this.getTutorComponent=function(){var a=CTAT.Component.Base.Tutorable.Options.TutorComponent;return h&&l&&n?a.TUTOR:h&&l&&!n?a.TUTOR_NO_FEEDBACK:!h&&l?a.DO_NOT_TUTOR:p};this.getDisableOnCorrect=function(){var a=$(this.getDivWrap()).attr("data-ctat-disable-on-correct");return a?CTATGlobalFunctions.toBoolean(a):null!=CTATGlobals.lockWidget?CTATGlobalFunctions.toBoolean(CTATGlobals.lockWidget):
!0};this.setDisableOnCorrect=function(a){$(this.getDivWrap()).attr("data-ctat-disable-on-correct",a)};this.setParameterHandler("DisableOnCorrect",this.setDisableOnCorrect);this.getShowFeedback=function(){return n};var v=!0;this.getShowHintHighlight=function(){return v};this.setShowHintHighlight=function(a){v=CTATGlobalFunctions.toBoolean(a)};this.setParameterHandler("ShowHintHighlight",this.setShowHintHighlight);this.data_ctat_handlers["show-hint-highlight"]=function(a){v=CTATGlobalFunctions.toBoolean(a)};
var y=CTAT.Component.Base.Tutorable.Options.Status.NOTGRADED;this.getComponentStatus=function(){return y};this.setComponentStatus=function(a){y=a};this.isCorrect=function(){return y===CTAT.Component.Base.Tutorable.Options.Status.CORRECT};this.isIncorrect=function(){return y===CTAT.Component.Base.Tutorable.Options.Status.INCORRECT};this.isNotGraded=function(){return y===CTAT.Component.Base.Tutorable.Options.Status.NOTGRADED};this.setCorrect=function(a){this.setNotGraded();"CTATTableGoogle"!=this.getClassName()&&
this.executeSAI(a);y=CTAT.Component.Base.Tutorable.Options.Status.CORRECT;!0===this.getDisableOnCorrect()&&this.setEnabled(!1);!1===CTATGlobals.suppressStudentFeedback&&n&&this.showCorrect(a);this.setIsBeingGraded(!1);this.ctatdebug("setCorrect() post showCorrect");this.component&&(a=new CustomEvent(CTAT.Component.Base.Tutorable.EventType.correct,{detail:{sai:a,component:this},bubbles:!0,cancelable:!0}),this.getDivWrap().dispatchEvent(a))};this.setIncorrect=function(a){this.ctatdebug("setIncorrect()");
this.setNotGraded();"CTATTableGoogle"!=this.getClassName()&&this.executeSAI(a);y=CTAT.Component.Base.Tutorable.Options.Status.INCORRECT;!1===CTATGlobals.suppressStudentFeedback&&n&&this.showInCorrect(a);this.setIsBeingGraded(!1);this.component&&(a=new CustomEvent(CTAT.Component.Base.Tutorable.EventType.incorrect,{detail:{sai:a,component:this},bubbles:!0,cancelable:!0}),this.getDivWrap().dispatchEvent(a))};this.setNotGraded=function(){this.ctatdebug("setNotGraded ()");this.setHintHighlight(!1);if(!this.isNotGraded()&&
(y=CTAT.Component.Base.Tutorable.Options.Status.NOTGRADED,this.removeCorrect(),this.removeInCorrect(),this.component)){var a=new CustomEvent(CTAT.Component.Base.Tutorable.EventType.ungrade,{detail:{component:this},bubbles:!0,cancelable:!0});this.getDivWrap().dispatchEvent(a)}};this.showHintHighlight=function(a,c){this.component.classList.remove("CTAT--correct");this.component.classList.remove("CTAT--incorrect");a?this.component.classList.add("CTAT--hint"):this.component.classList.remove("CTAT--hint")};
this.setHintHighlight=function(a,c){this.ctatdebug("setHintHighlight ("+a+")");if(v){a=CTATGlobalFunctions.toBoolean(a);if(this.component){var d=new CustomEvent(CTAT.Component.Base.Tutorable.EventType.highlight,{detail:{isHighlighted:a,component:this},bubbles:!0,cancelable:!0});this.getDivWrap().dispatchEvent(d)}a!==u&&(u=a,this.showHintHighlight(a,c))}};this.moveHintHighlight=function(a,c){this.ctatdebug("moveHintHighlight ("+a+")");CTATGlobals.Tab.previousFocus=CTATGlobals.Tab.Focus;CTATGlobals.Tab.Focus=
q;q.component.focus?CTATGlobals.Tab.Focus.getComponent().focus():CTATGlobals.Tab.Focus.getDivWrap().focus();if(v){a=CTATGlobalFunctions.toBoolean(a);if(this.component){var d=new CustomEvent(CTAT.Component.Base.Tutorable.EventType.highlight,{detail:{isHighlighted:a,component:this},bubbles:!0,cancelable:!0});this.getDivWrap().dispatchEvent(d)}a!==u&&(u=a,this.showHintHighlight(a,c))}};this.highlight=function(a){ctatdebug("highlight ()");this.component.classList.add("CTAT--highlight")};this.unhighlight=
function(a){ctatdebug("unhighlight ()");this.component.classList.remove("CTAT--highlight")};this.SetHighlight=this.setHighlight=function(a){return a?this.highlight():this.unhighlight()};this.showCorrect=function(a){this.ctatdebug("showCorrect("+a+")");this.getComponent().classList.remove("CTAT--incorrect");this.getComponent().classList.remove("CTAT--hint");this.getComponent().classList.add("CTAT--correct")};this.removeCorrect=function(){this.getComponent()&&this.getComponent().classList.remove("CTAT--correct")};
this.showInCorrect=function(a){this.ctatdebug("showInCorrect("+a+")");this.getComponent().classList.remove("CTAT--correct");this.getComponent().classList.remove("CTAT--hint");this.getComponent().classList.add("CTAT--incorrect")};this.removeInCorrect=function(){this.getComponent()&&this.getComponent().classList.remove("CTAT--incorrect")};this.resetTutoring=function(){this.showHintHighlight(!1);this.removeCorrect();this.removeInCorrect();y=CTAT.Component.Base.Tutorable.Options.Status.NOTGRADED};this.grade=
function(){this.updateSAI();this.processAction(!0)};this.getIsBeingGraded=function(){return!1};this.setIsBeingGraded=function(){};this.processAction=function(a,c){var d=!1;this.ctatdebug("processAction("+a+","+c+")");if(this.getIsBeingGraded())return this.ctatdebug("skipping processAction; I am being graded"),d;this.setIsBeingGraded(!0);q.unHighlightAll();var b=CTATShellTools.findComponentByClass("CTATDoneButton");b&&b instanceof CTAT.Component.Base.Tutorable&&b!=this&&b.setNotGraded();this.ctatdebug("processAction() finished checking doneButton");
ctatdebug("Clearing hint window ...");CTATCommShell.commShell&&CTATCommShell.commShell.clearFeedbackComponents();a=void 0===a||null===a?!1:a;c=void 0===c||null===c?!1:c;""!==this.getComponentGroup()?CTATShellTools.findComponent(this.getComponentGroup()).forEach(function(a){a.setNotGraded&&a.setNotGraded()}):this.setNotGraded();this.ctatdebug("processAction() finished setNotGraded");CTATCommShell.commShell&&(a?CTATCommShell.commShell.processComponentAction(this.getSAI(),!0,!0):c?CTATCommShell.commShell.processComponentAction(this.getSAI(),
!1,!0):CTATCommShell.commShell.processComponentAction(this.getSAI(),h,l),d=!0);this.ctatdebug("processAction() finished call to commShell.processComponentAction");this.component&&(a=new CustomEvent(CTAT.Component.Base.Tutorable.EventType.action,{detail:{sai:this.getSAI(),component:this,graded:a||h},bubbles:!0,cancelable:!0}),this.component.dispatchEvent(a));return d};this.addEventScreen=function(a){var c=document.createElement("div");c.style.position="absolute";c.style.top="0";c.style.left="0";c.style.bottom=
"0";c.style.right="0";a&&c.addEventListener("dblclick",function(){setTimeout(function(){var a=q.getDivWrap().getAttribute("data-ctat-enabled");q.setEnabled(!0);var c=q.getComponent();c.hasEditListeners||(c.addEventListener("blur",function(){q.setEnabled(!1);q.getDivWrap().setAttribute("data-ctat-enabled",a);q.getDivWrap().setAttribute("value",c.value)}),"CTATTextArea"===q.getClassName()&&c.addEventListener("keydown",function(a){13==(a.keyCode||a.charCode)&&(a.preventDefault(),this.value+="\n")}),
c.hasEditListeners=!0);c.focus()},410)});this.getDivWrap().appendChild(c)}};CTAT.Component.Base.Tutorable.Options={TutorComponent:{TUTOR:"Tutor",TUTOR_NO_FEEDBACK:"Tutor but no visual feedback",DO_NOT_TUTOR:"Do not tutor"},Status:{CORRECT:"CORRECT",INCORRECT:"INCORRECT",NOTGRADED:"NOTGRADED"}};CTAT.Component.Base.Tutorable.EventType={correct:"CTAT_CORRECT",incorrect:"CTAT_INCORRECT",highlight:"CTAT_HIGHLIGHT",ungrade:"CTAT_NOTGRADED",action:"CTAT_ACTION"};CTAT.Component.Base.Tutorable.prototype=Object.create(CTAT.Component.Base.SAIHandler.prototype);
CTAT.Component.Base.Tutorable.prototype.constructor=CTAT.Component.Base.Tutorable;CTAT.Component.Base.Clickable=function(b,g,f,e,c,a,d){CTAT.Component.Base.Tutorable.call(this,b,g,f,e,c,a,d);var h=this;this.processClick=function(a){h.ctatdebug("processClick ("+a.currentTarget.getAttribute("id")+" -> "+a.eventPhase+")");!0===h.getEnabled()?h.processAction():h.ctatdebug("Component is disabled, not grading")};this.setClickable=function(a){h.setEnabled(a)}};CTAT.Component.Base.Clickable.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);
CTAT.Component.Base.Clickable.prototype.constructor=CTAT.Component.Base.Clickable;var CTATButtonBasedComponent=function(b,g,f,e,c,a,d){CTAT.Component.Base.Clickable.call(this,b,g,f,e,c,a,d);var h=this,l="",n="black",p=!1;this.setActionInput("ButtonPressed","-1");this.getIsBeingGraded=function(){return p};this.setIsBeingGraded=function(a){p=a};this.setImage=function(a){h.ctatdebug("assignImage ("+a+")");h.getDivWrap().setAttribute("data-ctat-img",a);a&&(a='url("'+a+'")');$(h.getComponent()).css("background-image",a);$(h.getComponent()).css("background-size","cover")};this.data_ctat_handlers.img=
h.setImage;this.assignImage=function(a){h.ctatdebug("assignImage ()");h.assignImages(a,a,a,a)};this.assignImageURL=function(a){h.ctatdebug("assignImageURL ()");h.assignImages(a,a,a,a)};this.assignImages=function(a,c,d,b){h.ctatdebug("assignImages ()");h.getDivWrap().setAttribute("data-ctat-image-hover",a);h.getDivWrap().setAttribute("data-ctat-image-clicked",c);h.getDivWrap().setAttribute("data-ctat-image-default",d);h.getDivWrap().setAttribute("data-ctat-image-disabled",b);this.setImage(d)};this.processBaseMousedown=
function(){h.ctatdebug("processMousedown ()");h.component.classList.add("CTAT-button--clicked");var a=h.getDivWrap().getAttribute("data-ctat-image-clicked");h.getEnabled()&&a&&void 0!==a&&""!==a&&null!==a&&h.setImage(a)};this.processBaseMouseup=function(){h.ctatdebug("processMouseup ()");h.component.classList.remove("CTAT-button--clicked");var a=h.getDivWrap().getAttribute("data-ctat-image-default");h.getEnabled()&&a&&void 0!==a&&""!==a&&null!==a&&h.setImage(a)};this.processBaseMouseover=function(){h.ctatdebug("processBaseMouseover ()");
h.component.classList.add("CTAT-button--hover");var a=h.getDivWrap().getAttribute("data-ctat-image-hover");h.getEnabled()&&a&&void 0!==a&&""!==a&&h.setImage(a)};this.processBaseMouseout=function(){h.ctatdebug("processBaseMouseout ()");h.component.classList.remove("CTAT-button--hover");h.component.classList.remove("CTAT-button--clicked");var a=h.getDivWrap().getAttribute("data-ctat-image-default");h.getEnabled()&&a&&void 0!==a&&""!==a&&h.setImage(a)};this.setText=function(a){h.ctatdebug("setText ("+
a+")");l=a;null!==h.getComponent()&&(h.getComponent().innerHTML=l)};this.setFontColor=function(a){n=a;$(h.getComponent()).css("color",a)};this.getFontColor=function(){return n};this.setStyleHandler("labelText",this.setText);this.getText=function(){return l};this.processClick=function(a){h.ctatdebug("processClick("+(a&&a.target&&a.target.getAttribute("id"))+" -> "+(a&&a.eventPhase)+")");h.getEnabled()?(null!==CTATGlobals.Tab.Focus&&("CTATTextArea"==CTATGlobals.Tab.Focus.getClassName()||"CTATTextInput"==
CTATGlobals.Tab.Focus.getClassName()||"CTATMathInput"==CTATGlobals.Tab.Focus.getClassName()||"CTATTextField"==CTATGlobals.Tab.Focus.getClassName()?CTATGlobals.Tab.Focus.processAction():h.ctatdebug("Info: CTATGlobals.Tab.Focus==null")),a=$(h.getDivWrap()).attr("value"),h.setInput(a?a:"-1"),h.processAction()):h.ctatdebug("Component is disabled, not grading")};this.ButtonPressed=function(){};this.processAssociatedRules=function(){h.setIsBeingGraded(!1)}};CTATButtonBasedComponent.prototype=Object.create(CTAT.Component.Base.Clickable.prototype);
CTATButtonBasedComponent.prototype.constructor=CTATButtonBasedComponent;CTAT.ComponentRegistry={};CTAT.ComponentRegistry.addComponentType=function(){};Object.defineProperty(CTAT.ComponentRegistry,"addComponentType",{enumerable:!1,value:function(b,g){"string"==typeof b&&(this.hasOwnProperty(b)?alert(b+" is already a registered component"):this[b]=g)}});var CTATAudioButton=function(b,g,f,e,c){CTATButtonBasedComponent.call(this,"CTATAudioButton","audiobutton",b,g,f,e,c);var a=this;a.setActionInput("play","-1");var d=null,h="",l=CTATConfiguration.get("previewMode");this.setSource=function(a){this.getDivWrap().setAttribute("data-ctat-src",a);return this};this.getSource=function(){return this.getDivWrap().getAttribute("data-ctat-src")};this.setParameterHandler("SoundFile",this.setSource);this.init=function(){var c=document.createElement("button");c.value=
"-1";c.name=a.getName();c.setAttribute("id",CTATGlobalFunctions.gensym.div_id());c.setAttribute("onkeypress","return noenter(event)");c.classList.add("CTAT-button");if(this.getDivWrap().getAttribute("data-ctat-label"))c.textContent=this.getDivWrap().getAttribute("data-ctat-label");else if(a.getText())c.textContent=a.getText();else if(a.getDivWrap()&&a.getDivWrap().innerHTML&&!l){var b=a.getDivWrap().innerHTML;a.getDivWrap().innerHTML="";c.innerHTML=b}a.setInitialized(!0);a.setComponent(c);a.addComponentReference(a,
c);a.getDivWrap().appendChild(c);a.ctatdebug("Final location: "+a.getX()+","+a.getY()+" with text: "+a.getText());l||(c.addEventListener("click",a.processClick),c.addEventListener("focus",a.processFocus));d=document.createElement("audio");d.addEventListener("canplay",function(){a.ctatdebug("Audio loaded and ready for play");""!==h&&(a.logAudioEvent(h),h="")},!0);d.onended=function(){a.ctatdebug("Audio ended");a.logAudioEvent("end")};this.getDivWrap().appendChild(d)};this.getConfigurationActions=function(){var a=
[],c;0<this.component.innerHTML.trim().length&&(c=new CTATSAI,c.setSelection(this.getName()),c.setInput(this.component.innerHTML.toString()),c.setAction("setText"),a.push(c));0<this.getSource().trim().length&&(c=new CTATSAI,c.setSelection(this.getName()),c.setInput(this.getSource()),c.setAction("setSource"),a.push(c));return a};this.reset=function(){a.configFromDescription();a.processSerialization();a.setEnabled(!0);h="reset"};this.logAudioEvent=function(c){a.ctatdebug("logAudioEvent ("+c+")");if(void 0!==
d.duration)if(null!==CTATCommShell.commShell){c=new CTATSAI(a.getName(),c,a.toHHMMSS(d.currentTime)+".000","");c.addSelection(encodeURIComponent(d.currentSrc),"media_file");c.addSelection(a.toHHMMSS(d.duration)+".000","clip_length");var b=c.getInputObject();null!==b&&b.setType("time");CTATCommShell.commShell.processComponentAction(c,!1,!0,a,"AUDIO_ACTION","USER")}else a.ctatdebug("Error: commShell is null, can't send untutored tool message");else a.ctatdebug("Error: audio file not loaded yet, can't obtain duration")};
this.processClick=function(c){a.ctatdebug("processClick ("+c.currentTarget.getAttribute("id")+" -> "+c.eventPhase+")");!0===a.getEnabled()?(c=this.getSource(),a.ctatdebug("Playing audio file: "+c),d.setAttribute("src",c),d.play(),h="play",a.processAction()):a.ctatdebug("Component is disabled, not grading")}.bind(this);this.play=function(){a.ctatdebug("play");var c=this.getSource();d.setAttribute("src",c);d.load();d.play();h="play"};this.playClip=function(c){a.ctatdebug("playClip");d.setAttribute("src",
c);d.load();d.play();h="play"};this.pause=function(){a.ctatdebug("pause");d.pause();h="pause"}};CTATAudioButton.prototype=Object.create(CTATButtonBasedComponent.prototype);CTATAudioButton.prototype.constructor=CTATAudioButton;CTAT.ComponentRegistry.addComponentType("CTATAudioButton",CTATAudioButton);var CTATButton=function(b,g,f,e,c){CTATButtonBasedComponent.call(this,"CTATButton","aButton",b,g,f,e,c);var a=this,d=null,h=CTATConfiguration.get("previewMode");this.init=function(){a.ctatdebug("init ("+a.getName()+")");a.setActionInput("ButtonPressed","-1");d=document.createElement("button");d.type="button";d.name=a.getName();d.value=$(this.getDivWrap()).attr("value")||"-1";this.setInput(d.value);d.id=CTATGlobalFunctions.gensym.div_id();d.setAttribute("onkeypress","return noenter(event)");d.classList.add("CTAT-button");
a.setInitialized(!0);if(a.getDivWrap().getAttribute("data-ctat-label"))d.innerHTML=a.getDivWrap().getAttribute("data-ctat-label");else if(a.getText())d.innerHTML=a.getText();else if(a.getDivWrap()&&a.getDivWrap().innerHTML&&!h){var c=a.getDivWrap().innerHTML;a.getDivWrap().innerHTML="";d.innerHTML=c}a.setComponent(d);a.addComponentReference(a,d);a.getDivWrap().appendChild(d);d.addEventListener("click",a.processClick);d.addEventListener("focus",a.processFocus);d.addEventListener("mousedown",this.processBaseMousedown);
d.addEventListener("mouseup",this.processBaseMouseup);d.addEventListener("mouseover",a.processBaseMouseover);d.addEventListener("mouseout",a.processBaseMouseout)}.bind(this);this.render=function(){};this.getConfigurationActions=function(){var a=[],c;0<d.innerHTML.trim().length&&(c=new CTATSAI,c.setSelection(this.getName()),c.setInput(d.innerHTML.toString()),c.setAction("setText"),a.push(c));return a};this.reset=function(){a.configFromDescription();a.processSerialization();a.setEnabled(!0)}};
CTATButton.prototype=Object.create(CTATButtonBasedComponent.prototype);CTATButton.prototype.constructor=CTATButton;CTAT.ComponentRegistry.addComponentType("CTATButton",CTATButton);var CTATTextBasedComponent=function(b,g,f,e,c,a,d){function h(a,c,d){var b=1,e=0;if(a)var f=a.substring(0,c).split("\n"),b=f.length,e=f.reduce(function(a,d,b){return b<f.length-1?a+1+d.length:c-a},0);a={};a[(d||"")+"Line"]=b;a[(d||"")+"Char"]=e;return a}CTAT.Component.Base.Tutorable.call(this,b,g,f,e,c,a,d);var l=this,n="",p="#000000",q=16,u=!0,v=255,y=!0;this.trackSelection=!1;this.DEFAULT_ACTION="UpdateTextField";this.SELECT_TEXT_ACTION="selectText";this.setAction(this.DEFAULT_ACTION);this.backgrade=
!0;this.setFontColor=function(a){p=a;$(l.getComponent()).css("color",a)};this.getFontColor=function(){return p};this.setFontSize=function(a){a.includes("px")||(a+="px");q=a;$(l.getComponent()).css("font-size",a)};this.getFontSize=function(){return q};this.assignText=function(a){n=a;this.setInput(a)};this.UpdateTextArea=this.UpdateTextField=function(a){this.setText(a)};this.setTabOnEnter=function(a){u=CTATGlobalFunctions.toBoolean(a)};this.setStyleHandler("TabOnEnter",this.setTabOnEnter);this.data_ctat_handlers["tab-on-enter"]=
this.setTabOnEnter;this.assignEditable=function(a){y=a};this.setMaxCharacters=function(a){v=a};this.setStyleHandler("MaxCharacters",this.setMaxCharacters);this.getText=function(){return n};this.getEditable=function(){return y};this.getTabOnEnter=function(){return u};this.getMaxCharacters=function(){return v};this.disableTextAlterations=function(a){for(var c="autocomplete off autocapitalize off autocorrect off spellcheck false".split(" "),d=0;d<c.length;d+=2){var b=c[d],e=a.getAttribute(b);e||"false"===
String(e).toLowerCase()||a.setAttribute(b,e=c[d+1]);c[d+1]=e}this.ctatdebug("'#"+a.getAttribute("id")+"'.processAttributes("+c+")");return c};this.setEditable=function(a){l.assignEditable(CTATGlobalFunctions.toBoolean(a));null!==l.getComponent()&&(!0===l.getEditable()?l.getComponent().contentEditable="true":l.getComponent().contentEditable="false")};this.setStyleHandler("Enabled",this.setEditable);this.setEnabled=function(a){l.assignEnabled(a);null!==l.getComponent()&&(l.getComponent().disabled=!a,
this.setEditable(a))};var w=this.processAction.bind(this);this.processAction=function(a,c){l.ctatdebug("processAction ()");this.updateSAI();CTATGlobalFunctions.isBlank(this.getValue())||w(a,c)};this.processKeydown=function(a){return l.processKeydown(a)};this.processKeydown=function(a){l.ctatdebug("processKeydown ()");var c=a.target.getAttribute("id");l.ctatdebug(c);var d=l.getComponentFromID(c);if(null===d)l.ctatdebug("Error: component reference is null");else switch(l.ctatdebug(d.getName()+" keydown ("+
("google"==CTATConfig.platform?0:window.event?window.event.keyCode:a.which)+" -> "+a.eventPhase+") ID: "+c),a.which){case 37:l.ctatdebug("left arrow key pressed!");break;case 39:l.ctatdebug("right arrow key pressed!");break;case 13:return u?(l.component.blur(),CTATGlobals.Tab.Focus=null,l.processAction(),!1):!0;case 9:case 0:l.ctatdebug("processKeydown() Tab key pressed!");l.component.blur();CTATGlobals.Tab.Focus=null;l.processAction();break;default:l.ctatdebug('Key pressed! "'+a.which+'"')}};this.processSelect=
function(a){if(a.target==l.component&&l.trackSelection){l.setAction(l.SELECT_TEXT_ACTION);var c=l.getSelectionWithLineNumbers(a);l.setInput(JSON.stringify(Object.assign(c,{start:l.component.selectionStart,end:l.component.selectionEnd,selectedText:l.component.value.substring(a.target.selectionStart,a.target.selectionEnd),wholeText:l.component.value})));w()}};this.getSelectionWithLineNumbers=function(a){var c=h(a.target.value,a.target.selectionStart,"start");a=h(a.target.value,a.target.selectionEnd,
"end");return Object.assign(a,c)};this.updateSAI=function(){l.ctatdebug("updateSAI ()");l.setAction(l.DEFAULT_ACTION);l.setInput(l.getValue());var a=this.getSAI();l.ctatdebug("SAI: "+a.toTSxmlString())}};CTATTextBasedComponent.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);CTATTextBasedComponent.prototype.constructor=CTATTextBasedComponent;var CTATTextArea=function(b,g,f,e,c){CTATTextBasedComponent.call(this,"CTATTextArea","__undefined__",b,g,f,e,c);this.setDefaultWidth(100);this.setDefaultHeight(44);this.DEFAULT_ACTION="UpdateTextArea";var a=this,d=null,h=null,l=CTATConfiguration.get("previewMode");this.setAction(this.DEFAULT_ACTION);this.init=function(c){d=document.createElement("textarea");b&&(d.name=b.name);d.setAttribute("id",CTATGlobalFunctions.gensym.div_id());(c=this.getDivWrap())&&$(c).attr("maxlength")&&(d.maxlength=$(c).attr("maxlength"));
c&&$(c).attr("rows")&&(d.rows=$(c).attr("rows"));c&&$(c).attr("cols")&&(d.cols=$(c).attr("cols"));a.trackSelection=c&&/true/i.test($(c).attr("data-ctat-track-selection"));a.setComponent(d);a.disableTextAlterations(d);c&&$(c).attr("value")?this.setText($(c).attr("value")):d.value=this.getText();a.setInitialized(!0);a.addComponentReference(a,d);c.appendChild(d);$(d).keydown(a.processKeydown);d.addEventListener("focus",a.processFocus);a.addSafeEventListener("select",a.processSelect,d);$(d).on("input",
function(c){a.setNotGraded()});l&&this.addEventScreen(!1)};this.processBlur=function(c){a.processAction()};this.setCellContainer=function(a){h=a};this.getCellContainer=function(){return h};this.setText=function(c){a.ctatdebug("setText ("+c+")");a.assignText(c);d.value=c};this.getValue=function(){return d.value};this.reset=function(){a.configFromDescription();a.processSerialization();d.value=""}};CTATTextArea.prototype=Object.create(CTATTextBasedComponent.prototype);
CTATTextArea.prototype.constructor=CTATTextArea;CTAT.ComponentRegistry.addComponentType("CTATTextArea",CTATTextArea);var CTATChatPanel=function(b,g,f,e,c){function a(){var a=new Date,c=a.getHours();12<c&&(c-=12);var d=a.getMinutes();10>d&&(d="0"+a.getMinutes());return""+c+":"+d+(12<=a.getHours()?" PM":" AM")}CTAT.Component.Base.Tutorable.call(this,"CTATChatPanel","__undefined__",b,g,f,e,c);var d=this,h=null,l=null,n="",p="",q="",u="",v="",y=null,w=null,A=null,z=CTATConfiguration.get("previewMode"),C=null,D=0,F=CTATGlobals.languageManager.filterString("TYPING"),G=!1;this.log=(this.logger=new CTATLogger(["chatpanel"])).log;
this.setPlaceholder=function(a){n=a};this.data_ctat_handlers.placeholder=d.setPlaceholder;this.setDefaultLabel=function(a){p=a};this.data_ctat_handlers["default-label"]=d.setDefaultLabel;this.setShowSendButton=function(a){q=a};this.data_ctat_handlers["send-button"]=d.setShowSendButton;this.setWarningText=function(a){u=a};this.data_ctat_handlers["warning-text"]=d.setWarningText;this.setWarningImg=function(a){v=a};this.data_ctat_handlers["warning-img"]=d.setWarningImg;this.setTypeText=function(a){F=
a};this.data_ctat_handlers["type-text"]=d.setTypeText;this.setSendOnEnter=function(a){G=a&&/true|yes|enable/i.test(a)};this.data_ctat_handlers["send-on-enter"]=d.setSendOnEnter;this.init=function(){d.log("chatpanel","init ("+d.getName()+")");d.setTutorComponent(CTAT.Component.Base.Tutorable.Options.TutorComponent.DO_NOT_TUTOR);d.setInitialized(!0);var a=d.getDivWrap();d.addComponentReference(d,a);h=document.createElement("div");h.id=a.id+"chatArea";h.classList.add("CTATChatPanel--chat-area");l=document.createElement("div");
l.id=a.id+"inputDiv";l.classList.add("CTATChatPanel--input-div");lineBreak=document.createElement("br");w=document.createElement("textarea");w.id=a.id+"_input";w.classList.add("CTATChatPanel--message-box");w.placeholder=n;w.addEventListener("keydown",this.typingIndicator);if(u||v){y=document.createElement("div");y.classList.add("CTATChatPanel--warning-div");if(v){var c=document.createElement("img");c.src=v;y.appendChild(c)}u&&(c=document.createTextNode(u),y.appendChild(c))}l.appendChild(w);A=document.createElement("button");
A.innerText="Send";A.id=a.id+"_send";A.classList.add("CTATChatPanel--send-button");A.addEventListener("click",function(a){return d.sendText()});d.setComponent(w);d.addComponentReference(d,h);d.addComponentReference(d,l);y&&d.addComponentReference(d,y);d.addComponentReference(d,w);q&&(d.addComponentReference(d,A),l.appendChild(A));a.appendChild(h);y&&a.appendChild(y);a.appendChild(l);d.render();z&&this.addEventScreen(!1)};this.displayName=function(){return CTATConfiguration.get("display_name")||CTATConfiguration.get("user_guid")||
""};this.updateSAISend=function(a){d.log("chatpanel","updateSAISend ()",a);var c=d.getDivWrap();this.setSelection(c.id);this.setAction("sendMessage");c=d.displayName();this.setInput(c+": "+a);a=this.getSAI();d.log("chatpanel","SAI: "+a.toTSxmlString())};var x=this.processAction.bind(this);this.processSend=function(a,c,b){d.log("chatpanel","processSend()",a);d.updateSAISend(a);var e=/_computer$/i.test(String(a));CTATGlobalFunctions.isBlank(a)&&!e||x(c,b)};this.removeTypingNotifications=function(a){var c=
h.children;d.log("chatpanel","removeTypingNotifications:"+a+", length:"+c.length);for(var b=0,e=1;e<=c.length;e++){var f=c[c.length-e],g=f.children;if(g&&!(4>g.length)){var g=g[g.length-4].innerText,l=f.getAttribute("data-ctat-author");d.log("chatpanel","  ["+e+"] mbAuthor "+l+", mbText "+g);if(l==d.displayName()&&g==F||a==l&&g==a+": "+F)h.removeChild(f),b++}}0<b&&(h.scrollTop=h.scrollHeight);return b};this.processRemoveTypingNotifications=function(a,c,b){c=d.getDivWrap();this.setSelection(c.id);
this.setAction("removeTypingNotifications");this.setInput(a);a=d.getSAI();d.log("chatpanel","processRemoveTypingNotifications SAI: "+a.toTSxmlString());CTATCommShell.commShell.processComponentAction(a,d.getTutorComponent(),b,null,!1,"data")};this.addOwnMessage=function(c,b){var e=document.createElement("div");e.innerText=c;e.classList.add("CTATChatPanel--single-message");var f=document.createElement("div");f.innerText=a();f.classList.add("CTATChatPanel--timestamp");var g=document.createElement("br"),
l=document.createElement("br"),n=document.createElement("div");n.setAttribute("data-ctat-author",d.displayName());n.style.display=b||"block";n.style.padding="5px";n.appendChild(e);n.appendChild(g);n.appendChild(f);n.appendChild(l);d.log("chatpanel","CTATChatPanel.addOwnMessage",c);h.appendChild(n);h.scrollTop=h.scrollHeight;d.removeTypingNotifications(d.displayName());d.processRemoveTypingNotifications(d.displayName())};this.addOtherMessage=function(c){var b=c.indexOf(":"),e=c.substr(0,b),f=c.substr(b+
2),b=document.createElement("div");b.innerHTML=e.bold()+": "+f;b.classList.add("CTATChatPanel--other-message");f=document.createElement("div");f.innerText=a();f.classList.add("CTATChatPanel--timestamp");var g=document.createElement("br");f.style.cssFloat="left";var l=document.createElement("br"),n=document.createElement("div");n.setAttribute("data-ctat-author",e);n.style.display="block";n.style.padding="5px";n.appendChild(b);n.appendChild(g);n.appendChild(f);n.appendChild(l);d.log("chatpanel","CTATChatPanel.addOtherMessage",
c);h.appendChild(n);h.scrollTop=h.scrollHeight};this.sendCompMessage=function(c){var d=document.createElement("div");d.innerHTML="computer".bold()+": "+c;d.classList.add("CTATChatPanel--comp-message");c=document.createElement("div");c.innerText=a();c.classList.add("CTATChatPanel--timestamp");c.style.cssFloat="left";var b=document.createElement("br"),e=document.createElement("br");h.appendChild(d);h.appendChild(b);var f=document.createElement("div");f.setAttribute("data-ctat-author","computer");f.style.display=
"block";f.style.padding="5px";f.appendChild(d);f.appendChild(b);f.appendChild(c);f.appendChild(e);h.appendChild(f);h.scrollTop=h.scrollHeight};this.sendCompMessageBroadcast=function(a){if(""!==a){d.processSend(a+"_computer");var c=CTAT.Component.Base.Tutorable.Options.TutorComponent;d.getTutorComponent()===c.DO_NOT_TUTOR&&d.sendCompMessage(a)}};this.checkTime=function(a){D++;4<=D&&(d.resetTimer(!1),d.removeTypingNotifications(d.displayName()),d.processRemoveTypingNotifications(d.displayName()))};
this.resetTimer=function(a){null!=C&&(clearInterval(C),C=null,D=0);a&&null==C&&(C=setInterval(this.checkTime,1E3))};this.typingIndicator=function(a){if(G&&"Enter"==a.key&&!a.shiftKey&&!a.altKey)return a.stopPropagation(),d.sendText();d.resetTimer(!0);a=F;var c=null,b=h.children;0<b.length&&(c=b[b.length-1].children,c=c[c.length-4]);c&&c.innerText==a||(d.addOwnMessage(a,"none"),d.updateSAISend(a),CTATCommShell.commShell.processComponentAction(d.getSAI(),d.getTutorComponent(),null,null,!1,"data"))};
this.sendText=function(a){a=a||p;var c=w.value;""!==c&&(c=a+(a?": ":"")+c,d.processSend(c),a=CTAT.Component.Base.Tutorable.Options.TutorComponent,d.getTutorComponent()===a.DO_NOT_TUTOR&&d.addOwnMessage(c));w.value="";A.classList.remove("CTAT--incorrect")};this.sendMessage=function(a){d.log("chatpanel","CTATChatPanel.sendMessage()",a);var c;if("computer"===a.split("_").pop()){c=a.indexOf(":");var b=a.lastIndexOf("_");a=a.slice(c+2,b);d.sendCompMessage(a)}else(c=/^([^:]+): (.*)/.exec(a),c&&c[1]==d.displayName())?
d.addOwnMessage(c[2]):d.addOtherMessage(a);A.classList.remove("CTAT--incorrect")}};CTATChatPanel.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);CTATChatPanel.prototype.constructor=CTATChatPanel;CTAT.ComponentRegistry.addComponentType("CTATChatPanel",CTATChatPanel);var CTATCheckBox=function(b,g,f,e,c){CTAT.Component.Base.Clickable.call(this,"CTATCheckBox","__undefined__",b,g,f,e,c);var a=null,d=null,h=CTATConfiguration.get("previewMode");this.setStyleHandler("inspBackgroundColor",null);this.setStyleHandler("BackgroundColor",null);this.setStyleHandler("DrawBorder",null);this.setStyleHandler("showBorder",null);this.setStyleHandler("BorderColor",null);this.setStyleHandler("TextAlign",null);var l=this;this.setSelection(this.getComponentGroup());this.setAction("UpdateCheckBox");
this.getCheckBox=function(){return a};this.setStyleHandler("labelPlacement",null);var n=function(a){this.updateSAI();this.processClick(a)};this.init=function(){l.setInitialized(!0);a=document.createElement("input");a.type="checkbox";a.setAttribute("id",this.getName()+"_check");a.classList.add("CTATCheckBox--button");this.getText()?a.value=l.getText():this.getDivWrap()&&this.getDivWrap().textContent?a.value=this.getDivWrap().textContent:a.value=a.id;this.getComponentGroup()?a.name=l.getComponentGroup():
this.getDivWrap()&&$(this.getDivWrap()).attr("name")?a.name=$(this.getDivWrap()).attr("name"):a.name="checkBoxGroup";!0===l.getEnabled()?a.disabled=!1:a.disabled=!0;l.ctatdebug("Final location: "+l.getX()+","+l.getY()+" with text: "+l.getText());l.addComponentReference(l,a);if(!h){var c=this.getDivWrap().innerHTML;this.getDivWrap().innerHTML=""}$(l.getDivWrap()).append(a);d=document.createElement("label");d.htmlFor=a.id;d.classList.add("CTATCheckBox--label");this.getDivWrap().getAttribute("data-ctat-label")?
d.textContent=l.getDivWrap().getAttribute("data-ctat-label"):this.getText()?d.textContent=l.getText():c&&!h&&(d.innerHTML=c);$(this.getDivWrap()).append(d);l.setComponent(a);a.addEventListener("click",n.bind(this));a.addEventListener("focus",l.processFocus);a.onfocus=this.processOnFocus;this.setSelection(this.getComponentGroup())};this.resize=function(){var a=$(this.getDivWrap()).height();$(d).css("font-size",a-5+"px");$(this.getComponent()).css("height",a-10+"px");$(this.getComponent()).css("width",
a-10+"px")};this.getConfigurationActions=function(){var a=[],c;0<d.innerHTML.trim().length&&(c=new CTATSAI,c.setSelection(this.getName()),c.setInput(d.innerHTML.toString()),c.setAction("setText"),a.push(c));return a};var p=this.setText;this.setText=function(c){l.ctatdebug("setText ("+c+")");p(c);a&&(a.value=c,d.innerHTML=c)};this.setStyleHandler("labelText",this.setText);var q=this.setEnabled;this.setEnabled=function(c){q(c);a&&(a.disabled=!this.getEnabled())};this.getCheckBoxInput=function(){return d.innerHTML+
": "+a.checked};this.reset=function(){a.checked=!1;l.setEnabled(!0)};this.UpdateCheckBox=function(c){var d=new RegExp("(^|;)"+CTATCheckBox.escape(a.value)+"\\s*:\\s*true");a.checked=0<=c.search(d)};this.SetSelected=function(c){c=CTATGlobalFunctions.toBoolean(c);a.checked=c};this.updateSAI=function(){var c=$("."+this.getClassName()+'[data-ctat-component]:has(input[type="checkbox"][name="'+a.name+'"])').sort(function(a,c){a=a.id;c=c.id;return a>c?1:a<c?-1:0}),c=$.map(c,function(a){a=$(a).data("CTATComponent").getCheckBox();
return a.value+": "+a.checked});this.setSelection(a.name);this.setAction("UpdateCheckBox");this.setInput(c.join(";"))};var u=function(c){d.classList.add(c);a.classList.add(c)},v=function(c){d.classList.remove(c);a.classList.remove(c)};this.showCorrect=function(a){v("CTAT--incorrect");v("CTAT--hint");u("CTAT--correct")};this.removeCorrect=v.bind(this,"CTAT--correct");this.showInCorrect=function(a){v("CTAT--correct");v("CTAT--hint");u("CTAT--incorrect")};this.removeInCorrect=v.bind(this,"CTAT--incorrect");
this.showHintHighlight=function(a){v("CTAT--incorrect");v("CTAT--correct");a?u("CTAT--hint"):v("CTAT--hint")}};CTATCheckBox.prototype=Object.create(CTAT.Component.Base.Clickable.prototype);CTATCheckBox.prototype.constructor=CTATCheckBox;CTATCheckBox.escape=function(b){return b.replace(/[-[\]{}()*+?.,\\^$|#\s\/]/g,"\\$&")};CTAT.ComponentRegistry.addComponentType("CTATCheckBox",CTATCheckBox);var CTATComboBox=function(b,g,f,e,c){CTAT.Component.Base.Clickable.call(this,"CTATComboBox","__undefined__",b,g,f,e,c);var a=this,d=null;this.component=null;var h="",l=CTATConfiguration.get("previewMode");this.setAction("UpdateComboBox");var n=",";b=function(a){n=a;d&&(d.innerHTML="",this.addLabels(p,n))}.bind(this);this.setStyleHandler("SplitCharacter",b);this.data_ctat_handlers["split-on"]=b;var p=null;this.setLabels=function(a){p=a;d&&(d.innerHTML="",this.addLabels(p,n))}.bind(this);this.setStyleHandler("Labels",
this.setLabels);this.data_ctat_handlers.labels=this.setLabels;var q=null;b=function(a){a=parseInt(a);q=isNaN(a)?null:a;d&&d.setAttribute("size",q)};this.setStyleHandler("DropDownSize",b);this.data_ctat_handlers.size=b;this.setStyleHandler("DropDownWidth",null);this.setNumOptions=b;this.setGradeOnNextClick=function(c){a.ctatdebug("CTATComboBox["+a.getName()+"].setGradeOnNextClick("+c+")");h=c};this.getGradeOnNextClick=function(){a.ctatdebug("CTATComboBox["+a.getName()+"].getGradeOnNextClick() to return "+
h);return h};this.processAssociatedRules=function(c,d,b){c=c.getProperty("OutOfOrder");a.ctatdebug("CB["+a.getName()+"] processAssociatedRules indicator "+d+", outOfOrder "+c+", tutorAdvice '"+b+"'");d&&"incorrect"==d.toString().toLowerCase()&&(c||b&&b.toString().toLowerCase().includes(" the step you "))&&a.setGradeOnNextClick("at "+(new Date).toString()+": sai "+a.getSAI().toString())};this.init=function(){a.setInitialized(!0);d=document.createElement("select");d.name=a.getName();d.setAttribute("id",
CTATGlobalFunctions.gensym.div_id());d.setAttribute("onkeypress","return noenter(event)");d.onchange=this.processComboSelection;d.addEventListener("click",function(c){a.ctatdebug("CB["+a.getName()+"].onclick() "+c+", gradeOnNextClickInfo "+a.getGradeOnNextClick());a.getGradeOnNextClick()&&a.processComboSelection()});d.classList.add("CTAT-combobox");q&&!l&&d.setAttribute("size",q);if(!l){var c=this.getDivWrap().innerHTML;this.getDivWrap().innerHTML="";c.trim()&&(d.innerHTML=c)}p&&this.addLabels(p,
n);!0===a.getEnabled()?d.disabled=!1:d.disabled=!0;a.addComponentReference(a,d);a.setComponent(d);a.getDivWrap().appendChild(d);this.component=d;d.addEventListener("focus",a.processFocus)};this.getConfigurationActions=function(){var a=[];if(p){var c=new CTATSAI;c.setSelection(this.getName());c.setInput(p);c.setAction("setLabels");a.push(c)}return a};this.getHTMLComponent=function(){return d};this.addLabels=function(a,c){a=a.split(c?c:n);for(c=0;c<a.length;c++)this.addItem(a[c])};this.addBlank=function(a){for(var c=
0;c<a;c++)this.addItem("")};this.addItem=function(c){a.ctatdebug("addItem ("+c+")");var b=document.createElement("option");b.setAttribute("value",c);b.textContent=c;d.appendChild(b)};this.setFontSize=function(a){isNaN(a)||($(this.getComponent()).css("font-size",a+"px"),this.getDivWrap().setAttribute("data-ctat-font-size",a))};this.valid_selection=function(){return 0<=d.selectedIndex&&!CTATGlobalFunctions.isBlank(d.value)};this.processComboSelection=function(){a.ctatdebug("processComboSelection ()");
a.setGradeOnNextClick("");a.setInput(d.options[d.selectedIndex].value);a.valid_selection()?a.processAction():this.ctatdebug("Empty component, nothing to grade")};this.UpdateComboBox=function(a){d.value=a};this.updateSAI=function(){a.setInput(d.value)}};CTATComboBox.prototype=Object.create(CTAT.Component.Base.Clickable.prototype);CTATComboBox.prototype.constructor=CTATComboBox;CTAT.ComponentRegistry.addComponentType("CTATComboBox",CTATComboBox);var CTATDoneButton=function(b,g,f,e,c){CTAT.Component.Base.Clickable.call(this,"done","CTATDoneButton",b,g,f,e,c);this.setName("done");this.setClassName("CTATDoneButton");this.setText(CTATGlobals.languageManager.getString("DONE"));this.setStyleHandler("BackgroundColor",null);this.setStyleHandler("TextAlign",null);var a=this;this.init=function(){this.setInitialized(!0);var a=document.createElement("button");a.classList.add("CTAT-done-button");this.setComponent(a);var c=document.createElement("div");
c.classList.add("CTAT-done-button--content");a.appendChild(c);var b=document.createElement("div");b.textContent="\u2714";b.classList.add("CTAT-done-button--icon");c.appendChild(b);this.getText()&&(b=document.createElement("div"),b.classList.add("CTAT-done-button--text"),b.textContent=this.getText(),c.appendChild(b));this.getDivWrap().appendChild(a);a.addEventListener("mouseenter",function(a){a.target.classList.add("CTAT-done-button--hover")});a.addEventListener("mouseleave",function(a){a.target.classList.remove("CTAT-done-button--hover");
a.target.classList.remove("CTAT-done-button--clicked")});a.addEventListener("mousedown",function(a){a.target.classList.add("CTAT-done-button--clicked")});a.addEventListener("mouseup",function(a){a.target.classList.remove("CTAT-done-button--clicked")});a.addEventListener("click",function(a){a.target.classList.remove("CTAT-done-button--clicked")});a.addEventListener("click",this.processClick);a.addEventListener("focus",this.processFocus)};this.processClick=function(c){a.getEnabled()&&CTATCommShell.commShell&&
(c=new FocusEvent(a.getName(),{currentTarget:a,relatedTarget:CTATGlobals.Tab.Focus&&"function"==typeof CTATGlobals.Tab.Focus.getComponent?CTATGlobals.Tab.Focus.getComponent():null}),a.processFocus(c),CTATCommShell.commShell.processDone(a.getCompletionStatus()))};this.getCompletionStatus=function(){return this.getDivWrap()?this.getDivWrap().getAttribute("data-ctat-completion-status"):""};this.setCompletionStatus=function(a){this.getDivWrap()&&this.getDivWrap().setAttribute("data-ctat-completion-status",
String(a));return this}};CTATDoneButton.prototype=Object.create(CTAT.Component.Base.Clickable.prototype);CTATDoneButton.prototype.constructor=CTATDoneButton;CTAT.ComponentRegistry.addComponentType("CTATDoneButton",CTATDoneButton);var CTATDragNDrop=function(){CTAT.Component.Base.Tutorable.call(this,"CTATDragNDrop","aDnD");this.setParameterHandler("groupname",function(a){this.getDivWrap()&&$(this.getDivWrap()).attr("name",a)});this.set_child_limit=function(a){a=parseInt(a);isNaN(a)||$(this.component).attr("data-ctat-max-cardinality",a)};this.setParameterHandler("MaxObjects",this.set_child_limit);this.get_child_limit=function(){var a=parseInt($(this.component).attr("data-ctat-max-cardinality"));return isNaN(a)?-1:a};var b=function(a){return a.split("").reduce(function(a,
c){a=(a<<5)-a+c.charCodeAt(0);return a&a},0)},g=function(a){var c=$(this).parent().attr("name"),d=$(this).parent().attr("id");a.dataTransfer.setData("ctat/group",c);a.dataTransfer.setData("ctat/source",d);a.dataTransfer.setData("text",this.id);var e=b(this.id);CTATDragNDrop.dragging[e]={id:this.id,group:c,source:d};a.dataTransfer.setData("ctat/id/"+e,e)},f=function(a){for(var c,b=0;b<a.dataTransfer.types.length;b++)if(c=/^ctat\/id\/(.+)$/.exec(a.dataTransfer.types[b]))c=c[1],CTATDragNDrop.dragging.hasOwnProperty(c)&&
delete CTATDragNDrop.dragging[c]},e=null;this.init=function(){e=this.getDivWrap();if(!$(e).attr("name")){var a=CTATDragNDrop.default_groupname;this.getComponentGroup()&&(a=this.getComponentGroup());$(e).attr("name",a)}this.setComponent(e);CTATComponentReference.add(this,e);CTATConfiguration.get("previewMode")||$(e).children().addClass("CTATDragNDrop--item").attr({unselectable:"on",draggable:!0}).each(function(){this.id||(this.id=CTATGlobalFunctions.gensym.div_id());this.addEventListener("dragstart",
g,!1);this.addEventListener("dragend",f,!1)});this.component.addEventListener("dragover",function(a){var c=!1;if($(this).data("CTATComponent").getEnabled()){var b=parseInt($(this).attr("data-ctat-max-cardinality"));if((isNaN(b)||0>b||$(this).children().length<b)&&(new Set(a.dataTransfer.types)).has("ctat/group"))if(a.dataTransfer.getData("text"))a.dataTransfer.getData("ctat/group")===$(this).attr("name")&&a.dataTransfer.getData("ctat/source")!==this.id&&(c=!0);else for(var d,b=0;b<a.dataTransfer.types.length;b++)if(d=
/^ctat\/id\/(.+)$/.exec(a.dataTransfer.types[b]))d=d[1],CTATDragNDrop.dragging.hasOwnProperty(d)&&CTATDragNDrop.dragging[d].group===$(this).attr("name")&&CTATDragNDrop.dragging[d].source!==this.id&&(c=!0)}c&&(a.preventDefault(),a.dataTransfer.effectAllowed="move",a.dataTransfer.dropEffect="move",this.classList.add("CTATDragNDrop--valid-drop"))},!1);this.component.addEventListener("drop",function(a){a.preventDefault();this.classList.remove("CTATDragNDrop--valid-drop");var c=$(this).data("CTATComponent");
if(c.getEnabled()){var b=a.dataTransfer.getData("text");a.dataTransfer.getData("ctat/source");a=document.getElementById(b);this.appendChild(a);$("#"+b).removeClass("CTAT--correct CTAT--incorrect CTAT--hint");c.setActionInput("Add",b);c.processAction()}},!1);this.component.addEventListener("dragleave",function(a){this.classList.remove("CTATDragNDrop--valid-drop")},!1);this.setInitialized(!0)};this.getConfigurationActions=function(){var a=[],c=[];$(this.component).children().each(function(){c.push($(this).attr("id"))});
if(0<c.length){var b=new CTATSAI;b.setSelection(this.getName());b.setAction("SetChildren");b.setInput(c.sort().join(";"));a.push(b)}return a};var c=this.setEnabled;this.setEnabled=function(a){c(a);e&&($(e).children().attr("draggable",a),this.getDisableOnCorrect()&&$(e).find(".CTAT--correct").attr("draggable",!1))};this.Add=function(a){a=$("#"+a);0<a.length&&a.appendTo(this.getDivWrap());$(a).hasClass("CTATDragNDrop--item")||($(a).addClass("CTATDragNDrop--item").attr({unselectable:"on",draggable:!0}),
a.addEventListener("dragstart",g,!1),a.addEventListener("dragend",f,!1))};this.SetChildren=function(a){a.split(";").forEach(function(a){this.Add(a)},this)};this.updateSAI=function(){var a=[];$(this.component).children().each(function(){a.push($(this).attr("id"))});this.setActionInput("SetChildren",a.sort().join(";"))};var a=this.showCorrect.bind(this);this.showCorrect=function(c){switch(c.getAction()){case "Add":this.setEnabled(!0);c=c.getInput();$("#"+c).addClass("CTAT--correct");this.getDisableOnCorrect()&&
$("#"+c).attr("draggable",!1);break;default:a(c)}};var d=this.showInCorrect.bind(this);this.showInCorrect=function(a){switch(a.getAction()){case "Add":a=a.getInput();$("#"+a).addClass("CTAT--incorrect");break;default:d(a)}}};CTATDragNDrop.dragging={};CTATDragNDrop.default_groupname="DragNDropGroup";CTATDragNDrop.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);CTATDragNDrop.prototype.constructor=CTATDragNDrop;CTAT.ComponentRegistry.addComponentType("CTATDragNDrop",CTATDragNDrop);var CTATDragSource=function(){CTAT.Component.Base.Tutorable.call(this,"CTATDragSource","aDnD");this.setParameterHandler("groupname",function(a){this.getDivWrap()&&$(this.getDivWrap()).attr("name",a)});this.set_child_limit=function(a){a=parseInt(a);isNaN(a)||$(this.component).attr("data-ctat-max-cardinality",a)};this.setParameterHandler("MaxObjects",this.set_child_limit);this.get_child_limit=function(){var a=parseInt($(this.component).attr("data-ctat-max-cardinality"));return isNaN(a)?-1:a};this.set_child_overflow=
function(a){a=parseInt(a);isNaN(a)||$(this.component).attr("data-ctat-max-overflow",a)};this.setParameterHandler("MaxOverflow",this.set_child_overflow);this.get_child_overflow=function(){var a=parseInt($(this.component).attr("data-ctat-max-overflow"));return isNaN(a)?-1:a};this.set_purpose=function(a){a?$(this.component).attr("data-ctat-purpose",a):$(this.component).attr("data-ctat-purpose","destination")};this.setParameterHandler("Purpose",this.set_purpose);this.get_purpose=function(){return $(this.component).attr("data-ctat-purpose")?
$(this.component).attr("data-ctat-purpose"):"destination"};var b=function(a){return a.split("").reduce(function(a,c){a=(a<<5)-a+c.charCodeAt(0);return a&a},0)},g=function(a){var c=$(this).parent().attr("name"),d=$(this).parent().attr("id");a.dataTransfer.setData("ctat/group",c);a.dataTransfer.setData("ctat/source",d);a.dataTransfer.setData("original",this.id);if("source"===$("#"+d).attr("data-ctat-purpose")){var e=this.id+"--"+CTATGlobalFunctions.gensym.div_id().slice(7);a.dataTransfer.setData("text",
e);var f=b(e);a.dataTransfer.setData("ctat/id/"+f,f);CTATDragSource.dragging[f]={id:e,group:c,source:d}}else a.dataTransfer.setData("text",this.id),f=b(this.id),a.dataTransfer.setData("ctat/id/"+f,f),CTATDragSource.dragging[f]={id:this.id,group:c,source:d}},f=function(a){for(var c,b=0;b<a.dataTransfer.types.length;b++)if(c=/^ctat\/id\/(.+)$/.exec(a.dataTransfer.types[b]))c=c[1],CTATDragSource.dragging.hasOwnProperty(c)&&delete CTATDragSource.dragging[c]},e=this;e.setDisabled=function(a){try{if("button"!==
a.type&&(a.disabled=!0),0<a.children.length)for(var c=0;c<a.children.length;c++)e.setDisabled(a.children[c])}catch(p){}};e.removeDisabled=function(a){a.disabled=!1;if(0<a.children.length)for(var c=0;c<a.children.length;c++)e.removeDisabled(a.children[c])};e.animatedRemove=function(a){$("#"+a).animate({opacity:.1,zoom:1.3},500,"swing",function(){var c=document.getElementById(a);c.parentNode.removeChild(c)})};var c=null;this.init=function(){c=this.getDivWrap();if(!$(c).attr("name")){var a=CTATDragSource.default_groupname;
this.getComponentGroup()&&(a=this.getComponentGroup());$(c).attr("name",a)}this.setComponent(c);CTATComponentReference.add(this,c);CTATConfiguration.get("previewMode")||$(c).children().addClass("CTATDragSource--item").attr({unselectable:"on",draggable:!0}).each(function(){this.id||(this.id=CTATGlobalFunctions.gensym.div_id());this.addEventListener("dragstart",g,!1);this.addEventListener("dragend",f,!1)});"source"===c.getAttribute("data-ctat-purpose")&&(window.onload=function(){e.setDisabled(c)});
this.component.addEventListener("dragover",function(a){var c=!1;if($(this).data("CTATComponent").getEnabled()){var b=parseInt($(this).attr("data-ctat-max-cardinality"));if((isNaN(b)||0>b||$(this).children().length<b)&&(new Set(a.dataTransfer.types)).has("ctat/group"))if(a.dataTransfer.getData("text"))a.dataTransfer.getData("ctat/group")===$(this).attr("name")&&a.dataTransfer.getData("ctat/source")!==this.id&&(c=!0);else for(var d,b=0;b<a.dataTransfer.types.length;b++)if(d=/^ctat\/id\/(.+)$/.exec(a.dataTransfer.types[b]))d=
d[1],CTATDragSource.dragging.hasOwnProperty(d)&&CTATDragSource.dragging[d].group===$(this).attr("name")&&CTATDragSource.dragging[d].source!==this.id&&(c=!0)}"source"===$(a.target).attr("data-ctat-purpose")&&(c=!1);c&&(a.preventDefault(),a.dataTransfer.effectAllowed="move",a.dataTransfer.dropEffect="move",this.classList.add("CTATDragSource--valid-drop"))},!1);this.component.addEventListener("drop",function(a){a.preventDefault();this.classList.remove("CTATDragSource--valid-drop");var c=$(this).data("CTATComponent");
if(c.getEnabled()){var b=a.dataTransfer.getData("text"),d;document.getElementById(b)&&(d=document.getElementById(b),this.appendChild(d));if(!document.getElementById(b)){a=document.getElementById(a.dataTransfer.getData("original"));d=a.cloneNode(!1);this.append(d);d.id=b;d.addEventListener("dragstart",g,!1);d.addEventListener("dragend",f,!1);var h,l=/(CTAT[A-z]*)(\s|$)/g.exec(d.className);if(l)for(var n=0;n<l.length;n++)CTAT.ComponentRegistry[l[n]]&&(h=l[n]);h&&CTATTutor.initializeHTMLComponent(d,
h);d.setAttribute("draggable",!0);d.setAttribute("unselectable","on");h=a.childNodes.length;l=d.childNodes.length;a.classList.remove("CTAT--correct");a.classList.remove("CTAT--incorrect");a.classList.remove("CTAT--hint");if(l===h)for(n=0;n<l;n++)d.childNodes[n].setAttribute("class",a.childNodes[n].className),d.childNodes[n].setAttribute("value",a.childNodes[n].value),d.childNodes[n].innerHTML=a.childNodes[n].innerHTML;if(h!==l){for(;d.hasChildNodes();)d.removeChild(d.lastChild);for(n=0;n<h;n++)d.appendChild(a.childNodes[n].cloneNode(!0))}}"trashcan"===
$(this).attr("data-ctat-purpose")&&this.removeChild(d);"source"===$(this).attr("data-ctat-purpose")&&this.removeChild(d);"destination"!==$(this).attr("data-ctat-purpose")&&$(this).attr("data-ctat-purpose")||($("#"+d.id).removeClass("CTAT--correct CTAT--incorrect CTAT--hint"),e.removeDisabled(d),c.setActionInput("Add",b),c.processAction(),null!==$(this).attr("data-ctat-max-overflow")&&this.childNodes.length>$(this).attr("data-ctat-max-overflow")&&e.animatedRemove(this.firstChild.id))}},!1);this.component.addEventListener("dragleave",
function(a){this.classList.remove("CTATDragSource--valid-drop")},!1);this.setInitialized(!0)};this.getConfigurationActions=function(){var a=[],c=[];$(this.component).children().each(function(){c.push($(this).attr("id"))});if(0<c.length){var b=new CTATSAI;b.setSelection(this.getName());b.setAction("SetChildren");b.setInput(c.sort().join(";"));a.push(b)}return a};var a=this.setEnabled;this.setEnabled=function(b){a(b);c&&($(c).children().attr("draggable",b),this.getDisableOnCorrect()&&$(c).find(".CTAT--correct").attr("draggable",
!1))};this.Add=function(a){a=$("#"+a);0<a.length&&a.appendTo(this.getDivWrap());$(a).hasClass("CTATDragSource--item")||($(a).addClass("CTATDragSource--item").attr({unselectable:"on",draggable:!0}),a.addEventListener("dragstart",g,!1),a.addEventListener("dragend",f,!1))};this.SetChildren=function(a){a.split(";").forEach(function(a){this.Add(a)},this)};this.updateSAI=function(){var a=[];$(this.component).children().each(function(){a.push($(this).attr("id"))});this.setActionInput("SetChildren",a.sort().join(";"))};
var d=this.showCorrect.bind(this);this.showCorrect=function(a){switch(a.getAction()){case "Add":this.setEnabled(!0);a=a.getInput();$("#"+a).addClass("CTAT--correct");this.getDisableOnCorrect()&&$("#"+a).attr("draggable",!1);break;default:d(a)}};var h=this.showInCorrect.bind(this);this.showInCorrect=function(a){switch(a.getAction()){case "Add":a=a.getInput();$("#"+a).addClass("CTAT--incorrect");break;default:h(a)}}};CTATDragSource.dragging={};CTATDragSource.default_groupname="DragNDropGroup";
CTATDragSource.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);CTATDragSource.prototype.constructor=CTATDragSource;CTAT.ComponentRegistry.addComponentType("CTATDragSource",CTATDragSource);var CTATElement=function(b,g,f,e,c){CTAT.Component.Base.SAIHandler.call(this,"CTATElement","__undefined__",b,g,f,e,c);CTATConfiguration.get("previewMode");this.setStyleHandler("inspBackgroundColor",null);this.setStyleHandler("BackgroundColor",null);this.setStyleHandler("DrawBorder",null);this.setStyleHandler("showBorder",null);this.setStyleHandler("BorderColor",null);this.setStyleHandler("TextAlign",null);var a=this;this.setStyleHandler("labelPlacement",null);this.init=function(){a.setInitialized(!0);
console.log("CTATElement.init() typeof getDivWrap()",typeof a.getDivWrap(),a.getDivWrap());a.ctatdebug("Final location: "+a.getX()+","+a.getY()+" with text: "+a.getText());a.addComponentReference(a,a.getDivWrap())};this.resize=function(){var a=$(this.getDivWrap()).height();$(label).css("font-size",a-5+"px");$(this.getComponent()).css("height",a-10+"px");$(this.getComponent()).css("width",a-10+"px")};this.getConfigurationActions=function(){return[]}};CTATElement.prototype=Object.create(CTAT.Component.Base.SAIHandler.prototype);
CTATElement.prototype.constructor=CTATElement;CTAT.ComponentRegistry.addComponentType("CTATElement",CTATElement);CTAT.Math={LeastCommonMultiple:function(b,g){return b*g/CTAT.Math.GreatestCommonDivisor(b,g)},GreatestCommonDivisor:function(b,g){if(0>b||0>g)return CTAT.Math.GreatestCommonDivisor(Math.abs(b),Math.abs(g));if(1===b||1===g)return 1;if(0===b)return g;if(0===g)return b;var f=function(b,c){return c?f(c,b%c):b};return f(b,g)},round10:function(b,g){if("undefined"===typeof g||0===Number(g))return Math.round(b);b=Number(b);g=Number(g);if(isNaN(b)||"number"!==typeof g||0!==g%1)return NaN;b=b.toString().split("e");
b=Math.round(Number(b[0])+"e"+(b[1]?Number(b[1])-g:-g));b=b.toString().split("e");return Number(b[0]+"e"+(b[1]?Number(b[1])+g:g))},getPrecision:function(b){return(b=/(?:\.(\d+))?(?:[eE]([+\-]?\d+))?$/.exec(""+ +b))?Math.max(0,("0"==b[1]?0:(b[1]||"").length)-(b[2]||0)):0},precision:4,round:function(b){return CTAT.Math.round10(b,-CTAT.Math.precision)},rad2deg:function(b){return CTAT.Math.round(180*b/Math.PI)},deg2rad:function(b){return b*Math.PI/180}};CTAT.Math.Fraction=function(b,g){this._numerator=0;this._denominator=1;this.set(b,g)};
CTAT.Math.Fraction.prototype=Object.create(CTAT.Math.Fraction.prototype,{numerator:{get:function(){return this._numerator},set:function(b){this._numerator=b}},denominator:{get:function(){return this._denominator},set:function(b){this._denominator=b}},toString:{value:function(){return 1===this.denominator?String(this._numerator):String(this._numerator)+"/"+String(this._denominator)}},valueOf:{value:function(){return this.numerator/this.denominator}},fromString:{value:function(b){var g=b.match(/(\d*\.?\d*)\s*\/\s*(\d*\.?\d*)/);
g?(this._numerator=Number(g[1]),this._denominator=Number(g[2])):this.fromValue(b)}},fromValue:{value:function(b){this._numerator=Number(b.valueOf());this._denominator=1}},toMathML:{value:function(){var b=document.createElementNS("http://www.w3.org/1998/Math/MathML","math"),g=document.createElementNS("http://www.w3.org/1998/Math/MathML","mn");g.textContent=this.numerator;if(1==this.denominator)b.appendChild(g);else{var f=document.createElementNS("http://www.w3.org/1998/Math/MathML","mfrac"),e=document.createElementNS("http://www.w3.org/1998/Math/MathML",
"mrow");e.appendChild(g);f.appendChild(e);g=document.createElementNS("http://www.w3.org/1998/Math/MathML","mrow");e=document.createElementNS("http://www.w3.org/1998/Math/MathML","mn");e.textContent=this.denominator;g.appendChild(e);f.appendChild(g);b.appendChild(f)}return b}},is_proper:{get:function(){return Math.abs(this._numerator)<Math.abs(this._denominator)}},whole_part:{get:function(){return Math.floor(this.valueOf())}},remainder_part:{get:function(){return new CTAT.Math.Fraction(this._numerator%
this._denominator,this._denominator)}},set_denominator:{value:function(b){this._numerator=this.numerator*b/this.denominator;1E-9>Math.abs(this.numerator-Math.round(this.numerator))&&(this.numerator=Math.round(this.numerator));this._denominator=b;return this}},scale:{value:function(b){this._numerator*=b;this._denominator=0===b?1:Math.abs(this._denominator*b)}},set:{value:function(b,g){this._numerator=0;this._denominator=1;"undefined"!==typeof b&&g?(this.numerator="number"===typeof b?b:"string"===typeof b?
Number(b):b?b.valueOf():0,this.denominator="number"===typeof g?g:"string"===typeof g?Number(g):g.valueOf()):b&&(b instanceof CTAT.Math.Fraction?(this.numerator=b.numerator,this.denominator=b.denominator):"number"===typeof b?(this.numerator=b,this.denominator=1):"string"===typeof b?this.fromString(b):(this.numerator=b?b.valueOf():0,this.denominator=1));isNaN(this._numerator)&&(this._numerator=0);isNaN(this._denominator)&&(this._denominator=1);return this}},reduce:{value:function(){var b=CTAT.Math.GreatestCommonDivisor(this.numerator,
this.denominator);this._numerator/=b;this._denominator/=b;return this}},reduced:{value:function(){var b=new CTAT.Math.Fraction(this);b.reduce();return b}},reciprocal:{value:function(){return new CTAT.Math.Fraction(this.denominator,this.numerator)}},negative:{value:function(){return new CTAT.Math.Fraction(-this.numerator,this.denominator)}},add:{value:function(b){var g=new CTAT.Math.Fraction;b instanceof CTAT.Math.Fraction?0===this.numerator||isNaN(this.numerator)?g.set(b.numerator,b.denominator):
0===b.numerator||isNaN(b.numerator)?g.set(this.numerator,this.denominator):this.denominator==b.denominator?g.set(this.numerator+b.numerator,this.denominator):(g.set(this.numerator*b.denominator+b.numerator*this.denominator,this.denominator*b.denominator),g.reduce()):"string"===typeof b?(b=new CTAT.Math.Fraction(b),g=this.add(b)):g.set(b.valueOf()*this.denominator+this.numerator,this.denominator);return g}},subtract:{value:function(b){return b instanceof CTAT.Math.Fraction?this.add(b.negative()):"string"===
typeof b?(b=new CTAT.Math.Fraction(b),this.add(b.negative())):this.add(-b.valueOf())}},multiply:{value:function(b){b instanceof CTAT.Math.Fraction?(b=new CTAT.Math.Fraction(this.numerator*b.numerator,this.denominator*b.denominator),b.reduce()):"string"===typeof b?(b=new CTAT.Math.Fraction(b),b=this.multiply(b)):(b=new CTAT.Math.Fraction(b.valueOf()*this.numerator,this.denominator),b.reduce());return b}},divide:{value:function(b){return b instanceof CTAT.Math.Fraction?this.multiply(b.reciprocal()):
"string"===typeof b?(b=new CTAT.Math.Fraction(b),this.multiply(b.reciprocal())):this.multiply(new CTAT.Math.Fraction(1,b.valueOf()))}},equals:{value:function(b){return CTAT.Math.round(this.valueOf())===CTAT.Math.round(b.valueOf())}},deepEquals:{value:function(b){return b instanceof CTAT.Math.Fraction&&this.numerator===b.numerator&&this.denominator===b.denominator}},clone:{value:function(){return new CTAT.Math.Fraction(this.numerator,this.denominator)}}});
CTAT.Math.Fraction.FromString=function(b){var g=new CTAT.Math.Fraction;g.setFromString(String(b));return g};CTAT.Math.Fraction.FromNumber=function(b){b=new CTAT.Math.Fraction(b);b.reduce();return b};CTAT.Math.Fraction.Sum=function(){for(var b=new CTAT.Math.Fraction,g=0;g<arguments.length;g++)b=b.add(arguments[g]);return b};CTAT.Math.Fraction.Product=function(){for(var b=new CTAT.Math.Fraction(1,1),g=0;g<arguments.length;g++)b=b.multiply(arguments[g]);return b};CTAT.Component.Base.SVG=function(b,g,f,e,c,a,d){CTAT.Component.Base.Clickable.call(this,b,g,f,e,c,a,d);var h=null;this.initSVG=function(){this.setInitialized(!0);var a=CTATGlobals.NameSpace.svg,c=CTATGlobals.NameSpace.xml,b=CTATGlobals.NameSpace.xlink,d=CTATGlobals.NameSpace.ev,e=document.createDocumentFragment();h=document.createElementNS(a,"svg");e.appendChild(h);h.classList.add("CTAT-gen-component");h.classList.add("CTAT-svg");h.classList.add("unselectable");h.setAttributeNS(c,"xmlns",a);h.setAttributeNS(c,
"xmlns:xlink",b);h.setAttributeNS(c,"xmlns:ev",d);a=document.createElementNS(a,"defs");h.appendChild(a);this.getDivWrap().appendChild(e);this.setComponent(h)};this.genName=function(a){return this.getName()+"_"+a};this.getBoundingBox=function(){var a=new DOMRect(0,0,this.getWidth(),this.getHeight()),c=this.getComponent(),b=window.getComputedStyle(c),d=window.getComputedStyle(this.getDivWrap()),c=parseInt(b.getPropertyValue("padding-left")),e=parseInt(b.getPropertyValue("padding-right")),f=parseInt(b.getPropertyValue("padding-bottom")),
h=parseInt(b.getPropertyValue("padding-right")),g=parseInt(b.getPropertyValue("border-left-width")),A=parseInt(b.getPropertyValue("border-right-width")),z=parseInt(b.getPropertyValue("border-bottom-width")),b=parseInt(b.getPropertyValue("border-right-width")),C=parseInt(d.getPropertyValue("padding-top")),D=parseInt(d.getPropertyValue("padding-bottom")),F=parseInt(d.getPropertyValue("border-right-width")),d=parseInt(d.getPropertyValue("border-bottom-width"));a.width-=c+h+g+b;a.height-=e+f+A+z+C+D+
F+d;return a}};CTAT.Component.Base.SVG.prototype=Object.create(CTAT.Component.Base.Clickable.prototype);CTAT.Component.Base.SVG.prototype.constructor=CTAT.Component.Base.SVG;CTAT.Component.Base.UnitDisplay=function(b,g,f,e,c,a,d){CTAT.Component.Base.SVG.call(this,b,g,f,e,c,a,d);var h="1/2+1/4+(0*1/8)";this.setActionInput("SetPieces",h);var l="#800080";this.color=l;var n=1;this.colorAlpha=n;var p="#800080";this.deselectedColor=p;var q=.3;this.deselectedColorAlpha=q;var u="black";this.piece_border_color=u;this.piece_border_thickness=1;this.getPieceBorderColor=function(){return u};this.setPieceBorderColor=function(a){u=CTATGlobalFunctions.formatColor(a);return this};var v=
[],y=this;this.generateClassname=function(){return this.getName()+" UnitPart"};this.getPieces=function(){return v};var w=function(a){if(a.hasAttributeNS(null,"data-selected"))return CTATGlobalFunctions.toBoolean(a.getAttributeNS(null,"data-selected"));a.setAttributeNS(null,"data-selected",!0);return!0};this.getPiecesBySelected=function(a){for(var c=this.getPieces(),b=[],d,e=0;e<c.length;e++)d=c[e],w(d)===a&&b.push(d);return b};this.getSelectedPieces=this.getPiecesBySelected.bind(this,!0);this.getDeselectedPieces=
this.getPiecesBySelected.bind(this,!1);this.getColor=function(){return l};this.getColorAlpha=function(){return n};this.getDeselectedColor=function(){return p};this.getDeselectedColorAlpha=function(){return q};this.setColor=function(a){this.color=l=CTATGlobalFunctions.formatColor(a);a=this.getSelectedPieces();for(var c=0;c<a.length;c++)$(a[c]).css("fill",l)};this.setColorAlpha=function(a){n=Number(a);this.colorAlpha=n=isNaN(n)?1:n;a=this.getSelectedPieces();for(var c=0;c<a.length;c++)$(a[c]).css("fill-opacity",
n)};this.setDeselectedColor=function(a){this.deselectedColor=p=CTATGlobalFunctions.formatColor(a);a=this.getDeselectedPieces();for(var c=0;c<a.length;c++)$(a[c]).css("fill",l)};this.setDeselectedColorAlpha=function(a){q=Number(a);isNaN(q)&&(q=.3);this.deselectedColorAlpha=q;a=this.getDeselectedPieces();for(var c=0;c<a.length;c++)$(a[c]).css("fill-opacity",q)};this.valueOf=function(){return this.evaluate()};this.getValue=function(){return h};this.setValue=function(a){h=String(a);this.setInput(h);this.clear();
this.drawPieces();return h};this.setParameterHandler("Value",this.setValue);this.data_ctat_handlers.value=function(a){this.setValue(a)};this.drawPieces=function(){};this.evaluate=function(){return this.parseValue().reduce(function(a,c){return c.selected?a.add(c):a},new CTAT.Math.Fraction)};this.numActive=function(){return this.getSelectedPieces().length};this.parseValue=function(){var a=[];h.split("+").forEach(function(c){var b=!0;-1!=c.search(/(\(\s*0\s*\*)|(\*\s*0\s*\))/)&&(b=!1,c=c.replace(/(\(\s*0\s*\*)|(\*\s*0\s*\))/,
""),c=c.replace(/[() ]/g,""));c=new CTAT.Math.Fraction(c);c.selected=b;0<c&&a.push(c);return c});return a};this.updateValue=function(){return h=this.getPieces().map(function(a){return C(a.getAttributeNS(null,"data-value"),CTATGlobalFunctions.toBoolean(a.getAttributeNS(null,"data-selected")))}).join("+")};var A=function(a,c){c=CTATGlobalFunctions.toBoolean(c);CTATGlobalFunctions.toBoolean(a.getAttributeNS(null,"data-selected"));!0===c?(a.setAttributeNS(null,"data-selected",!0),$(a).css("fill",y.color),
$(a).css("fill-opacity",y.colorAlpha)):($(a).css("fill",y.deselectedColor),$(a).css("fill-opacity",y.deselectedColorAlpha),a.setAttributeNS(null,"data-selected",!1))};this.clickHandler=function(a){!0===y.getEnabled()&&(a=CTATGlobalFunctions.toBoolean(this.getAttributeNS(null,"data-selected")),A(this,!a),y.setActionInput("SetPieces",y.updateValue()),y.processAction())};this.updateSAI=function(){y.setActionInput("SetPieces",y.updateValue())};this.addPieceElem=function(a,c,b){a.setAttributeNS(null,"data-selected",
b);a.setAttributeNS(null,"data-value",c.toString());a.dataValue=c;this.getEnabled()&&(a.style.cursor="pointer");a.addEventListener("click",this.clickHandler);v.push(a)};var z=this.setEnabled;this.setEnabled=function(a){z(a);v.forEach(function(c){c.style.cursor=a?"pointer":"default"})};this.clear=function(){v=[]};var C=function(a,c){a=a.toString();!1===c&&(a="(0*"+a+")");return a};this.AddPiece=function(a,c){if(a&&(a=new CTAT.Math.Fraction(a),0<CTAT.Math.round(a.valueOf()))){var b=h.split("+");b.push(C(a,
c));y.setValue(b.join("+"))}};this.AddToValue=function(a,c){if(a&&(a=new CTAT.Math.Fraction(a),0<CTAT.Math.round(a.valueOf()))){var b=h.split("+");b.push(C(a,c));h=b.join("+")}return h};var D=-1,F=function(a){isNaN(a)&&this.get_denominator();a=Math.max(a,1);1<D&&(a=Math.min(a,D));return a}.bind(this);this.set_max_denominator=function(a){a=parseInt(a);isNaN(a)||(D=a)};this.set_denominator=function(a){y.setHintHighlight(!1);var c="string"===typeof a?parseInt(a):a;if(!isNaN(c)&&(c=F(c),this.get_denominator()!=
a)){var b=y.evaluate();y.clear();a=[];b.set_denominator(c);for(var d=new CTAT.Math.Fraction(1,c),e=Math.floor(b.numerator),f=c-e,g=0;g<e;g++)a.push(C(d,!0));c=new CTAT.Math.Fraction(b.numerator-e,c);c.equals(0)||(a.push(C(c,!0)),a.push(C(d.subtract(c),!1)),f--);for(c=0;c<f;c++)a.push(C(d,!1));this.setValue(a.join("+"));y.setActionInput("SetPieces",h);y.processAction();return h}};this.get_denominator=function(){return v.reduce(function(a,c,b,d){return Math.min(a,c.dataValue.denominator)},Infinity)};
this.change_denominator=function(a){return this.set_denominator(this.get_denominator()+Number(a))};this.set_number_pieces=function(a){y.setHintHighlight(!1);a="string"===typeof a?parseInt(a):a;if(!isNaN(a)){a=F(a);var c=y.numActive();y.clear();for(var b=[],d=new CTAT.Math.Fraction(1,a),e=0;e<a;e++)b.push(C(d,0<c)),c--;this.setValue(b.join("+"));y.setActionInput("SetPieces",h);y.processAction();return h}};this.change_number_pieces=function(a){this.set_number_pieces(v.length+a)};this.set_numerator=
function(a){return this.change_numerator(a-this.getSelectedPieces().length)};this.change_numerator=function(a){0!==a&&(0<a?v.every(function(c){!1===w(c)&&(A(c,!0),a--);return 0<a}):(v.reverse(),v.every(function(c){!0===w(c)&&(A(c,!1),a++);return 0>a}),v.reverse()))};this.SetPieces=function(a){y.setValue(a)};f=function(a){return(a=$(this.getDivWrap()).attr(a))?a.split(/\s*;\s*/).map(function(a){return a.trim()}):[]};b=f.bind(this,"data-ctat-ctrl-denominator");g=f.bind(this,"data-ctat-ctrl-partition");
f=f.bind(this,"data-ctat-ctrl-numerator");e=function(a,c){return 0<=a().indexOf(c)};var G=e.bind(null,b),x=e.bind(null,g),H=e.bind(null,f),K=function(a){var c=null;if(a instanceof CTAT.Component.Base.Tutorable)a!=this&&(c=a.getName());else if(a instanceof CTATSAI)a.getSelection()!=y.getName()&&(c=a.getSelection());else if(a instanceof String)a!=y.getName()&&(c=a);else if(a instanceof Element)a!=y.getComponent()&&(c=a.id);else return null;if(c){if(G(c))return I.bind(this,this.change_denominator,this.set_denominator);
if(H(c))return I.bind(this,this.change_numerator,this.set_numerator);if(x(c))return I.bind(this,this.change_number_pieces,this.set_number_pieces)}return null}.bind(this);b=CTAT.Component.Base.Tutorable.EventType;CTATConfiguration.get("previewMode")||document.addEventListener(b.action,function(a){var c=a.detail.sai;a=K(a.detail.component);c&&null!==a&&a(c)},!1);var I=function(a,c,b){var d=parseInt(b.getInput());if(!isNaN(d)){switch(b.getAction()){case "ButtonPressed":a.call(this,d);break;case "Update":case "UpdateTextField":case "UpdateTextArea":c.call(this,
d)}this.updateSAI();this.processAction()}};this.setNumeratorControllers=function(a){this.getDivWrap().setAttribute("data-ctat-ctrl-numerator",a);return this};this.setParameterHandler("NumeratorControllers",this.setNumeratorControllers);this.setDenominatorControllers=function(a){this.getDivWrap().setAttribute("data-ctat-ctrl-denominator",a);return this};this.setParameterHandler("DenominatorControllers",this.setDenominatorControllers);this.setPartitionControllers=function(a){this.getDivWrap().setAttribute("data-ctat-ctrl-partition",
a);return this};this.setParameterHandler("PartitionControllers",this.setPartitionControllers);this.getConfigurationActions=function(){var a=this.getDivWrap().getAttribute("data-ctat-value");if(a){var c=new CTATSAI;c.setSelection(this.getName());c.setAction("SetPieces");c.setInput(a);return[c]}this.updateSAI();return[this.getSAI()]}};CTAT.Component.Base.UnitDisplay.prototype=Object.create(CTAT.Component.Base.SVG.prototype);CTAT.Component.Base.UnitDisplay.prototype.constructor=CTAT.Component.Base.UnitDisplay;var CTATFractionBar=function(b,g,f,e,c){CTAT.Component.Base.UnitDisplay.call(this,"CTATFractionBar","aFractionBar",b,g,f,e,c);var a=CTATGlobals.NameSpace.svg;this.init=function(){this.initSVG();this.baseGroup=document.createElementNS(a,"g");this.getComponent().appendChild(this.baseGroup);this.getComponent().classList.add("CTATFractionBar--container");this.drawPieces();this.addComponentReference(this,this.getDivWrap());this.component.addEventListener("focus",this.processFocus)};this.render=function(){this.drawPieces()};
this.drawPieces=function(){if(this.baseGroup){this.clear();for(var c=this.parseValue(),b=0,e=document.createDocumentFragment(),f=0;f<c.length;f++){var g=c[f],q=100*g,u=document.createElementNS(a,"rect");u.classList.add("CTATFractionBar--piece");u.setAttributeNS(null,"height","100%");u.setAttributeNS(null,"width",q+"%");u.setAttributeNS(null,"y",0);u.setAttributeNS(null,"x",b+"%");this.addPieceElem(u,g,g.selected);e.appendChild(u);var v=document.createElementNS(a,"text");v.classList.add("CTATFractionBar--label");
v.setAttributeNS(null,"text-anchor","middle");v.setAttributeNS(null,"dominant-baseline","middle");e.appendChild(v);var u=""+String(g.numerator),g=""+String(g.denominator),y=document.createElementNS(a,"tspan"),w=document.createElementNS(a,"tspan");y.appendChild(document.createTextNode(u));w.appendChild(document.createTextNode(g));v.appendChild(y);v.appendChild(w);v=b+q/2;y.setAttributeNS(null,"x",v+"%");y.setAttributeNS(null,"y","60%");y.setAttributeNS(null,"dy","-1em");w.setAttributeNS(null,"x",v+
"%");w.setAttributeNS(null,"y","60%");u.length>g.length?y.style.textDecoration="underline":w.style.textDecoration="overline";b+=q}this.baseGroup.innerHTML="";this.baseGroup.appendChild(e);var A=this.baseGroup.getBBox().width-1;Array.prototype.slice.call(this.baseGroup.childNodes).forEach(function(a){if("rect"==a.nodeName){var c=window.getComputedStyle(a),b=parseFloat(c.getPropertyValue("padding-left")),d=parseFloat(c.getPropertyValue("stroke-width")),c=a.getBBox();a.setAttributeNS(null,"y",c.y+d/
2);a.setAttributeNS(null,"height",c.height-d);var e=c.x+d/2,d=c.width-d;1>c.x?d-=b/2:(e+=b/2,d=c.x+c.width>=A?d-b/2:d-b);a.setAttributeNS(null,"x",e);a.setAttributeNS(null,"width",d)}})}};this.setShowFractionLabel=function(a){};this.setStyleHandler("showFractionLabel",this.setShowFractionLabel)};CTATFractionBar.prototype=Object.create(CTAT.Component.Base.UnitDisplay.prototype);CTATFractionBar.prototype.constructor=CTATFractionBar;CTAT.ComponentRegistry.addComponentType("CTATFractionBar",CTATFractionBar);var CTATFS={writeFile:function(b,g){return new Promise(function(f,e){return $.post(location.origin+"/writeFile?path="+b,g).done(function(c){return f(c)}).fail(function(c){return e(c)})})}};var CTATGroupingComponent=function(b,g,f,e,c){CTAT.Component.Base.SAIHandler.call(this,"CTATGroupingComponent","__undefined__",b,g,f,e,c);var a=this,d=a.executeSAI;this.isTabIndexable=!1;this.getComponentList=function(){var c=[],b=a.getDivWrap().getAttribute("data-ctat-componentlist");b&&(c=b.split(/\s*[,;]\s*/).map(function(a){return $("#"+a.trim()).data("CTATComponent")}));$(a.getDivWrap()).children(".CTATComponent").each(function(){c.push($(this).data("CTATComponent"))});return[].concat($jscomp.arrayFromIterable(new Set(c)))};
this.init=function(){a.setInitialized(!0)};this.executeSAI=function(c){a.getComponentList().forEach(function(b){b&&"function"==typeof b.executeSAI?b.executeSAI(c):a.ctatdebug("CTATGroupingComponent "+a.getName()+".executeSAI: comp doesn't implement executeSAI: "+b)});d.call(a,c)};this.SetFocus=function(c){if(a.getEnabled())for(var b=a.getComponentList(),d=0;d<b.length;d++)if(b[d].SetFocus(c))return!0;return!1}};CTATGroupingComponent.prototype=Object.create(CTAT.Component.Base.SAIHandler.prototype);
CTATGroupingComponent.prototype.constructor=CTATGroupingComponent;CTAT.ComponentRegistry.addComponentType("CTATGroupingComponent",CTATGroupingComponent);var CTATHintButton=function(b,g,f,e,c){CTAT.Component.Base.Clickable.call(this,"hint","CTATHintButton",b,g,f,e,c);this.setName("hint");this.setClassName("CTATHintButton");this.isTabIndexable=!1;this.setText(CTATGlobals.languageManager.getString("HINT"));this.setStyleHandler("BackgroundColor",null);this.setStyleHandler("TextAlign",null);this.setStyleHandler("BorderColor",null);this.setStyleHandler("FontFace",null);this.setStyleHandler("TextColor",null);this.init=function(){this.setInitialized(!0);
var a=document.createElement("button");this.setComponent(a);a.classList.add("unselectable");a.classList.add("CTAT-hint-button");var c=document.createElement("div");c.classList.add("CTAT-hint-button--icon");c.textContent="?";a.appendChild(c);this.getText()&&(c=document.createElement("div"),c.textContent=this.getText(),a.appendChild(c));this.getDivWrap().appendChild(a);a.addEventListener("mouseenter",function(a){a.target.classList.add("CTAT-hint-button--hover")});a.addEventListener("mouseleave",function(a){a.target.classList.remove("CTAT-hint-button--hover");
a.target.classList.remove("CTAT-hint-button--clicked")});a.addEventListener("mousedown",function(a){a.target.classList.add("CTAT-hint-button--clicked")});a.addEventListener("mouseup",function(a){a.target.classList.remove("CTAT-hint-button--clicked")});a.addEventListener("click",function(a){a.target.classList.remove("CTAT-hint-button--clicked")});a.addEventListener("click",this.processClick)};var a=this;this.processClick=function(c){a.getEnabled()&&CTATCommShell.commShell&&CTATCommShell.commShell.requestHint()}};
CTATHintButton.prototype=Object.create(CTAT.Component.Base.Clickable.prototype);CTATHintButton.prototype.constructor=CTATHintButton;CTAT.ComponentRegistry.addComponentType("CTATHintButton",CTATHintButton);var CTATHintWindow=function(b,g,f,e,c){function a(a){n.log("mark","\tHW.processMark",a);a.componentIDs.map(function(a){return document.querySelector("#"+a)}).forEach(function(c){c.classList["start"===a.type?"add":"remove"](a.name);c.dispatchEvent(new CustomEvent("mark"+a.type,{detail:{name:a.name,data:a.data}}))});markedComps=P[a.name]?P[a.name]:P[a.name]=[];markedComps="start"===a.type?markedComps.concat(a.componentIDs).filter(function(a,c,b){return c===b.indexOf(a)}):markedComps.filter(function(c){return!a.componentIDs.includes(c)});
P[a.name]=markedComps}function d(c,b,d){n.log("mark","HW.handleSSUEvent(",c,"\n",b,"\n",d,")");d="boundary"===c?d.charIndex:c;b=b[d];n.log("mark","HW.handleSSUEvent marks",b);"boundary"===c&&B[d]||(b&&b.forEach(a),B[d]=!0)}function h(){var c=Array.prototype.slice.call(Object.keys(P));n.log("mark","HW.clearMarkedComponents markNames",c);c.forEach(function(c){a({name:c,type:"end",componentIDs:P[c]});delete P[c]})}function l(){h();B={};window.speechSynthesis.speak(x)}CTAT.Component.Base.Graphical.call(this,
"CTATHintWindow","__undefined__",b,g,f,e,c);var n=this;this.log=(new CTATLogger(["mark"])).log;n.isTabIndexable=!1;var p=CTATConfig.parserType_is_XML()?new CTATXML:new CTATJSON,q=new CTATTutorMessageBuilder,u=null,v=null,y=null,w=null,A=null,z=null,C=CTATGlobals.languageManager.getString("NEXT"),D=CTATGlobals.languageManager.getString("PREVIOUS"),F=CTATGlobals.languageManager.getString("REPLAY"),G=null,x=null;this.data_ctat_handlers["next-content"]=function(a){G=a;w&&(w.innerHTML=a)};var H=null;this.data_ctat_handlers["previous-content"]=
function(a){H=a;y&&(y.innerHTML=a)};var K=!1,I=!0,L="en-US",P={};this.getCurrentHint=function(){return u.innerHTML};this.init=function(){n.ctatdebug("init ("+n.getName()+")");n.setInitialized(!0);n.setIsAbstractComponent(!0);z=this.getDivWrap();z.id||z.setAttribute("id",CTATGlobalFunctions.gensym.div_id());z.classList.add("CTATHintWindow--empty");z.setAttribute("onkeypress","return noenter(event)");n.setComponent(z);n.addComponentReference(n,z);if(K="true"===z.getAttribute("data-ctat-speak-hints"))I=
"false"!==z.getAttribute("data-ctat-show-text"),L=z.getAttribute("data-ctat-lang")||"en-US";u=document.createElement("div");z.appendChild(u);u.classList.add("CTATHintWindow--hint-content");var a=document.createElement("div");a.classList.add("CTATHintWindow--hint-button-area");z.appendChild(a);y=document.createElement("button");y.classList.add("CTATHintWindow--previous");H?y.innerHTML=H:D&&y.appendChild(document.createTextNode(D));y.addEventListener("click",function(a){CTATShellTools.showPrevHint()},
!1);a.appendChild(y);var c=document.createElement("div");c.classList.add("CTATHintWindow--middle-btn-container");a.appendChild(c);if(K){A=document.createElement("button");A.classList.add("CTATHintWindow--replay");var b=document.createElement("span");b.classList.add("CTATHintWindow--button-icon");b.textContent="\u21bb";b.style.cssFloat="right";A.appendChild(document.createTextNode(F));A.appendChild(b);c.appendChild(A);A.addEventListener("click",l)}v=document.createElement("div");v.classList.add("CTATHintWindow--hint-indicator");
c.appendChild(v);G?(w=document.createElement("button"),w.classList.add("CTATHintWindow--next"),w.innerHTML=G):(w=document.createElement("button"),w.classList.add("CTATHintWindow--next"),C&&w.appendChild(document.createTextNode(C)));w.addEventListener("click",function(a){CTATShellTools.showNextHint()},!1);a.appendChild(w);var d=function(a){this.disabled=!a;a||(this.classList.remove("CTAT-hint-button--hover"),this.classList.remove("CTAT-hint-button--clicked"))};[y,w].concat(A?A:[]).forEach(function(a){a.setEnabled=
d.bind(a);a.classList.add("CTATHintWindow--button");a.classList.add("CTAT-hint-button");a.addEventListener("mouseenter",function(a){a.target.classList.add("CTAT-hint-button--hover")});a.addEventListener("mouseleave",function(a){a.target.classList.remove("CTAT-hint-button--hover");a.target.classList.remove("CTAT-hint-button--clicked")});a.addEventListener("mousedown",function(a){a.target.classList.add("CTAT-hint-button--clicked")});a.addEventListener("mouseup",function(a){a.target.classList.remove("CTAT-hint-button--clicked")});
a.addEventListener("click",function(a){a.target.classList.remove("CTAT-hint-button--clicked")});a.setEnabled(!1)});CTATShellTools.registerFeedbackComponent(this,this.goNext,this.goPrevious,this.showHint,this.showFeedback);n.ctatdebug("Disabling previous and next ...")};this.setStyleHandler("OuterBorderColor",this.setBorderColor);this.SetText=this.showFeedback=function(a,c){n.ctatdebug("showFeedback ("+a+")");a=a instanceof Array?a:[a];return this.showHint(a,c)};this.setEnabled=function(a){n.assignEnabled(a);
null===n.getComponent()?n.ctatdebug("Error pointer.getComponent()==null"):n.getComponent().disabled=!a};var B={};this.setContent=function(a){var c=CTATGlobals.languageManager.getMarkData()[a];a=CTATGlobals.languageManager.filterString(a);I&&u&&(u.innerHTML=a);K&&(x=new SpeechSynthesisUtterance(a),x.lang=L,x.addEventListener("start",d.bind(this,"start",c)),x.addEventListener("boundary",d.bind(this,"boundary",c)),x.addEventListener("end",d.bind(this,"end",c)),A.setEnabled(!0),l())};this.showHint=function(a,
c){n.ctatdebug("showHint ()");v.innerHTML="";hints=a||[];hintIndex=0;y.setEnabled(!1);w.setEnabled(!1);A&&A.setEnabled(!1);hints=hints.filter(function(a){return""!==a});z.classList.remove("CTATHintWindow--success","CTATHintWindow--bug","CTATHintWindow--hint","CTATHintWindow--first-message","CTATHintWindow--last-message","CTATHintWindow--empty");if(!hints||0>=hints.length)h(),hints=[],u.innerHTML="",z.classList.add("CTATHintWindow--empty");else for(this.setEnabled(!0),this.setContent(hints[hintIndex]),
z.classList.add("CTATHintWindow--"+(c||"hint")),z.classList.add("CTATHintWindow--first-message"),1<hints.length?(n.ctatdebug("We have more than one hint, enabling next button"),w.setEnabled(!0)):(n.ctatdebug("We only have one hint, leaving next button disabled"),z.classList.add("CTATHintWindow--last-message")),a=0;a<hints.length;a++)c=document.createElement("span"),c.classList.add("CTATHintWindow--hint-indicator-bullet"),c.innerHTML=0===a?"&#9679;":"&#9675;",v.appendChild(c)};this.changeHint=function(a){this.setContent(hints[hintIndex]);
var c=new CTATTutoringServiceMessageBuilder,b=CTATGuid.guid(),d="previous"===a?CTATShellTools.reservedSelections.previousButton.name:CTATShellTools.reservedSelections.nextButton.name,e=new CTATSAI(d,"ButtonPressed","-1"),c=c.createInterfaceActionMessage(b,e),e=new CTATSAI(d,"ButtonPressed","hint request");commLoggingLibrary.logSemanticEvent(b,e,"HINT_REQUEST","");CTATCommShell.commShell.propagateShellEvent("InterfaceAction",c);d=n.getCurrentHint();b=q.createAssociatedRulesMessageForHint([d],logHintSAI,
"student",null,logHintStepID,b,hints.length,hintIndex+1);b=new CTATMessage(p.parse(b));CTATCommShell.commShell.processAssociatedRules(b,"HintWindow",d);CTAT.ToolTutor.tutor&&CTAT.ToolTutor.tutor.getProblemStateSaver().appendToProblemState(c,CTATExampleTracerLink.HINT_ACTION,CTAT.ToolTutor.tutor.getOutputStatus());CTATCommShell.commShell.propagateShellEvent("previous"===a?"PreviousPressed":"NextPressed",b)};this.goPrevious=function(){n.ctatdebug("goPrevious ()");hintIndex--;w.setEnabled(!0);z.classList.remove("CTATHintWindow--last-message");
0>=hintIndex?(hintIndex=0,y.setEnabled(!1),z.classList.add("CTATHintWindow--first-message")):y.setEnabled(!0);var a=v.querySelectorAll(".CTATHintWindow--hint-indicator-bullet");a[hintIndex+1].innerHTML="&#9675;";a[hintIndex].innerHTML="&#9679;";this.changeHint("previous")};this.goNext=function(){n.ctatdebug("goNext ()");hintIndex++;y.setEnabled(!0);z.classList.remove("CTATHintWindow--first-message");hintIndex>hints.length-1&&(hintIndex=hints.length-1);hintIndex>hints.length-2?(z.classList.add("CTATHintWindow--last-message"),
w.setEnabled(!1)):w.setEnabled(!0);var a=v.querySelectorAll(".CTATHintWindow--hint-indicator-bullet");a[hintIndex-1].innerHTML="&#9675;";a[hintIndex].innerHTML="&#9679;";this.changeHint("next")}},_ssu=new SpeechSynthesisUtterance;window.speechSynthesis.speak(_ssu);CTATHintWindow.prototype=Object.create(CTAT.Component.Base.Graphical.prototype);CTATHintWindow.prototype.constructor=CTATHintWindow;CTAT.ComponentRegistry.addComponentType("CTATHintWindow",CTATHintWindow);var CTATIFrameManager=function(){var b={},g=this;this.initFrame=function(f,e,c){var a=f?f.getAttribute("id"):null;a?b[a]={domNode:f,initialDom:e,initialMode:c}:console.error("iFrames managed by CTATIFrameManager must exist and have unique ids");f.setAttribute("data-ctat-target",c);this.writeData(f,e)};this.refresh=function(f){var e=b[f];e.domNode?(e.domNode.setAttribute("src","about:blank"),this.writeData(e.domNode,e.initialDom)):console.warn("CTATIFrameManager: iFrame id "+f+" not found")};this.writeData=
function(b,e){b&&(b=b.contentDocument||b.contentWindow.document,b.open(),b.write(e),b.close())};document.addEventListener("refreshIframe",function(b){b=b.detail;console.log("refresh event for iframe "+b);g.refresh(b)})};var CTATImageButton=function(b,g,f,e,c){CTATButtonBasedComponent.call(this,"CTATImageButton","__undefined__",b,g,f,e,c);var a=this,d=null;this.init=function(){var c=document.createElement("img");c.id=CTATGlobalFunctions.gensym.div_id();c.name=a.getName();c.classList.add("CTAT-button");a.setActionInput("ButtonPressed",a.getDivWrap().getAttribute("value")||"-1");if(d=a.getDivWrap().getAttribute("data-ctat-image-default"))c.setAttribute("src",d),a.getDivWrap().setAttribute("data-ctat-img",d);c.setAttribute("onkeypress",
"return noenter(event)");a.setComponent(c);a.addComponentReference(a,c);a.getDivWrap().appendChild(c);c.addEventListener("click",a.processClick);c.addEventListener("focus",a.processFocus);c.addEventListener("mousedown",a.processBaseMousedown);c.addEventListener("mouseup",a.processBaseMouseup);c.addEventListener("mouseover",a.processBaseMouseover);c.addEventListener("mouseout",a.processBaseMouseout);a.setInitialized(!0)}.bind(this);this.setImage=function(c){if(d=c)a.getDivWrap().setAttribute("data-ctat-img",
c),a.getComponent().setAttribute("src",c)};this.getImage=function(){return d};var h=this.setEnabled;this.setEnabled=function(c){h(c);(c=a.getDivWrap().getAttribute(a.getEnabled()?"data-ctat-image-default":"data-ctat-image-disabled"))&&a.setImage(c)};this.getConfigurationActions=function(){var a=this.getDivWrap(),c=a.getAttribute("data-ctat-image-hover"),b=a.getAttribute("data-ctat-image-clicked"),d=a.getAttribute("data-ctat-image-default"),a=a.getAttribute("data-ctat-image-disabled");if(d){var e=
new CTATSAI;e.setSelection(this.getName());c||b||a?(e.setAction("assignImages"),e.setInputArray([c,b,d,a])):(e.setAction("assignImage"),e.setInput(d));return[e]}return[]}};CTATImageButton.prototype=Object.create(CTATButtonBasedComponent.prototype);CTATImageButton.prototype.constructor=CTATImageButton;CTAT.ComponentRegistry.addComponentType("CTATImageButton",CTATImageButton);var CTATJumble=function(b,g,f,e,c){CTAT.Component.Base.Tutorable.call(this,"CTATJumble","aJumble",b,g,f,e,c);var a=this;this.setActionInput("SetOrder","");var d=null;this.init=function(){this.setInitialized(!0);d=this.getDivWrap();this.setComponent(d);this.addComponentReference(this,d);CTATConfiguration.get("previewMode")||$(d).children().addClass("CTATJumble--item").attr({unselectable:"on",draggable:!0}).each(function(){this.addEventListener("dragstart",l,!1);this.addEventListener("dragenter",p,
!1);this.addEventListener("dragover",n,!1);this.addEventListener("dragleave",q,!1);this.addEventListener("drop",u,!1);this.addEventListener("dragend",v,!1)});this.component.addEventListener("focus",this.processFocus)};this.getConfigurationActions=function(){this.updateSAI();return[this.getSAI()]};var h=null,l=function(a){/CTATJumble/.test(a.target.className)&&(a.target.classList.add("CTATJumble--item--home"),h=a.target,a.dataTransfer.effectAllowed="move",a.dataTransfer.setData("text/html",a.target.innerHTML))},
n=function(a){a.preventDefault&&a.preventDefault();a.dataTransfer.dropEffect="move";return!1},p=function(a){this.classList.add("CTATJumble--item--over")},q=function(a){this.classList.remove("CTATJumble--item--over")},u=function(c){c.stopPropagation&&c.stopPropagation();if(h&&($(d).children().removeClass("CTATJumble--item--over"),h!=this)){h.innerHTML=this.innerHTML;var b=h.id;h.id=this.id;this.innerHTML=c.dataTransfer.getData("text/html");this.id=b;a.setInput(a.getOrder());a.processAction()}return!1},
v=function(a){this.classList.remove("CTATJumble--item--home");$(d).children().removeClass("CTATJumble--item--over");h=null},y=this.setEnabled;this.setEnabled=function(a){y(a);d&&$(d).children().attr("draggable",a)};this.init_items=function(a){if(d){var c=document.createDocumentFragment();a=a.split(";");for(var b=a.length,e=0;e<b;e++){var f=document.createElement("div");f.textContent=a[e];f.id=this.getName()+e;f.setAttribute("unselectable","on");f.setAttribute("draggable",!0);f.classList.add("CTATJumble--item");
f.addEventListener("dragstart",l,!1);f.addEventListener("dragenter",p,!1);f.addEventListener("dragover",n,!1);f.addEventListener("dragleave",q,!1);f.addEventListener("drop",u,!1);f.addEventListener("dragend",v,!1);c.appendChild(f)}d.innerHTML="";d.appendChild(c)}};this.setParameterHandler("textItems",this.init_items);this.SetOrder=function(a){a.split(";").forEach(function(a){$(d).append($("#"+a))})};this.getOrder=function(){var c=[];$(d).children().each(function(){this.draggable&&(this.id?c.push(this.id):
console.log("ERROR: The CTATJumble "+a.getName()+" has a child with no id attribute: "+this+"!!!"))});return c.join(";")};this.updateSAI=function(){a.setInput(a.getOrder())}};CTATJumble.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);CTATJumble.prototype.constructor=CTATJumble;CTAT.ComponentRegistry.addComponentType("CTATJumble",CTATJumble);var GUPPY_SYMS={_version:"2.0.0-alpha.3",_name:"customSyms",deltaT:{output:{latex:"\\Delta T",text:"deltaT"},attrs:{type:"deltaT"}},norm:{output:{latex:"||{$1}||",asciimath:"norm({$1})"},attrs:{type:"norm",group:"functions"},args:[{"delete":"1"}]},text:{output:{latex:"\\text{{$1}}",asciimath:"text({$1})"},attrs:{type:"text",group:"editor"},args:[{mode:"text"}]},sym_name:{output:{latex:"\\backslash\\texttt{{$1}}",asciimath:"SYMBOL({$1})"},attrs:{type:"symbol",group:"editor"},args:[{mode:"symbol",is_bracket:"yes"}]},
abs:{output:{latex:"\\left|{$1}\\right|",asciimath:"|{$1}|"},keys:["|"],attrs:{type:"absolutevalue",group:"functions"},args:[{"delete":"1",is_bracket:"yes"}]},eval:{output:{latex:"{$1}({$2})",asciimath:"{$1}({$2})"},attrs:{type:"eval",group:"functions"},args:[{"delete":"2",name:"function"},{"delete":"1",name:"argument"}]},sqrt:{output:{latex:"\\sqrt{{$1}\\phantom{\\tiny{!}}}",asciimath:"sqrt({$1})"},attrs:{type:"sqrt",group:"functions"},args:[{"delete":"1"}]},paren:{output:{latex:"\\left({$1}\\right)",
asciimath:"({$1})"},keys:["("],attrs:{type:"bracket",group:"functions"},ast:{type:"pass"},args:[{"delete":"1",is_bracket:"yes"}]},floor:{output:{latex:"\\lfloor {$1} \\rfloor",asciimath:"|_ {$1} _|"},attrs:{type:"floor",group:"functions"},args:[{"delete":"1"}]},factorial:{output:{latex:"{$1}!",asciimath:"({$1})!"},input:1,keys:["!"],attrs:{type:"factorial",group:"functions"},args:[{bracket:"yes","delete":"1"}]},exp:{output:{latex:"{{$1}}^{{$2}}",asciimath:"({$1})^({$2})"},input:1,keys:["^","shift+up"],
attrs:{type:"exponential",group:"functions"},args:[{up:"2",bracket:"yes","delete":"1",name:"base"},{down:"1","delete":"1",name:"exponent",small:"yes"}]},sub:{output:{latex:"{{$1}}_{{$2}}",asciimath:"{$1}{$2}"},input:1,keys:["_","shift+down"],attrs:{type:"subscript",group:"functions"},args:[{down:"2",bracket:"yes","delete":"1",name:"base"},{up:"1","delete":"1",name:"subscript",small:"yes"}]},frac:{output:{latex:"\\dfrac{{$1}}{{$2}}",small_latex:"\\frac{{$1}}{{$2}}",asciimath:"({$1})/({$2})"},input:1,
keys:["/"],attrs:{type:"fraction",group:"functions"},args:[{up:"1",down:"2",name:"numerator"},{up:"1",down:"2","delete":"1",name:"denominator"}]},"int":{output:{latex:"\\displaystyle\\int{{$1}}d{$2}",small_latex:"\\int{{$1}}d{$2}",asciimath:"int {$1} d{$2}"},attrs:{type:"integral",group:"calculus"},args:[{"delete":"1",name:"integrand"},{"delete":"1",bracket:"yes",name:"variable"}]},defi:{output:{latex:"\\displaystyle\\int_{{$1}}^{{$2}}{$3}d{$4}",small_latex:"\\int_{{$1}}^{{$2}}{$3}d{$4}",asciimath:"int_{{$1}}^{{$2}} {$3} d{$4}"},
attrs:{type:"defintegral",group:"calculus"},args:[{down:"1",up:"2",small:"yes",name:"lower_limit"},{down:"1",up:"2",small:"yes",name:"upper_limit"},{down:"1",up:"2","delete":"3",name:"integrand"},{down:"1",up:"2",bracket:"yes","delete":"4",name:"variable"}]},deriv:{output:{latex:"\\displaystyle\\frac{d{$1}}{d{$2}}",small_latex:"\\frac{d{$1}}{d{$2}}",asciimath:"diff({$1},{$2})"},attrs:{type:"derivative",group:"calculus"},args:[{down:"1",up:"2",bracket:"yes",name:"function"},{down:"1",up:"2",bracket:"yes",
name:"variable"}]},sum:{output:{latex:"\\displaystyle\\sum_{{$1}}^{{$2}}{$3}",small_latex:"\\sum_{{$1}}^{{$2}}{$3}",asciimath:"sum_{{$1}}^{{$2}} {$3}"},attrs:{type:"summation",group:"functions"},args:[{down:"1",up:"2",small:"yes",name:"lower_limit"},{down:"1",up:"2",small:"yes",name:"upper_limit"},{down:"1",up:"2","delete":"3",bracket:"yes",name:"summand"}]},prod:{output:{latex:"\\displaystyle\\prod_{{$1}}^{{$2}}{$3}",small_latex:"\\prod_{{$1}}^{{$2}}{$3}",asciimath:"prod_{{$1}}^{{$2}} {$3}"},attrs:{type:"summation",
group:"functions"},args:[{down:"1",up:"2",small:"yes",name:"lower_limit"},{down:"1",up:"2",small:"yes",name:"upper_limit"},{down:"1",up:"2","delete":"3",bracket:"yes",name:"summand"}]},root:{output:{latex:"\\sqrt[{$1}]{{$2}\\phantom{\\tiny{!}}}",asciimath:"nroot({$1},{$2})"},attrs:{type:"root",group:"functions"},args:[{down:"2",up:"1",small:"yes","delete":"1",name:"index"},{down:"2",up:"1","delete":"1",name:"radicand"}]},vec:{output:{latex:"\\left\\langle {$1{,}} \\right\\rangle",asciimath:"vec({$1{,}})"},
keys:["{"],attrs:{group:"array",type:"vector"}},"*":{output:{latex:"\\cdot",asciimath:"*"},keys:["*"],attrs:{group:"operations",type:"*"},ast:{type:"operator"}},infinity:{output:{latex:"\\infty",asciimath:"oo"},attrs:{group:"qwerty",type:"infinity"}},_templates:{latex_func:{output:{latex:"\\{$name}\\left({$1}\\right)",asciimath:" {$name}({$1})"},attrs:{type:"{$name}",group:"functions"},args:[{"delete":"1"}]},func:{output:{latex:"{$latex}\\left({$1}\\right)",asciimath:" {$asciimath}({$1})"},attrs:{type:"{$name}",
group:"functions"},args:[{"delete":"1"}]},"char":{output:{latex:"\\{$name}",asciimath:" {$name} "},attrs:{group:"greek",type:"{$name}"}},binop:{output:{latex:"{$latex}",asciimath:"{$asciimath}"},keys:["{$type}"],attrs:{group:"operations",type:"{$type}"},ast:{type:"operator"}}},functions:{template:"latex_func",values:"sin cos tan sec csc cot log ln arcsin arccos arctan sinh cosh tanh".split(" ")},greek:{template:"char",values:"alpha beta gamma delta epsilon zeta eta theta iota kappa lambda mu nu xi omicron pi rho sigma tau upsilon phi chi psi omega Gamma Delta Theta Lambda Xi Pi Sigma Phi Psi Omega".split(" ")},
comparisons:{template:"binop",values:{equal:{latex:"=",asciimath:" = ",type:"="},leq:{latex:"\\leq",asciimath:" <= ",type:"<="},less:{latex:"<",asciimath:" < ",type:"<"},geq:{latex:"\\geq",asciimath:" >= ",type:">="},greater:{latex:">",asciimath:" > ",type:">"},neq:{latex:"\\neq",asciimath:" != ",type:"!="}}}},CTATMathInput=function(){function b(c){h.parentNode&&h.parentNode.removeChild(h);l.parentNode&&l.parentNode.removeChild(l);p.parentNode&&p.parentNode.removeChild(p);n.parentNode&&n.parentNode.removeChild(n);
var b;(b=g.exec(c))?(a.appendChild(l),a.appendChild(p),a.appendChild(n),c=c.split(b[0]).map(function(a,c){return 0===c?a+"</m>":"<m>"+a}),Guppy.Doc.render(c[0],l.id),Guppy.Doc.render("<m>"+b[0]+"</m>",p.id),Guppy.Doc.render(c[1],n.id)):(a.appendChild(h),Guppy.Doc.render(c,h.id))}var g=/<f group="operations" type="=" (subgroup="comparisons" )?ast_type="operator"><b p="latex">=<\/b><b p="asciimath"> = <\/b><\/f>/;CTAT.Component.Base.Tutorable.call(this,"CTATMathInput","myComponent");CTATMathInput.guppyInitialized||
(Guppy.init({path:"https://cdn.ctat.cs.cmu.edu/releases/latest/guppy/",symbols:[GUPPY_SYMS],osk:{config:{attach:"focus",groups:["qwerty"],controls:"&uarr; &darr; &larr; &rarr; del enter".split(" ")}},settings:{force_relationals_to_top:!0}}),document.documentElement.className+="ontouchstart"in document.documentElement?" touch":" no-touch",CTATMathInput.guppyInitialized=!0);var f=this,e=null,c=CTATConfiguration.get("previewMode"),a,d,h,l,n,p,q="",u=0,v=!1;this.backgrade=!0;this.getIsBeingGraded=function(){return v};
this.setIsBeingGraded=function(a){v=a};this.processAssociatedRules=function(){this.setIsBeingGraded(!1)};this.init=function(){this.ctatdebug("init ("+f.getName()+")");f.getInitialized()||(a=f.getDivWrap(),d=document.createElement("div"),d.id=a.id+"_math",a.appendChild(d),e=new Guppy(d.id,{events:{done:function(){f.getEnabled()&&"false"!==a.getAttribute("data-ctat-submit-on-enter")&&f.processAction()},focus:function(a){a.focused&&f.processFocus()}},settings:{empty_content:""}}),h=document.createElement("div"),
h.id=a.id+"_new",a.appendChild(h),l=document.createElement("div"),l.id=a.id+"_left",l.classList.add("CTATMathInput-left"),p=document.createElement("div"),p.id=a.id+"_equals",p.classList.add("CTATMathInput-equals"),n=document.createElement("div"),n.id=a.id+"_right",n.classList.add("CTATMathInput-right"),this.ctatdebug("Final location: "+f.getX()+","+f.getY()+" with text: "+f.getValue()),a.addEventListener("keydown",function(a){++u;f.ctatdebug("dirty "+u)}),f.setInitialized(!0),f.setComponent(a),f.addComponentReference(f,
a),c&&this.addEventScreen(!1),this.backgrade="false"!==a.getAttribute("data-ctat-submit-on-blur"))};this.GuppyStyleInput=function(a){var c;if(a.includes("/")){for(var b=a.indexOf("/"),d=b;0<d;d--)if("+"===a[d]||"-"===a[d]){c=a.slice(0,d+1)+"("+a.slice(d+1,b)+")/"+f.GuppyStyleInput(a.slice(b+1,a.length));break}!c&&(c="("+a.slice(0,b)+")/"+f.GuppyStyleInput(a.slice(b+1,a.length)))}else c=a;return c};this.SetFocus=function(a){return f.getEnabled()?(e[a?"activate":"deactivate"](),!0):!1};this.getValue=
function(){var a;try{a=e.asciimath()}catch(G){console.log("mathinput.asciimath err: ",G),console.log("v is ",a)}return a||""};this.updateSAI=function(){this.setActionInput("UpdateTextField",f.getValue())};this.setMath=function(a){(a=a.trim())?e.import_text(a):(e.engine.sel_all(),e.engine.sel_delete(),e.engine.sel_clear());e.render(!0);f.getEnabled()||(a=e.xml(),b(a))};this.getConfigurationActions=function(){var a=[],c=$(this.getDivWrap());if(c.attr("value")){var b=new CTATSAI;b.setSelection(this.getName());
b.setAction("UpdateTextField");b.setInput(c.attr("value"));a.push(b)}return a};this.UpdateTextField=function(a){this.setMath(a)};this.reset=function(){f.configFromDescription();f.processSerialization();e.import_text("")};var y=this.processAction;this.processAction=function(){var a=!1,c=f.getValue();if(/^\s*$/.test(String(c)))return a;f.setActionInput("UpdateTextField",c);if(a=y.call(f))u=0;return a};var w=this.setEnabled;this.setEnabled=function(c){w.call(this,c);f.getInitialized()&&(c?("none"===
d.style.display&&(d.style.display=q||""),h.parentNode===a?a.removeChild(h):l.parentNode===a&&(a.removeChild(l),a.removeChild(p),a.removeChild(n))):(c=e.xml(),"none"!==d.style.display&&(q=d.style.display,d.style.display="none"),b(c),e.deactivate()))};var A=this.setCorrect;this.setCorrect=function(){A.apply(this,arguments)};var z=this.setIncorrect;this.setIncorrect=function(){z.apply(this,arguments)};var C=this.showIncorrect;this.showIncorrect=function(){C.apply(this,arguments);d.style.color="red"};
var D=this.showHintHighlight;this.showHintHighlight=function(){D.apply(this,arguments);d.style.color="initial"}};CTATMathInput.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);CTATMathInput.prototype.constructor=CTATMathInput;CTAT.ComponentRegistry.addComponentType("CTATMathInput",CTATMathInput);var CTATMobileTutorHandler=function(b,g){CTATBase.call(this,"CTATMobileTutorHandler","mobiletutorhandler");this.ctatdebug("CTATMobileTutorHandler ()");var f="",e=g?g:"disabled",c=!1;/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(c=!0);this.error=function(a){this.ctatdebug(a);alert(a)};this.processOrientationChange=function(a){this.ctatdebug("processOrientationChange ("+a+")")};this.getEnabled=function(){return"disabled"==e||"auto"==e&&0==c?!1:!0};this.processTextFocus=
function(a,b,h,g,n){this.ctatdebug("processTextFocus ("+a+","+b+","+h+","+g+","+n+")");"disabled"==e||"auto"==e&&0==c||(f="",this.manipulateKeyboard())};this.processEnter=function(){this.ctatdebug("processEnter ()");if("disabled"!=e&&("auto"!=e||0!=c)){var a=getSafeElementById(b);if(null!=a)try{a.processExternalEnter(),this.ctatdebug("Successfully called AS3 method")}catch(d){this.ctatdebug("Error description: "+d.message)}else this.ctatdebug("Error: unable to obtain reference to swf object")}};this.setText=
function(a){this.ctatdebug("setText ("+a+")");if("disabled"!=e&&("auto"!=e||0!=c))if(null!=CTATGlobals.selectedTextInput){this.ctatdebug("Attempting to call HTML5 method on text object ...");var d=CTATGlobals.selectedTextInput.getText();CTATGlobals.selectedTextInput.setText(d+a)}else if(this.ctatdebug("Attempting to call AS3 method ..."),d=getSafeElementById(b),null!=d)try{f+=a,this.ctatdebug(f),d.processExternalKeyboard(f),this.ctatdebug("Successfully called AS3 method")}catch(h){this.ctatdebug("Error description: "+
h.message)}else this.ctatdebug("Error: unable to obtain reference to swf object")};this.manipulateKeyboard=function(){this.ctatdebug("manipulateKeyboard()");if("disabled"!=e&&("auto"!=e||0!=c)){this.hideKeyboard();var a=getSafeElementById("keyboardUI");a&&(a.style.visibility="visible")}};this.hideKeyboard=function(){document.activeElement.blur();var a=getSafeElementById("input");a&&a.blur()};this.hideCustomKeyboard=function(){getSafeElementById("keyboardUI").style.visibility="visible"}};
CTATMobileTutorHandler.prototype=Object.create(CTATBase.prototype);CTATMobileTutorHandler.prototype.constructor=CTATMobileTutorHandler;function processTextFocus(b,g,f,e,c){mobileAPI.processTextFocus(b,g,f,e,c)}function processFocusOut(){closeK()};var CTATMovieClip=function(b,g,f,e,c){CTATBase.call(this,"CTATMovieClip",b);var a=CTATGlobalFunctions.gensym.z_index(),d=CTATGlobalFunctions.gensym.div_id(),h=CTATGlobalFunctions.gensym.z_index();CTATGlobalFunctions.gensym.div_id();var l=[],n=this,p=null;this.wrapComponent=function(b){p=document.createElement("div");p.setAttribute("id",d);p.setAttribute("name",this.getName());p.setAttribute("style","z-index: "+a);p.setAttribute("width",e+"px");p.setAttribute("height",c+"px");p.setAttribute("style",
"border: 0px; position: absolute; left:"+g+"px; top:"+f+"px; z-index:"+h+";");b.appendChild(p);return p};this.getDivWrapper=function(){return p};this.addComponent=function(a){n.ctatdebug("addComponent ("+a+")");l.push(a)};this.isRegistered=function(a){for(var c=0;c<l.length;c++)if(l[c]==a)return!0;return!1}};CTATMovieClip.prototype=Object.create(CTATBase.prototype);CTATMovieClip.prototype.constructor=CTATMovieClip;var CTATNLPInput=function(b,g,f,e,c){CTATTextBasedComponent.call(this,"CTATNLPInput","__undefined__",b,g,f,e,c);var a=this,d=null,h=null,l=CTATConfiguration.get("previewMode");this.init=function(){this.ctatdebug("init ("+a.getName()+")");d=document.createElement("input");d.type="text";b&&(d.name=b.name);d.setAttribute("maxlength",a.getMaxCharacters());d.setAttribute("id",CTATGlobalFunctions.gensym.div_id());a.setComponent(d);this.ctatdebug("Final location: "+a.getX()+","+a.getY()+" with text: "+a.getText());
var c=$(this.getDivWrap());c.attr("value")&&this.setText(c.attr("value"));var e=$(d);"autofocus defaultValue maxLength pattern placeholder readOnly size title".split(" ").forEach(function(a){var b=c.attr(a);b&&e.attr(a,b)});a.setInitialized(!0);a.addComponentReference(a,d);a.getDivWrap().appendChild(d);a.addSafeEventListener("keydown",a.processKeydown,d);a.addSafeEventListener("focus",a.processFocus,d);$(d).on("input",function(c){a.setNotGraded()});l&&this.addEventScreen(!1)};this.getConfigurationActions=
function(){var a=[],c=$(this.getDivWrap());if(c.attr("value")){var b=new CTATSAI;b.setSelection(this.getName());b.setAction("UpdateTextField");b.setInput(c.attr("value"));a.push(b)}return a};this.processAction.bind(this);this.processAction=function(a,c){if("GET"===p){var b=this.nlp_url,b=b.includes("${input}")?b.replace("${input}",this.getValue()):b.concat(this.getValue()),d=this.getName();(function(a){$.get(b,function(c){console.log("NLP DATA: ",c);a(c)})})(function(a){"string"!=typeof a&&(a=JSON.stringify(a));
var c=new CTATSAI;c.setSelection(d);c.setAction("NLPclassification");c.setInput(a);CTATCommShell.commShell.processComponentAction(c)})}"POST"===p&&(b=this.nlp_url,a=n,a=a.includes("${input}")?a.replace("${input}",this.getValue()):a.concat(this.getValue()),b=b.concat(a),d=this.getName(),function(a){$.post(b,function(c){a(c)})}(function(a){var c=new CTATSAI;c.setSelection(d);c.setAction("NLPclassification");c.setInput(a);CTATCommShell.commShell.processComponentAction(c)}))};this.setCellContainer=function(a){h=
a};this.getCellContainer=function(){return h};this.setText=function(c){a.ctatdebug("setText ("+c+")");a.assignText(c);d.value=c};this.getValue=function(){return d.value};this.reset=function(){a.configFromDescription();a.processSerialization();d.value=""};this.setStyleHandler("DrawBorder",null);this.nlp_url="";this.setURL=function(a){this.nlp_url=a};this.data_ctat_handlers["nlp-url"]=function(a){this.setURL(a)};var n="";this.setPostBody=function(a){this.post_body=a};this.data_ctat_handlers["post-body"]=
function(a){this.setPostBody(a)};var p="GET";this.setMethod=function(a){a&&(this.method=a)};this.data_ctat_handlers["nlp-method"]=function(a){this.setMethod(a)};this.setPreprocessor=function(a){window&&"function"===typeof window[a]&&(this.preprocessor=window[a])};this.data_ctat_handlers.preprocess=function(a){this.setPreprocessor(a)}};CTATNLPInput.prototype=Object.create(CTATTextBasedComponent.prototype);CTATNLPInput.prototype.constructor=CTATNLPInput;
CTAT.ComponentRegistry.addComponentType("CTATNLPInput",CTATNLPInput);CTAT.Geom={};CTAT.Geom.Point={};try{new DOMPoint}catch(b){if(console.log("WARNING: new DOMPoint():",b,typeof b),b instanceof ReferenceError||b instanceof TypeError){console.log("   Using shim!");var DOMPoint=function(g,f,e,c){this.z=this.y=this.x=0;this.w=1;if(g instanceof DOMPoint)for(var a in g)this[a]=g[a];else this.x=g||0,this.y=f||0,this.z=e||0,this.w=c||1}}}CTAT.Geom.Point.useDOMMatrix=!0;try{new DOMMatrix}catch(b){b instanceof ReferenceError&&(CTAT.Geom.Point.useDOMMatrix=!1)}
CTAT.Geom.Point.add=function(){if(CTAT.Geom.Point.useDOMMatrix){for(var b=new DOMMatrix,g,f=0;f<arguments.length;f++)g=arguments[f],b.translateSelf(g.x/g.w,g.y/g.w,g.z/g.w);return b.transformPoint(new DOMPoint)}return Array.prototype.reduce.call(arguments,function(b,c){for(var a in b)"w"!=a&&0!==c[a]&&(b[a]+=c[a]/c.w);return b},new DOMPoint)};
DOMPoint.prototype.add||Object.defineProperty(DOMPoint.prototype,"add",{enumerable:!1,value:function(b){return CTAT.Geom.Point.useDOMMatrix?(new DOMMatrix).translate(b.x/b.w,b.y/b.w,b.z/b.w).transformPoint(this):CTAT.Geom.Point.add(this,b)}});CTAT.Geom.Point.angle=function(b,g){return Math.acos(DOMPoint.dot(b,g)/(b.magnitude*g.magnitude))};CTAT.Geom.Point.angle_degrees=function(b,g){return CTAT.Math.rad2deg(CTAT.Geom.Point.angle(b,g))};
CTAT.Geom.Point.angle_between_2d=function(b,g){return CTAT.Math.rad2deg(Math.atan2(g.y,g.x)-Math.atan2(b.y,b.x))};DOMPoint.prototype.clone||Object.defineProperty(DOMPoint.prototype,"clone",{value:function(){return new DOMPoint(this.x,this.y,this.z,this.w)}});CTAT.Geom.Point.distance=function(b,g){b=CTAT.Geom.Point.add(b,CTAT.Geom.Point.scale(g,-1));return Math.sqrt(CTAT.Geom.Point.dot(b,b))};
DOMPoint.prototype.distance||Object.defineProperty(DOMPoint.prototype,"distance",{value:function(b){return CTAT.Geom.Point.distance(this,b)}});CTAT.Geom.Point.dot=function(b,g){return(b.x*g.x+b.y*g.y+b.z*g.z)/(b.w*g.w)};CTAT.Geom.Point.equals=function(b,g){var f=!0,e;for(e in b)if(e in g?"w"!=e&&(f&=b[e]/b.w==g[e]/g.w):f=!1,!f)break;return f};CTAT.Geom.Point.interpolate=function(b,g,f){return CTAT.Geom.Point.add(b.scale(f),g.scale(1-f))};
"magnitude"in DOMPoint.prototype||Object.defineProperty(DOMPoint.prototype,"magnitude",{enumerable:!1,get:function(){return CTAT.Math.round(Math.sqrt(CTAT.Geom.Point.dot(this,this)))}});DOMPoint.prototype.normalize||Object.defineProperty(DOMPoint.prototype,"normalize",{value:function(b){return this.scale((b?b:1)/this.magnitude)}});
CTAT.Geom.Point.scale=function(b,g){if(CTAT.Geom.Point.useDOMMatrix)return(new DOMMatrix).scale(g).transformPoint(b);var f=new DOMPoint(b),e;for(e in f)"w"!=e&&(f[e]=CTAT.Math.round(b[e]*g));return f};DOMPoint.prototype.scale||Object.defineProperty(DOMPoint.prototype,"scale",{value:function(b){return CTAT.Geom.Point.scale(this,b)}});CTAT.Geom.Point.polar=function(b,g){return new DOMPoint(CTAT.Math.round(b*Math.cos(g)),CTAT.Math.round(b*Math.sin(g)))};
CTAT.Geom.Point.is_on_line=function(b,g,f){return 1E-4>Math.abs(b.distance(f)+g.distance(f)-b.distance(g))};CTAT.Geom.Point.circle_intersection=function(b,g,f,e){g=g.add(b.scale(-1)).normalize();var c=CTAT.Geom.Point.dot(g,f.add(b.scale(-1))),a=b.add(g.scale(c));f=CTAT.Geom.Point.distance(f,a);return f<e?(e=Math.sqrt(e*e-f*f),[b.add(g.scale(c-e)),b.add(g.scale(c+e))]):f==e?[a]:[]};CTAT.Geom.Point.to2DString=function(b,g){b=[b.x/b.w,b.y/b.w].join();g&&(b="("+b+")");return b};CTAT.Geom.Rectangle={};try{new DOMRect}catch(b){if(console.log("WARNING: new DOMRect():",b,typeof b),b instanceof ReferenceError||b instanceof TypeError){console.log("    Using shim!");var DOMRect=function(g,f,e,c){this.x=g||0;this.y=f||0;this.width=e||0;this.height=c||0;return this}}}"left"in DOMRect.prototype||Object.defineProperty(DOMRect.prototype,"left",{get:function(){return Math.min(this.x,this.x+this.width)}});
"right"in DOMRect.prototype||Object.defineProperty(DOMRect.prototype,"right",{get:function(){return Math.max(this.x,this.x+this.width)}});"top"in DOMRect.prototype||Object.defineProperty(DOMRect.prototype,"top",{get:function(){return Math.min(this.y,this.y+this.height)}});"bottom"in DOMRect.prototype||Object.defineProperty(DOMRect.prototype,"bottom",{get:function(){return Math.max(this.y,this.y+this.height)}});
CTAT.Geom.Rectangle.contains=function(b,g,f){var e=CTAT.Geom.Rectangle.contains;if(g instanceof DOMRect)return e(b,g.left,g.top)&e(b,g.right,g.bottom);if(g instanceof DOMPoint){var c=!0;if(f instanceof DOMPoint)c=e(b,f.x/f.w,f.y/f.w);else if("number"==typeof f)return e(b,g.x-f,g.y-f)&e(b,g.x+f,g.y+f);return c&e(b,g.x,g.y)}return b.left<=g&b.right>=g&b.top<=f&b.bottom>=f};
DOMRect.prototype.contains||Object.defineProperty(DOMRect.prototype,"contains",{value:function(b,g){return CTAT.Geom.Rectangle.contains(this,b,g)}});DOMRect.prototype.clone||Object.defineProperty(DOMRect.prototype,"clone",{value:function(){return new DOMRect(this.x,this.y,this.width,this.height)}});DOMRect.prototype.copyFrom||Object.defineProperty(DOMRect.prototype,"copyFrom",{value:function(b){this.x=b.x;this.y=b.y;this.width=b.width;this.height=b.height;return this}});
CTAT.Geom.Rectangle.equals=function(b,g){return b.left==g.left&&b.top==g.top&&b.right==g.right&&b.bottom==g.bottom};CTAT.Geom.Rectangle.inflate=function(b,g,f){g=g?g:0;f=f?f:0;g instanceof DOMPoint&&(f=g.y,g=g.x);b=b.clone();b.x-=g;b.y-=f;b.width+=2*g;b.height+=2*f;return b};CTAT.Geom.Rectangle.isEmpty=function(b){return 0===b.width||0===b.height};CTAT.Geom.Rectangle.setEmpty=function(b){b.x=0;b.y=0;b.width=0;b.height=0;return b};
CTAT.Geom.Rectangle.setTo=function(b,g,f,e,c){b.x=g;b.y=f;b.width=e;b.height=c;return b};CTAT.Geom.Rectangle.offset=function(b,g,f){g=g?g:0;f=f?f:0;g instanceof DOMPoint&&(f=g.y,g=g.x);b=b.clone();b.x+=g;b.y+=f;return b};CTAT.Geom.Rectangle.union=function(b,g){var f=new DOMRect;f.x=Math.min(b.x,g.x);f.y=Math.min(b.y,g.y);f.width=Math.max(b.right,g.right)-f.x;f.height=Math.max(b.bottom,g.bottom)-f.y;return f};var CTATNumberLine=function(b,g,f,e,c){CTAT.Component.Base.SVG.call(this,"CTATNumberLine","aNumberLine",b,g,f,e,c);var a=CTAT.Math.Fraction,d=CTATGlobals.NameSpace.svg,h=this,l=0;this.setAction("AddPoint");b=function(c,b,e,f,h,g){this.numberline=c;this.step=new a(b);this.size=e;this.origin=new a(0);this.precision=isNaN(g)?CTAT.Math.getPrecision(this.step.numerator):g;f=f?f:null;h=h?h:null;this.g=null;this.setStep=function(c){this.step=new a(c);this.precision=CTAT.Math.getPrecision(this.step.numerator)};
this.setSize=function(a){a=Number(a);isNaN(a)&&(a=e);this.size=a};this.setOrigin=function(c){this.origin=new a(c)};this.generate=function(c){if(this.numberline){var b=new a,e=document.createDocumentFragment(),g=document.createElementNS(d,"g");g.setAttributeNS(null,"data-step-size",this.step.toString());g.setAttributeNS(null,"pointer-events","none");f&&g.classList.add(f);e.appendChild(g);this.g=g;if(0<this.step){for(b.set(this.origin).reduce();b<=this.numberline.Maximum;)b>=this.numberline.Minimum&&
(b.numerator=Number(b.numerator.toFixed(this.precision)),g.appendChild(this.numberline.genTickmark(b,null,this.size))),b=b.add(this.step);b.set(this.origin).reduce();for(b=b.subtract(this.step);b>=this.numberline.Minimum;)b<=this.numberline.Maximum&&(b.numerator=Number(b.numerator.toFixed(this.precision)),g.appendChild(this.numberline.genTickmark(b,null,this.size))),b=b.subtract(this.step)}h&&$(g).find("text.CTATNumberLine--tickmark-label").each(function(){this.classList.add(h)});c&&this.hide();return e}};
this.hide=function(){this.g&&this.g.classList.add("CTATNumberLine--tickmark-hidden")};this.show=function(){this.g&&this.g.classList.remove("CTATNumberLine--tickmark-hidden")}};var n=new b(this,new a(1),30,"CTATNumberLine--large-tickmark","CTATNumberLine--large-tickmark-label");this.setLargeTickSize=function(a){n.setSize(s);this.render();return this};this.setParameterHandler("LargeTickmarkSize",this.setLargeTickSize);this.setParameterHandler("LargeTickmarkStep",function(a){n.setStep(a);this.render();
return this});this.data_ctat_handlers["large-tick-step"]=function(a){n.setStep(a);this.render()};var p=new b(this,new a(1,2),20,"CTATNumberLine--small-tickmark","CTATNumberLine--small-tickmark-label");this.setSmallTickSize=function(a){p.setSize(s);this.render();return this};this.setParameterHandler("SmallTickmarkSize",this.setSmallTickSize);this.setParameterHandler("SmallTickmarkStep",function(a){p.setStep(a);this.render();return this});this.data_ctat_handlers["small-tick-step"]=function(a){p.setStep(a);
this.render()};var q=new b(this,new a(0),25,"CTATNumberLine--denominator-tickmark","CTATNumberLine--denominator-tickmark-label");this.setParameterHandler("DenominatorTickmarkSize",function(a){q.setSize(a);this.render();return this});this.setParameterHandler("DenominatorTickmarkStep",function(c){q.setStep((new a(c)).reciprocal())});this.data_ctat_handlers.denominator=function(c){c=new a(c);q.setStep(c.reciprocal())};var u=!0;this.setDenomTicksVisible=function(a){(u=CTATGlobalFunctions.toBoolean(a))?
q.show():q.hide()};this.data_ctat_handlers["denominator-visible"]=this.setDenomTicksVisible;this.setColor=function(a){this.color=a=CTATGlobalFunctions.formatColor(a);for(var c=$(this.getDivWrap()).find("g"),b=0;b<c.length;b++)$(c[b]).css("stroke",a)};this.getColor=function(){return this.color};this.X_Axis=new function(a,c,b,d){var e={};this.svg_group=null;var f=a;Object.defineProperty(this,"start",{get:function(){return f},set:function(a){e={};f=a}});Object.defineProperty(this,"min_loc",{get:function(){if(!e.hasOwnProperty("min_loc")){var a=
this.start.clone(),c=CTAT.Geom.Point.polar(20,this.angle()),a=a.add(c);a.x=CTAT.Math.round(a.x);a.y=CTAT.Math.round(a.y);e.min_loc=a}return e.min_loc}});var h=c;Object.defineProperty(this,"end",{get:function(){return h},set:function(a){e={};h=a}});Object.defineProperty(this,"max_loc",{get:function(){if(!e.hasOwnProperty("max_loc")){var a=this.end.clone(),c=CTAT.Geom.Point.polar(20,this.angle()),a=a.add(c.scale(-1));a.x=CTAT.Math.round(a.x);a.y=CTAT.Math.round(a.y);e.max_loc=a}return e.max_loc}});
var g=b;Object.defineProperty(this,"min",{get:function(){return g},set:function(a){e={};g=a}});var l=d;Object.defineProperty(this,"max",{get:function(){return l},set:function(a){e={};l=a}});Object.defineProperty(this,"length",{get:function(){e.hasOwnProperty("length")||(e.length=CTAT.Math.round(this.min_loc.distance(this.max_loc)));return e.length}});this.isHorizontal=function(){return this.start.y===this.end.y};this.isVertical=function(){return this.start.x===this.end.x};Object.defineProperty(this,
"range",{get:function(){return this.max.subtract(this.min)}});Object.defineProperty(this,"step_size",{get:function(){return CTAT.Geom.Point.equals(this.min_loc,this.max_loc)?this.length:CTAT.Math.round(this.length/this.range)}});this.s_vec=function(){return this.max_loc.add(this.min_loc.scale(-1))};this.slope=function(){var a=this.s_vec();return a.y/a.x};this.step=function(){e.hasOwnProperty("step")||(e.step=this.s_vec().normalize(this.step_size));return e.step};this.scalar=function(){e.hasOwnProperty("scalar")||
(e.scalar=this.range/this.length);return e.scalar};this.zero=function(){e.hasOwnProperty("zero")||(e.zero=this.min_loc.add(this.step().scale(-this.min)),e.zero.x=CTAT.Math.round(e.zero.x),e.zero.y=CTAT.Math.round(e.zero.y));return e.zero};this.angle=function(){if(!e.hasOwnProperty("angle")){var a=this.end.add(this.start.scale(-1));e.angle=Math.atan2(a.y,a.x)}return e.angle};this.angle_deg=function(){return CTAT.Math.rad2deg(this.angle())};this.getPosition=function(a){a=this.zero().add(this.step().scale(1*
a));a.x=CTAT.Math.round(a.x);a.y=CTAT.Math.round(a.y);return a};this.projected_point=function(a){var c=this.s_vec(),b=a.add(this.min_loc.scale(-1)),b=0+(c.y*b.x-c.x*b.y)/(c.y*c.y+c.x*c.x);return a.add(new DOMPoint(-b*c.y,b*c.x))};this.getProjectedPoint=function(a){a=this.projected_point(a);return a.distance(this.max_loc)>this.length?this.min_loc:a.distance(this.min_loc)>this.length?this.max_loc:a};this.getAxisValue=function(a){return CTAT.Math.round(g+this.scalar()*this.min_loc.distance(this.getProjectedPoint(a)))}}(new DOMPoint(0,
0),new DOMPoint(0,0),new a(0),new a(3));var v=Math.sin(Math.PI/2)/7,y=function(a,c){this.points=[{val:a.value.valueOf(),loc:{x:Number(a.getAttribute("cx")),y:Number(a.getAttribute("cy"))},ptEl:a}];a.classList.add("CTATNumberline--line-segment-end");(a=h._point_label_group.querySelector("#label-for-"+a.id))&&a.classList.add("CTATNumberline--line-segment-end");c?(c.classList.add("CTATNumberline--line-segment-end"),(a=h._point_label_group.querySelector("#label-for-"+c.id))&&a.classList.add("CTATNumberline--line-segment-end"),
this.points.push({val:c.value.valueOf(),loc:{x:Number(c.getAttribute("cx")),y:Number(c.getAttribute("cy"))},ptEl:c}),this.points.sort(function(a,c){return a.val-c.val})):this.points.unshift({val:0,loc:h.X_Axis.getPosition(0)});this.length=this.points[1].val-this.points[0].val;this.el=document.createElementNS(d,"line");c=Math.sin(Math.PI/2-h.theta)/v;a=Math.sin(h.theta)/v;this.el.setAttributeNS(null,"x1",this.points[0].loc.x+c);this.el.setAttributeNS(null,"y1",this.points[0].loc.y+a);this.el.setAttributeNS(null,
"x2",this.points[1].loc.x-c);this.el.setAttributeNS(null,"y2",this.points[1].loc.y-a);this.el.classList.add("CTATNumberline--line-segment");this.containsPoint=function(a){a=a.value.valueOf();return a>this.points[0].val&&a<this.points[1].val}};Object.defineProperty(this,"Maximum",{get:function(){return this.X_Axis.max},set:function(c){this.X_Axis.max=new a(c)}});this.setMaximum=function(a){this.Maximum=a};this.setParameterHandler("Maximum",this.setMaximum);this.data_ctat_handlers.maximum=this.setMaximum;
Object.defineProperty(this,"Minimum",{get:function(){return this.X_Axis.min},set:function(c){this.X_Axis.min=new a(c)}});this.setMinimum=function(a){this.Minimum=a};this.setParameterHandler("Minimum",this.setMinimum);this.data_ctat_handlers.minimum=this.setMinimum;var w=1;Object.defineProperty(this,"Max_Points",{get:function(){return w},set:function(a){a=parseInt(a);isNaN(a)||(w=a)}});this.setMaxPoints=function(a){this.Max_Points=a};this.setParameterHandler("Max_Points",this.setMaxPoints);this.data_ctat_handlers["max-points"]=
this.setMaxPoints;var A=7;this.setPointSize=function(a){A=Number(a);L&&(L.setAttributeNS(null,"r",A),$(this._point_group).find("circle").each(function(){$(this).attr("r",A)}));this.render()};this.setStyleHandler("PointSize",this.setPointSize);this.data_ctat_handlers["point-size"]=this.setPointSize;var z=!1;this.setSnapToTickMark=function(a){z=CTATGlobalFunctions.toBoolean(a)};this.setParameterHandler("SnapToTickmark",this.setSnapToTickMark);this.data_ctat_handlers.snap=this.setSnapToTickMark;var C=
!1;this.setLabelPoints=function(a){var c=this;C=CTATGlobalFunctions.toBoolean(a);this._point_group&&[].slice.call(this._point_group.children).forEach(function(a){var b=c._point_label_group.querySelector("#label-for-"+a.id);C&&!b?pa(a):!C&&b&&(a=h._point_label_group.querySelector("#label-for-"+a.id))&&h._point_label_group.removeChild(a)})};this.setParameterHandler("LabelPoints",this.setLabelPoints);this.data_ctat_handlers["label-points"]=this.setLabelPoints;var D=!1;this.setLabelCursor=function(a){D=
CTATGlobalFunctions.toBoolean(a);r&&(r.style.visibility=D&&this.getEnabled()&&B?null:"hidden")};this.setParameterHandler("LabelCursor",this.setLabelCursor);this.data_ctat_handlers["label-cursor"]=this.setLabelCursor;var F=0;this.setSegmentSize=function(a){F=isNaN(a)?F:Number(a)};this.setParameterHandler("SegmentSize",this.setSegmentSize);this.data_ctat_handlers["segment-size"]=this.setSegmentSize;var G=[];this.orientation=this.theta=0;Object.defineProperty(this,"Orientation",{get:function(){return this.orientation},
set:function(a){a=Number(a);isNaN(a)&&(a=0);this.theta=Math.PI*a/180;this.orientation=a}});this.setOrientation=function(a){this.Orientation=a;this.render()};this.setParameterHandler("Orientation",this.setOrientation);this.data_ctat_handlers.rotation=this.setOrientation;var x=function(a,c,b){var e=""+String(a.numerator);a=""+String(a.denominator);b.setAttributeNS(null,"text-align","center");var f=document.createElementNS(d,"tspan"),h=document.createElementNS(d,"tspan");f.style.fontSize="0.8em";h.style.fontSize=
"0.8em";f.appendChild(document.createTextNode(e));h.appendChild(document.createTextNode(a));b.appendChild(f);b.appendChild(h);f.setAttributeNS(null,"text-anchor","middle");h.setAttributeNS(null,"text-anchor","middle");f.setAttributeNS(null,"dy","-1.2em");c&&(f.setAttributeNS(null,"x",c.x),f.setAttributeNS(null,"y",c.y),h.setAttributeNS(null,"x",c.x),h.setAttributeNS(null,"y",c.y));e.length>a.length?f.style.textDecoration="underline":h.style.textDecoration="overline"},H=function(a,c,b){var e=document.createElementNS(d,
"text");e.classList.add("CTATNumberLine--tickmark-label");e.setAttributeNS(null,"text-anchor","middle");b?(e.appendChild(document.createTextNode(b.toString())),e.setAttributeNS(null,"x",a.x),e.setAttributeNS(null,"y",a.y)):1==c.denominator?(e.appendChild(document.createTextNode(String(c.numerator.toPrecision(xa)))),a&&(e.setAttributeNS(null,"x",a.x),e.setAttributeNS(null,"y",a.y))):x(c,a,e);return e};this._tickmarks=[];this.genTickmark=function(a,c,b){var e=document.createDocumentFragment();if(!this._tickmarks.some(function(c){return c.data.equals(a)})){var f=
document.createElementNS(d,"line"),h=this.X_Axis.getPosition(a),g=CTAT.Geom.Point.polar(b/2,this.theta+Math.PI/2).add(h);b=CTAT.Geom.Point.polar(-b/2,this.theta+Math.PI/2).add(h);f.setAttributeNS(null,"x1",g.x);f.setAttributeNS(null,"y1",g.y);f.setAttributeNS(null,"x2",b.x);f.setAttributeNS(null,"y2",b.y);f.setAttributeNS(null,"data-value",a.toString());f.data=a;f.location=h;f.label=null;this._tickmarks.push(f);e.appendChild(f);""!==c&&(c=H(b,a,c),f.label=c,e.appendChild(c))}return e};var K=function(){if(null!==
this.X_Axis&&null!==this.X_Axis.svg_group){var a=this.getBoundingBox(),c=window.getComputedStyle(this._axis_line_group);parseInt(c.getPropertyValue("stroke-width"));this.component.setAttribute("viewBox","0 0 "+a.width+" "+a.height);var b=new DOMPoint(a.width/2,a.height/2),e=b.add(CTAT.Geom.Point.polar(Math.min(40,a.height,a.width)/4,this.theta)),f=Math.sin(this.theta),h=-Math.cos(this.theta),g=f*b.x+h*b.y,l=-a.height*h,w=-f*a.width,c=new DOMPoint(a.left,b.y),b=new DOMPoint(a.right,b.y);if(0<Math.abs(CTAT.Math.round(l))){var l=
new DOMPoint(a.left,(g-f*a.left)/h),y=new DOMPoint(a.right,(g-f*a.right)/h);if(a.contains(l)||a.contains(y))e.distance(l)<e.distance(y)?(c=y,b=l):(c=l,b=y)}0<Math.abs(CTAT.Math.round(w))&&(w=new DOMPoint((g-h*a.top)/f,a.top),f=new DOMPoint((g-h*a.bottom)/f,a.bottom),a.contains(w)||a.contains(f))&&(e.distance(w)<e.distance(f)?(c=f,b=w):(c=w,b=f));if(this.X_Axis.start.x!=c.x||this.X_Axis.start.y!=c.y||this.X_Axis.end.x!=b.x||this.X_Axis.end.y!=b.y)this.X_Axis.start=c,this.X_Axis.end=b,this.X_Axis.svg_group.innerHTML=
"",a=document.createDocumentFragment(),e=document.createElementNS(d,"line"),e.setAttributeNS(null,"x1",c.x),e.setAttributeNS(null,"y1",c.y),e.setAttributeNS(null,"x2",b.x),e.setAttributeNS(null,"y2",b.y),a.appendChild(e),e=document.createElementNS(d,"path"),e.setAttributeNS(null,"d","M 11,6 L 1,0 L 11,-6"),e.setAttributeNS(null,"transform","translate("+CTAT.Geom.Point.to2DString(c)+") rotate("+this.Orientation+")"),a.appendChild(e),c=document.createElementNS(d,"path"),c.setAttributeNS(null,"d","M -11,6 L -1,0 L -11,-6"),
c.setAttributeNS(null,"transform","translate("+CTAT.Geom.Point.to2DString(b)+") rotate("+this.Orientation+")"),a.appendChild(c),this.X_Axis.svg_group.appendChild(a);this._tickmarks=[];c=document.createDocumentFragment();c.appendChild(n.generate());c.appendChild(p.generate());c.appendChild(q.generate(!u));this._tick_mark_group.innerHTML="";this._tick_mark_group.appendChild(c);c=this._point_group.children;b={};for(a=0;a<c.length;b={distX:b.distX,distY:b.distY},a++){var r=c[a],e=this.X_Axis.getPosition(r.value),
f=new DOMPoint(r.cx.baseVal.value,r.cy.baseVal.value);1<e.distance(f)&&(f=this._point_label_group.querySelector("#label-for-"+r.id),b.distX=e.x-r.cx.baseVal.value,b.distY=e.y-r.cy.baseVal.value,f&&(g=f.getAttribute("transform"),w=h=0,g&&(g=/translate\((-?\d+(?:\.\d+)?), ?(-?\d+(?:\.\d+)?)\)/.exec(g),h=Number(g[1]),w=Number(g[2])),h+=b.distX,w+=b.distY,f.setAttributeNS(null,"transform","translate("+h+","+w+")")),r.cx.baseVal.value=e.x,r.cy.baseVal.value=e.y,G.forEach(function(a){return function(c){c.points[0].ptEl===
r?(c.el.setAttribute("x1",Number(c.el.getAttribute("x1"))+a.distX),c.el.setAttribute("y1",Number(c.el.getAttribute("y1"))+a.distY)):c.points[1].ptEl===r&&(c.el.setAttribute("x2",Number(c.el.getAttribute("x2"))+a.distX),c.el.setAttribute("y2",Number(c.el.getAttribute("y2"))+a.distY))}}(b)))}}}.bind(this),I=0,L=null,P=new DOMPoint(-30,-30),B=!1,r=null,M=function(a){P.x=a.clientX;P.y=a.clientY;B&&D&&h.getEnabled()&&(r.style.visibility=null)},V=function(a){cancelAnimationFrame(I);L.style.visibility="hidden";
r.style.visibility="hidden";B=!1},N=function(a){if(!0===this.getEnabled()&&0<w){this.setHintHighlight(!1);z?a=Ba(a.clientX,a.clientY).data:(a=T(a.clientX,a.clientY),a=this.X_Axis.getAxisValue(a));var c=J(a);R();h._point_group.children.length>=w?this.setActionInput("AddPointAtMax",a.toString()):(this._point_group.appendChild(c),C&&(pa(c),D&&(r.style.visibility="hidden")),this.setActionInput("AddPoint",a.toString()));this.processAction()}}.bind(this),Q=function(a){h._point_group.removeChild(a);(a=h._point_label_group.querySelector("#label-for-"+
a.id))&&h._point_label_group.removeChild(a)},R=function(){Array.prototype.filter.call(h._point_group.children,function(a){return a.classList.contains("CTAT--incorrect")}).forEach(function(a){return Q(a)})},aa=function(){if(h._point_group.children.length>=h.Max_Points){var a=[].slice.call(h._point_group.children),c=a.filter(function(a,c,b){return a.classList.contains("CTAT--incorrect")});0<c.length?Q(c[0]):(c=a.filter(function(a,c,b){return!a.correct}),0<c.length?Q(c[0]):Q(a[0]))}},E,S=function(){clearTimeout(E);
E=setTimeout(K,100)};this.init=function(){this.initSVG();this.component.classList.add("CTATNumberLine--container");this._axis_line_group=document.createElementNS(d,"g");this._axis_line_group.classList.add("CTATNumberLine--axis");this._tick_mark_group=document.createElementNS(d,"g");this._tick_mark_group.classList.add("CTATNumberLine--tickmark");this._point_group=document.createElementNS(d,"g");this._point_label_group=document.createElementNS(d,"g");this._segment_group=document.createElementNS(d,"g");
L=document.createElementNS(d,"circle");L.setAttributeNS(null,"r",A);L.classList.add("CTATNumberLine--cursor");L.setAttributeNS(null,"transform","translate(-30,-30)");r=document.createElementNS(d,"text");r.classList.add("CTATNumberLine--cursor-label");r.setAttributeNS(null,"transform","translate(-30,-30)");r.style.visibility="hidden";r.setAttributeNS(null,"text-anchor","middle");this.component.appendChild(this._axis_line_group);this.component.appendChild(this._segment_group);this.component.appendChild(this._tick_mark_group);
this.component.appendChild(this._point_group);this.component.appendChild(this._point_label_group);this.component.appendChild(L);this._point_label_group.appendChild(r);r.textContent="label";this.X_Axis.svg_group=this._axis_line_group;K();this.addComponentReference(this,this.getDivWrap());this.component.addEventListener("mousemove",M);this.component.addEventListener("mouseleave",V);var a=this.getEnabled;this.component.addEventListener("mouseenter",function(c){!0===a()&&0<w&&(B=!0,L.style.visibility=
null,D&&(r.style.visibility=null),I=requestAnimationFrame(sa))});this.component.addEventListener("click",N);this.component.addEventListener("focus",this.processFocus);(new ResizeObserver(S)).observe(this.component)};this.getConfigurationActions=function(){var a=[],c,b=$(this.getDivWrap());b.attr("data-ctat-minimum")&&(c=new CTATSAI,c.setSelection(this.getName()),c.setAction("set_minimum"),c.setInput(b.attr("data-ctat-minimum")),a.push(c));b.attr("data-ctat-maximum")&&(c=new CTATSAI,c.setSelection(this.getName()),
c.setAction("set_maximum"),c.setInput(b.attr("data-ctat-maximum")),a.push(c));b.attr("data-ctat-max-points")&&(c=new CTATSAI,c.setSelection(this.getName()),c.setAction("set_max_user_entries"),c.setInput(b.attr("data-ctat-max-points")),a.push(c));b.attr("data-ctat-large-tick-step")&&(c=new CTATSAI,c.setSelection(this.getName()),c.setAction("set_large_step"),c.setInput(b.attr("data-ctat-large-tick-step")),a.push(c));b.attr("data-ctat-small-tick-step")&&(c=new CTATSAI,c.setSelection(this.getName()),
c.setAction("set_small_step"),c.setInput(b.attr("data-ctat-small-tick-step")),a.push(c));b.attr("data-ctat-denominator")&&(c=new CTATSAI,c.setSelection(this.getName()),c.setAction("set_denominator"),c.setInput(b.attr("data-ctat-denominator")),a.push(c));return a};var W=-1<navigator.userAgent.toLowerCase().indexOf("firefox"),T=function(a,c){this.svgPoint=this.svgPoint?this.svgPoint:this.component.createSVGPoint();this.svgPoint.x=a;this.svgPoint.y=c;a=this._axis_line_group.getScreenCTM().inverse();
this.svgPoint=this.svgPoint.matrixTransform(a);a=new DOMPoint(this.svgPoint.x,this.svgPoint.y);if(W){var b=$(this.component);c=parseInt(b.css("borderLeftWidth"))+parseInt(b.css("paddingLeft"))+parseInt(b.css("marginLeft"));b=parseInt(b.css("borderTopWidth"))+parseInt(b.css("paddingTop"))+parseInt(b.css("marginTop"));a.x-=c;a.y-=b}return a}.bind(this),fa=function(a,c){return this.getProjectedPoint(T(a,c))}.bind(this.X_Axis),Ba=function(a,c){a=fa(a,c);c=null;for(var b=Number.POSITIVE_INFINITY,d,e,f=
0;f<this._tickmarks.length;f++)d=this._tickmarks[f],e=a.distance(d.location),e<b&&(c=d,b=e);return c}.bind(this),sa=function(){if(B&&!0===this.getEnabled()){var a,c;if(z){var b=Ba(P.x,P.y);a=b.location;1===b.data.denominator?r.innerHTML=b.data.toString():(r.innerHTML="",x(b.data,a,r),c=new DOMPoint(0,0))}else a=fa(P.x,P.y),b=T(P.x,P.y),b=this.X_Axis.getAxisValue(b),r.innerHTML=Number(b).toFixed(2);L.setAttributeNS(null,"transform","translate"+CTAT.Geom.Point.to2DString(a,!0));b=r.getBBox();c=(c?c:
a).add(new DOMPoint(0,l+b.height));r.setAttributeNS(null,"transform","translate"+CTAT.Geom.Point.to2DString(c,!0));I=requestAnimationFrame(sa)}}.bind(this);this.render=function(){l=Math.max(A,n.size/2);K()};this.calcXCoordinate=function(c){c=new a(c);var b=this.getWidth()-30,b=Math.abs(b-30),d=max.subtract(min);return 30+c.subtract(min).divide(d)/b};this.calcNum=function(a){var c=this.getWidth()-30,c=Math.abs(c-30);a=max.subtract(min).multiply((a-30)/c);return min.add(a)};var ga=function(a,c){switch(c.getClassName()){case "CTATMessage":c=
c.getSAI()}c=c.clone();c.setAction(a.getSAI().getAction());c.setSelection(a.getName());return c},ta=this.setCorrect.bind(this);this.setCorrect=function(a){var c=this;if("AddPoint"===a.getAction()){this.setNotGraded();this.setLastPoint(a.getInput());var b=[].slice.call(this._point_group.children),d=b[b.length-1];d&&(d.correct=!0);componentStatus=CTAT.Component.Base.Tutorable.Options.Status.CORRECT;this.getDisableOnCorrect()&&h._point_group.children.length>=w&&b.every(function(a){return a.correct})&&
this.setEnabled(!1);!1===CTATGlobals.suppressStudentFeedback&&this.getShowFeedback()&&this.showCorrect(a);if(F){var e=b.filter(function(a){return a.correct}),f=d.value.valueOf(),b=[],g=null,l=null;e.forEach(function(a){var c=Math.abs(a.value.valueOf()-f);a!==d&&(!g||c<l)&&0===c%F&&(l=c,g=a)});if(g){if(b.push(new y(d,g)),e=G.find(function(a){return a.containsPoint(d)}))this._segment_group.removeChild(e.el),G.splice(G.indexOf(e),1),e=e.points.find(function(a){return a.ptEl&&a.ptEl!==g}),b.push(new y(d,
e?e.ptEl:null))}else 0===f%F&&b.push(new y(d));b.forEach(function(a){G.push(a);c._segment_group.appendChild(a.el);a.length===F&&(a.correct=!0,c.getShowFeedback()&&a.el.classList.add("CTAT--correct"))})}this.component&&(a=new CustomEvent(CTAT.Component.Base.Tutorable.EventType.correct,{detail:{sai:a,component:this},bubbles:!0,cancelable:!0}),this.getDivWrap().dispatchEvent(a))}else"Points"===a.getAction()&&[].slice.call(this._point_group.children).forEach(function(a){a.correct=!0}),ta(a)};var ua=function(a){a.classList.remove("CTAT--incorrect");
a.classList.remove("CTAT--hint");a.classList.add("CTAT--correct");if(a=h._point_label_group.querySelector("#label-for-"+a.id))a.classList.remove("CTAT--incorrect"),a.classList.add("CTAT--correct")},ha=function(a){a.classList.remove("CTAT--correct");a.classList.remove("CTAT--hint");a.classList.add("CTAT--incorrect");if(a=h._point_label_group.querySelector("#label-for-"+a.id))a.classList.remove("CTAT--correct"),a.classList.add("CTAT--incorrect")};this.showCorrect=function(a){a.getInput();var c=a.getAction(),
b=function(c){c.setCorrect(ga(c,a))},d=[].slice.call(this._point_group.children);switch(c){case "AddPoint":(c=d[d.length-1])&&ua(c);break;case "Points":d.forEach(function(a){ua(a)});break;case "set_minimum":U(ia()).forEach(b);break;case "set_maximum":U(Y()).forEach(b);break;case "set_large_step":U(ka()).forEach(b);break;case "set_small_step":U(O()).forEach(b);break;case "set_denominator":U(la()).forEach(b);break;case "AddPointAtMax":break;default:console.log("Unhandled Action in",this.getName(),c)}};
this.showInCorrect=function(a){a.getInput();var c=a.getAction(),b=function(c){c.setIncorrect(ga(c,a))};switch(c){case "AddPoint":0<this._point_group.children.length&&(c=[].slice.call(this._point_group.children),ha(c[c.length-1]));break;case "Points":c=this._point_group.children;for(b=0;b<c.length;b++)ha(c[b]);break;case "set_minimum":U(ia()).forEach(b);break;case "set_maximum":U(Y()).forEach(b);break;case "set_large_step":U(ka()).forEach(b);break;case "set_small_step":U(O()).forEach(b);break;case "set_denominator":U(la()).forEach(b);
break;case "AddPointAtMax":break;default:console.log("Unhandled Action in",this.getName(),c)}};var ja=this.setEnabled;this.setEnabled=function(a){ja(a);L&&B&&(L.style.visibility=this.getEnabled()?null:"hidden",r.style.visibility=D&&this.getEnabled()?null:"hidden")};this.set_minimum=function(a){this.Minimum=a;this.render()};this.change_minimum=function(c){c=new a(c);0!==c.valueOf()&&(this.Minimum=this.Minimum.add(c),this.render())};var ea=function(){this.setActionInput("set_minimum",this.Minimum)}.bind(this);
this.set_maximum=function(a){this.Maximum=a;this.render()};this.change_maximum=function(c){c=new a(c);0!==c.valueOf()&&(this.Maximum=this.Maximum.add(c),this.render())};var X=function(){this.setActionInput("set_maximum",this.Maximum)}.bind(this);this.set_max_user_entries=function(a){this.setMaxPoints(parseInt(a))};b=function(a,c){a.setStep(c);this.render()};this.set_large_step=b.bind(this,n);var ba=function(){this.setActionInput("set_large_step",n.step.toString())}.bind(this);this.set_small_step=
b.bind(this,p);var ma=function(){this.setActionInput("set_small_step",p.step.toString())}.bind(this);this.set_denominator=function(c){0===parseInt(c)?q.setStep(0):q.setStep((new a(c)).reciprocal());this.render()};var na=function(){var a=0===q.step.valueOf()?0:q.step.reciprocal();this.setActionInput("set_denominator",a.toString())}.bind(this);b=function(c,b){0!==(new a(b)).valueOf()&&(b=c.step.add(b),0>b.valueOf()&&b.set(0,1),c.setStep(b),this.render())};this.change_large_step=b.bind(this,n);this.change_small_step=
b.bind(this,p);this.change_denominator=function(c){c=new a(c);0!==c.valueOf()&&(c=c.add(q.step.denominator),q.setStep(c.reciprocal()),this.render())};this.set_label_points=this.setLabelPoints;this.set_label_cursor=this.setLabelCursor;this.set_segment_size=this.setSegmentSize;this.set_denominator_visible=this.setDenomTicksVisible;var xa=void 0;this.set_precision=function(a){xa=parseInt(a);this.render()};var J=function(c){var b=new a(c),e=h.X_Axis.getPosition(b),f=document.createElementNS(d,"circle");
f.classList.add("CTATNumberLine--point");f.setAttributeNS(null,"cx",e.x);f.setAttributeNS(null,"cy",e.y);f.setAttributeNS(null,"r",A);f.value=b;f.setAttribute("id",h.getName()+"-point-at-"+c.toString().replaceAll(".","-pt-").replaceAll("/","-over-"));return f},pa=function(a){var c=a.value,b=c.toString(),b=isNaN(b)?null:z?b:Number(b).toFixed(2),d=h.X_Axis.getPosition(c),d=CTAT.Geom.Point.polar(l,h.theta+Math.PI/2).add(d),c=H(d,c,b);c.setAttribute("id","label-for-"+a.id);h._point_label_group.appendChild(c);
b=c.getBBox().height;c.setAttributeNS(null,"transform","translate(0,"+b+")");a.classList.contains("CTAT--correct")?c.classList.add("CTAT--correct"):a.classList.contains("CTAT--incorrect")&&c.classList.add("CTAT--incorrect")};this.AddPoint=function(a,c){var b=J(a);[].slice.call(this._point_group.children).some(function(a){return b.value.equals(a.value)})||(aa(),this._point_group.appendChild(b),C&&pa(b))};this.setLastPoint=function(a){a=J(a);var c=this._point_group,b=c.children;Q(b[b.length-1]);c.appendChild(a);
C&&pa(a)};this.Points=function(a,c){this._point_group.innerHTML="";this._point_label_group.innerHTML="";a=a.split(";");for(var b in a)this.AddPoint(a[b],c)};var qa=function(a,c,b,d){switch(d.getAction()){case "ButtonPressed":a.call(this,d.getInput());break;case "Update":case "UpdateTextField":case "UpdateTextArea":c.call(this,d.getInput())}b.call();this.processAction(!1,!0)};b=function(a){return(a=$(this.getDivWrap()).attr(a))?a.split(/\s*;\s*/).map(function(a){return a.trim()}):[]};var Y=b.bind(this,
"data-ctat-ctrl-max"),ia=b.bind(this,"data-ctat-ctrl-min"),ka=b.bind(this,"data-ctat-ctrl-large-tick"),O=b.bind(this,"data-ctat-ctrl-small-tick"),la=b.bind(this,"data-ctat-ctrl-denominator"),U=function(a){return a.map(function(a){return $("#"+a).data("CTATComponent")})},da=function(a){var c=null;if(a instanceof CTAT.Component.Base.Tutorable)a!=this&&(c=a.getName());else if(a instanceof CTATSAI)a.getSelection()!=h.getName()&&(c=a.getSelection());else if(a instanceof String)a!=h.getName()&&(c=a);else if(a instanceof
Element)a!=h.getComponent()&&(c=a.id);else return null;if(c){if(ra(c))return qa.bind(this,this.change_denominator,this.set_denominator,na);if(Z(c))return qa.bind(this,this.change_small_step,this.set_small_step,ma);if(Da(c))return qa.bind(this,this.change_large_step,this.set_large_step,ba);if(ca(c))return qa.bind(this,this.change_minimum,this.set_minimum,ea);if(Ea(c))return qa.bind(this,this.change_maximum,this.set_maximum,X)}return null}.bind(this);if(!CTATConfiguration.get("previewMode")){var Ia=
function(a){var c=a.detail.sai;a=da(a.detail.component);c&&null!=a&&a(c)};[CTAT.Component.Base.Tutorable.EventType.action,"CTAT_EXECUTE_SAI"].forEach(function(a){return document.addEventListener(a,Ia,!1)})}this.setMaxControllers=function(a){$(this.getDivWrap()).attr("data-ctat-ctrl-max",a)};this.setParameterHandler("MaxValueControllers",this.setMaxControllers);this.setMinControllers=function(a){$(this.getDivWrap()).attr("data-ctat-ctrl-min",a)};this.setParameterHandler("MinValueControllers",this.setMinControllers);
this.setLargeTickControllers=function(a){$(this.getDivWrap()).attr("data-ctat-ctrl-large-tick",a)};this.setParameterHandler("LargeTickmarkControllers",this.setLargeTickControllers);this.setSmallTickControllers=function(a){$(this.getDivWrap()).attr("data-ctat-ctrl-small-tick",a)};this.setParameterHandler("SmallTickmarkControllers",this.setSmallTickControllers);this.setDenominatorControllers=function(a){$(this.getDivWrap()).attr("data-ctat-ctrl-denominator",a)};this.setParameterHandler("DenominatorTickmarkControllers",
this.setDenominatorControllers);b=function(a,c){return 0<=a().indexOf(c)};var Ea=b.bind(null,Y),ca=b.bind(null,ia),Da=b.bind(null,ka),Z=b.bind(null,O),ra=b.bind(null,la);this.grade=function(a){a=a.getDivWrap().id;Ea(a)?(this.setAction("set_maximum"),this.setInput(this.Maximum.toString())):ca(a)?(this.setAction("set_minimum"),this.setInput(this.Minimum.toString())):Da(a)?(this.setAction("set_large_step"),this.setInput(n.step.toString())):Z(a)?(this.setAction("set_small_step"),this.setInput(p.step.toString())):
ra(a)?(this.setAction("set_denominator"),this.setInput(q.step.reciprocal().toString())):this.updateSAI();this.processAction(!0)};this.updateSAI=function(){for(var a=this._point_group.children,c=[],b=0;b<a.length;b++)c.push(a[b].value);c.sort(function(a,c){return a-c});this.setActionInput("Points",c.join(";"))}};CTATNumberLine.prototype=Object.create(CTAT.Component.Base.SVG.prototype);CTATNumberLine.prototype.constructor=CTATNumberLine;CTAT.ComponentRegistry.addComponentType("CTATNumberLine",CTATNumberLine);var CTATNumericStepper=function(b,g,f,e,c){CTAT.Component.Base.Tutorable.call(this,"CTATNumericStepper","__undefined__",b,g,f,e,c);this.setAction("Update");var a=document.createElement("input");a.type="number";this.set_maximum=function(c){c=Number(c);isNaN(c)||(a.max=c)};this.setParameterHandler("maximum",this.set_maximum);this.set_minimum=function(c){c=Number(c);isNaN(c)||(a.min=c)};this.setParameterHandler("minimum",this.set_minimum);this.set_step=function(c){c=Number(c);isNaN(c)||(a.step=c)};this.setParameterHandler("stepSize",
this.set_step);this.update_value=function(c){c=Number(c);isNaN(c)||(a.value=c,this.setInput(c))};this.setParameterHandler("value",this.update_value);this.updateSAI=function(){this.setInput(a.value)};this.Update=this.update_value;this.init=function(){a.id=this.getName()+"_spinner";this.setComponent(a);this.setInitialized(!0);var c=$(this.getDivWrap()),b=$(a);"autofocus defaultValue placeholder value max min readOnly step".split(" ").forEach(function(a){var d=c.attr(a);d&&b.attr(a,d)});CTATConfiguration.get("previewMode")||
(this.getDivWrap().innerHTML="");this.getDivWrap().appendChild(a);this.component.addEventListener("focus",this.processFocus);var e=this;a.addEventListener("change",function(a){var c=Number(this.min);isNaN(c)&&(c=0);a=Number(this.value);if(isNaN(a))this.value=c;else if(""!==this.min&&a<c)this.value=c;else if(""!==this.max&&!isNaN(Number(this.max))&&a>Number(this.max))this.value=this.max;else{var b=Number(this.step);if(isNaN(b)||0>=b)b=1;c=(a-c)%b;0!==c&&(this.value=a-c)}e.updateSAI();e.processAction();
return!1});CTATConfiguration.get("previewMode")&&this.addEventScreen(!1)};this.getConfigurationActions=function(){var a=[],c,b=$(this.getDivWrap());b.attr("min")&&(c=new CTATSAI,c.setSelection(this.getName()),c.setAction("set_minimum"),c.setInput(b.attr("min")),a.push(c));b.attr("max")&&(c=new CTATSAI,c.setSelection(this.getName()),c.setAction("set_maximum"),c.setInput(b.attr("max")),a.push(c));b.attr("step")&&(c=new CTATSAI,c.setSelection(this.getName()),c.setAction("set_step"),c.setInput(b.attr("step")),
a.push(c));b.attr("value")&&(c=new CTATSAI,c.setSelection(this.getName()),c.setAction("Update"),c.setInput(b.attr("value")),a.push(c));return a}};CTATNumericStepper.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);CTATNumericStepper.prototype.constructor=CTATNumericStepper;CTAT.ComponentRegistry.addComponentType("CTATNumericStepper",CTATNumericStepper);var CTATPieChart=function(b,g,f,e,c){CTAT.Component.Base.UnitDisplay.call(this,"CTATPieChart","aPieChart",b,g,f,e,c);var a=3,d=3,h=this,l,n,p,q=null,u=CTATGlobals.NameSpace.svg;this.init=function(){this.initSVG();this.baseGroup=document.createElementNS(u,"g");this.getComponent().appendChild(this.baseGroup);this.getComponent().classList.add("CTATPieChart--container");l=document.createElementNS(u,"filter");l.id=this.genName("Shadow");n="#"+l.id;p="url("+n+")";l.setAttributeNS(null,"width","200%");l.setAttributeNS(null,
"height","200%");q=document.createElementNS(u,"feOffset");q.setAttributeNS(null,"in","SourceAlpha");q.setAttributeNS(null,"result","offOut");q.setAttributeNS(null,"dx",d);q.setAttributeNS(null,"dy",d);l.appendChild(q);var a=document.createElementNS(u,"feGaussianBlur");a.setAttributeNS(null,"in","offOut");a.setAttributeNS(null,"result","blurOut");a.setAttributeNS(null,"stdDeviation",4);l.appendChild(a);a=document.createElementNS(u,"feBlend");a.setAttributeNS(null,"in","SourceGraphic");a.setAttributeNS(null,
"in2","blurOut");a.setAttributeNS(null,"mode","normal");l.appendChild(a);this.getComponent().getElementsByTagName("defs")[0].appendChild(l);0<d&&this.baseGroup.setAttributeNS(null,"filter",p);this.drawPieces();this.addComponentReference(this,this.getDivWrap());this.component.addEventListener("focus",this.processFocus)};this.render=function(){this.drawPieces()};this.drawPieces=function(){if(this.baseGroup){this.clear();var c=window.getComputedStyle(this.getComponent()),c=parseFloat(c.getPropertyValue("stroke-width")),
b=this.getBoundingBox(),e=Math.min(b.width/2,b.height/2)-(c+d+4),f=new DOMPoint(b.width/2,b.height/2),c=this.parseValue(),g=document.createDocumentFragment();c.reduce(function(c,b,d,l){if(1<=b.valueOf())d=document.createElementNS(u,"circle"),d.classList.add("CTATPieChart--piece"),d.cx.baseVal.value=f.x,d.cy.baseVal.value=f.y,d.r.baseVal.value=e,this.addPieceElem(d,b,b.selected),g.appendChild(d);else{d=document.createElementNS(u,"path");d.classList.add("CTATPieChart--piece");g.appendChild(d);window.getComputedStyle(d);
var n=2*Math.PI*c.valueOf();l=f.add(CTAT.Geom.Point.polar(e,n));b.reduce();var p=f.add(CTAT.Geom.Point.polar(e,2*Math.PI*b.valueOf()+n)),q=f.clone();if(0<a&&a<e){n=CTAT.Geom.Point.polar(a,n+Math.PI*b.valueOf());q=q.add(n);l=l.add(n);var w=function(a,c,b){return a.distance(c)<a.distance(b)?c:b};l=CTAT.Geom.Point.circle_intersection(q,l,f,e).reduce(w.bind(this,l));p=p.add(n);p=CTAT.Geom.Point.circle_intersection(q,p,f,e).reduce(w.bind(this,p))}n=CTAT.Geom.Point.to2DString;q="M "+n(q);w=new DOMPoint(e,
e);q+=" L "+n(l);q+=" A "+n(w)+" 0 "+(.5<b.valueOf()?1:0)+",1 "+n(p);d.setAttributeNS(null,"d",q+" Z");h.addPieceElem(d,b,b.selected)}return c.add(b)},new CTAT.Math.Fraction);this.baseGroup.innerHTML="";this.baseGroup.appendChild(g)}};this.getExplode=function(){return a};this.getDropShadowDistance=function(){return d};this.setExplode=function(c){c=Number(c);if(!isNaN(c)){var b=c!==a;a=c;b&&this.drawPieces()}return this};this.setStyleHandler("explode",this.setExplode);this.data_ctat_handlers.explode=
function(a){this.setExplode(a)};this.setDropShadowDistance=function(a){d=parseInt(a);d=isNaN(d)?0:d;q&&(q.setAttributeNS(null,"dx",d),q.setAttributeNS(null,"dy",d),0>=d&&this.baseGroup?this.baseGroup.removeAttributeNS(null,"filter"):this.baseGroup.hasAttributeNS(null,"filter")||this.baseGroup.setAttributeNS(null,"filter",p))};this.data_ctat_handlers["shadow-distance"]=function(a){this.setDropShadowDistance(a)}};CTATPieChart.prototype=Object.create(CTAT.Component.Base.UnitDisplay.prototype);
CTATPieChart.prototype.constructor=CTATPieChart;CTAT.ComponentRegistry.addComponentType("CTATPieChart",CTATPieChart);var CTATRadioButton=function(b,g,f,e,c){CTAT.Component.Base.Clickable.call(this,"CTATRadioButton","__undefined__",b,g,f,e,c);var a=CTATConfiguration.get("previewMode"),d=this,h=null,l=null,n="#000000";this.setSelection(this.getComponentGroup());this.setAction("UpdateRadioButton");this.setStyleHandler("BackgroundColor",null);this.init=function(){d.setInitialized(!0);h=document.createElement("input");h.type="radio";h.id=this.getName()+"_radio";h.value=d.getName();this.getComponentGroup()?h.name=d.getComponentGroup():
this.getDivWrap()&&$(this.getDivWrap()).attr("name")?h.name=$(this.getDivWrap()).attr("name"):h.name="radioButtonGroup";!0===d.getEnabled()?h.disabled=!1:h.disabled=!0;d.addComponentReference(d,h);var c;a||(c=this.getDivWrap().innerHTML,this.getDivWrap().innerHTML="");d.getDivWrap().appendChild(h);l=document.createElement("label");l.htmlFor=h.id;l.classList.add("CTATRadioButton--label");this.getDivWrap().getAttribute("data-ctat-label")?l.textContent=d.getDivWrap().getAttribute("data-ctat-label"):
this.getText()?l.textContent=d.getText():c&&!a&&(l.innerHTML=c);d.setComponent(h);this.getDivWrap().appendChild(l);h.addEventListener("click",function(a){d.updateSAI();d.processAction()});h.addEventListener("focus",this.processFocus);h.onfocus=this.processOnFocus;this.setSelection(this.getComponentGroup());this.component.addEventListener("focus",this.processFocus)};this.getConfigurationActions=function(){var a=[];if(0<l.innerHTML.trim().length){var c=new CTATSAI;c.setSelection(this.getName());c.setInput(l.innerHTML.toString());
c.setAction("setText");a.push(c)}return a};this.setFontColor=function(a){n=a;$(l).css("color",a)};this.getFontColor=function(){return n};this.resize=function(){var a=$(this.getDivWrap()).height();$(l).css("font-size",a-5+"px");$(this.getComponent()).css("height",a-10+"px");$(this.getComponent()).css("width",a-10+"px")};var p=this.setText;this.setText=function(a){p(a);null!==l&&(l.innerHTML=this.getText())};this.setStyleHandler("buttonLabel",this.setText);var q=this.setEnabled;this.setEnabled=function(a){q(a);
null!==h&&(h.disabled=!this.getEnabled())};this.setChecked=function(a){null!==h&&(h.checked=a)};this.getChecked=function(){return h.checked};this.getRadioInput=function(){return h.checked?h.value+": "+l.textContent:""};this.setStyleHandler("labelPlacement",null);this.reset=function(){d.ctatdebug(" reset ( "+d.getName()+")");h.checked=!1;d.setEnabled(!0)};this.UpdateRadioButton=function(a){0<=a.indexOf(h.value)&&d.setChecked(!0);d.ctatdebug("UpdateRadioButton ()")};this.updateSAI=function(){var a=
$("."+this.getClassName()+'[data-ctat-component]:has(input[type="radio"][name="'+h.name+'"]:checked)'),c="";1===a.length&&(c=$(a[0]).data("CTATComponent").getRadioInput());d.setSelection(h.name);d.setInput(c)};var u=function(a){l&&l.classList.add(a);h&&h.classList.add(a)},v=function(a){l&&l.classList.remove(a);h&&h.classList.remove(a)};this.showCorrect=function(a){v("CTAT--hint");v("CTAT--incorrect");(a?0===a.getInput().indexOf(h.value):1)?u("CTAT--correct"):v("CTAT-correct")};this.removeCorrect=
function(){v("CTAT--correct")};this.showInCorrect=function(a){v("CTAT--hint");v("CTAT--correct");(a?0===a.getInput().indexOf(h.value):1)?u("CTAT--incorrect"):v("CTAT-incorrect")};this.removeInCorrect=v.bind(this,"CTAT--incorrect");this.showHintHighlight=function(a){this.removeCorrect();this.removeInCorrect();a?u("CTAT--hint"):v("CTAT--hint")}};CTATRadioButton.prototype=Object.create(CTAT.Component.Base.Clickable.prototype);CTATRadioButton.prototype.constructor=CTATRadioButton;
CTAT.ComponentRegistry.addComponentType("CTATRadioButton",CTATRadioButton);var CTATScrollPaneComponent=function(b,g,f,e,c){CTAT.Component.Base.Tutorable.call(this,"CTATScrollPaneComponent","__undefined__",b,g,f,e,c);var a=0,d=this;d.isTabIndexable=!1;this.getAlpha=function(){return a};this.setAlpha=function(c){a=c};this.init=function(){d.ctatdebug("init ("+d.getName()+")");d.ctatdebug("Final location: "+d.getX()+","+d.getY()+" with text: "+d.getText());d.setInitialized(!0)};this.processCommShellEvent=function(a,c){d.ctatdebug("processCommShellEvent ("+a+")")};this.processSerialization=
function(){d.ctatdebug("processSerialization()")};this.postProcess=function(){d.ctatdebug("postProcess ()");for(var a in this.parameters){var c=this.parameters[a];d.ctatdebug("Checking style name: "+a);if("TargetMovieClip"==a)if(d.ctatdebug("Loading sub element: ["+c.trim()+"] ..."),c=findMovieClip(c.trim()),null!==c){if(d.ctatdebug("Found target movieclip, temporarily removing ..."),null!==c.getDivWrapper().parentNode){try{c.getDivWrapper().parentNode.removeChild(c.getDivWrapper())}catch(q){CTATScrim.scrim.errorScrimUp(q.message);
return}d.getDivWrap().setAttribute("id","scrollsubdiv");d.ctatdebug("Adding ...");d.getDivWrap().appendChild(c.getDivWrapper());var b=c.getDivWrapper().style.left,e=c.getDivWrapper().style.top;c.getDivWrapper().style.left="0px";c.getDivWrapper().style.top="0px";d.ctatdebug("Moving canvas from: "+b+","+e+" to: 0,0");c=c.getDivWrapper().childNodes;for(b=0;b<c.length;b++);}}else d.ctatdebug("Unable to find the target movieclip to reparent the content from")}d.ctatdebug("Final location: "+d.getX()+","+
d.getY()+" with text: "+d.getText());null===CTATCommShell.commShell||void 0===CTATCommShell.commShell?d.ctatdebug("Error: can't add event listener to commshell, pointer is invalid"):CTATCommShell.commShell.addGlobalEventListener(this)};this.configFromDescription()};CTATScrollPaneComponent.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);CTATScrollPaneComponent.prototype.constructor=CTATScrollPaneComponent;CTAT.ComponentRegistry.addComponentType("CTATScrollPaneComponent",CTATScrollPaneComponent);var CTATSkillWindow=function(b,g,f,e,c){CTAT.Component.Base.Graphical.call(this,"CTATSkillWindow","__undefined__",b,g,f,e,c);var a=this;a.isTabIndexable=!1;this.getThreshold=function(){var a=parseFloat($(this.getDivWrap()).attr("data-ctat-threshold"));return isNaN(a)?.95:a};this.setThreshold=function(a){$(this.getDivWrap()).attr("data-ctat-threshold",a)};var d=null;this.init=function(){a.ctatdebug("init ("+a.getName()+")");a.setIsAbstractComponent(!0);a.setInitialized(!0);d=this.getDivWrap();this.setComponent(d);
this.drawComponent();this.component.addEventListener("focus",this.processFocus)};this.assignSkillSet=function(a){CTATSkillSet.skills=a;this.drawComponent()};this.updateSkillSet=function(c){if(CTATSkillSet.skills){a.ctatdebug("updateSkillSet ("+c.getSkillSet().length+")");c=c.getSkillSet();for(var b=0,d=0;d<c.length;d++){var e=c[d];a.ctatdebug("Updating skill "+e.getSkillName()+" to level: "+e.getLevel()+" ...");CTATSkillSet.skills.setSkillLevel(e.getSkillName(),e.getLevel(),1);b++}0<b&&this.drawComponent()}else a.ctatdebug("Error: updateSkillSet () no initial skill set given, can't update")};
this.drawComponent=function(){a.ctatdebug("drawComponent ()");if(null===CTATSkillSet.skills)ctatdebug("Info: no skillSet object available, bumping out");else{var c=CTATSkillSet.skills.getSkillSet();if(null===c)a.ctatdebug("Error: list of skills is null in skills object");else if(0>=c.length)a.ctatdebug("Error: list of skills is 0 length");else{for(var b=document.createDocumentFragment(),e=this.getThreshold(),f=0;f<c.length;f++){var g=c[f];a.ctatdebug("Drawing skill "+f+" "+g.getDisplayName()+" level: "+
g.getLevel()+" ...");var u=document.createElement("div");u.classList.add("CTATSkillWindow--skill");var v=document.createElement("div");v.classList.add("CTATSkillWindow--bar");var y=document.createElement("div"),w=g.getLevel();w<e?y.classList.add("CTATSkillWindow--bar--nonmastered"):y.classList.add("CTATSkillWindow--bar--mastery");y.style.width=w>e?"100%":100*w+"%";v.appendChild(y);u.appendChild(v);b.appendChild(u);v=document.createElement("div");v.textContent=g.getDisplayName()||"no-name";v.classList.add("CTATSkillWindow--label");
u.appendChild(v)}d.innerHTML="";d.appendChild(b)}}}};CTATSkillWindow.prototype=Object.create(CTAT.Component.Base.Graphical.prototype);CTATSkillWindow.prototype.constructor=CTATSkillWindow;CTAT.ComponentRegistry.addComponentType("CTATSkillWindow",CTATSkillWindow);var CTATSubmitButton=function(b,g,f,e,c){CTATButton.call(this,b,g,f,e,c);this.setClassName("CTATSubmitButton");CTATConfiguration.get("previewMode");var a=this;this.logger=new CTATLogger(["submitbutton"]);this.log=a.logger.log;this.setParameterHandler("target_components",function(a){this.getDivWrap().setAttribute("data-ctat-target",a);return this});var d=this.init;this.init=function(){d();this.setParameter("tutorComponent",CTAT.Component.Base.Tutorable.Options.DO_NOT_TUTOR);this.component.addEventListener("focus",
this.processFocus)};var h=function(c){var b=a.getTargets();return 0===Object.keys(b).length?!1:c===a?!1:c instanceof CTAT.Component.Base.Tutorable?b.hasOwnProperty(c.getName())||b.hasOwnProperty(c.getComponentGroup()):c instanceof CTATSAI?c.getSelection()!=a.getName()&&b.hasOwnProperty(c.getSelection()):c instanceof String?c!=a.getName()&&b.hasOwnProperty(c):c instanceof Element?c!=a.getComponent()&&(b.hasOwnProperty(c.id)||b.hasOwnProperty(c.getAttribute("name"))):!1};b=CTAT.Component.Base.Tutorable.EventType;
document.addEventListener(b.correct,function(c){c.detail.sai&&h(c.detail.component)&&a.isNotGraded()&&a.setCorrect()},!1);document.addEventListener(b.incorrect,function(c){c.detail.sai&&h(c.detail.component)&&(a.setIncorrect(),a.setEnabled(!0))},!1);document.addEventListener(b.ungrade,function(c){(c=c.detail.component)&&h(c)&&a.setNotGraded()},!1);document.addEventListener(b.action,function(c){var b=c.detail.component;b&&h(b)&&!c.detail.graded&&(a.setNotGraded(),a.setEnabled(!0))},!1);document.addEventListener(b.highlight,
function(c){var b=c.detail.component;b&&h(b)&&a.setHintHighlight(c.detail.isHighlighted)},!1);this.getTargetsAsArray=function(){var c=a.getDivWrap();return(c=c&&c.getAttribute("data-ctat-target")||"")?String(c).split(/\s*[;,]\s*/):[]};this.getTargets=function(){var a={},c=this.getDivWrap().getAttribute("data-ctat-target");c&&String(c).split(/\s*[;,]\s*/).forEach(function(c){return a[c.trim()]=1});return a};this.processClick=function(c){if(!0===a.getEnabled()){c=a.startGroupTransaction();var b=a.getTargets(),
d;for(d in b)b=CTATShellTools.findComponent(d),null!==b&&0<b.length&&(b=b[0],b instanceof CTAT.Component.Base.Tutorable?b.getEnabled()&&b.grade(a):a.ctatdebug("Invalid target component: "+b));a.endGroupTransaction(c)}};this.startGroupTransaction=function(){var c=null,b=a.getDivWrap().getAttribute("data-ctat-group-feedback");a.log("submitbutton","startGroupTransaction groupFeedback",b);!b||/ *false */i.test(b)||/ *no */i.test(b)||(a.setAction("startGroupTransaction"),a.setInput(c=Date.now()),a.processAction(!0),
a.setIsBeingGraded(!1));return c};this.endGroupTransaction=function(c){a.log("submitbutton","endGroupTransaction timeStamp",c);Number.isInteger(c)&&(a.setAction("endGroupTransaction"),a.setInput(c),a.processAction(!0),a.setIsBeingGraded(!1))}};CTATSubmitButton.prototype=Object.create(CTATButtonBasedComponent.prototype);CTATSubmitButton.prototype.constructor=CTATSubmitButton;CTAT.ComponentRegistry.addComponentType("CTATSubmitButton",CTATSubmitButton);var CTATTable=function(b,g,f,e,c){CTAT.Component.Base.Tutorable.call(this,"CTATTable","__undefined__",b,g,f,e,c);var a=this,d=[],h=[],l=0;this.get_first_row_is_header=function(){return CTATGlobalFunctions.toBoolean($(this.getDivWrap()).attr("data-ctat-has-header"))};this.set_first_row_is_header=function(a){$(this.getDivWrap()).attr("data-ctat-has-header",a);this.get_first_row_is_header()?(q(),l=1):(u(),l=0)};this.setParameterHandler("FirstRowIsHeader",this.set_first_row_is_header);b=function(a){a=
parseInt($(this.getDivWrap()).attr(a));return isNaN(a)?2:a};var n=b.bind(this,"data-ctat-num-rows");this.get_row_count=n;this.set_row_count=function(a){$(this.getDivWrap()).attr("data-ctat-num-rows",a)};this.setNumRows=function(a){a=Number(a);if(!isNaN(a)){for(;this.get_row_count()<a;)this.addRow();for(;this.get_row_count()>a;)this.deleteRow()}};var p=b.bind(this,"data-ctat-num-cols");this.get_col_count=p;this.set_col_count=function(a){$(this.getDivWrap()).attr("data-ctat-num-cols",a)};this.setNumCols=
function(a){a=Number(a);if(!isNaN(a)){for(;this.get_col_count()<a;)this.addColumn();for(;this.get_col_count()>a;)this.deleteColumn()}};this.super_setName=this.setName;this.setName=function(a){this.super_setName(a);if(d&&d[0])for(var c=0;c<d.length;c++)for(var b=0;b<d[0].length;b++)d[c][b].setAttribute("id",a+".R"+c+"C"+b)};this.init=function(){a.ctatdebug("init ("+a.getName()+")");a.setInitialized(!0);var c=a.getDivWrap();a.setComponent(c);a.addComponentReference(a,c);a.render();a.ctatdebug("table name = "+
this.getName());this.adjustTableContents();this.get_first_row_is_header()?(q(),l=1):l=0};this.getConfigurationActions=function(){var a=[],c,b=$(this.getDivWrap());b.attr("data-ctat-num-rows")&&(c=new CTATSAI,c.setSelection(this.getName()),c.setAction("setNumRows"),c.setInput(b.attr("data-ctat-num-rows")),a.push(c));b.attr("data-ctat-num-cols")&&(c=new CTATSAI,c.setSelection(this.getName()),c.setAction("setNumCols"),c.setInput(b.attr("data-ctat-num-cols")),a.push(c));b.attr("data-ctat-has-header")&&
(c=new CTATSAI,c.setSelection(this.getName()),c.setAction("set_first_row_is_header"),c.setInput(b.attr("data-ctat-has-header")),a.push(c));return a};var q=function(){a.ctatdebug("fix_header()");h[0].classList.add("CTATTable--headers");for(var c=0;c<d[0].length;c++)d[0][c].classList.add("CTATTable--header")}.bind(this),u=function(){a.ctatdebug("remove_header()");h[0].classList.remove("CTATTable--headers");for(var c=0;c<d[0].length;c++)d[0][c].classList.remove("CTATTable--header")}.bind(this);this.fixHeader=
q;this.removeHeader=u;var v=function(a,c){var b=document.createElement("div");c=this.getName()+".R"+a+"C"+c;b.id=c;b.classList.add("CTATTable--cell");b.classList.add("CTATTextArea");a=new CTATTextArea;a.setName(c);a.setDivWrapper(b);(c=this.getTabIndex())&&a.setTabIndex(c);a.processAttributes();a.init(!0);a.processTabOrder();a.setEnabled(this.getEnabled());$(b).data("CTATComponent",a);return b}.bind(this);this.addRow=function(){var a=document.createElement("div");a.classList.add("CTATTable--row");
var c=n();parseInt(c,10);d[c]=[];for(var b=0;b<p();b++){var e=v(c,b);d[c].push(e);a.appendChild(e)}$(this.getDivWrap()).append(a);h.push(a);this.set_row_count(c+1)};this.deleteRow=function(){var a=this.getDivWrap();a.removeChild(a.lastChild);h.pop();d.pop();this.set_row_count(this.get_row_count()-1)};this.addColumn=function(){var a=p(),c=0;h.forEach(function(b){var e=v(c,a);d[c].push(e);c<l&&e.classList.add("CTATTable--header");b.appendChild(e);c++});this.set_col_count(a+1)};this.deleteColumn=function(){this.getDivWrap();
for(var a=h.length,c=0;c<a;c++)h[c].removeChild(h[c].lastChild),d[c].pop();this.set_col_count(this.get_col_count()-1)};this.adjustTableContents=function(){a.ctatdebug("adjustTableContents()");for(var c=n(),b=0;b<c;b++){var e=document.createElement("div");e.classList.add("CTATTable--row");$(this.getDivWrap()).append(e);h.push(e);for(var f=0;f<p();f++){var g=a.getName()+".R"+b+"C"+f,l=CTATShellTools.findComponent(g);l&&0!==l.length&&l[0].getName()===g?(g=l[0].getDivWrap(),g.classList.add("CTATTable--cell")):
g=v(b,f);e.appendChild(g);d[b]||(d[b]=[]);d[b].push(g)}}};this.SetFocus=function(c){if(a.getEnabled())for(var b=0;b<d.length;b++)for(var e=0;e<d[b].length;e++)if($(d[b][e]).data("CTATComponent").SetFocus(c))return!0;return!1}};CTATTable.prototype=Object.create(CTAT.Component.Base.Graphical.prototype);CTATTable.prototype.constructor=CTATTable;CTAT.ComponentRegistry.addComponentType("CTATTable",CTATTable);var CTATTextField=function(b,g,f,e,c){CTATTextBasedComponent.call(this,"CTATTextBasedComponent","__undefined__",b,g,f,e,c);var a=this,d=null,h,l,n=null;this.setAction("UpdateTextArea");this.init=function(){d=this.getDivWrap();a.setComponent(d);this.getText()&&(d.innerHTML=a.getText());var c=d.getAttribute("data-ctat-selectable");c&&"true"==c.toLowerCase()&&q();a.setInitialized(!0);a.addComponentReference(a,d);a.setEditable(!1);c=(c=d.getAttribute("data-ctat-enabled"))&&"true"==c.toLowerCase();a.setEnabled(c);
a.render();a.addSafeEventListener("focus",a.processFocus,d)};var p=this.setEnabled.bind(this);this.setEnabled=function(c){p(c);a.setEditable(!1)};var q=function(){[h,l].forEach(function(a,c){a=document.createElement("span");var b=document.createElement("div");c=0==c;a.className="ctattextfield-marker";a.id=c?"start-marker":"end-marker";b.className="handle";a.appendChild(b);c?(b.className+=" start-handle",h=a):(b.className+=" end-handle",l=a);a.addEventListener("click",function(a){a.stopPropagation()});
a.addEventListener("mouseup",function(a){a.stopPropagation()})});a.addSafeEventListener("mouseup",u,d)},u=function(c){if(a.getEnabled()){c=null;a.clearSelectionMarkers();if(window.getSelection){var b=window.getSelection();b.getRangeAt&&(c=b.getRangeAt(0))}else document.selection&&document.selection.createRange&&(c=document.selection.createRange());c&&!c.collapsed&&d.contains(c.startContainer)&&c.startContainer==c.endContainer?(n=c.startOffset+","+c.endOffset,a.processAction(),a.setSelectionMarkers(c)):
(n="0,0",a.processAction())}};this.setSelectionMarkers=function(a){a.insertNode(h);a.collapse(!1);a.insertNode(l)};this.clearSelectionMarkers=function(){h.parentNode&&h.parentNode.removeChild(h);l.parentNode&&l.parentNode.removeChild(l);d.normalize();n=null};this.getConfigurationActions=function(){return 0<d.innerHTML.trim().length?(console.log(d.innerHTML),this.setInput(d.innerHTML.toString()),[this.getSAI()]):[]};this.setText=function(c){a.ctatdebug("setText ("+c+")");a.assignText(c);null!==d&&
(d.innerHTML=c)};this.getValue=function(){var a=content=""+this.getDivWrap().innerHTML;n&&(content=content.replace(/<span.*?class="ctattextfield-marker".*?>.*?<\/span>/g,""),a=n+";"+content);return a};var v=this.updateSAI.bind(this);this.updateSAI=function(){n?a.setAction("TextSelected"):a.setAction("UpdateTextArea");v()};this.setStyleHandler("ShowScrollbars",function(c){!0===CTATGlobalFunctions.toBoolean(c)?a.modifyCSSAttribute("overflow","scroll"):a.modifyCSSAttribute("overflow","hidden")})};
CTATTextField.prototype=Object.create(CTATTextBasedComponent.prototype);CTATTextField.prototype.constructor=CTATTextField;CTAT.ComponentRegistry.addComponentType("CTATTextField",CTATTextField);var CTATTextInput=function(b,g,f,e,c){CTATTextBasedComponent.call(this,"CTATTextInput","__undefined__",b,g,f,e,c);var a=this,d=null,h=null,l=CTATConfiguration.get("previewMode");this.init=function(){this.ctatdebug("init ("+a.getName()+")");var c=$(this.getDivWrap());a.trackSelection=/true/i.test(c.attr("data-ctat-track-selection"));var e=c.attr("data-ctat-type");d=document.createElement("input");d.type="number"==e?"number":"text";b&&(d.name=b.name);d.setAttribute("maxlength",a.getMaxCharacters());
d.setAttribute("id",CTATGlobalFunctions.gensym.div_id());a.setComponent(d);a.disableTextAlterations(d);this.ctatdebug("Final location: "+a.getX()+","+a.getY()+" with text: "+a.getText());c.attr("value")&&this.setText(c.attr("value"));var f=$(d);"autofocus defaultValue maxLength pattern placeholder readOnly size title".split(" ").forEach(function(a){var b=c.attr(a);b&&f.attr(a,b)});a.setInitialized(!0);a.addComponentReference(a,d);a.getDivWrap().appendChild(d);a.addSafeEventListener("keydown",a.processKeydown,
d);a.addSafeEventListener("focus",a.processFocus,d);a.addSafeEventListener("select",a.processSelect,d);$(d).on("input",function(c){a.setNotGraded()});l&&this.addEventScreen(!1)};this.getConfigurationActions=function(){var c=[],b=$(this.getDivWrap());if(b.attr("value")){var d=new CTATSAI;d.setSelection(this.getName());d.setAction(a.DEFAULT_ACTION);d.setInput(b.attr("value"));c.push(d)}return c};this.setCellContainer=function(a){h=a};this.getCellContainer=function(){return h};this.setText=function(c){a.ctatdebug("setText ("+
c+")");a.assignText(c);d.value=c};this.getValue=function(){return d.value};this.reset=function(){a.configFromDescription();a.processSerialization();d.value=""};this.setStyleHandler("DrawBorder",null)};CTATTextInput.prototype=Object.create(CTATTextBasedComponent.prototype);CTATTextInput.prototype.constructor=CTATTextInput;CTAT.ComponentRegistry.addComponentType("CTATTextInput",CTATTextInput);var CTATVideo=function(b,g,f,e,c){CTAT.Component.Base.Tutorable.call(this,"CTATVideo","__undefined__",b,g,f,e,c);var a=0,d=this,h=null;this.getAlpha=function(){return a};this.setAlpha=function(c){a=c};this.ctatdebug(this.getClassName()+" ("+this.getX()+","+this.getY()+","+this.getWidth()+","+this.getHeight()+")");this.setTutorComponent(CTAT.Component.Base.Tutorable.Options.TutorComponent.DO_NOT_TUTOR);this.configFromDescription();this.init=function(){d.ctatdebug("init ("+d.getName()+")");d.addCSSAttribute("z-index",
CTATGlobalFunctions.gensym.z_index());h=document.createElement("video");this.getDivWrap()&&$(this.getDivWrap()).attr("src")&&!CTATConfiguration.get("previewMode")&&(h.src=$(this.getDivWrap()).attr("src"));this.getDivWrap()&&$(d.getDivWrap()).attr("data-ctat-controls")?h.controls=CTATGlobalFunctions.toBoolean($(this.getDivWrap()).attr("data-ctat-controls")):h.controls=!0;h.autocontrols=!1;d.ctatdebug("Auto play: "+$(d.getDivWrap()).attr("data-ctat-autoplay"));this.getDivWrap()&&$(d.getDivWrap()).attr("data-ctat-autoplay")?
h.autoplay=CTATGlobalFunctions.toBoolean($(this.getDivWrap()).attr("data-ctat-autoplay")):h.autoplay=!0;d.setComponent(h);h.name=d.getName();h.setAttribute("id",CTATGlobalFunctions.gensym.div_id());h.setAttribute("onkeypress","return noenter(event)");d.addComponentReference(d,h);d.ctatdebug("Final location: "+d.getX()+","+d.getY()+" with text: "+d.getText());d.setInitialized(!0);d.getDivWrap().appendChild(h);d.ctatdebug("Resizing component to: "+$(d.getDivWrap()).width()+","+$(d.getDivWrap()).height());
h.addEventListener("focus",this.processFocus);h.addEventListener("canplay",function(){d.ctatdebug("Video loaded and ready for play");d.sizeToDiv()},!0);h.addEventListener("play",function(){d.ctatdebug("Video loaded and ready for play");d.logVideoEvent("play")},!0);h.addEventListener("pause",function(){d.ctatdebug("Video loaded and ready for play");d.logVideoEvent("pause")},!0);d.sizeToDiv()};this.sizeToDiv=function(){h&&(h.setAttribute("width",$(d.getDivWrap()).width()),h.setAttribute("height",$(d.getDivWrap()).height()))};
var l=this.render;this.render=function(){l.call(this);this.sizeToDiv()};this.getConfigurationActions=function(){var a=[],c;$(d.getDivWrap()).attr("data-ctat-controls")&&(c=new CTATSAI,c.setSelection(this.getName()),c.setAction("showControls"),c.setInput($(d.getDivWrap()).attr("data-ctat-controls")),a.push(c));$(d.getDivWrap()).attr("data-ctat-autoplay")&&(c=new CTATSAI,c.setSelection(this.getName()),c.setAction("setAutoplay"),c.setInput($(d.getDivWrap()).attr("data-ctat-autoplay")),a.push(c));$(this.getDivWrap()).attr("src")&&
(c=new CTATSAI,c.setSelection(this.getName()),c.setAction("setURL"),c.setInput($(this.getDivWrap()).attr("src")),a.push(c));return a};this.logVideoEvent=function(a){d.ctatdebug("logVideoEvent ("+a+")");if(void 0!==h.duration)if(null!==CTATCommShell.commShell){a=new CTATSAI(d.getName(),a,d.toHHMMSS(h.currentTime)+".000","");a.addSelection(encodeURIComponent(h.currentSrc),"media_file");a.addSelection(d.toHHMMSS(h.duration)+".000","clip_length");var c=a.getInputObject();null!==c&&c.setType("time");CTATCommShell.commShell.processComponentAction(a,
d.getTutorComponent(),!0,d,"VIDEO_ACTION","USER")}else d.ctatdebug("Error: commShell is null, can't send untutored tool message");else d.ctatdebug("Error: audio file not loaded yet, can't obtain duration")};this.PlayMedia=function(a){h.src=a};this.showControls=function(a){a=CTATGlobalFunctions.toBoolean(a);$(d.getDivWrap()).attr("data-ctat-controls",a);h.controls=a};this.setAutoplay=function(a){a=CTATGlobalFunctions.toBoolean(a);$(d.getDivWrap()).attr("data-ctat-autoplay",a);h.autoplay=a};this.setURL=
function(a){$(this.getDivWrap()).attr("src",a);h.src=a};this.play=function(a){d.ctatdebug("play ()");var c="0";a&&(c="number"===typeof a?String(a):"string"===typeof a?a:"0");h.currentTime=c;h.play()};this.pause=function(a){d.ctatdebug("pause ()");h.pause();var c="0";a&&(c="number"===typeof a?String(a):"string"===typeof a?a:"0");h.currentTime=c};this.stop=function(){d.ctatdebug("stop ()");d.pause()}};CTATVideo.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);
CTATVideo.prototype.constructor=CTATVideo;CTAT.ComponentRegistry.addComponentType("CTATVideo",CTATVideo);var CTATAssistments={},assistmentsTimerVar,assistmentsJSONpreface='{ "version" : "AS.1", "action" : ';function iframeToParent(b){window.parent.postMessage(b,"https://test1.assistments.org")}function iframeLoaded(){iframeToParent(assistmentsJSONpreface+'"loaded" }');assistmentsTimerVar=window.setInterval("iframeHeartbeat()",1E4)}function iframeHeartbeat(){iframeToParent(assistmentsJSONpreface+'"heartbeat"}')}
function iframeCompleted(){var b=document.getElementById("MyScore").value;iframeToParent(assistmentsJSONpreface+'"completed", "answer" : "<b>Student worked hard on this problem.</b>","score" : '+b+" }");window.clearTimeout(assistmentsTimerVar)};var CTATEnabledInPreview={},ctatEnabledInPreview={CTATButton:!0,CTATComboBox:!0,CTATAudioButton:!0,CTATImageButton:!0,CTATSubmitButton:!0,CTATTextArea:!0,CTATTextInput:!0,CTATNumericStepper:!0,CTATTable:!0,CTATHintButton:!0,CTATDoneButton:!0};var CTATTutor={drawing:!1,onMobile:!1,tutorInitialized:!1,flashVars:null};Object.defineProperty(CTATTutor,"parser",{get:function(){this._parser||(CTATConfig.parserType_is_XML()?(ctatdebug("Creating XML parser ..."),this._parser=new CTATXML):CTATConfig.parserType_is_JSON()&&(this._parser=new CTATJSON));return this._parser}});
CTATTutor.removeComponent=function(b){var g=[],f=CTATShellTools.findComponent(b);console.log("CTATTutor.removeComponent("+b+") cList",f);if(!b||!f)return g;for(var e=b=null,e=null,c=0;c<f.length;++c)if(b=f[c]){console.log("CTATTutor.removeComponent()[",c,"] ",b.getName&&b.getName(),b);(b.getComponentList?b.getComponentList():[]).forEach(function(a){CTATTutor.removeComponent(a.getName?a.getName():"")});if(e=b.getName&&b.getName())delete CTATShellTools.component_descriptions[e],g.push(e);if(e=b.getDivWrap&&
b.getDivWrap())b.setDivWrapper(null),$(e).data("CTATComponent",null),$(e).remove();console.log("CTATTutor.removeComponent()[",c,"] divWrap",e)}return g};
CTATTutor.initializeHTMLComponent=function(b,g){var f=CTAT.ComponentRegistry[g];if(g=$(b).data("CTATComponent"))return g;g=new f;$(b).attr("id")?g.setName($(b).attr("id")):(b.setAttribute("id",CTATGlobalFunctions.gensym.div_id()),g.setName(b.getAttribute("id")));g.setDivWrapper(b);g.processAttributes();g.init();g.processTabOrder();g.setEnabled(g.getEnabled());0==g.isFeedbackComponent()&&(f=new CTATComponentDescription,f.type=g.getClassName(),f.name=g.getName(),f.setComponentPointer(g),CTATShellTools.registerComponentDescription(f));
$(b).data("CTATComponent",g);CTATConfiguration.get("previewMode")&&(b=g.getDivWrap().getAttribute("data-ctat-enabled"),(f=ctatEnabledInPreview[g.getClassName()])||(f=!1),g.setEnabled(f),g.getDivWrap().setAttribute("data-ctat-enabled",b));return g};CTATTutor.initializeHTMLComponents=function(){for(var b in CTAT.ComponentRegistry)$("."+b).each(function(){$(this).data("CTATComponent")||CTATTutor.initializeHTMLComponent(this,b)});CTATShellTools.listComponents();ctatdebug("initializeHTMLComponents () done")};
var CTATComponentMutObserver=new MutationObserver(function(b,g){b.forEach(function(b){if(b.addedNodes){b=b.addedNodes;for(var e=b.length,c=0;c<e;c++){var a=b[c];if(a.nodeType===Node.ELEMENT_NODE){a.childNodes&&(b=Array.prototype.concat.call(b,Array.from(a.childNodes)));for(var e=b.length,d=/(CTAT[A-z]*)(\s|$)/g;ctatClass=d.exec(a.className);)if(CTAT.ComponentRegistry[ctatClass[1]]){CTATComponentMutObserver.disconnect();CTATTutor.initializeHTMLComponent(a,ctatClass[1]);CTATComponentMutObserver.observe(document.body,
{childList:!0,subtree:!0});break}}}}})});function addMutObserver(){console.log("adding ctatcomponent mutation observer");CTATComponentMutObserver.observe(document.body,{childList:!0,subtree:!0})}"loading"!==document.readyState?addMutObserver():document.addEventListener("DOMContentLoaded",addMutObserver);CTATTutor.callComponentFunction=function(b,g,f){if((b=CTATShellTools.findComponent(b.id))&&0<b.length){b=b[0];var e=null;g&&(e=g(b,f));return e}};
function assignNameTranslator(b){nameTranslator=b}CTATTutor.drawTutor=function(){if(!0!==this.drawing){this.drawing=!0;for(var b in CTATShellTools.component_descriptions){var g=CTATShellTools.component_descriptions[b].getComponentPointer();null!==g&&g.drawComponent()}this.drawing=!1}};
CTATTutor.initialize=function(){var b=navigator.userAgent.toLowerCase();0<b.search("iphone")?CTATTutor.onMobile=!0:0<b.search("ipod")?CTATTutor.onMobile=!0:0<b.search("android")&&(CTATTutor.onMobile=!0);b=getSafeElementById("pageor");null!==b&&!1===CTATTutor.onMobile&&(b.style.display="none");ctatdebug("initialize ()");this.initializeHTMLComponents();flashVars.getRawFlashVars();b=!0;CTATConfiguration.get("previewMode")&&(ctatdebug("In preview mode..."),b=!1);1==b?(CTATCommShell.commShell=new CTATCommShell,
CTATCommShell.commShell.init(CTATTutor)):CTATScrim.scrim.scrimDown()};
CTATTutor.createInterface=function(){ctatdebug("createInterface ("+Object.keys(CTATShellTools.component_descriptions).length+")");if(1==CTATGlobals.ignoreInterfaceDescriptions)ctatdebug("No need to process interface description messages, the interface should already be ready."),this.postProcess(),this.drawTutor();else{if(CTATGlobals.interfaceElement){ctatdebug("Re-creating interface ...");var b=CTATTutor.parser.getElementChildren(CTATGlobals.interfaceElement);CTATTutor.createStaticInterface(null,
b,null)}for(var g in CTATShellTools.component_descriptions){b=CTATShellTools.component_descriptions[g];if(!b){alert("Internal error parsing component at index "+g);return}if(!b.name){alert("Internal error parsing component at index "+g+" (no name attribute available)");return}if(-1==b.name.indexOf("null."))if(ctatdebug("Component: "+b.name+", type: "+b.type),"CTATCommShell"==b.type){if(CTATCommShell.commShell&&CTATCommShell.commShell.setName(b.name),"CTATCommShell"==b.type){ctatdebug("Tutor dimensions: "+
b.width+"x"+b.height);var f=getSafeElementById(ctatcontainer);null!==f?(ctatdebug("Setting canvas dimensions from: "+f.width+"px, "+f.height+"px, to: "+b.width+"px, "+b.height+"px"),f.width=b.width,f.height=b.height,f.style.width=b.width,f.style.height=b.height,ctatdebug("Canvas dimensions now: "+f.width+"px, "+f.height+"px")):ctatdebug("Error: tutor canvas is null, can't adjust size");f=getSafeElementById(ctatcontainer);null!==f?(f.style.width=b.width+"px",f.style.height=b.height+"px"):ctatdebug("Error: tutor container is null, can't adjust size")}}else CTAT.ComponentRegistry.hasOwnProperty(b.type)?
(ctatdebug("Creating ("+b.type+") :"+b.name),f=new CTAT.ComponentRegistry[b.type](b,b.x,b.y,b.width,b.height),f.setName(b.name),"CTATTextInput"!=b.type&&"CTATTextArea"!=b.type||f.setEnabled(!0),f.setTabIndex(b.tabIndex),b.setComponentPointer(f),f.initialize(),ctatdebug(f.getDivWrap())):ctatdebug("ERROR: Unrecognized component type "+b.type+" for "+b.name)}this.postProcess();this.drawTutor();ctatdebug("Tutor has been intialized from BRD, recalculating canvas position and size ...")}};
CTATTutor.postProcess=function(){ctatdebug("postProcess ()");for(var b in CTATShellTools.component_descriptions){var g=CTATShellTools.component_descriptions[b].getComponentPointer();null!==g?(g.getClassName(),g.postProcess&&g.postProcess()):ctatdebug("Error: component pointer "+b+" is null")}};
CTATTutor.createStaticInterface=function(b,g,f){ctatdebug("createStaticInterface ()");var e=getSafeElementById(ctatcontainer);null!==b&&(e=b);for(b=0;b<g.length;b++){var c=g[b];ctatdebug(this.parser.getElementName(c));if("timeline"==this.parser.getElementName(c)){ctatdebug("Timeline node found, obtaining visual elements ...");g=this.parser.getElementChildren(c);this.createStaticInterface(null,g,null);break}if("ctatcomponent"==this.parser.getElementName(c)){var a=this.parser.getElementAttr("instance");
f&&(ctatdebug("Registering existence of CTAT component on MovieClip container: "+a),f.addComponent(a))}var d,h,l,n;"shape"==this.parser.getElementName(c)&&(d=this.parser.getElementAttr(c,"x"),h=this.parser.getElementAttr(c,"y"),l=this.parser.getElementAttr(c,"width"),n=this.parser.getElementAttr(c,"height"),a=this.parser.getElementAttr(c,"instance"),ctatdebug("Creating shape: "+a+" at: "+d+","+h+","+l+","+n),l="data:image/png;base64, "+this.parser.getNodeTextValue(c),n=new Image,n.setAttribute("style",
"position: absolute; top: "+h+"px; left:"+d+"px; z-index:"+CTATGlobalFunctions.gensym.z_index()+";"),n.setAttribute("id",a),n.setAttribute("src",l),e.appendChild(n));"statictext"==this.parser.getElementName(c)&&(d=this.parser.getElementAttr(c,"x"),h=this.parser.getElementAttr(c,"y"),l=this.parser.getElementAttr(c,"width"),n=this.parser.getElementAttr(c,"height"),a=this.parser.getElementAttr(c,"instance"),ctatdebug("Creating static text: "+a+" at: "+d+","+h+","+l+","+n),l="data:image/png;base64, "+
this.parser.getNodeTextValue(c),n=new Image,n.setAttribute("style","position: absolute; top: "+h+"px; left:"+d+"px; z-index:"+CTATGlobalFunctions.gensym.z_index()+";"),n.setAttribute("id",a),n.setAttribute("src",l),e.appendChild(n));"statictext"==this.parser.getElementName(c)&&(a=this.parser.getElementAttr("instance"),ctatdebug("Creating movieclip: "+a),d=this.parser.getElementAttr(c,"x"),h=this.parser.getElementAttr(c,"y"),l=this.parser.getElementAttr(c,"width"),n=this.parser.getElementAttr(c,"height"),
d=new CTATMovieClip(a,d,h,l,n),h=d.wrapComponent(e),ctatdebug("Created movieclip: "+a+" at: "+d.x+","+d.y+","+d.width+","+d.height),movieclips.push(d),c=this.parser.getElementChildren(c),this.createStaticInterface(h,c,d))}};
CTATTutor.runTutor=function(){ctatdebug("runTutor ()");!0===CTATGlobals.tutorRunning?ctatdebug("The tutor is already running"):(null==CTATSkillSet.skills&&(CTATSkillSet.skills=new CTATSkillSet),window.onerror=function(b,g,f){var e=new CTATHTMLManager;ctatdebug(e.htmlEncode(b)+" in "+g+", line "+f);ctatdebug(e.htmlEncode(b)+" in "+g+", line "+f)},centerTutorContainer(),CTATTutor.initialize(),CTATGlobals.tutorRunning=!0,ctatdebug("runTutor () ... all set"))};var idleTime=0;
CTATTutor.setIdleTimeout=function(){setInterval(CTATTutor.timerIncrement,6E4);$(document).mousemove(function(b){idleTime=0});$(document).keypress(function(b){idleTime=0})};
CTATTutor.timerIncrement=function(){if(!(0>idleTime)){var b=1140,g=CTATConfiguration.get("session_timeout");if(g&&!isNaN(g))b=parseInt(g)+60;else if(!CTATLMS.identifier||0>parseInt(CTATLMS.identifier))b=1E20;idleTime+=60;idleTime>b&&(idleTime=-1,CTATScrim.scrim.OKScrimUp("The tutor timed out due to inactivity, click 'Ok' to reload the page.",function(){window.location.reload()}))}};
CTATTutor.initTutor=function(b,g,f,e){ctatdebug("initTutor() aFlashVars "+typeof b+", usingFlash "+e);if(1==CTATTutor.tutorInitialized)ctatdebug("Tutor already initialized, probably in author mode"),"undefined"!=typeof b&&b.previewMode&&(CTATScrim.scrim.scrimDown(),ctatdebug("In preview mode..."));else{CTATConfiguration.generateDefaultConfigurationObject(b,"undefined"==typeof CTATTarget?void 0:CTATTarget);switch(CTATConfiguration.get("show_debug_traces")){case "true":case "basic":useDebuggingBasic=
!0;break;case "on":case "full":useDebugging=!0;break;case "false":case "off":useDebuggingBasic=useDebugging=!1;break;default:useDebuggingBasic=!0}null==e&&(e=CTATConfiguration.usingFlash());e&&CTATScrim.scrim.scrimDown();CTATCommLibrary.setAuthenticityToken(CTATConfiguration.get("authenticity_token"));g&&(ctatcontainer=g);(b=document.getElementById(ctatcontainer))&&b.classList.add("CTATTutorContainer");b=getSafeElementById("debugtraces");null!==b&&(useDebugging=!0===b.checked?!0:!1);ctatdebug("initTutor() CTATConfiguration.get('mode')="+
CTATConfiguration.get("mode")+", window.sendToTutor="+window.sendToTutor);CTATConfiguration.get("swf_name")&&!window.sendToTutor&&(window.sendToTutor=function(c){ctatdebug("window.sendToTutor("+c+") CTAT.ToolTutor.tutor "+CTAT.ToolTutor.tutor);return CTAT.ToolTutor.tutor?CTAT.ToolTutor.tutor.receiveFromInterface(c):CTAT.ToolTutor.tutorMessages.push(c)},window.registerInterface=function(c){CTAT.ToolTutor.registerInterfaceMessageHandler(c)});"javascript"==String(CTATConfiguration.get("tutoring_service_communication")).toLowerCase()&&
("undefined"!=typeof CTATExampleTracer&&CTATExampleTracer?CTAT.ToolTutor.registerTutor(new CTATExampleTracer):CTATScrim.scrim.warningScrimUp('Tutoring service communication parameter is "JavaScript" but class\nCTATExampleTracer is missing. Use a different ctat-*.js script.'));ctatdebug("initTutor ()");"applet"==CTATConfiguration.get("tutoring_service_communication")&&deployJava.runApplet({id:"TSApplet",width:150,height:10},{jnlp_href:"/ctat_applet/TSApplet.jnlp"},"1.6");e||CTATTutor.runTutor();CTATTutor.setIdleTimeout();
CTATTutor.tutorInitialized=!0;document&&"function"==typeof document.dispatchEvent&&(e={student_interface:CTATConfiguration.get("student_interface"),question_file:CTATConfiguration.get("question_file")},"function"==typeof parent.postMessage&&location.origin&&!CTATConfiguration.get("editorMode")&&parent.postMessage({command:"tutorInitialized",id:CTATCommLibrary.makeTeamID(),data:e},location.origin),document.dispatchEvent(new CustomEvent("tutorInitialized",{detail:e})))}};
window.hasOwnProperty("initTutor")||(window.initTutor=CTATTutor.initTutor);function receiveFromTutor(){ctatdebug("receiveFromTutor ()")}function saveAndQuit(){ctatdebug("saveAndQuit ()")}function prepTutorArea(){initTutor()}window.prepTutorArea=prepTutorArea;function assignAnonymousGradingProcessor(b){CTATCommShell.commShell.assignAnonymousGradingProcessor(b)}
function gradeAnonymousComponent(b,g,f){ctatdebug("gradeAnonymousComponent ()");b=new CTATSAI(b,g,f);CTATCommShell.commShell.processComponentAction(b)}function testTutor(b){ctatdebug("testTutor ()");window.onerror=function(b,f,e){var c=new CTATHTMLManager;ctatdebug(c.htmlEncode(b)+" in "+f+", line "+e)};null==CTATSkillSet.skills&&(CTATSkillSet.skills=new CTATSkillSet);(new CTATCommLibrary).send("http://augustus.pslc.cs.cmu.edu/crossdomain.xml")}
function centerTutorContainer(){ctatdebug("centerTutorContainer ()");var b=getSafeElementById(ctatcontainer);if(null==b)ctatdebug("Tutor container not found, bump");else{var g;if(flashVars){g=flashVars.getRawFlashVars();var f,e;f=b.offsetWidth;e=b.offsetHeight;g&&g.width&&g.height&&(ctatdebug("We have raw width and height variables in our flashvars: "+g.width+","+g.height),f=g.width,e=g.height);g.centerTutor?1==g.centerTutor&&(ctatdebug("Moving tutor over by: "+("-"+Number(f/2)+"px 0 0 -"+Number(e/
2)+"px;")),b.style.position="absolute",b.style.top="0",b.style.left="0",b.style.right="0",b.style.bottom="0",b.style.margin="auto"):ctatdebug("The tutor is not configured to center the container, bump")}else ctatdebug("No flashvars yet, bump")}}
function checkTutorCanvas(){ctatdebug("checkTutorCanvas ()");var b=getSafeElementById(ctatcontainer),g=getSafeElementById("main-canvas"),f=flashVars.getRawFlashVars(),e="550",c="450";b&&(ctatdebug("Recording the actual CSS width and height: "+b.offsetWidth+" , "+b.offsetHeight),e=b.offsetWidth,c=b.offsetHeight);f&&f.width&&f.height&&(ctatdebug("We have tutor size flashvars, using those instead: "+f.width+" , "+f.height),e=f.width,c=f.height);null===g?(ctatdebug("No canvas available, creating ..."),
g=document.createElement("canvas"),g.id="main-canvas",g.innerHTML="Your browser does not support CTAT. Please update or use another browser.",ctatdebug("Setting canvas to: 0,0,"+e+" , "+c),getSafeElementById(ctatcontainer).appendChild(g)):(ctatdebug("Setting canvas to: 0 , 0, "+e+" , "+c),g.style.top="0",g.style.left="0");g.style.width=e+"px";g.style.height=c+"px";return g};!function(b,g){"object"==typeof exports&&"undefined"!=typeof module?module.exports=g():"function"==typeof define&&define.amd?define(g):b.lifecycle=g()}(this,function(){var b=void 0;try{new EventTarget,b=!1}catch(w){b=!1}var g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},f=function(a,c){if(!(a instanceof c))throw new TypeError("Cannot call a class as a function");
},e=function(){function a(a,c){for(var b=0;b<c.length;b++){var d=c[b];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(c,b,d){return b&&a(c.prototype,b),d&&a(c,d),c}}(),c=function(a,c){if("function"!=typeof c&&null!==c)throw new TypeError("Super expression must either be null or a function, not "+typeof c);a.prototype=Object.create(c&&c.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});c&&(Object.setPrototypeOf?
Object.setPrototypeOf(a,c):a.__proto__=c)},a=function(a,c){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!c||"object"!=typeof c&&"function"!=typeof c?a:c},d=function(){function a(){f(this,a);this._registry={}}return e(a,[{key:"addEventListener",value:function(a,c){this._getRegistry(a).push(c)}},{key:"removeEventListener",value:function(a,c){a=this._getRegistry(a);c=a.indexOf(c);-1<c&&a.splice(c,1)}},{key:"dispatchEvent",value:function(a){return a.target=
this,Object.freeze(a),this._getRegistry(a.type).forEach(function(c){return c(a)}),!0}},{key:"_getRegistry",value:function(a){return this._registry[a]=this._registry[a]||[]}}]),a}(),h=b?EventTarget:d,l=b?Event:function A(a){f(this,A);this.type=a},n=function(b){function d(c,b){f(this,d);c=a(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,c));return c.newState=b.newState,c.oldState=b.oldState,c.originalEvent=b.originalEvent,c}return c(d,l),d}(),p="object"===("undefined"==typeof safari?"undefined":
g(safari))&&safari.pushNotification,q=["focus","blur","visibilitychange","freeze","resume","pageshow","onpageshow"in self?"pagehide":"unload"],u=function(a){return a.preventDefault(),a.returnValue="Are you sure?"},v=[["active","passive","hidden","terminated"],["active","passive","hidden","frozen"],["hidden","passive","active"],["frozen","hidden"],["frozen","active"],["frozen","passive"]].map(function(a){return a.reduce(function(a,c,b){return a[c]=b,a},{})}),y=function(){return"hidden"===document.visibilityState?
"hidden":document.hasFocus()?"active":"passive"};return new (function(b){function d(){f(this,d);var c=a(this,(d.__proto__||Object.getPrototypeOf(d)).call(this)),b=y();return c._state=b,c._unsavedChanges=[],c._handleEvents=c._handleEvents.bind(c),q.forEach(function(a){return addEventListener(a,c._handleEvents,!0)}),p&&addEventListener("beforeunload",function(a){c._safariBeforeUnloadTimeout=setTimeout(function(){a.defaultPrevented||0<a.returnValue.length||c._dispatchChangesIfNeeded(a,"hidden")},0)}),
c}return c(d,h),e(d,[{key:"addUnsavedChanges",value:function(a){-1< !this._unsavedChanges.indexOf(a)&&(0===this._unsavedChanges.length&&addEventListener("beforeunload",u),this._unsavedChanges.push(a))}},{key:"removeUnsavedChanges",value:function(a){a=this._unsavedChanges.indexOf(a);-1<a&&(this._unsavedChanges.splice(a,1),0===this._unsavedChanges.length&&removeEventListener("beforeunload",u))}},{key:"_dispatchChangesIfNeeded",value:function(a,c){if(c!==this._state){a:{for(var b=this._state,d,e=0;d=
v[e];++e){var f=d[b],g=d[c];if(0<=f&&0<=g&&g>f){c=Object.keys(d).slice(f,g+1);break a}}c=[]}for(b=0;b<c.length-1;++b)d=c[b],this._state=e=c[b+1],this.dispatchEvent(new n("statechange",{oldState:d,newState:e,originalEvent:a}))}}},{key:"_handleEvents",value:function(a){switch(p&&clearTimeout(this._safariBeforeUnloadTimeout),a.type){case "pageshow":case "resume":this._dispatchChangesIfNeeded(a,y());break;case "focus":this._dispatchChangesIfNeeded(a,"active");break;case "blur":"active"===this._state&&
this._dispatchChangesIfNeeded(a,y());break;case "pagehide":case "unload":this._dispatchChangesIfNeeded(a,a.persisted?"frozen":"terminated");break;case "visibilitychange":"frozen"!==this._state&&"terminated"!==this._state&&this._dispatchChangesIfNeeded(a,y());break;case "freeze":this._dispatchChangesIfNeeded(a,"frozen")}}},{key:"state",get:function(){return this._state}},{key:"pageWasDiscarded",get:function(){return document.wasDiscarded||!1}}]),d}())});var CTATVariableTableCount=0,CTATVariableTable=function(){function b(e){var c={},a;for(a in e)!0===e.hasOwnProperty(a)&&(c[a]="object"!==typeof e[a]?e[a]:b(e[a]));return c}CTATBase.call(this,"CTATVariableTable","");CTATVariableTableCount++;var g={},f=this;this.toString=function(){var b="",c;for(c in g)0<b.length&&(b+=", "),b=b+c+"="+g[c];return"{ "+b+" }"};this.clone=function(){ctatdebug("CTATVariableTable --\x3e in clone; this "+this+", this.getTable() "+this.getTable);var e=new CTATVariableTable;
ctatdebug("CTATVariableTable --\x3e in clone; copy "+e+", copy.setTable() "+e.setTable);e.setTable(b(g));ctatdebug("CTATVariableTable --\x3e out of clone");return e};this.put=function(b,c){f.ctatdebug("CTATVariableTable.put("+b+", "+c+") typeof value "+typeof c);if(b)if(0>b.indexOf("."))g[b]=c;else{var a=b.split(".");if("object"!==typeof g[a[0]]||null===g[a[0]])g[a[0]]={};b=g[a[0]];for(var d=1;d<a.length-1;d++)if("object"!==typeof b[a[d]]||null===b[a[d]])b[a[d]]={},b=b[a[d]];b[a[d]]=c}else console.log("CTATVariableTable.put() warning: null or empty variable name '"+
b+"'");return f};this.getTable=function(){return g};this.setTable=function(b){g=b};this.get=function(b){if(0>b.indexOf("."))return null===g[b]||"undefined"===typeof g[b]?null:g[b];var c=b.split(".");if(null===g[c[0]]||"undefined"===typeof g[c[0]])return null;b=g[c[0]];for(var a=1;a<c.length-1;a++){if(null===b[c[a]]||"undefined"===typeof b[c[a]])return null;b=b[c[a]]}return null===b[c[a]]||"undefined"===typeof b[c[a]]?null:b[c[a]]}};
Object.defineProperty(CTATVariableTable,"serialVersionUID",{enumerable:!1,configurable:!1,writable:!1,value:"201403071830L"});CTATVariableTable.standardizeType=function(b){if("string"!=typeof b||1>b.trim().length)return b;if((!0).toString()==b)return!0;if((!1).toString()==b)return!1;if("null"==b)return null;var g=Number(b);return isNaN(g)?b:g};CTATVariableTable.valueAsString=function(b){return"string"==typeof b?b:String(b)};CTATVariableTable.nameAsString=function(b){return b?b+"_String":null};
CTATVariableTable.prototype=Object.create(CTATBase.prototype);CTATVariableTable.prototype.constructor=CTATVariableTable;"undefined"!==typeof module&&(module.exports=CTATVariableTable);var CTATInterfaceDescriptions=function(b){CTATBase.call(this,"CTATInterfaceDescriptions",b?String(b.length):"");var g=this;this.logger=new CTATLogger(["tracervars"]);this.log=g.logger.log;var f=new Map;Array.isArray(b)&&b.forEach(function(b,c){return b&&b.commName?g.name2Desc.set(b.commName,b):console.log("CTATInterfaceDescriptions: descList["+c+"]: null desc or commName)",b)});this.get=function(b){return f.get(b)};this.getAction=function(b){return(b=g.get(b))?b.action:null};this.size=function(){return f.size};
this.parseXML=function(b,c){c||(c=new CTATXML);var a=null;try{a=c.getElementChildren(b),/^messages$/i.test(c.getElementName(a[0]))&&(a=c.getElementChildren(a[0]))}catch(d){console.error("CTATInterfaceDescriptions.parseXML() error parsing interface descriptions",d);return}a.forEach(function(a,c){try{var b=new CTATMessage(a);g.log("tracervars","msgs["+c+"]",a.outerHTML,b.getMessageType());switch(b.getMessageType()){case "InterfaceDescription":var d=b.getProperty("CommName");if(!d)throw Error("no CommName");
f.set(d,{selection:d,action:b.getProperty("Action"),type:b.getProperty("WidgetType")});break;case "InterfaceAction":var e=f.get(b.getSelection());e&&(e.configAction=b.getAction(),e.configInput=b.getInput())}}catch(q){console.error("CTATInterfaceDescriptions.parseXML() error on element",c,":",q,a.outerHTML)}});return g};this.toString=function(){return f.toString()}};
CTATInterfaceDescriptions.updateVariableTable=function(b,g,f,e,c){if(null!=g&&0<g.length){c&&c.getAction(g)!=f||(b.put(g,CTATVariableTable.standardizeType(e)),b.put(CTATVariableTable.nameAsString(g),CTATVariableTable.valueAsString(e)));g=String(g)+"_State";c=b.get(g)||{};c[f]=CTATVariableTable.standardizeType(e);b.put(g,c);g=CTATVariableTable.nameAsString(g);var a=b.get(g)||{};a[f]=CTATVariableTable.valueAsString(e);b.put(g,a);return c}};CTATInterfaceDescriptions.prototype=Object.create(CTATBase.prototype);
CTATInterfaceDescriptions.prototype.constructor=CTATInterfaceDescriptions;"undefined"!==typeof module&&(module.exports=CTATInterfaceDescriptions);var CTATNoolsTracerUtil=function(){var b={},g=/^(?:[a-z]+:\/)?\//i;this.setTypes=function(f,e){console.log("setTypes()");e.forEach(function(c){b[c]=f.getDefined(c);b[c]?console.log("set type "+c):console.log("couldn't get "+c)})};this.getFactType=function(f){var e=typeof f;if("object"===e)if(e=null,f instanceof Array)e="Array";else if(f instanceof RegExp)e="RegExp";else if(f instanceof Date)e="Date";else for(t in b)if(b.hasOwnProperty(t)&&b[t]===f.constructor){e=t;break}return e};this.getTypeConstructor=
function(f){return b[f]};this.relativeToAbsolute=function(b,e){if(this.isAbsoluteURL(b))return b;e=e||window.location.origin+window.location.pathname;var c;c=e.replace(/^([^?]*)([?].*)?$/,"$2")||"";e=e.split("/");b=b.split("/");e.pop();for(var a=0;a<b.length;a++)"."!=b[a]&&(".."==b[a]?e.pop():e.push(b[a]));return e.join("/")+c};this.isAbsoluteURL=function(b){return g.test(b)};this.buildStartStateMsg=function(){var b=0,e=new CTATTutoringServiceMessageBuilder;return function(c){return e.createInterfaceActionMessage(b++,
new CTATSAI(c.selection,c.action,c.input),"tutor")}}();this.buildStateGraphMsg=function(b){var e="<message><verb>SendNoteProperty</verb><properties><MessageType>StateGraph</MessageType>",c;for(c in b)b.hasOwnProperty(c)&&(e+="<"+c+">"+b[c]+"</"+c+">");return e+"</properties></message>"};this.printAgenda=function(b){return JSON.stringify(b.getAgenda())};this.printConflictTree=function(b,e){return b.getConflictTree().toString(e)};this.printFact=function(b,e,c){var a=b.getFact(e),d="";if(a){c&&(d="id: "+
e+", ");var d=d+("type: "+b.getFactType(a.object)+", "),f;try{f="values: "+JSON.stringify(a.object)}catch(l){f="< Error converting fact to JSON >"}d+=f}else d="no fact found with ID "+e;return d};this.getFacts=function(b,e){var c=[];if(Array.isArray(e)){e=$jscomp.makeIterator(e);for(var a=e.next();!a.done;a=e.next())type=a.value,c=c.concat(this.getFacts(b,type));return c}if(Number.isInteger(e))return this.getFact(b,e);c=b.getFacts(e,!0);e||(c=c.filter(function(a){a=b.getFactType(a.object);return!("hint"===
a||"tpa"===a||"customfield"===a||"skill"===a)}));return c.map(function(a){return a.object})};this.getFact=function(b,e){var c=null;"number"===typeof e?(c=b.getFact(e))&&(c=c.object):e&&"string"!==typeof e||(b=this.getFacts(b,e))&&(c=b[0]);return c};this.printFacts=function(b,e){var c=e,a="";if(Array.isArray(c)){for(var c=$jscomp.makeIterator(c),d=c.next();!d.done;d=c.next())e=d.value,a+=Number.isInteger(e)?this.printFact(b,e,!0):this.printFacts(b,e),a+="\n";return a}if(Number.isInteger(e))return this.printFact(b,
e);c=b.getFacts(e,!0);e||(c=c.filter(function(a){a=b.getFactType(a.object);return!("hint"===a||"tpa"===a||"customfield"===a||"skill"===a)}));a="got "+c.length+(e?" "+e:"")+" fact(s):\n";c.forEach(function(c){a+="id: "+c.id+", "+(e?"":"type: "+b.getFactType(c.object)+", ");var d;try{d="values: "+JSON.stringify(c.object)+"\n"}catch(n){d="< Error converting fact to JSON >\n"}a+=d});return a};this.printRules=function(b,e){b=b.getRuleNames();e&&(b=b.filter(function(c){return c.toLowerCase().includes(e)}));
return b.join(", ")};this.printCtNodeMatch=function(b,e){b=b.getNodeMatcherResult(e);var c;b&&"no match"!==b?(e=b.student,c=b.tutor,b="rule: "+b.rule+"\nstudent: "+e.selection+", "+e.action+", "+e.input+"\ntutor:   "+c.selection+", "+c.action+", "+c.input+"\nresult: "+(b.isMatch?"match":"no match")):b="no match"===b?"No match found at node "+e:"No conflict tree node found for ID "+e;return b};this.printRuleNodes=function(){function b(c){var a={};c.facts.forEach(function(b,e){var d;for(e=0;!d&&e<c.aliases.length;e++)c.factHash[c.aliases[e]]===
b.object&&(d=c.aliases[e]);d?a[d]=b:console.warn("no alias found for "+JSON.stringify(b))});return a}function e(c,a){c={};var d="NotNode"===a.nodeType||"FromNotNode"===a.nodeType;switch(a.nodeType){case "BetaNode":case "NotNode":case "ExistsNode":var e=a.rightMemory,f,g=[],p;for(p in e)f=e[p].data.match,g.push(b(f));c.factBindings=g;break;case "JoinNode":var g=a.leftMemory,q;a=[];for(e in g)for(f in q=g[e].data.rightMatches,q)p=q[f].match,a.push(b(p));c.factBindings=a;break;case "FromNode":case "FromNotNode":e=
a.fromMemory;a=[];for(g in e)for(q in f=e[g],f)p=f[q][1],p.match&&a.push(b(p.match));c.factBindings=a;break;default:c.factBindings=[]}c.isMatch=c.factBindings.length&&!d||!c.factBindings.length&&d;return c}return function(c,a){var b=!0;c=c.getRuleData(a);var f="";if(c){a=c.memoryNodes;c=[].concat(c.patterns);for(var g={},n=null,p,q,u=/("([^"]*)"):/g,v=0;v<c.length;v++)if(f+=n?"\n\t":'\npattern: "',q=c[v],q.disjuncts&&(f+="or (\n\t",n=v-1+q.disjuncts.length,c.splice.apply(c,[].concat([v,1],$jscomp.arrayFromIterable(q.disjuncts))),
q=c[v]),f+=q.string+(n?"":'"'),p=q.alias,g[p]||(g[p]=0),p=e(q,a[p][g[p]++]),p.isMatch||(f+=" NOT"),f+=" MATCHED",(q=p.factBindings).length&&(f+=" - "+q.length+" Possible bindings: ",q.forEach(function(a,c){for(var b in a)try{if("__i__"!==b){var d=JSON.stringify(a[b].object);for(c=null;c=u.exec(d);)d=d.replace(c[1],c[2]);f+="\n\t"+(n?"\t":"")+b+": "+d+" (fact ID "+a[b].id+")"}}catch(C){if(C.message.includes("circular structure"))f+="\n\t"+b+": can't print binding -- circular fact structure ";else throw C;
}f+="\n"})),v===n&&(f+='\n)"',n=null),!p.isMatch){b=!1;break}return f+"\nRule "+(b?"":"not ")+"matched"}return"Rule "+a+" not found"}}();this.printBreakpoints=function(b){return"breakpoints set for rules: "+b.getBreakpoints().join(", ")}};var CTATNoolsTracerWrapper=function(b){this.printAgenda=function(){b.printAgenda("override")};this.getAgenda=function(){return b.getAgenda()};this.printConflictTree=function(g,f){b.printConflictTree("override",g,f)};this.printPregenTrees=function(g,f){b.printPregenTrees("override",g,f)};this.printTutorSAIs=function(g){b.printTutorSAIs("override",g)};this.printFact=function(g){b.printFact(g)};this.getFact=function(g){return b.getFact(g)};this.printFacts=function(g){b.printFacts(g)};this.getFacts=function(g){return b.getFacts(g)};
this.printRules=function(g){b.printRules(g)};this.printMatch=function(g){b.printCtNodeMatch(g)};this.printRuleNodes=function(g){b.printRuleNodes(g)};this.setStepperMode=function(g){b.setInStepMode(g)};this.takeSteps=function(g,f){b.takeSteps(g,f)};this.setBreakpoint=function(g,f){b.setBreakpoint(g,f)};this.printBreakpoints=function(){b.printBreakpoints()};this.resume=function(){b.resume()};this.getProblemStateStatus=function(){return b.getProblemStateStatus()}};var CTATAlgebraTreeNode={};
(function(){var b,g=[].slice;b=function(){function b(){}b.operators=[["UNKNOWN"],["CONST"],["VAR"],["EXP","ROOT"],["UPLUS","UMINUS"],["ITIMES","TIMES","DIVIDE"],["IDIVIDE","REM"],["PLUS","MINUS"],"LESS LESSEQUAL EQUAL NOTEQUAL GREATEREQUAL GREATER".split(" ")];b.relationalOperators="LESS LESSEQUAL EQUAL NOTEQUAL GREATEREQUAL GREATER".split(" ");b.operatorPrecedence=function(b,c){return Math.sign(this.operators.findIndex(function(a){return a.includes(b)})-this.operators.findIndex(function(a){return a.includes(c)}))};b.operatorStrings=
{EXP:["^","**"],ROOT:["|","\u221a"],UPLUS:["+"],UMINUS:["-"],ITIMES:[""],TIMES:["*","\u00d7"],DIVIDE:["/","\u00f7"],IDIVIDE:["//"],REM:["%"],PLUS:["+"],MINUS:["-"],LESS:["<"],LESSEQUAL:["<=","\u2264"],EQUAL:["=","=="],NOTEQUAL:["!=","/=","<>","\u2260"],GREATEREQUAL:[">=","\u2265"],GREATER:[">"]};b.toOperatorString=function(b){var c;return(null!=(c=this.operatorStrings[b])?c[0]:void 0)||""};b.toOperator=function(b,c){var a;return null!=(a=Object.entries(this.operatorStrings).find(function(a){return function(a){return a[1].includes(b)&&
(!["UPLUS","UMINUS"].includes(a[0])||1===c)}}(this)))?a[0]:void 0};b.diff=function(b,c){return b.filter(function(a){return!c.includes(a)})};b.prototype.toString=function(b,c,a){var d,e;null==c&&(c="EQUAL");null==a&&(a=!1);d=0;for(e=this.parens;0<=e?d<e:d>e;0<=e?++d:--d)b="("+b+")";!this.parented()&&this.addParens(null,!0)&&(b="("+b+")");this.inverted()&&(b="1/"+b);this.negated()&&(b="-"+b);!this.parented()&&this.addParens(c,a)&&(b="("+b+")");return b};b.prototype.setParens=function(){this.parens++;
return this};b.prototype.addParens=function(e,c){var a;null==e&&(e=null);null==c&&(c=!1);null!=e?a=this.negated()?"UMINUS":this.inverted()?"DIVIDE":this.operator:(e=this.negated()?"MINUS":this.inverted()?"DIVIDE":null,a=this.operator);a=b.operatorPrecedence(e,a);return null!=e&&(0>a||0===a&&c)};b.prototype.addPaths=function(b){return Object.assign(this,{path:b})};b.prototype.evaluate=function(b,c){null==c&&(c=!0);return this.sign*(this.inverted()&&c?1/b:b)};b.prototype.applyOperator=function(b,c,
a){var d;null==a&&(a=!1);d=a?"DIVIDE":this.operator;return function(){switch(d){case "LESS":return b<c;case "GREATER":return b>c;case "LESSEQUAL":return b<=c;case "GREATEREQUAL":return b>=c;case "EQUAL":return b===c;case "NOTEQUAL":return b!==c;case "PLUS":return b+c;case "MINUS":return b-c;case "TIMES":case "ITIMES":return b*c;case "DIVIDE":return b/c;case "EXP":return Math.pow(b,c);case "ROOT":return Math.pow(b,1/c);case "REM":return b%c;case "IDIVIDE":return Math.floor(b/c);case "UPLUS":return b;
case "UMINUS":return-b}}()};b.prototype.equals=function(b){return b&&this.operator===b.operator&&this.sign===b.sign&&this.exp===b.exp&&this.parens===b.parens};b.prototype.subEquals=function(b,c){return!1};b.prototype.subNode=function(b,c){return this};b.prototype.countOperands=function(){return 0};b.prototype.getOperator=function(b,c){null==b&&(b=!1);return b&&this.inverted()&&"DIVIDE"||b&&this.negated()&&"UMINUS"||void 0};b.prototype.getOperators=function(b){null==b&&(b=!1);return this.getOperator(b)&&
[void 0]||[]};b.prototype.getVariables=function(){return[]};b.prototype.getOperands=function(){return[]};b.prototype.getExpression=function(b,c){null==b&&(b=0);null==c&&(c=this.countOperands()-1);return c<=this.countOperands()-1&&1<=c-b&&this.subNode(b,c+1)||null};b.prototype.findExpression=function(b,c,a){var d;null==a&&(a=null);return!a&&this.equals(b)?[Object.assign(this,{path:c})]:null!=a&&null!=this.terms&&this.subEquals(b,a)?[Object.assign(this.subNode(a,d=a+b.terms.length),{path:c.concat([["terms",
a,d]])})]:null!=a&&null!=this.factors&&this.subEquals(b,a)?[Object.assign(this.subNode(a,d=a+b.factors.length),{path:c.concat([["factors",a,d]])})]:[]};b.prototype.createExpression=function(){var e,c,a;c=arguments[0];e=2<=arguments.length?g.call(arguments,1):[];return(null!=(a=function(){switch(c=b.toOperator(c,e.length+1)||c){case "LESS":case "LESSEQUAL":case "EQUAL":case "NOTEQUAL":case "GREATEREQUAL":case "GREATER":return e[0]&&new CTATRelationNode(c,this,e[0])||null;case "PLUS":case "MINUS":return 1<
e.unshift(this)&&new CTATAdditionNode(c,e)||null;case "UPLUS":case "UMINUS":return new CTATUnaryNode(c,this);case "TIMES":case "DIVIDE":return 1<e.unshift(this)&&new CTATMultiplicationNode(c,e)||null;case "IDIVIDE":case "REM":return e[0]&&new CTATIntDivisionNode(c,this,e[0])||null;case "EXP":return e[0]&&new CTATPowerNode(c,this,e[0])||null;case "ROOT":return new CTATPowerNode(c,this,new CTATConstantNode(2))}}.call(this))?a.simpleFlatten():void 0)||null};b.prototype.replaceExpression=function(b,c,
a){var d,e,f,g,p;"number"===typeof a&&(b=this.findExpression(b,[])[a])&&(a=b.path,delete b.path);if(0===(null!=a?a.length:void 0))return c;if(null!=(p=null!=a?a.shift():void 0))return d=this.clone(!1),"string"===typeof p?(d[p]=null!=(e=this[p])?e.replaceExpression(b,c,a):void 0,d.simpleFlatten()):"object"===typeof p&&2===p.length?(d[p[0]]=d[p[0]].slice(0),d[p[0]][p[1]]=null!=(f=this[p[0]])?f[p[1]].replaceExpression(b,c,a):void 0,d.simpleFlatten()):"object"===typeof p&&3===p.length?(d[p[0]]=d[p[0]].slice(0),
[].splice.apply(d[p[0]],[g=p[1],p[2]-g].concat(c)),c,d.simpleFlatten()):this};b.prototype.deleteExpression=function(b,c){var a,d,e,f,g;"number"===typeof c&&(b=this.findExpression(b,[])[c])&&(c=b.path,delete b.path);if(0===(null!=c?c.length:void 0))return null;if(null!=(g=null!=c?c.shift():void 0))return a=this.clone(!1),"string"===typeof g?(a[g]=null!=(d=this[g])?d.deleteExpression(b,c):void 0,a.removeNull()):"object"===typeof g&&2===g.length?(a[g[0]]=a[g[0]].slice(0),a[g[0]][g[1]]=null!=(e=this[g[0]])?
e[g[1]].deleteExpression(b,c):void 0,a.removeNull()):"object"===typeof g&&3===g.length?(a[g[0]]=a[g[0]].slice(0),[].splice.apply(a[g[0]],[f=g[1],g[2]-f].concat(null)),null,a.removeNull()):this};b.prototype.applyRulesSelectively=function(){var b,c,a,d,f,l;f=arguments[0];b=arguments[1];c=arguments[2];a=4<=arguments.length?g.call(arguments,3):[];this.rules=f;null==b&&(b=!0);null==c&&(c=null);return this.checkIndices(a.concat(c))&&(!["PLUS","TIMES"].includes(this.operator)||this.wholeNode(c,a)?this.applyRules(this.rules,
b):(l=this.selectOperands(a.concat(c)))&&l.equals(d=l.applyRules(this.rules,b))?this:this.replaceOperands(d,c,a))||null};b.prototype.applyRules=function(b,c){var a,d,e;this.rules=b;d=this;a=this.rules;b=0;for(c=a.length;b<c;b++)e=a[b],d=d[e].call(d),d.rules=this.rules;delete d.rules;return d};b.prototype.removeNull=function(){return this};b.prototype.checkIndices=function(b){return b.every(function(c,a){return null==c||0<=c&&1>=c&&b.indexOf(c)===a})};b.prototype.wholeNode=function(b,c){return null==
b||0===c.length||c.concat(b).length>=this.countOperands()};b.prototype.selectOperands=function(b,c){return this};b.prototype.replaceOperands=function(b,c,a){return b};b.prototype.simpleFlatten=function(){return this};b.prototype.flatten=function(){this.parens=0;return this.simpleFlatten()};b.prototype.computeConstants=function(){return this};b.prototype.combineSimilar=function(){return this};b.prototype.expand=function(){return this};b.prototype.distribute=function(){return this};b.prototype.removeIdentity=
function(){return this};b.prototype.sort=function(){return this};b.prototype.spreadIdentity=function(){return this};b.prototype.stripIdentity=function(){return this};b.prototype.multiplyOne=function(b){null==b&&(b=!1);return(new CTATMultiplicationNode("TIMES",[new CTATConstantNode(1,b),this])).popNegation().pushNegation()};b.prototype.powerOne=function(b){null==b&&(b=!1);return(new CTATPowerNode("EXP",this,new CTATConstantNode(1,b))).popInversion().pushInversion().popNegation()};b.prototype.findGroup=
function(b,c){return b.find(function(a){var b,e;return(null!=(b=a[0])?b.equals(c[0]):void 0)||a[0]===(e=c[0])&&null===e})};b.prototype.compareFactors=function(b,c){return this.compareSigns(b,!c)||this.compare(b,c)};b.prototype.compare=function(e,c){return b.operatorPrecedence(this.operator,e.operator)};b.prototype.compareSigns=function(b,c){return(Math.sign(this.sign-b.sign)||Math.sign(this.exp-b.exp))*(c?-1:1)};b.prototype.countVariables=function(){return 0};b.prototype.pushNegation=function(){return this};
b.prototype.popNegation=function(){return this};b.prototype.pushInversion=function(){return this};b.prototype.popInversion=function(){return this};b.prototype.negate=function(){this.sign=-this.sign;return this};b.prototype.invert=function(){this.exp=-this.exp;return this};b.prototype.addition=function(){return"PLUS"===this.operator};b.prototype.subtraction=function(){return"MINUS"===this.operator};b.prototype.multiplication=function(){return"TIMES"===this.operator};b.prototype.division=function(){return"DIVIDE"===
this.operator};b.prototype.intDivision=function(){return"IDIVIDE"===this.operator};b.prototype.power=function(){return"EXP"===this.operator};b.prototype.root=function(){return"ROOT"===this.operator};b.prototype.negation=function(){return"UMINUS"===this.operator};b.prototype.unary=function(){var b;return"UPLUS"===(b=this.operator)||"UMINUS"===b};b.prototype.constant=function(b){return!1};b.prototype.unknown=function(){return!1};b.prototype.integer=function(){return!1};b.prototype.negated=function(){return 0>
this.sign};b.prototype.inverted=function(){return 0>this.exp};b.prototype.parented=function(){return 0<this.parens};b.prototype.even=function(){return!1};return b}();"undefined"!==typeof module&&null!==module?module.exports=b:this.CTATAlgebraTreeNode=b}).call(this);var CTATRelationNode={};
(function(){var b,g=function(b,c){function a(){this.constructor=b}for(var d in c)f.call(c,d)&&(b[d]=c[d]);a.prototype=c.prototype;b.prototype=new a;b.__super__=c.prototype;return b},f={}.hasOwnProperty;b=function(b){function c(a,c,b,e,f,g){this.operator=a;this.left=c;this.right=b;this.parens=null!=e?e:0;this.sign=null!=f?f:1;this.exp=null!=g?g:1}g(c,b);c.prototype.clone=function(a){null==a&&(a=!0);return new c(this.operator,a?this.left.clone():this.left,a?this.right.clone():this.right,this.parens,
this.sign,this.exp)};c.prototype.toString=function(a,b){null==a&&(a="EQUAL");null==b&&(b=!1);return c.__super__.toString.call(this,""+this.left.toString(this.operator)+CTATAlgebraTreeNode.toOperatorString(this.operator)+this.right.toString(this.operator),a,b)};c.prototype.addPaths=function(a){this.left.addPaths(a.concat(["left"]));this.right.addPaths(a.concat(["right"]));return c.__super__.addPaths.apply(this,arguments)};c.prototype.evaluate=function(a){null==a&&(a=null);return this.applyOperator(this.left.evaluate(a),
this.right.evaluate(a))};c.prototype.equals=function(a){return c.__super__.equals.call(this,a)&&this.left.equals(a.left)&&this.right.equals(a.right)};c.prototype.countOperands=function(){return 2};c.prototype.getOperator=function(a,c){return this.operator};c.prototype.getOperators=function(a){return this.left.getOperators().concat(this.getOperator(),this.right.getOperators())};c.prototype.getVariables=function(){return this.left.getVariables().concat(this.right.getVariables())};c.prototype.getOperands=
function(){return[this.left,this.right]};c.prototype.findExpression=function(a,b){return this.left.findExpression(a,b.concat(["left"])).concat(c.__super__.findExpression.call(this,a,b),this.right.findExpression(a,b.concat(["right"])))};c.prototype.applyRules=function(a,b){this.rules=a;null==b&&(b=!0);b&&(this.left=this.left.applyRules(this.rules),this.right=this.right.applyRules(this.rules));return c.__super__.applyRules.apply(this,arguments)};c.prototype.removeNull=function(){var a,c;this.left=null!=
(a=this.left)?a.removeNull():void 0;this.right=null!=(c=this.right)?c.removeNull():void 0;return null!=this.left&&null!=this.right?this:this.left||this.right||null};c.prototype.computeConstants=function(){return this.left.constant()&&this.right.constant()?new CTATConstantNode(this.evaluate()):this};c.prototype.sort=function(){var a;switch(this.operator){case "GREATER":this.operator="LESS";a=[this.right,this.left];this.left=a[0];this.right=a[1];break;case "GREATEREQUAL":this.operator="LESSEQUAL";a=
[this.right,this.left];this.left=a[0];this.right=a[1];break;case "EQUAL":case "NOTEQUAL":0>this.left.compare(this.right)&&(a=[this.right,this.left],this.left=a[0],this.right=a[1])}return this};c.prototype.countVariables=function(){return this.left.countVariables()+this.right.countVariables()};return c}(CTATAlgebraTreeNode);"undefined"!==typeof module&&null!==module?module.exports=b:this.CTATRelationNode=b}).call(this);var CTATAdditionNode={};
(function(){var b,g=function(b,c){function a(){this.constructor=b}for(var d in c)f.call(c,d)&&(b[d]=c[d]);a.prototype=c.prototype;b.prototype=new a;b.__super__=c.prototype;return b},f={}.hasOwnProperty;b=function(b){function c(a,c,b,e,f){this.operator=a;this.terms=c;this.parens=null!=b?b:0;this.sign=null!=e?e:1;this.exp=null!=f?f:1}g(c,b);c.prototype.clone=function(a){null==a&&(a=!0);return new c(this.operator,a?this.terms.map(function(a){return a.clone()}):this.terms,this.parens,this.sign,this.exp)};
c.prototype.toString=function(a,b){null==a&&(a="EQUAL");null==b&&(b=!1);return c.__super__.toString.call(this,this.terms.reduce(function(a){return function(c,b){var d;d=c&&!b.negated()?a.operator:"";return""+c+CTATAlgebraTreeNode.toOperatorString(d)+b.toString(a.operator)}}(this),""),a,b)};c.prototype.addPaths=function(a){this.terms.forEach(function(c,b){return c.addPaths(a.concat([["terms",b]]))});return c.__super__.addPaths.apply(this,arguments)};c.prototype.evaluate=function(a){null==a&&(a=null);
return c.__super__.evaluate.call(this,this.terms.reduce(function(c){return function(b,d){return c.applyOperator(b,d.evaluate(a))}}(this),0))};c.prototype.equals=function(a){return c.__super__.equals.call(this,a)&&this.terms.length===a.terms.length&&this.terms.every(function(c,b){return c.equals(a.terms[b])})};c.prototype.subEquals=function(a,c){return this.operator===a.operator&&!a.negated()&&this.terms.length>=a.terms.length&&a.terms.every(function(a){return function(b,d){return b.equals(a.terms[c+
d])}}(this))};c.prototype.subNode=function(a,c){console.log(a,c);return null!=a?Object.assign(this.clone(!1),{terms:this.terms.slice(a,c)}):this};c.prototype.countOperands=function(){return this.terms.length};c.prototype.getOperator=function(a,b){null==a&&(a=!1);null==b&&(b=null);return a&&c.__super__.getOperator.apply(this,arguments)||null!=b&&this.terms[b].negated()&&"MINUS"||this.operator};c.prototype.getOperators=function(a){null==a&&(a=!1);return this.terms.slice(1).reduce(function(c){return function(b,
d,e){return b.concat(c.getOperator(a,e+1),d.getOperators())}}(this),this.terms[0].getOperators())};c.prototype.getVariables=function(){return this.terms.slice(1).reduce(function(a){return function(a,c){return a.concat(c.getVariables())}}(this),this.terms[0].getVariables())};c.prototype.getOperands=function(){return this.terms.slice(0)};c.prototype.findExpression=function(a,b){return this.terms.slice(1).reduce(function(d){return function(e,f,g){return e.concat(c.__super__.findExpression.call(d,a,b,
g),f.findExpression(a,b.concat([["terms",g+1]])))}}(this),this.terms[0].findExpression(a,b.concat([["terms",0]])))};c.prototype.applyRules=function(a,b){this.rules=a;null==b&&(b=!0);b&&(this.terms=this.terms.map(function(a){return function(c){return c.applyRules(a.rules)}}(this)));return c.__super__.applyRules.apply(this,arguments)};c.prototype.removeNull=function(){this.terms=this.terms.map(function(a){return null!=a?a.removeNull():void 0}).filter(function(a){return a});return 1<this.terms.length?
this:this.terms[0]||null};c.prototype.checkIndices=function(a){var c;c=this.terms.length;return a.every(function(b,d){return null==b||0<=b&&b<c&&a.indexOf(b)===d})};c.prototype.selectOperands=function(a){return Object.assign(this.clone(!1),{terms:this.terms.filter(function(c,b){return a.includes(b)})})};c.prototype.replaceOperands=function(a,c,b){var d;(d=this.clone(!1)).terms=this.terms.slice(0);[].splice.apply(d.terms,[c,c-c+1].concat(a="PLUS"===a.operator?a.terms:a));a;b.forEach(function(a){var c;
return[].splice.apply(d.terms,[a,a-a+1].concat(c=[])),c});return d};c.prototype.simpleFlatten=function(){!this.terms[0].negation()||this.terms[0].inverted()||this.terms[0].parented()||(this.terms[0]=this.terms[0].base.negate());this.subtraction()&&(this.terms[1].negate(),this.operator="PLUS");this.terms=this.terms.reduce(function(a,c){c.inverted()||c.parented()||!c.addition()?a.push(c):a.push.apply(a,c.pushNegation().terms);return a},[]);return this};c.prototype.flatten=function(){return c.__super__.flatten.apply(this,
arguments).pushNegation()};c.prototype.computeConstants=function(){var a,c;0<=(c=this.terms.findIndex(function(a){return a.constant()}))&&(a=this.terms[c].evaluate(),this.terms=this.terms.filter(function(b,d){return d<=c||!b.constant()||(a+=b.evaluate())&&!1}),0===a&&1<this.terms.length?this.terms.splice(c,1):this.terms[c]=new CTATConstantNode(a));return 1<this.terms.length?this:this.pushInversion().terms[0]};c.prototype.combineSimilar=function(){var a;a=[];this.terms.forEach(function(c){return function(b){var d,
e,f;f=b.constant()?[null,b]:(b=b.multiplyOne(),[b,b.factors.shift()]);return null!=(e=f[0])&&e.unknown()||!(d=c.findGroup(a,f))?a.push([f[0],f[1].evaluate()]):d[1]+=f[1].evaluate()}}(this));this.terms=a.reduce(function(a,c){0!==c[1]&&(c[1]=(new CTATConstantNode(c[1])).popNegation(),c[0]?(c[0].factors.unshift(c[1]),a.push(c[0].removeIdentity())):a.push(c[1]));return a},[]);if(1<this.terms.length)return this;1!==this.terms.length&&(this.terms[0]=new CTATConstantNode(0));return this.pushInversion().terms[0]};
c.prototype.removeIdentity=function(a){var c;null==a&&(a=!1);c=this.terms.filter(function(c){return!c.constant(0,a)});this.terms=c.length?c:this.terms.slice(0,1);return 1<this.terms.length?this.pushNegation():this.pushInversion().terms[0]};c.prototype.sort=function(){this.spreadIdentity();this.terms=this.terms.sort(function(a,c){return-a.compare(c,!0)});return this.stripIdentity()};c.prototype.spreadIdentity=function(){this.terms=this.terms.map(function(a){return a.multiplyOne(!0)});return this};
c.prototype.stripIdentity=function(){this.terms=this.terms.map(function(a){return a.removeIdentity(!0)});return this};c.prototype.compare=function(a,b){var d;return c.__super__.compare.apply(this,arguments)||this.countVariables()-a.countVariables()||(d=null,this.terms.some(function(c,e){return d=c.compare(a.terms[e],b)})&&d)||this.compareSigns(a,b)};c.prototype.countVariables=function(){return this.terms.reduce(function(a,c){return a+c.countVariables()},0)};c.prototype.pushNegation=function(){this.negated()&&
(this.negate(),this.terms.forEach(function(a){return a.negate()}));return this};c.prototype.popNegation=function(){this.terms[0].negated()&&(this.negate(),this.terms.forEach(function(a){return a.negate()}));return this};c.prototype.pushInversion=function(){this.inverted()&&(this.invert(),this.terms[0].invert());return this};c.prototype.unknown=function(){return this.terms.some(function(a){return a.unknown()})};c.prototype.even=function(){return!this.inverted&&this.terms.every(function(a){return a.even()})};
return c}(CTATAlgebraTreeNode);"undefined"!==typeof module&&null!==module?module.exports=b:this.CTATAdditionNode=b}).call(this);var CTATMultiplicationNode={};
(function(){var b,g=function(b,c){function a(){this.constructor=b}for(var d in c)f.call(c,d)&&(b[d]=c[d]);a.prototype=c.prototype;b.prototype=new a;b.__super__=c.prototype;return b},f={}.hasOwnProperty;b=function(b){function c(a,c,b,e,f){this.operator=a;this.factors=c;this.parens=null!=b?b:0;this.sign=null!=e?e:1;this.exp=null!=f?f:1}g(c,b);c.prototype.clone=function(a){null==a&&(a=!0);return new c(this.operator,a?this.factors.map(function(a){return a.clone()}):this.factors,this.parens,this.sign,
this.exp)};c.prototype.toString=function(a,b){null==a&&(a="EQUAL");null==b&&(b=!1);return c.__super__.toString.call(this,this.factors.reduce(function(a){return function(c,b){var d,e;b.inverted()?(b.invert(),d=b.toString("DIVIDE",c),b.invert()):d=b.toString(a.operator,c);e=c?b.inverted()?"DIVIDE":"DIVIDE"===a.operator||/^[\d+-]/.test(d)&&/\d$/.test(c)?a.operator:"":"";d=""===e&&b.negated()?"("+d+")":d;return""+c+CTATAlgebraTreeNode.toOperatorString(e)+d}}(this),"TIMES"===this.operator&&this.factors[0].inverted()?
"1":""),a,b)};c.prototype.addPaths=function(a){this.factors.forEach(function(c,b){return c.addPaths(a.concat([["factors",b]]))});return c.__super__.addPaths.apply(this,arguments)};c.prototype.evaluate=function(a){var b;null==a&&(a=null);b=this.factors.reduce(function(c){return function(b,d){return d.inverted()?b:c.applyOperator(b,d.evaluate(a,!1))}}(this),1);return c.__super__.evaluate.call(this,this.factors.reduce(function(c){return function(b,d){return d.inverted()?c.applyOperator(b,d.evaluate(a,
!1),!0):b}}(this),b))};c.prototype.equals=function(a){return c.__super__.equals.call(this,a)&&this.factors.length===a.factors.length&&this.factors.every(function(c,b){return c.equals(a.factors[b])})};c.prototype.subEquals=function(a,c){return this.operator===a.operator&&!a.inverted()&&this.factors.length>=a.factors.length&&a.factors.every(function(a){return function(b,d){return b.equals(a.factors[c+d])}}(this))};c.prototype.subNode=function(a,c){console.log(a,c);return null!=a?Object.assign(this.clone(!1),
{factors:this.factors.slice(a,c)}):this};c.prototype.countOperands=function(){return this.factors.length};c.prototype.getOperator=function(a,b){null==a&&(a=!1);null==b&&(b=null);return a&&c.__super__.getOperator.apply(this,arguments)||null!=b&&this.factors[b].inverted()&&"DIVIDE"||this.operator};c.prototype.getOperators=function(a){null==a&&(a=!1);return this.factors.slice(1).reduce(function(c){return function(b,d,e){return b.concat(c.getOperator(a,e+1),d.getOperators())}}(this),this.factors[0].getOperators())};
c.prototype.getVariables=function(){return this.factors.slice(1).reduce(function(a){return function(a,c){return a.concat(c.getVariables())}}(this),this.factors[0].getVariables())};c.prototype.getOperands=function(){return this.factors.slice(0)};c.prototype.findExpression=function(a,b){return this.factors.slice(1).reduce(function(d){return function(e,f,g){return e.concat(c.__super__.findExpression.call(d,a,b,g),f.findExpression(a,b.concat([["factors",g+1]])))}}(this),this.factors[0].findExpression(a,
b.concat([["factors",0]])))};c.prototype.applyRules=function(a,b){this.rules=a;null==b&&(b=!0);b&&(this.factors=this.factors.map(function(a){return function(c){return c.applyRules(a.rules)}}(this)));return c.__super__.applyRules.apply(this,arguments)};c.prototype.removeNull=function(){this.factors=this.factors.map(function(a){return null!=a?a.removeNull():void 0}).filter(function(a){return a});return 1<this.factors.length?this:this.factors[0]||null};c.prototype.checkIndices=function(a){var c;c=this.factors.length;
return a.every(function(b,d){return null==b||0<=b&&b<c&&a.indexOf(b)===d})};c.prototype.selectOperands=function(a){return Object.assign(this.clone(!1),{factors:this.factors.filter(function(c,b){return a.includes(b)})})};c.prototype.replaceOperands=function(a,c,b){var d;(d=this.clone(!1)).terms=this.factors.slice(0);[].splice.apply(d.factors,[c,c-c+1].concat(a="TIMES"===a.operator?a.factors:a));a;b.forEach(function(a){var c;return[].splice.apply(d.factors,[a,a-a+1].concat(c=[])),c});return d};c.prototype.simpleFlatten=
function(){this.division()&&this.factors[1].invert();this.operator="TIMES";this.factors=this.factors.reduce(function(a,c){c.parented()||!c.multiplication()?a.push(c):a.push.apply(a,c.pushNegation().pushInversion().factors);return a},[]);return this};c.prototype.flatten=function(){return c.__super__.flatten.apply(this,arguments).popNegation()};c.prototype.computeConstants=function(){var a,b,e;0<=(b=this.factors.findIndex(function(a){return a.constant()}))&&(a=new c("TIMES",[new CTATConstantNode(1)]),
this.factors=this.factors.filter(function(c,d){return d<b||!c.constant()||a.factors.push(c)&&!1}),1===(e=a.evaluate())&&0!==this.factors.length||this.factors.unshift(new CTATConstantNode(e)));return 1<this.factors.length?this:this.pushNegation().pushInversion().factors[0]};c.prototype.combineSimilar=function(){var a;a=[];this.factors.forEach(function(c){return function(b){var d,e,f,g,h;h=b.constant()?[null,b]:b.power()?b.exponent.constant()?(b.pushInversion(),[b.base,b.exponent]):(b.exponent=b.exponent.multiplyOne(),
[b,b.exponent.factors.shift()]):(b=b.powerOne(),[b.base,b.exponent]);return null!=(e=h[0])&&e.unknown()||!(d=c.findGroup(a,h))?a.push([h[0],(null!=(g=h[1])?g.evaluate():void 0)||1]):d[1]+=(null!=(f=h[1])?f.evaluate():void 0)||1}}(this));this.factors=a.reduce(function(a,c){0!==c[1]&&(c[1]=(new CTATConstantNode(c[1])).popNegation(),c[0]?c[1].constant(1)?a.push(c[0]):c[1].constant(-1)?a.push(c[0].invert()):c[0].power()?(c[0].exponent.factors.unshift(c[1]),a.push(c[0])):a.push((new CTATPowerNode("EXP",
c[0],c[1])).popInversion()):a.push(c[1]));return a},[]);if(1<this.factors.length)return this;1!==this.factors.length&&(this.factors[0]=new CTATConstantNode(1));return this.pushNegation().pushInversion().factors[0]};c.prototype.distribute=function(){var a,c;a=this.factors.filter(function(a){return!a.inverted()});c=this.factors.filter(function(a){return a.inverted()});return!this.distributedOrSingle(a)||!this.distributedOrSingle(c)||this.single(a)&&c.length&&this.distributed(c)?(this.distributed(c)?
(a=this.distributeFactors(this.factors),c=[]):this.distributed(a)?(c=this.distributeFactors(this.factors),a=[]):(a=this.distributeFactors(a),c=this.distributeFactors(c)),this.factors=c.length?a.length?[this.packTerms(a),this.packTerms(c).invert()]:[this.packTerms(c).invert()]:[this.packTerms(a)],1<this.factors.length?this:this.pushNegation().pushInversion().factors[0]):this};c.prototype.distributedOrSingle=function(a){return this.distributed(a)||this.single(a)};c.prototype.distributed=function(a){return a.every(function(a){return!a.addition()})};
c.prototype.single=function(a){return 1===a.length&&a[0].addition()};c.prototype.distributeFactors=function(a){var c;c=a[0].addition()?a[0].terms.map(function(a){return a.multiplication()?a.pushNegation().factors:[a]}):[[a[0]]];a.slice(1).forEach(function(a){var b;return a.addition()?1===c.length?c=a.terms.map(function(a){var b;b=c[0].map(function(a){return a.clone()});a.multiplication()?b.push.apply(b,a.pushNegation().factors):b.push(a);return b}):c=c.reduce(function(c,b){c.push.apply(c,a.terms.map(function(a){var c;
c=b.map(function(a){return a.clone()});a.multiplication()?c.push.apply(c,a.pushNegation().factors.map(function(a){return a.clone()})):c.push(a.clone());return c}));return c},[]):1===c.length?a.multiplication()?(b=c[0]).push.apply(b,a.pushNegation().factors):c[0].push(a):c.forEach(function(b,d){var e;return a.multiplication()?(e=c[d]).push.apply(e,a.pushNegation().factors.map(function(a){return a.clone()})):c[d].push(a.clone())})});return c};c.prototype.packTerms=function(a){var b;b=CTATAlgebraTreeNode.diff(this.rules,
["flatten","distribute"]);return(new CTATAdditionNode("PLUS",a.map(function(a){return(new c("TIMES",a)).popNegation().applyRules(b,!1)}))).applyRules(b,!1)};c.prototype.removeIdentity=function(a){var c;null==a&&(a=!1);this.popNegation();c=this.factors.filter(function(c){return!c.constant(1,a)});this.factors=c.length?c:this.factors.slice(0,1);(c=this.factors.find(function(c){return c.constant(0,a)}))&&this.factors.every(function(a){return!a.inverted()&&(!a.power()||a.exponent.constant())})&&(this.factors=
[c]);return 1<this.factors.length?this:this.pushNegation().pushInversion().factors[0]};c.prototype.sort=function(){this.factors=this.factors.sort(function(a,c){return a.compareFactors(c)});return this};c.prototype.spreadIdentity=function(){this.factors=this.factors.map(function(a){return a.powerOne(!0)});return this};c.prototype.stripIdentity=function(){this.factors=this.factors.map(function(a){return a.removeIdentity(!0)});return this.popNegation()};c.prototype.multiplyOne=function(a){null==a&&(a=
!1);this.factors[0].constant()||this.factors.unshift(new CTATConstantNode(1,a));return this.pushNegation()};c.prototype.compare=function(a,b){var d,e;return c.__super__.compare.apply(this,arguments)||this.countVariables()-a.countVariables()||(e=null,(d=a.factors.slice(0).reverse())&&this.factors.slice(0).reverse().some(function(a,c){return d[c]?e=a.compareFactors(d[c],b):e})&&e)||this.compareSigns(a,b)};c.prototype.countVariables=function(){return this.factors.reduce(function(a,c){return a+c.countVariables()},
0)};c.prototype.pushNegation=function(){this.negated()&&(this.negate(),this.factors[0].negate());return this};c.prototype.popNegation=function(){this.factors.forEach(function(a){return function(c){if(c.negated())return a.negate(),c.negate()}}(this));return this};c.prototype.pushInversion=function(){this.inverted()&&(this.invert(),this.factors.forEach(function(a){return a.invert()}));return this};c.prototype.unknown=function(){return this.factors.some(function(a){return a.unknown()})};c.prototype.even=
function(){return!this.inverted()&&this.factors.every(function(a){return a.integer()})&&this.factors.some(function(a){return a.even()})};return c}(CTATAlgebraTreeNode);"undefined"!==typeof module&&null!==module?module.exports=b:this.CTATMultiplicationNode=b}).call(this);var CTATIntDivisionNode={};
(function(){var b,g=function(b,c){function a(){this.constructor=b}for(var d in c)f.call(c,d)&&(b[d]=c[d]);a.prototype=c.prototype;b.prototype=new a;b.__super__=c.prototype;return b},f={}.hasOwnProperty;b=function(b){function c(a,c,b,e,f,g){this.operator=a;this.dividend=c;this.divisor=b;this.parens=null!=e?e:0;this.sign=null!=f?f:1;this.exp=null!=g?g:1}g(c,b);c.prototype.clone=function(a){null==a&&(a=!0);return new c(this.operator,a?this.dividend.clone():this.dividend,a?this.divisor.clone():this.divisor,
this.parens,this.sign,this.exp)};c.prototype.toString=function(a,b){null==a&&(a="EQUAL");null==b&&(b=!1);return c.__super__.toString.call(this,""+this.dividend.toString(this.operator)+CTATAlgebraTreeNode.toOperatorString(this.operator)+this.divisor.toString(this.operator),a,b)};c.prototype.addPaths=function(a){this.dividend.addPaths(a.concat(["dividend"]));this.divisor.addPaths(a.concat(["divisor"]));return c.__super__.addPaths.apply(this,arguments)};c.prototype.evaluate=function(a){null==a&&(a=null);
return c.__super__.evaluate.call(this,this.applyOperator(this.dividend.evaluate(a),this.divisor.evaluate(a)))};c.prototype.equals=function(a){return c.__super__.equals.call(this,a)&&this.dividend.equals(a.dividend)&&this.divisor.equals(a.divisor)};c.prototype.countOperands=function(){return 2};c.prototype.getOperator=function(a,b){null==a&&(a=!1);null==b&&(b=null);return a&&c.__super__.getOperator.apply(this,arguments)||this.operator};c.prototype.getOperators=function(a){null==a&&(a=!1);return this.dividend.getOperators().concat(this.getOperator(a),
this.divisor.getOperators())};c.prototype.getVariables=function(){return this.dividend.getVariables().concat(this.divisor.getVariables())};c.prototype.getOperands=function(){return[this.dividend,this.divisor]};c.prototype.findExpression=function(a,b){return this.dividend.findExpression(a,b.concat(["dividend"])).concat(c.__super__.findExpression.call(this,a,b),this.divisor.findExpression(a,b.concat(["divisor"])))};c.prototype.applyRules=function(a,b){this.rules=a;null==b&&(b=!0);b&&(this.dividend=
this.dividend.applyRules(this.rules),this.divisor=this.divisor.applyRules(this.rules));return c.__super__.applyRules.apply(this,arguments)};c.prototype.removeNull=function(){var a,c;this.dividend=null!=(a=this.dividend)?a.removeNull():void 0;this.divisor=null!=(c=this.divisor)?c.removeNull():void 0;return null!=this.dividend&&null!=this.divisor?this:this.dividend||this.divisor||null};c.prototype.computeConstants=function(){return this.dividend.constant()&&this.divisor.constant()?new CTATConstantNode(this.evaluate()):
this};c.prototype.removeIdentity=function(a){null==a&&(a=!1);return this.divisor.constant(1,a)?(this.intDivision()||(this.dividend=new CTATConstantNode(0,a)),this.pushNegation().pushInversion().dividend):this.popNegation()};c.prototype.compare=function(a,b){return c.__super__.compare.apply(this,arguments)||this.dividend.compare(a.dividend,b)||this.divisor.compare(a.divisor,b)||this.operator!==a.operator&&(this.intDivision()&&-1||1)||this.compareSigns(a,b)};c.prototype.countVariables=function(){return this.dividend.countVariables()+
divisor.countVariables()};c.prototype.pushNegation=function(){this.intDivision()&&this.negated()&&(this.negate(),this.dividend.negate());return this};c.prototype.pushInversion=function(){this.intDivision()&&this.inverted()&&(this.invert(),this.dividend.invert());return this};c.prototype.popNegation=function(){this.divisor.negated()&&(this.divisor.negate(),this.intDivision()&&this.dividend.negate());return this};c.prototype.unknown=function(){return this.dividend.unknown()||this.divisor.unknown()};
c.prototype.even=function(){return!this.inverted&&"REM"===this.operator&&this.dividend.even()&&this.divisor.even()};return c}(CTATAlgebraTreeNode);"undefined"!==typeof module&&null!==module?module.exports=b:this.CTATIntDivisionNode=b}).call(this);var CTATUnaryNode={};
(function(){var b,g=function(b,c){function a(){this.constructor=b}for(var d in c)f.call(c,d)&&(b[d]=c[d]);a.prototype=c.prototype;b.prototype=new a;b.__super__=c.prototype;return b},f={}.hasOwnProperty;b=function(b){function c(a,c,b,e,f){this.operator=a;this.base=c;this.parens=null!=b?b:0;this.sign=null!=e?e:1;this.exp=null!=f?f:1}g(c,b);c.prototype.clone=function(a){null==a&&(a=!0);return new c(this.operator,a?this.base.clone():this.base,this.parens,this.sign,this.exp)};c.prototype.toString=function(a,
b){null==a&&(a="EQUAL");null==b&&(b=!1);return c.__super__.toString.call(this,""+CTATAlgebraTreeNode.toOperatorString(this.operator)+this.base.toString(this.operator),a,b)};c.prototype.addPaths=function(a){this.base.addPaths(a.concat(["base"]));return c.__super__.addPaths.apply(this,arguments)};c.prototype.evaluate=function(a,b){null==a&&(a=null);null==b&&(b=!0);return c.__super__.evaluate.call(this,this.applyOperator(this.base.evaluate(a)),b)};c.prototype.equals=function(a){return c.__super__.equals.call(this,
a)&&this.base.equals(a.base)};c.prototype.countOperands=function(){return 1};c.prototype.getOperator=function(a,b){null==a&&(a=!1);null==b&&(b=null);return a&&c.__super__.getOperator.apply(this,arguments)||this.operator};c.prototype.getOperators=function(a){null==a&&(a=!1);return[this.getOperator(a)].concat(this.base.getOperators())};c.prototype.getVariables=function(){return this.base.getVariables()};c.prototype.getOperands=function(){return[this.base]};c.prototype.findExpression=function(a,b){return this.base.findExpression(a,
b.concat(["base"])).concat(c.__super__.findExpression.call(this,a,b))};c.prototype.applyRules=function(a,b){this.rules=a;null==b&&(b=!0);b&&(this.base=this.base.applyRules(this.rules));return c.__super__.applyRules.apply(this,arguments)};c.prototype.removeNull=function(){var a;this.base=null!=(a=this.base)?a.removeNull():void 0;return null!=this.base?this:null};c.prototype.simpleFlatten=function(){if(this.parented())return this;this.negation()&&(this.negate(),this.operator="UPLUS");return this.pushNegation().pushInversion().base};
c.prototype.flatten=function(){return c.__super__.flatten.apply(this,arguments).popNegation()};c.prototype.compare=function(a,b){return a.unary()&&this.base.compare(a.base,b)||c.__super__.compare.apply(this,arguments)||this.compareSigns(a,b)};c.prototype.countVariables=function(){return this.base.countVariables()};c.prototype.pushNegation=function(){this.negated()&&(this.negate(),this.base.negate());return this};c.prototype.pushInversion=function(){this.inverted()&&(this.invert(),this.base.invert());
return this};c.prototype.constant=function(a,c){null==c&&(c=!1);return this.base.constant(a,c)};c.prototype.unknown=function(){return this.base.unknown()};return c}(CTATAlgebraTreeNode);"undefined"!==typeof module&&null!==module?module.exports=b:this.CTATUnaryNode=b}).call(this);var CTATPowerNode={};
(function(){var b,g=function(b,c){function a(){this.constructor=b}for(var d in c)f.call(c,d)&&(b[d]=c[d]);a.prototype=c.prototype;b.prototype=new a;b.__super__=c.prototype;return b},f={}.hasOwnProperty;b=function(b){function c(a,c,b,e,f,g){this.operator=a;this.base=c;this.exponent=b;this.parens=null!=e?e:0;this.sign=null!=f?f:1;this.exp=null!=g?g:1}g(c,b);c.prototype.clone=function(a){null==a&&(a=!0);return new c(this.operator,a?this.base.clone():this.base,a?this.exponent.clone():this.exponent,this.parens,
this.sign,this.exp)};c.prototype.toString=function(a,b){null==a&&(a="EQUAL");null==b&&(b=!1);return c.__super__.toString.call(this,""+this.base.toString(this.operator)+CTATAlgebraTreeNode.toOperatorString(this.operator)+this.exponent.toString(this.operator),a,b)};c.prototype.addPaths=function(a){this.base.addPaths(a.concat(["base"]));this.exponent.addPaths(a.concat(["exponent"]));return c.__super__.addPaths.apply(this,arguments)};c.prototype.evaluate=function(a){null==a&&(a=null);return c.__super__.evaluate.call(this,
this.applyOperator(this.base.evaluate(a),this.exponent.evaluate(a)))};c.prototype.equals=function(a){return c.__super__.equals.call(this,a)&&this.base.equals(a.base)&&this.exponent.equals(a.exponent)};c.prototype.countOperands=function(){return 2};c.prototype.getOperator=function(a,b){null==a&&(a=!1);null==b&&(b=null);return a&&c.__super__.getOperator.apply(this,arguments)||this.operator};c.prototype.getOperators=function(a){null==a&&(a=!1);return this.base.getOperators().concat(this.getOperator(a),
this.exponent.getOperators())};c.prototype.getVariables=function(){return this.base.getVariables().concat(this.exponent.getVariables())};c.prototype.getOperands=function(){return[this.base,this.exponent]};c.prototype.findExpression=function(a,b){return this.base.findExpression(a,b.concat(["base"])).concat(c.__super__.findExpression.call(this,a,b),this.exponent.findExpression(a,b.concat(["exponent"])))};c.prototype.applyRules=function(a,b){this.rules=a;null==b&&(b=!0);b&&(this.base=this.base.applyRules(this.rules),
this.exponent=this.exponent.applyRules(this.rules));return c.__super__.applyRules.apply(this,arguments)};c.prototype.removeNull=function(){var a,c;this.base=null!=(a=this.base)?a.removeNull():void 0;this.exponent=null!=(c=this.exponent)?c.removeNull():void 0;return null!=this.base&&null!=this.exponent?this:this.base||this.exponent||null};c.prototype.flatten=function(){var a,b;c.__super__.flatten.apply(this,arguments);this.root()&&(this.exponent.invert(),this.operator="EXP");this.popNegation().popInversion();
return this.base.power()?(b=CTATAlgebraTreeNode.diff(this.rules,["flatten"]),a=this.base.exponent.multiplication()?this.base.exponent.pushNegation().pushInversion().factors:[this.base.exponent],this.exponent.multiplication()?a.push.apply(a,this.exponent.pushNegation().pushInversion().factors):a.push(this.exponent),this.base.exponent=(new CTATMultiplicationNode("TIMES",a)).applyRules(b,!1),this.pushBaseNegation().pushBaseInversion().base):this};c.prototype.computeConstants=function(){return this.base.constant()&&
(this.exponent.constant()||this.exponent.multiplication()&&this.exponent.factors[0].constant())?(this.exponent.constant()?(this.base=new CTATConstantNode(this.evaluate()),this.exponent=null,this.exp=1):(this.base=new CTATConstantNode((new c("EXP",this.base,this.exponent.factors.shift())).evaluate()),1===this.exponent.factors.length&&(this.exponent=this.exponent.pushNegation().pushInversion().factors[0])),this.exponent?this:this.pushBaseNegation().pushBaseInversion().base):this};c.prototype.powerOne=
function(a){null==a&&(a=!1);this.exponent=this.exponent.multiplyOne(a);return this.pushInversion()};c.prototype.expand=function(){var a,c,b;if(this.base.addition()&&(this.exponent.integer()&&1<this.exponent.value||this.exponent.multiplication()&&this.exponent.factors[0].integer()&&1<this.exponent.factors[0].value)){this.exponent.integer()?(a=this.exponent,this.exponent=null):(a=this.exponent.factors.shift(),1===this.exponent.factors.length&&(this.exponent=this.exponent.pushNegation().pushInversion().factors[0]));
c=[this.base];b=1;for(a=a.evaluate();1<=a?b<a:b>a;1<=a?++b:--b)c.push(this.base.clone());this.base=(new CTATMultiplicationNode("TIMES",c)).applyRules(["distribute"],!1);return this.exponent?this:this.pushBaseNegation().pushBaseInversion().base}return this};c.prototype.distribute=function(){var a;return this.base.multiplication()||this.exponent.addition()?(a=this.base.multiplication()?this.base.pushNegation().pushInversion().factors:[this.base],a=this.exponent.addition()?a.reduce(function(a){return function(c,
b){c.push.apply(c,a.exponent.terms.map(function(a){return[b.clone(),a.clone()]}));return c}}(this),[]):a.map(function(a){return function(c){return[c,a.exponent.clone()]}}(this)),this.base=this.packFactors(a),this.pushBaseNegation().pushBaseInversion().base):this};c.prototype.packFactors=function(a){var b;b=CTATAlgebraTreeNode.diff(this.rules,["flatten"]);return new CTATMultiplicationNode("TIMES",a.map(function(a){return(new c("EXP",a[0],a[1])).applyRules(b,!1)}))};c.prototype.removeIdentity=function(a){null==
a&&(a=!1);this.popInversion();if(this.exponent.constant(0,a))return this.base=new CTATConstantNode(1,a),this.pushBaseNegation().base;if(this.base.constant(0,a))return this.pushBaseInversion().base;if(this.exponent.constant(1,a))return this.pushBaseNegation().pushBaseInversion().base;this.exponent=this.exponent.removeIdentity(a);return this};c.prototype.compare=function(a,b){return c.__super__.compare.apply(this,arguments)||(this.countVariables()-a.countVariables())*(b?-1:1)||this.exponent.compare(a.exponent,
b)||this.base.compare(a.base,b)||this.compareSigns(a,b)};c.prototype.countVariables=function(){return this.base.countVariables()*(this.exponent.constant()?Math.abs(this.exponent.evaluate()):Infinity)};c.prototype.pushBaseNegation=function(){this.negated()&&(this.negate(),this.base.negate());return this};c.prototype.pushInversion=function(){this.inverted()&&(this.invert(),this.exponent.negate());return this};c.prototype.pushBaseInversion=function(){this.inverted()&&(this.invert(),this.base.invert());
return this};c.prototype.popNegation=function(){this.base.negated()&&this.exponent.constant()&&(this.base.negate(),this.exponent.even()||this.negate());return this};c.prototype.popInversion=function(){this.exponent.negated()&&(this.invert(),this.exponent.negate());this.base.inverted()&&(this.invert(),this.base.invert());return this};c.prototype.unknown=function(){return this.base.unknown()||this.exponent.unknown()};c.prototype.even=function(){return!this.inverted()&&this.base.even()&&this.exponent.integer()};
return c}(CTATAlgebraTreeNode);"undefined"!==typeof module&&null!==module?module.exports=b:this.CTATPowerNode=b}).call(this);var CTATVariableNode={};
(function(){var b,g=function(b,c){function a(){this.constructor=b}for(var d in c)f.call(c,d)&&(b[d]=c[d]);a.prototype=c.prototype;b.prototype=new a;b.__super__=c.prototype;return b},f={}.hasOwnProperty;b=function(b){function c(a,c,b,e,f){this.variableTable=a;this.variable=c;this.parens=null!=b?b:0;this.sign=null!=e?e:1;this.exp=null!=f?f:1;this.operator="VAR"}g(c,b);c.prototype.clone=function(){return new c(this.variableTable,this.variable,this.parens,this.sign,this.exp)};c.prototype.toString=function(a,
b){null==a&&(a="EQUAL");null==b&&(b=!1);return c.__super__.toString.call(this,this.variable,a,b)};c.prototype.evaluate=function(a){null==a&&(a=null);return c.__super__.evaluate.call(this,null!=a?("function"===typeof a.get?a.get(this.variable):void 0)||a[this.variable]:null!=this.variableTable?this.variableTable.get(this.variable):function(){try{return eval(this.variable)}catch(d){}}.call(this))};c.prototype.equals=function(a){return c.__super__.equals.call(this,a)&&this.variable===a.variable};c.prototype.getOperator=
function(a,b){null==a&&(a=!1);null==b&&(b=null);return a&&c.__super__.getOperator.apply(this,arguments)};c.prototype.getVariables=function(){return[this.variable]};c.prototype.compare=function(a,b){b=null!=b?-1:1;return c.__super__.compare.apply(this,arguments)||this.variable>a.variable&&b||this.variable<a.variable&&-b||this.compareSigns(a,b)};c.prototype.countVariables=function(){return 1};return c}(CTATAlgebraTreeNode);"undefined"!==typeof module&&null!==module?module.exports=b:this.CTATVariableNode=
b}).call(this);var CTATConstantNode={};
(function(){var b,g=function(b,c){function a(){this.constructor=b}for(var d in c)f.call(c,d)&&(b[d]=c[d]);a.prototype=c.prototype;b.prototype=new a;b.__super__=c.prototype;return b},f={}.hasOwnProperty;b=function(b){function c(a,c,b,e,f){this.value=a;this.marked=null!=c?c:!1;this.parens=null!=b?b:0;this.sign=null!=e?e:1;this.exp=null!=f?f:1;this.operator="CONST"}g(c,b);c.prototype.clone=function(){return new c(this.value,this.marked,this.parens,this.sign,this.exp)};c.prototype.toString=function(a,
b){null==a&&(a="EQUAL");null==b&&(b=!1);return c.__super__.toString.call(this,this.value.toString(),a,b)};c.prototype.evaluate=function(a,b){null==b&&(b=!0);return c.__super__.evaluate.call(this,this.value,b)};c.prototype.equals=function(a){return c.__super__.equals.call(this,a)&&this.value===a.value};c.prototype.getOperator=function(a,b){null==a&&(a=!1);null==b&&(b=null);return a&&c.__super__.getOperator.apply(this,arguments)};c.prototype.multiplyOne=function(){return this};c.prototype.powerOne=
function(){return this};c.prototype.compare=function(a,b){b=null!=b?1:-1;return c.__super__.compare.apply(this,arguments)||Math.sign(Math.abs(this.evaluate())-Math.abs(a.evaluate()))*b||this.compareSigns(a,b)};c.prototype.popNegation=function(){0>this.value&&(this.negate(),this.value=-this.value);return this};c.prototype.constant=function(a,c){null==c&&(c=!1);return null==a||this.evaluate()===a&&this.marked===c};c.prototype.integer=function(){return Math.floor(this.evaluate())===this.value};c.prototype.even=
function(){return 0===this.evaluate()%2};c.prototype.set=function(a){this.exp=1;this.value=Math.abs(a);return this.sign=Math.sign(a)};return c}(CTATAlgebraTreeNode);"undefined"!==typeof module&&null!==module?module.exports=b:this.CTATConstantNode=b}).call(this);var CTATUnknownNode={};
(function(){var b,g=function(b,c){function a(){this.constructor=b}for(var d in c)f.call(c,d)&&(b[d]=c[d]);a.prototype=c.prototype;b.prototype=new a;b.__super__=c.prototype;return b},f={}.hasOwnProperty;b=function(b){function c(a,c,b){this.parens=null!=a?a:0;this.sign=null!=c?c:1;this.exp=null!=b?b:1;this.operator="UNKNOWN"}g(c,b);c.prototype.clone=function(){return new c(this.parens,this.sign,this.exp)};c.prototype.toString=function(a,b){null==a&&(a="EQUAL");null==b&&(b=!1);return c.__super__.toString.call(this,
"?",a,b)};c.prototype.evaluate=function(a){return NaN};c.prototype.getOperator=function(a,b){null==a&&(a=!1);null==b&&(b=null);return a&&c.__super__.getOperator.apply(this,arguments)};c.prototype.compare=function(a,b){b=null!=b?1:-1;return c.__super__.compare.apply(this,arguments)||this.compareSigns(a,b)};c.prototype.unknown=function(){return!0};return c}(CTATAlgebraTreeNode);"undefined"!==typeof module&&null!==module?module.exports=b:this.CTATUnknownNode=b}).call(this);var CTATAlgebraGrammar=function(){function b(){this.yy={}}var g=function(a,c,b,d){b=b||{};for(d=a.length;d--;b[a[d]]=c);return b},f=[1,6],e=[1,7],c=[1,10],a=[1,11],d=[1,12],h=[1,13],l=[1,14],n=[1,22],p=[1,23],q=[5,7,8,9,10,11,12,13,15,26],u=[1,24],v=[1,25],y=[1,27],w=[1,28],A=[5,7,8,9,10,11,12,13,15,16,18,20,21,24,25,26,27,28,29],z=[5,7,8,9,10,11,12,13,15,16,18,20,21,23,24,25,26,27,28,29],g={trace:function(){},yy:{},symbols_:{error:2,expression:3,relational:4,EOF:5,arithmetic:6,LESS:7,GREATER:8,LESSEQUAL:9,
GREATEREQUAL:10,EQUAL:11,NOTEQUAL:12,PLUS:13,term:14,MINUS:15,TIMES:16,signedfactor:17,DIVIDE:18,factor:19,IDIVIDE:20,REM:21,atom:22,EXP:23,SQRT:24,LPAREN:25,RPAREN:26,VARIABLE:27,NUMBER:28,UNKNOWN:29,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",7:"LESS",8:"GREATER",9:"LESSEQUAL",10:"GREATEREQUAL",11:"EQUAL",12:"NOTEQUAL",13:"PLUS",15:"MINUS",16:"TIMES",18:"DIVIDE",20:"IDIVIDE",21:"REM",23:"EXP",24:"SQRT",25:"LPAREN",26:"RPAREN",27:"VARIABLE",28:"NUMBER",29:"UNKNOWN"},productions_:[0,[3,2],[4,
3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,1],[6,3],[6,3],[6,1],[14,3],[14,3],[14,2],[14,3],[14,3],[14,1],[17,2],[17,2],[17,1],[19,3],[19,2],[19,1],[22,3],[22,1],[22,1],[22,1]],performAction:function(a,c,b,d,e,f,g){a=f.length-1;switch(e){case 1:return f[a-1];case 2:this.$=new d.CTATRelationNode("LESS",f[a-2],f[a]);break;case 3:this.$=new d.CTATRelationNode("GREATER",f[a-2],f[a]);break;case 4:this.$=new d.CTATRelationNode("LESSEQUAL",f[a-2],f[a]);break;case 5:this.$=new d.CTATRelationNode("GREATEREQUAL",
f[a-2],f[a]);break;case 6:this.$=new d.CTATRelationNode("EQUAL",f[a-2],f[a]);break;case 7:this.$=new d.CTATRelationNode("NOTEQUAL",f[a-2],f[a]);break;case 8:case 11:case 17:case 20:case 23:this.$=f[a];break;case 9:this.$=new d.CTATAdditionNode("PLUS",[f[a-2],f[a]]);break;case 10:this.$=new d.CTATAdditionNode("MINUS",[f[a-2],f[a]]);break;case 12:this.$=new d.CTATMultiplicationNode("TIMES",[f[a-2],f[a]]);break;case 13:this.$=new d.CTATMultiplicationNode("DIVIDE",[f[a-2],f[a]]);break;case 14:this.$=
new d.CTATMultiplicationNode("ITIMES",[f[a-1],f[a]]);break;case 15:this.$=new d.CTATIntDivisionNode("IDIVIDE",f[a-2],f[a]);break;case 16:this.$=new d.CTATIntDivisionNode("REM",f[a-2],f[a]);break;case 18:this.$=new d.CTATUnaryNode("UPLUS",f[a]);break;case 19:this.$=new d.CTATUnaryNode("UMINUS",f[a]);break;case 21:this.$=new d.CTATPowerNode("EXP",f[a-2],f[a]);break;case 22:this.$=new d.CTATPowerNode("ROOT",f[a],new d.CTATConstantNode(2));break;case 24:this.$=f[a-1].setParens();break;case 25:this.$=
new d.CTATVariableNode(d.variableTable,f[a]);break;case 26:this.$=new d.CTATConstantNode(Number(f[a]));break;case 27:this.$=new d.CTATUnknownNode}},table:[{3:1,4:2,6:3,13:f,14:4,15:e,17:5,19:8,22:9,24:c,25:a,27:d,28:h,29:l},{1:[3]},{5:[1,15]},{5:[2,8],7:[1,16],8:[1,17],9:[1,18],10:[1,19],11:[1,20],12:[1,21],13:n,15:p},g(q,[2,11],{22:9,19:26,16:u,18:v,20:y,21:w,24:c,25:a,27:d,28:h,29:l}),g(A,[2,17]),{13:f,15:e,17:29,19:8,22:9,24:c,25:a,27:d,28:h,29:l},{13:f,15:e,17:30,19:8,22:9,24:c,25:a,27:d,28:h,
29:l},g(A,[2,20]),g(A,[2,23],{23:[1,31]}),{13:f,15:e,17:32,19:8,22:9,24:c,25:a,27:d,28:h,29:l},{6:33,13:f,14:4,15:e,17:5,19:8,22:9,24:c,25:a,27:d,28:h,29:l},g(z,[2,25]),g(z,[2,26]),g(z,[2,27]),{1:[2,1]},{6:34,13:f,14:4,15:e,17:5,19:8,22:9,24:c,25:a,27:d,28:h,29:l},{6:35,13:f,14:4,15:e,17:5,19:8,22:9,24:c,25:a,27:d,28:h,29:l},{6:36,13:f,14:4,15:e,17:5,19:8,22:9,24:c,25:a,27:d,28:h,29:l},{6:37,13:f,14:4,15:e,17:5,19:8,22:9,24:c,25:a,27:d,28:h,29:l},{6:38,13:f,14:4,15:e,17:5,19:8,22:9,24:c,25:a,27:d,
28:h,29:l},{6:39,13:f,14:4,15:e,17:5,19:8,22:9,24:c,25:a,27:d,28:h,29:l},{13:f,14:40,15:e,17:5,19:8,22:9,24:c,25:a,27:d,28:h,29:l},{13:f,14:41,15:e,17:5,19:8,22:9,24:c,25:a,27:d,28:h,29:l},{13:f,15:e,17:42,19:8,22:9,24:c,25:a,27:d,28:h,29:l},{13:f,15:e,17:43,19:8,22:9,24:c,25:a,27:d,28:h,29:l},g(A,[2,14]),{13:f,15:e,17:44,19:8,22:9,24:c,25:a,27:d,28:h,29:l},{13:f,15:e,17:45,19:8,22:9,24:c,25:a,27:d,28:h,29:l},g(A,[2,18]),g(A,[2,19]),{13:f,15:e,17:46,19:8,22:9,24:c,25:a,27:d,28:h,29:l},g(A,[2,22]),
{13:n,15:p,26:[1,47]},{5:[2,2],13:n,15:p},{5:[2,3],13:n,15:p},{5:[2,4],13:n,15:p},{5:[2,5],13:n,15:p},{5:[2,6],13:n,15:p},{5:[2,7],13:n,15:p},g(q,[2,9],{22:9,19:26,16:u,18:v,20:y,21:w,24:c,25:a,27:d,28:h,29:l}),g(q,[2,10],{22:9,19:26,16:u,18:v,20:y,21:w,24:c,25:a,27:d,28:h,29:l}),g(A,[2,12]),g(A,[2,13]),g(A,[2,15]),g(A,[2,16]),g(A,[2,21]),g(z,[2,24])],defaultActions:{15:[2,1]},parseError:function(a,c){if(c.recoverable)this.trace(a);else throw a=Error(a),a.hash=c,a;},parse:function(a){var c=[0],b=
[null],d=[],e=this.table,f="",g=0,h=0,l=0,n=d.slice.call(arguments,1),p=Object.create(this.lexer),q={},w;for(w in this.yy)Object.prototype.hasOwnProperty.call(this.yy,w)&&(q[w]=this.yy[w]);p.setInput(a,q);q.lexer=p;q.parser=this;"undefined"==typeof p.yylloc&&(p.yylloc={});w=p.yylloc;d.push(w);var u=p.options&&p.options.ranges;this.parseError="function"===typeof q.parseError?q.parseError:Object.getPrototypeOf(this).parseError;for(var v,y,A,C,z={},S,W;;){A=c[c.length-1];if(this.defaultActions[A])C=
this.defaultActions[A];else{if(null===v||"undefined"==typeof v)v=p.lex()||1,"number"!==typeof v&&(v=this.symbols_[v]||v);C=e[A]&&e[A][v]}if("undefined"===typeof C||!C.length||!C[0]){var T;W=[];for(S in e[A])this.terminals_[S]&&2<S&&W.push("'"+this.terminals_[S]+"'");T=p.showPosition?"Parse error on line "+(g+1)+":\n"+p.showPosition()+"\nExpecting "+W.join(", ")+", got '"+(this.terminals_[v]||v)+"'":"Parse error on line "+(g+1)+": Unexpected "+(1==v?"end of input":"'"+(this.terminals_[v]||v)+"'");
this.parseError(T,{text:p.match,token:this.terminals_[v]||v,line:p.yylineno,loc:w,expected:W})}if(C[0]instanceof Array&&1<C.length)throw Error("Parse Error: multiple actions possible at state: "+A+", token: "+v);switch(C[0]){case 1:c.push(v);b.push(p.yytext);d.push(p.yylloc);c.push(C[1]);v=null;y?(v=y,y=null):(h=p.yyleng,f=p.yytext,g=p.yylineno,w=p.yylloc,0<l&&l--);break;case 2:W=this.productions_[C[1]][1];z.$=b[b.length-W];z._$={first_line:d[d.length-(W||1)].first_line,last_line:d[d.length-1].last_line,
first_column:d[d.length-(W||1)].first_column,last_column:d[d.length-1].last_column};u&&(z._$.range=[d[d.length-(W||1)].range[0],d[d.length-1].range[1]]);A=this.performAction.apply(z,[f,h,g,q,C[1],b,d].concat(n));if("undefined"!==typeof A)return A;W&&(c=c.slice(0,-2*W),b=b.slice(0,-1*W),d=d.slice(0,-1*W));c.push(this.productions_[C[1]][0]);b.push(z.$);d.push(z._$);C=e[c[c.length-2]][c[c.length-1]];c.push(C);break;case 3:return!0}}}},f=function(){return{EOF:1,parseError:function(a,c){if(this.yy.parser)this.yy.parser.parseError(a,
c);else throw Error(a);},setInput:function(a,c){this.yy=c||this.yy||{};this._input=a;this._more=this._backtrack=this.done=!1;this.yylineno=this.yyleng=0;this.yytext=this.matched=this.match="";this.conditionStack=["INITIAL"];this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0};this.options.ranges&&(this.yylloc.range=[0,0]);this.offset=0;return this},input:function(){var a=this._input[0];this.yytext+=a;this.yyleng++;this.offset++;this.match+=a;this.matched+=a;a.match(/(?:\r\n?|\n).*/g)?
(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++;this.options.ranges&&this.yylloc.range[1]++;this._input=this._input.slice(1);return a},unput:function(a){var c=a.length,b=a.split(/(?:\r\n?|\n)/g);this._input=a+this._input;this.yytext=this.yytext.substr(0,this.yytext.length-c);this.offset-=c;a=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1);this.matched=this.matched.substr(0,this.matched.length-1);b.length-1&&(this.yylineno-=b.length-1);var d=
this.yylloc.range;this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:b?(b.length===a.length?this.yylloc.first_column:0)+a[a.length-b.length].length-b[0].length:this.yylloc.first_column-c};this.options.ranges&&(this.yylloc.range=[d[0],d[0]+this.yyleng-c]);this.yyleng=this.yytext.length;return this},more:function(){this._more=!0;return this},reject:function(){if(this.options.backtrack_lexer)this._backtrack=!0;else return this.parseError("Lexical error on line "+
(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno});return this},less:function(a){this.unput(this.match.slice(a))},pastInput:function(){var a=this.matched.substr(0,this.matched.length-this.match.length);return(20<a.length?"...":"")+a.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var a=this.match;20>a.length&&(a+=this._input.substr(0,
20-a.length));return(a.substr(0,20)+(20<a.length?"...":"")).replace(/\n/g,"")},showPosition:function(){var a=this.pastInput(),c=Array(a.length+1).join("-");return a+this.upcomingInput()+"\n"+c+"^"},test_match:function(a,c){var b,d;this.options.backtrack_lexer&&(d={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,
yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(d.yylloc.range=this.yylloc.range.slice(0)));if(b=a[0].match(/(?:\r\n?|\n).*/g))this.yylineno+=b.length;this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:b?b[b.length-1].length-b[b.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+a[0].length};this.yytext+=
a[0];this.match+=a[0];this.matches=a;this.yyleng=this.yytext.length;this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]);this._backtrack=this._more=!1;this._input=this._input.slice(a[0].length);this.matched+=a[0];a=this.performAction.call(this,this.yy,this,c,this.conditionStack[this.conditionStack.length-1]);this.done&&this._input&&(this.done=!1);if(a)return a;if(this._backtrack)for(var e in d)this[e]=d[e];return!1},next:function(){if(this.done)return this.EOF;this._input||
(this.done=!0);var a,c,b;this._more||(this.match=this.yytext="");for(var d=this._currentRules(),e=0;e<d.length;e++)if((c=this._input.match(this.rules[d[e]]))&&(!a||c[0].length>a[0].length))if(a=c,b=e,this.options.backtrack_lexer){a=this.test_match(c,d[e]);if(!1!==a)return a;if(this._backtrack)a=!1;else return!1}else if(!this.options.flex)break;return a?(a=this.test_match(a,d[b]),!1!==a?a:!1):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+
this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var a=this.next();return a?a:this.lex()},begin:function(a){this.conditionStack.push(a)},popState:function(){return 0<this.conditionStack.length-1?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(a){a=
this.conditionStack.length-1-Math.abs(a||0);return 0<=a?this.conditionStack[a]:"INITIAL"},pushState:function(a){this.begin(a)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(a,c,b,d){switch(b){case 1:return 25;case 2:return 26;case 3:return 23;case 4:return 23;case 5:return 24;case 6:return 24;case 7:return 16;case 8:return 16;case 9:return 16;case 10:return 20;case 11:return 18;case 12:return 18;case 13:return 21;case 14:return 15;case 15:return 13;
case 16:return 9;case 17:return 9;case 18:return 10;case 19:return 10;case 20:return 7;case 21:return 8;case 22:return 12;case 23:return 12;case 24:return 12;case 25:return 12;case 26:return 11;case 27:return 11;case 28:return 28;case 29:return 28;case 30:return 27;case 31:return 29;case 32:return 5}},rules:[/^(?:\s+)/,/^(?:\()/,/^(?:\))/,/^(?:\*\*)/,/^(?:\^)/,/^(?:\|)/,/^(?:\u221a)/,/^(?:\*)/,/^(?:\u00d7)/,/^(?:\u22c5)/,/^(?:\/\/)/,/^(?:\/)/,/^(?:\u00f7)/,/^(?:%)/,/^(?:-)/,/^(?:\+)/,/^(?:<=)/,/^(?:\u2264)/,
/^(?:>=)/,/^(?:\u2265)/,/^(?:<)/,/^(?:>)/,/^(?:!=)/,/^(?:\/=)/,/^(?:<>)/,/^(?:\u2260)/,/^(?:==)/,/^(?:=)/,/^(?:(([0-9])+\.?([0-9])*|\.([0-9])+)([Ee][+-]?([0-9])+)?)/,/^(?:(0[Bb]([0-1])+|0[Oo]([0-7])+|0[Xx]([0-9A-Fa-f])+))/,/^(?:([A-Za-z]))/,/^(?:\?)/,/^(?:$)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32],inclusive:!0}}}}();g.lexer=f;b.prototype=g;g.Parser=b;return new b}();var CTATAlgebraParser={};
(function(){var b,g=[].slice;b=function(){function b(b){this.parser=new CTATAlgebraGrammar.Parser;this.parser.yy={CTATRelationNode:CTATRelationNode,CTATAdditionNode:CTATAdditionNode,CTATMultiplicationNode:CTATMultiplicationNode,CTATIntDivisionNode:CTATIntDivisionNode,CTATUnaryNode:CTATUnaryNode,CTATPowerNode:CTATPowerNode,CTATVariableNode:CTATVariableNode,CTATConstantNode:CTATConstantNode,CTATUnknownNode:CTATUnknownNode,CTATAlgebraTreeNode:CTATAlgebraTreeNode};this.parser.yy.variableTable=b}b.partial=
["flatten","removeIdentity"];b.full="flatten computeConstants combineSimilar expand distribute removeIdentity".split(" ");b.prototype.toTree=function(b,c,a,d){null==c&&(c=!1);null==a&&(a=!1);null==d&&(d=!1);return(b instanceof CTATAlgebraTreeNode?a?b.clone():b:this.parser.parse(String(b))).applyRules([d?"flatten":"simpleFlatten"].concat(c?"sort":[]))};b.prototype.toExpression=function(b,c,a){null==a&&(a=!0);return b instanceof CTATAlgebraTreeNode?a&&c instanceof CTATAlgebraTreeNode?c.addPaths(c.path||
[]):c:null!=c?c.toString():c};b.prototype.equalExpressions=function(b,c){return b instanceof CTATAlgebraTreeNode||c instanceof CTATAlgebraTreeNode?b.toString()===c.toString():b===c};b.prototype.algParse=function(b,c,a){null==c&&(c=!1);null==a&&(a=!1);try{return this.toTree(b,c,!0,a).addPaths([])}catch(d){return null}};b.prototype.algGetError=function(b){try{return b instanceof CTATAlgebraTreeNode||this.parser.parse(String(b)),null}catch(c){return c}};b.prototype.algStringify=function(b){return(null!=
b?b.toString():void 0)||null};b.prototype.algEvaluate=function(b,c){null==c&&(c=null);try{return this.toTree(b).evaluate(c)}catch(a){return null}};b.prototype.algSort=function(b){try{return this.toExpression(b,this.toTree(b,!0,!0))}catch(c){return null}};b.prototype.algGetOperator=function(b){try{return this.toTree(b).getOperator(!0,1)}catch(c){return null}};b.prototype.algGetOperators=function(b){try{return this.toTree(b).getOperators(!0)}catch(c){return null}};b.prototype.algGetVariables=function(b){try{return this.toTree(b).getVariables()}catch(c){return null}};
b.prototype.algGetOperands=function(b){var c;try{return null!=(c=this.toTree(b))?c.getOperands().map(function(a){return function(c){return a.toExpression(b,c,!1)}}(this)):void 0}catch(a){return null}};b.prototype.algGetExpression=function(b,c,a){try{return this.toExpression(b,this.toTree(b).getExpression(c,a),!1)}catch(d){return null}};b.prototype.algFindExpression=function(b,c){try{return this.toTree(b).findExpression(this.toTree(c),[]).map(function(a){return function(c){return a.toExpression(b,
c,!1)}}(this))}catch(a){return null}};b.prototype.algCreateExpression=function(){var b,c,a,d;a=arguments[0];b=arguments[1];c=3<=arguments.length?g.call(arguments,2):[];try{return this.toExpression(b,(d=this.toTree(b,!1,!0)).createExpression.apply(d,[a].concat(g.call(c.map(function(a){return function(c){return a.toTree(c,!1,!0)}}(this))))))}catch(h){return null}};b.prototype.algReplaceExpression=function(b,c,a,d){var e,f;null==d&&(d=null);d=(null!=d?d:null!=(e=c.path)?e.slice(0):void 0)||0;try{return this.toExpression(b,
null!=(f=this.toTree(b))?f.replaceExpression(this.toTree(c),this.toTree(a),d):void 0)}catch(n){return null}};b.prototype.algDeleteExpression=function(b,c,a){var d,e;null==a&&(a=null);a=(null!=a?a:null!=(d=c.path)?d.slice(0):void 0)||0;try{return this.toExpression(b,null!=(e=this.toTree(b))?e.deleteExpression(this.toTree(c),a):void 0)}catch(l){return null}};b.prototype.algApplyRulesSelectively=function(){var b,c,a,d,f,l;b=arguments[0];l=arguments[1];c=arguments[2];a=arguments[3];d=5<=arguments.length?
g.call(arguments,4):[];null==c&&(c=!0);null==a&&(a=null);try{return this.toExpression(b,(f=this.toTree(b,!1,!0)).applyRulesSelectively.apply(f,[l,c,a].concat(g.call(d))))}catch(n){return null}};b.prototype.algApplyRules=function(b,c,a){null==a&&(a=!0);try{return this.toExpression(b,this.toTree(b,!1,!0).applyRules(c,a))}catch(d){return null}};b.prototype.algPartiallySimplify=function(e,c){null==c&&(c=!1);return this.algApplyRules(e,b.partial.concat(c?"sort":[]),!0)};b.prototype.algSimplify=function(e,
c){null==c&&(c=!1);return this.algApplyRules(e,b.full.concat(c?"sort":[]),!0)};b.prototype.algValid=function(b,c){var a,d;null==c&&(c=!1);return null!=(a=this.algParse(b,!0))&&null!=(d=this.algParse(b,!c))?this.equalExpressions(a,d):null};b.prototype.algValued=function(b,c){var a;null==c&&(c=null);return null!=(a=this.algEvaluate(b,c))?!isNaN(a):null};b.prototype.algPartiallySimplified=function(b,c){var a,d;null==c&&(c=!1);return null!=(a=this.algPartiallySimplify(b,!0))&&null!=(d=this.algParse(b,
!c))?this.equalExpressions(a,d):null};b.prototype.algSimplified=function(b,c){var a,d;null==c&&(c=!1);return null!=(a=this.algSimplify(b,!0))&&null!=(d=this.algParse(b,!c))?this.equalExpressions(a,d):null};b.prototype.algIdentical=function(b,c,a,d){null==a&&(a=!1);null==d&&(d=!1);return null!=(b=this.algParse(b,!a,d))&&null!=(c=this.algParse(c,!a,d))?this.equalExpressions(b,c):null};b.prototype.algEqual=function(b,c,a){var d,e;null==a&&(a=null);return null!=(d=this.algEvaluate(b,a))&&null!=(e=this.algEvaluate(c,
a))?d===e:null};b.prototype.algPartiallyEquivalent=function(b,c,a){null==a&&(a=!1);return null!=(b=this.algPartiallySimplify(b,!a))&&null!=(c=this.algPartiallySimplify(c,!a))?this.equalExpressions(b,c):null};b.prototype.algEquivalent=function(b,c,a){null==a&&(a=!1);return null!=(b=this.algSimplify(b,!a))&&null!=(c=this.algSimplify(c,!a))?this.equalExpressions(b,c):null};b.prototype.isAlgValid=b.prototype.algValid;b.prototype.algEval=b.prototype.algEvaluate;b.prototype.algStrictEquivTermsSameOrder=
function(b,c){return this.algPartiallyEquivalent(b,c,!0)};b.prototype.algEquivTermsSameOrder=b.prototype.algStrictEquivTermsSameOrder;b.prototype.algStrictEquivTerms=b.prototype.algPartiallyEquivalent;b.prototype.algEquivTerms=b.prototype.algStrictEquivTerms;b.prototype.algEquiv=b.prototype.algEquivalent;b.prototype.isSimplified=function(b){return this.algSimplified(b,!0)};b.prototype.calc=b.prototype.algEvaluate;b.prototype.calca=function(b){return(+this.algEvaluate(b)).toFixed(2)};b.prototype.simplify=
function(b){return this.algSimplify(b,!0)};b.prototype.algebraicEqual=b.prototype.algEqual;b.prototype.patternMatches=function(b,c){return this.algIdentical(b,c,!0)};b.prototype.polyTermsEqual=function(b,c){return this.algPartiallyEquivalent(b,c)};b.prototype.algebraicMatches=function(b,c){return this.algEquivalent(b,c,!0)};b.prototype.expressionMatches=b.prototype.algebraicMatches;return b}();"undefined"!==typeof module&&null!==module?module.exports=b:this.CTATAlgebraParser=b}).call(this);var CTATLogicTreeNode={};
(function(){var b,g=[].slice,f=[].indexOf||function(b){for(var c=0,a=this.length;c<a;c++)if(c in this&&this[c]===b)return c;return-1};b=function(){function b(c,a,d){this.operator=c;this.operatorSymbol=a;null==this.operatorSymbol||null==d||b.options.constantSymbols?null==this.operatorSymbol||null!=d||null==this.operator||b.options.operatorSymbols||(b.options.defaultOperatorSymbols[this.operator]=this.operatorSymbol):b.options.defaultConstantSymbols[d]=this.operatorSymbol}b.operators=[["CONST"],["VAR",
"NOT"],["AND","NAND"],["OR","NOR"],["IF","NIF"],["IFF","XOR"]];b.toOperatorString=function(c){var a;return(null!=(a=this.options.operatorSymbols)?a[c]:void 0)||this.options.defaultOperatorSymbols[c]||""};b.toConstantString=function(c){var a;return(null!=(a=this.options.constantSymbols)?a[c]:void 0)||this.options.defaultConstantSymbols[c]||""};b.diff=function(c,a){return c.filter(function(c){return function(c){return!a.includes(c)}}(this))};b.uniq=function(c){return c.filter(function(a){return function(a,
c,b){return b.indexOf(a)===c}}(this))};b.addIndex=function(c,a,b){c=c.slice(0);[].splice.apply(c,[b,b-b].concat(a));a;return c};b.removeIndex=function(c,a){c=c.slice(0);[].splice.apply(c,[a,a-a+1].concat(a=[]));a;return c};b.difference=function(c,a,b){var d,e;d=null!=(e=(null!=b?b:{}).deep)?e:!1;return c.filter(function(c){return function(c){return!a.some(function(a){return a===c||d&&a.equals(c)})}}(this))};b.intersection=function(c){return c[0].filter(function(a){return function(a){return c.every(function(c){return c.some(function(c){return c.equals(a)})})}}(this))};
b.commonItems=function(c){return c.some(function(a){return function(a){return a.some(function(b){return c.some(function(c){return c!==a&&c.some(function(a){return a.equals(b)})})})}}(this))};b.subsets=function(c,a,b){null==a&&(a=1);null==b&&(b=Infinity);return c.reduce(function(a){return function(a,c){var b;b=a.map(function(a){return g.call(a).concat([c])});b.unshift.apply(b,a);return b}}(this),[[]]).filter(function(c){return function(c){return c.length>=a&&c.length<=b}}(this))};b.sameNegation=function(c,
a){var b;a=null!=(b=(null!=a?a:{}).inverse)?b:!1;return c[0].negationNode()===c[1].negationNode()&&(!a||2===c.length&&c[0].negationNode())};b.oppositeNegation=function(c){var a;return(a=c.find(function(a){return function(a){return a.negationNode()}}(this)))&&c.every(function(c){return function(c){return c===a||!c.negationNode()}}(this))};b.sameOppositeTerms=function(c,a){var b,e;b=c.terms.concat(a.terms).filter(function(a){return function(a){return a.negationOperator()}}(this)).flatMap(function(a){return function(a){return a.right.conjunctionOperator()?
a.right.terms:[a.right]}}(this));e=c.terms.concat(a.terms).filter(function(a){return function(a){return!a.negationOperator()}}(this)).flatMap(function(a){return function(a){return a.conjunctionOperator()?a.terms:[a]}}(this));return b.length===e.length&&b.every(function(a){return function(a){return e.some(function(c){return c.equals(a)})}}(this))};b.replaceTerm=function(c,a,b){var d,e,f,g;b=null!=(d=(null!=b?b:{}).inverse)?d:!1;f=[];d=0;for(e=c.length;d<e;d++)g=c[d],(a[0]!==g||b&&(g=g.junctionNode(this.removeIndex(g.terms,
a[1]))))&&f.push(g);return f};b.emptyString=function(c,a,b,e){return/^\s*$/.test(c.slice(a-e,b-e))};b.prototype.addOperand=function(c,a,b,e,f){null==b&&(b=null);null==e&&(e="");null==f&&(f={});return new CTATLogicFlattenNode(c,[this,a],b,e,f)};b.prototype.mergeLocations=function(c,a){return[Math.min(c.location[0],a.location[0]),Math.max(c.location[1],a.location[1])]};b.prototype.setParens=function(c,a,b){this.parens=c;null!=a&&(this.string=a);null!=b&&(this.parensLocation=b);return this};b.prototype.checkParens=
function(){var c,a,b;return"NOT"===(c=this.operator)||"VAR"===c||"CONST"===c||this.parens&&("AND"!==(a=this.operator)&&"OR"!==a||2>=(null!=(b=this.terms)?b.length:void 0))};b.prototype.checkOperator=function(){var c;return(null!=(c=b.options.operatorSymbols)?c[this.operator]:void 0)===this.operatorSymbol};b.prototype.checkConstant=function(){var c;return(null!=(c=b.options.constantSymbols)?c[this.value]:void 0)===this.operatorSymbol};b.prototype.checkSelectedOperator=function(){var c;return c=this.operator,
0<=f.call(b.options.selectedOperators,c)};b.prototype.checkSelectedVariable=function(){var c;return c=this.variable,0<=f.call(b.options.selectedVariables,c)};b.prototype.toString=function(c,a,d){var e;null==a&&(a=null);d=null!=(e=(null!=d?d:{}).embedded)?e:!1;this.addParens(a,{embedded:d})&&(c="("+c+")");this.negated&&(c=""+b.toOperatorString("NOT")+c);return c};b.prototype.addParens=function(c,a){var d;a=null!=(d=(null!=a?a:{}).embedded)?d:!1;return this.parens||this.binaryOperator()&&(this.negated||
null!=c&&(b.options.strictParentheses||this.precedence()>c.precedence()||a&&this.precedence()===c.precedence()))};b.prototype.operatorString=function(){return""+(this.binaryOperator()?" ":"")+b.toOperatorString(this.operator)+(this.binaryOperator()?" ":"")};b.prototype.constantString=function(){return b.toConstantString(this.value)};b.prototype.evaluate=function(c){return this.negated?applyOperator("NOT",c):c};b.prototype.applyOperator=function(c,a,b){switch(c){case "NOT":if(null!=a)return!a;break;
case "AND":return null!=a?a&&b:b&&a;case "OR":return null!=a?a||b:b||a}};b.prototype.equals=function(c,a){var b;a=null!=(b=(null!=a?a:{}).inverse)?b:!1;return c&&this.operator===c.operator&&a!==(this.negated===c.negated)};b.prototype.subEquals=function(){return!1};b.prototype.subNode=function(){return this};b.prototype.countOperands=function(){return 0};b.prototype.subTree=function(c,a,b,e){return this.wholeNode(c,a,b,e)};b.prototype.wholeNode=function(c,a,d,e){var f;if(f=null!=this.parensLocation&&
(c<=this.parensLocation[0]&&this.parensLocation[1]<=a||this.parensLocation[0]<c&&c<=this.location[0]&&this.location[1]<=a&&a<this.parensLocation[1])||null==this.parensLocation&&c<=this.location[0]&&this.location[1]<=a){var g,h,q,u;if(null==d||b.emptyString(d,c,null!=(g=null!=(h=this.parensLocation)?h[0]:void 0)?g:this.location[0],e)&&b.emptyString(d,null!=(q=null!=(u=this.parensLocation)?u[1]:void 0)?q:this.location[1],a,e))f=this;else throw Error();}return f||void 0};b.prototype.getOperators=function(c){var a,
b;c=null!=(a=(null!=c?c:{}).symbols)?a:!1;return("CONST"===(b=this.operator)||"VAR"===b)&&[]||!c&&this.operator||this.operatorSymbol};b.prototype.getVariables=function(){return[]};b.prototype.getOperands=function(){return[]};b.prototype.getExpression=function(c){var a,b,e;b=null!=c?c:{};c=null!=(a=b.start)?a:0;a=null!=(e=b.end)?e:Infinity;if(e=0<=c&&c<a)a:{try{e=this.subTree(c,a);break a}catch(l){}e=void 0}return e||void 0};b.prototype.findOperator=function(c,a,b,e){var d;e=null!=(d=(null!=e?e:{}).paths)?
d:!1;return this.operator===c&&(null==this.terms||2===this.terms.length||null==b||b+2>=this.terms.length)?e?[Object.assign(this,{path:a})]:this:this.operator===c?e?[Object.assign(this.subNode(0,b+2),{path:a.concat([[0,b+2]])})]:this.subNode(0,b+2):[]};b.prototype.findExpression=function(c,a,b,e){var d,f;e=null!=(f=(null!=e?e:{}).paths)?f:!1;return!b&&this.equals(c)?e?[Object.assign(this,{path:a})]:[this]:null!=b&&this.subEquals(c,b)?e?[Object.assign(this.subNode(b,d=b+c.terms.length),{path:a.concat([[b,
d]])})]:[this.subNode(b,b+c.terms.length)]:[]};b.prototype.findRuleApplications=function(c,a,b,e){var d,f,g;f=null!=e?e:{};e=null!=(d=f.reverse)?d:!1;d=null!=(g=f.paths)?g:!1;return null==b&&this.testRule(c,b,{reverse:e})?d?[Object.assign(this,{path:a})]:[this]:null!=b&&this.testRule(c,b,{reverse:e})?d?[Object.assign(this.subNode(b,b+2),{path:a.concat([[b,b+2]])})]:[this.subNode(b,b+2)]:[]};b.prototype.testRule=function(c,a,b){var d;null==a&&(a=null);b=null!=(d=(null!=b?b:{}).reverse)?d:!1;return this.subNode(a)[c]({reverse:b,
test:!0})};b.prototype.createExpression=function(){var c,a;a=arguments[0];c=2<=arguments.length?g.call(arguments,1):[];switch(a){case "NAND":case "NOR":case "IF":case "NIF":case "IFF":case "XOR":return c[0]&&new CTATLogicRelationNode(a,this,c[0])||null;case "AND":case "OR":return 1<c.unshift(this)&&new CTATLogicFlattenNode(a,c)||null;case "NOT":return new CTATLogicRelationNode(a,null,this)}};b.prototype.replaceExpression=function(c,a,b){var d,e;b=(null!=b?b:{}).index;return null!=b||null!=c&&c.path||
!(d=this.findExpression(c,[],{paths:!0})[0])?null!=b&&(d=this.findExpression(c,[],{paths:!0})[b])?this.replaceOneExpression(d,a,d.path.slice(0)):this.replaceOneExpression(c,a,null!=c?null!=(e=c.path)?e.slice(0):void 0:void 0):this.replaceOneExpression(d,a,d.path.slice(0)).replaceExpression(c,a,{index:b})};b.prototype.replaceOneExpression=function(c,a,b){var d,e,f;if(null==b)return this;if(0===(null!=b?b.length:void 0))return a;if(null!=(f=null!=b?b.shift():void 0))return d=this.clone({deep:!1}),"string"===
typeof f?(d[f]=this[f].replaceOneExpression(c,a,b),d):"number"===typeof f?(d.terms=d.terms.slice(0),b.length?d.terms[f]=this.terms[f].replaceOneExpression(c,a,b):(c=this.operator===a.operator?a.terms:a,[].splice.apply(d.terms,[f,f-f+1].concat(c)),c),d):"object"===typeof f?(d.terms=d.terms.slice(0),c=this.operator===a.operator?a.terms:a,[].splice.apply(d.terms,[e=f[0],f[1]-e].concat(c)),c,d):this};b.prototype.deleteExpression=function(c,a){var b,e;a=(null!=a?a:{}).index;return null!=a||null!=c&&c.path||
!(b=this.findExpression(c,[],{paths:!0})[0])?null!=a&&(b=this.findExpression(c,[],{paths:!0})[a])?this.deleteOneExpression(b,b.path.slice(0)):this.deleteOneExpression(c,null!=c?null!=(e=c.path)?e.slice(0):void 0:void 0):this.deleteOneExpression(b,b.path.slice(0)).deleteExpression(c,{index:a})};b.prototype.deleteOneExpression=function(c,a){var b,e,f,g,p;if(null==a)return this;if(0===(null!=a?a.length:void 0))return null;if(null!=(p=null!=a?a.shift():void 0))return b=this.clone({deep:!1}),"string"===
typeof p?(b[p]=null!=(e=this[p])?e.deleteOneExpression(c,a):void 0,b.removeNull()):"number"===typeof p?(b.terms=b.terms.slice(0),b.terms[p]=null!=(f=this.terms[p])?f.deleteOneExpression(c,a):void 0,b.removeNull()):"object"===typeof p?(b.terms=b.terms.slice(0),[].splice.apply(b.terms,[g=p[0],p[1]-g].concat(null)),null,b.removeNull()):this};b.prototype.removeNull=function(){return this};b.prototype.applyRule=function(c,a,b){var d,e,f;null==a&&(a=null);f=null!=b?b:{};b=null!=(e=f.reverse)?e:!1;e=f.index;
d=null!=a?null!=e?this.findExpression(a,[],{paths:!0})[e]:null!=a&&a.path?a:this.findExpression(a,[],{paths:!0})[0]:this.findRuleApplications(c,[],{reverse:b,paths:!0})[null!=e?e:0];return null!=d?d.applyOneRule(c,null,{reverse:b,local:!0}).map(function(a){return function(c){return a.replaceExpression(d,c)}}(this)):[]};b.prototype.applyRules=function(c,a){var b,e;null==c&&(c=[]);e=null!=(b=(null!=a?a:{}).reverse)?b:!1;c="string"===typeof c?[c]:c;return c.reduce(function(a){return function(a,c){return a.map(function(a){return a.applyOneRule(c,
null,{reverse:e})})}}(this),[this])};b.prototype.applyOneRule=function(c,a,b){var d;null==a&&(a=null);b=null!=(d=(null!=b?b:{}).reverse)?d:!1;return null==a||this.equals(a)?this[c]({reverse:b}):[]};b.prototype.truthValues=function(c){var a;return!(null!=(a=(null!=c?c:{}).test)&&a)&&[]};b.prototype.domination=function(c){var a;return!(null!=(a=(null!=c?c:{}).test)&&a)&&[]};b.prototype.complement=function(c){var a;return!(null!=(a=(null!=c?c:{}).test)&&a)&&[]};b.prototype.identity=function(c){var a,
b,e;a=null!=c?c:{};c=null!=(b=a.reverse)?b:!1;b=null!=(e=a.test)?e:!1;return c?b||[new CTATLogicFlattenNode("OR",this,new CTATLogicConstantNode(!0))]:!b&&[]};b.prototype.idempotence=function(c){var a,b,e;a=null!=c?c:{};c=null!=(b=a.reverse)?b:!1;b=null!=(e=a.test)?e:!1;return c?b||[new CTATLogicFlattenNode("OR",[this,this])]:!b&&[]};b.prototype.absorption=function(c){var a;return!(null!=(a=(null!=c?c:{}).test)&&a)&&[]};b.prototype.inverseAbsorption=function(c){var a;return!(null!=(a=(null!=c?c:{}).test)&&
a)&&[]};b.prototype.commutativity=function(c){var a;return!(null!=(a=(null!=c?c:{}).test)&&a)&&[]};b.prototype.associativity=function(c){var a;return!(null!=(a=(null!=c?c:{}).test)&&a)&&[]};b.prototype.distributivity=function(c){var a;return!(null!=(a=(null!=c?c:{}).test)&&a)&&[]};b.prototype.deMorgan=function(c){var a;return!(null!=(a=(null!=c?c:{}).test)&&a)&&[]};b.prototype.doubleNegation=function(c){var a,b,e;a=null!=c?c:{};c=null!=(b=a.reverse)?b:!1;b=null!=(e=a.test)?e:!1;return c&&!this.negationOperator()?
b||[this.negateNode().negateNode()]:!b&&[]};b.prototype.negativeConjunction=function(c){var a;return!(null!=(a=(null!=c?c:{}).test)&&a)&&[]};b.prototype.negativeDisjunction=function(c){var a;return!(null!=(a=(null!=c?c:{}).test)&&a)&&[]};b.prototype.implication=function(c){var a;return!(null!=(a=(null!=c?c:{}).test)&&a)&&[]};b.prototype.negativeImplication=function(c){var a;return!(null!=(a=(null!=c?c:{}).test)&&a)&&[]};b.prototype.negativeImplicationToImplication=function(c){var a;return!(null!=
(a=(null!=c?c:{}).test)&&a)&&[]};b.prototype.biimplication=function(c){var a;return!(null!=(a=(null!=c?c:{}).test)&&a)&&[]};b.prototype.biimplicationToImplication=function(c){var a;return!(null!=(a=(null!=c?c:{}).test)&&a)&&[]};b.prototype.exclusiveDisjunction=function(c){var a;return!(null!=(a=(null!=c?c:{}).test)&&a)&&[]};b.prototype.exclusiveDisjunctionToImplication=function(c){var a;return!(null!=(a=(null!=c?c:{}).test)&&a)&&[]};b.prototype.findPairs=function(c,a,b){var d,e,f,g,q;d=null!=(e=(null!=
b?b:{}).inverse)?e:!1;if(this.operator===c){f=this.terms;g=[];b=c=0;for(e=f.length;c<e;b=++c)q=f[b],(q.operator!==this.inverseOperator()&&a.some(function(a){return function(c){return c!==a&&c.equals(q,{inverse:d})}}(this))||!d&&q.operator===this.inverseOperator()&&q.terms.every(function(c){return function(b){return a.some(function(a){return a!==c&&a.equals(b)})}}(this)))&&g.push([this,b]);return g}return[]};b.prototype.checkTests=function(c){null==c&&(c=[]);return c.every(function(a){return function(c){return a[c]()}}(this))};
b.prototype.normalFormOperators=function(){var c;return"NOT"===(c=this.operator)||"AND"===c||"OR"===c||"VAR"===c||"CONST"===c};b.prototype.atomicNegation=function(){return!0};b.prototype.atomicConjunction=function(){return!0};b.prototype.atomicDisjunction=function(){return!0};b.prototype.applySimplifications=function(c){var a;null==c&&(c=[]);a=c.reduce(function(a){return function(a,b){a.rules=c;return a[b]()}}(this),this);delete a.rules;return a};b.prototype.replaceNodes=function(){return this};b.prototype.flatten=
function(){return this};b.prototype.pushNegation=function(){return this};b.prototype.distributeDisjunction=function(){return this};b.prototype.distributeConjunction=function(){return this};b.prototype.sort=function(){return this};b.prototype.absorb=function(){return this};b.prototype.compare=function(c){return Math.sign(this.countLevels()-c.countLevels()||this.precedence({sort:!0})-c.precedence({sort:!0})||this.countVariables()-c.countVariables())};b.prototype.compareNegations=function(c){return this.negationNode()-
c.negationNode()};b.prototype.precedence=function(c){var a;return null!=(a=(null!=c?c:{}).sort)&&a&&"NOT"===this.operator?this.right.precedence():b.operators.findIndex(function(a){return function(c){return c.includes(a.operator)}}(this))};b.prototype.countVariables=function(){return 0};b.prototype.countLevels=function(){return 0};b.prototype.findAlwaysEqualCounterexample=function(c){return this.checkExpressions(c,b.uniq(this.getVariables().concat(c.getVariables())))};b.prototype.checkExpressions=
function(c,a,b){var d,e;null==b&&(b={});return a.length?this.checkExpressions(c,a.slice(1),Object.assign(b,(d={},d[""+a[0]]=!0,d)))||this.checkExpressions(c,a.slice(1),Object.assign(b,(e={},e[""+a[0]]=!1,e))):this.evaluate(b)!==c.evaluate(b)&&b||void 0};b.prototype.invertOperator=function(){this.operator=this.inverseOperator();this.string=b.toOperatorString(this.operator);return this};b.prototype.inverseOperator=function(){return this.conjunctionOperator()?"OR":this.disjunctionOperator()?"AND":this.operator};
b.prototype.negateNode=function(){return new CTATLogicRelationNode("NOT",null,this)};b.prototype.unnegateNode=function(){return this.negationOperator()?this.right:this};b.prototype.unnegateOperator=function(){return this.negativeConjunctionOperator()?"AND":this.negativeDisjunctionOperator()?"OR":this.operator};b.prototype.negationNode=function(){return this.negationOperator()&&!this.right.negationNode()||this.negated};b.prototype.negate=function(){this.negated&&this.setSteps(this.steps+1);this.negated=
!this.negated;return this};b.prototype.setSteps=function(c){isNaN(c)||(this.steps=c);return this};b.prototype.atomic=function(){var c,a;return"VAR"===(c=this.operator)||"CONST"===c||"NOT"===this.operator&&("VAR"===(a=this.right.operator)||"CONST"===a)};b.prototype.negationOperator=function(){return"NOT"===this.operator};b.prototype.conjunctionOperator=function(){return"AND"===this.operator};b.prototype.disjunctionOperator=function(){return"OR"===this.operator};b.prototype.negativeConjunctionOperator=
function(){return"NAND"===this.operator};b.prototype.negativeDisjunctionOperator=function(){return"NOR"===this.operator};b.prototype.junctionOperator=function(){var c;return"AND"===(c=this.operator)||"OR"===c};b.prototype.negativeJunctionOperator=function(){var c;return"NAND"===(c=this.operator)||"NOR"===c};b.prototype.implicationOperator=function(){return"IF"===this.operator};b.prototype.negativeImplicationOperator=function(){return"NIF"===this.operator};b.prototype.biimplicationOperator=function(){return"IFF"===
this.operator};b.prototype.exclusiveDisjunctionOperator=function(){return"XOR"===this.operator};b.prototype.binaryOperator=function(){var c;return"AND"===(c=this.operator)||"NAND"===c||"OR"===c||"NOR"===c||"IF"===c||"NIF"===c||"IFF"===c||"XOR"===c};b.prototype.leftAssociative=function(){var c;return"AND"===(c=this.operator)||"NAND"===c||"OR"===c||"NOR"===c};b.prototype.rightAssociative=function(){var c;return"IF"===(c=this.operator)||"NIF"===c||"IFF"===c||"XOR"===c};b.prototype.constant=function(){return!1};
return b}();"undefined"!==typeof module&&null!==module?module.exports=b:this.CTATLogicTreeNode=b}).call(this);var CTATLogicRelationNode={};
(function(){var b,g=function(b,c){function a(){this.constructor=b}for(var d in c)f.call(c,d)&&(b[d]=c[d]);a.prototype=c.prototype;b.prototype=new a;b.__super__=c.prototype;return b},f={}.hasOwnProperty;b=function(b){function c(a,b,e,f,g,p,q){this.left=b;this.right=e;null==f&&(f=null);this.string=null!=g?g:"";this.location=null!=p?p:{};this.negated=null!=q?q:!1;c.__super__.constructor.call(this,a,f)}g(c,b);c.prototype.clone=function(a){var b,e;a=null!=(b=(null!=a?a:{}).deep)?b:!0;return new c(this.operator,
a?(null!=(e=this.left)?e.clone():void 0)||null:this.left,a?this.right.clone():this.right,this.operatorSymbol,this.string,this.location,this.negated)};c.prototype.toString=function(a,b){var d,e;null==a&&(a=null);b=null!=(d=(null!=b?b:{}).embedded)?d:!1;return c.__super__.toString.call(this,""+((null!=(e=this.left)?e.toString(this,{embedded:this.rightAssociative()}):void 0)||"")+(""+this.operatorString())+this.right.toString(this,{embedded:this.leftAssociative()}),a,{embedded:b})};c.prototype.evaluate=
function(a){var b,e,f;null==a&&(a=null);b=null!=(e=this.left)?e.evaluate(a):void 0;f=this.right.evaluate(a);return c.__super__.evaluate.call(this,function(){switch(this.operator){case "NOT":return this.applyOperator("NOT",f);case "NAND":return this.applyOperator("NOT",this.applyOperator("AND",b,f));case "NOR":return this.applyOperator("NOT",this.applyOperator("OR",b,f));case "IF":return this.applyOperator("OR",this.applyOperator("NOT",b),f);case "NIF":return this.applyOperator("AND",b,this.applyOperator("NOT",
f));case "IFF":return this.applyOperator("OR",this.applyOperator("AND",b,f),this.applyOperator("AND",this.applyOperator("NOT",b),this.applyOperator("NOT",f)));case "XOR":return this.applyOperator("OR",this.applyOperator("AND",b,this.applyOperator("NOT",f)),this.applyOperator("AND",this.applyOperator("NOT",b),f))}}.call(this))};c.prototype.equals=function(a,b){var d;b=null!=(d=(null!=b?b:{}).inverse)?d:!1;return c.__super__.equals.call(this,a,{inverse:b})&&(null==this.left||this.left.equals(a.left))&&
this.right.equals(a.right)||a&&this.negationOperator()&&this.right.equals(a,{inverse:!b})||a&&a.negationOperator()&&this.equals(a.right,{inverse:!b})};c.prototype.countOperands=function(){return 2};c.prototype.subTree=function(a,c,b,e){return this.wholeNode(a,c,b,e)||null!=this.left&&this.left.subTree(a,c,this.string,this.location[0])||this.right.subTree(a,c,this.string,this.location[0])||void 0};c.prototype.getOperators=function(a){var b,e,f,g,p;e=null!=a?a:{};a=null!=(b=e.symbols)?b:!1;return(b=
null!=(f=e.local)?f:!1)?c.__super__.getOperators.call(this,{symbols:a}):(null!=(g=null!=(p=this.left)?p.getOperators({symbols:a,local:b}):void 0)?g:[]).concat([c.__super__.getOperators.call(this,{symbols:a})],this.right.getOperators({symbols:a,local:b}))};c.prototype.getVariables=function(){var a,c;return(null!=(a=null!=(c=this.left)?c.getVariables():void 0)?a:[]).concat(this.right.getVariables())};c.prototype.getOperands=function(){return null!=this.left?[this.left,this.right]:[this.right]};c.prototype.findOperator=
function(a,b,e){var d,f,g;e=null!=(d=(null!=e?e:{}).paths)?d:!1;return(null!=(f=null!=(g=this.left)?g.findOperator(a,b.concat(["left"]),{paths:e}):void 0)?f:[]).concat(c.__super__.findOperator.call(this,a,b,null,{paths:e}),this.right.findOperator(a,b.concat(["right"]),{paths:e}))};c.prototype.findExpression=function(a,b,e){var d,f,g;e=null!=(d=(null!=e?e:{}).paths)?d:!1;return(null!=(f=null!=(g=this.left)?g.findExpression(a,b.concat(["left"]),{paths:e}):void 0)?f:[]).concat(c.__super__.findExpression.call(this,
a,b,null,{paths:e}),this.right.findExpression(a,b.concat(["right"]),{paths:e}))};c.prototype.findRuleApplications=function(a,b,e){var d,f,g,h,u;f=null!=e?e:{};e=null!=(d=f.reverse)?d:!1;d=null!=(g=f.paths)?g:!1;return(null!=(h=null!=(u=this.left)?u.findRuleApplications(a,b.concat(["left"]),{reverse:e,paths:d}):void 0)?h:[]).concat(c.__super__.findRuleApplications.call(this,a,b,null,{reverse:e,paths:d}),this.right.findRuleApplications(a,b.concat(["right"]),{reverse:e,paths:d}))};c.prototype.removeNull=
function(){var a,c;this.left=null!=(a=this.left)?a.removeNull():void 0;this.right=null!=(c=this.right)?c.removeNull():void 0;return null!=this.left&&null!=this.right?this:this.left||this.right||null};c.prototype.truthValues=function(a){var c,b,e;c=null!=a?a:{};a=null!=(b=c.reverse)?b:!1;b=null!=(e=c.test)?e:!1;return!a&&this.negationOperator()&&this.right.constant()?b||[this.right.clone().negate()]:!b&&[]};c.prototype.deMorgan=function(a){var c,b,e;c=null!=a?a:{};a=null!=(b=c.reverse)?b:!1;b=null!=
(e=c.test)?e:!1;return!a&&this.negationOperator()&&this.right.junctionOperator()?b||[new CTATLogicFlattenNode(this.right.inverseOperator(),this.right.terms.map(function(a){return function(a){return a.negateNode()}}(this)))]:!b&&[]};c.prototype.doubleNegation=function(a){var b,e,f;b=null!=a?a:{};a=null!=(e=b.reverse)?e:!1;e=null!=(f=b.test)?f:!1;return!a&&this.negationOperator()&&this.right.negationOperator()?e||[this.unnegateNode().unnegateNode()]:c.__super__.doubleNegation.call(this,{reverse:a,test:e})};
c.prototype.negativeConjunction=function(a){var b,e,f;b=null!=a?a:{};a=null!=(e=b.reverse)?e:!1;e=null!=(f=b.test)?f:!1;return!a&&this.negativeConjunctionOperator()?e||[(new CTATLogicFlattenNode("AND",[this.left,this.right])).negateNode()]:a&&this.negationOperator()&&this.right.conjunctionOperator()&&2===this.right.terms.length?e||[new c("NAND",this.right.terms[0],this.right.terms[1])]:!e&&[]};c.prototype.negativeDisjunction=function(a){var b,e,f;b=null!=a?a:{};a=null!=(e=b.reverse)?e:!1;e=null!=
(f=b.test)?f:!1;return!a&&this.negativeDisjunctionOperator()?e||[(new CTATLogicFlattenNode("OR",[this.left,this.right])).negateNode()]:a&&this.negationOperator()&&this.right.disjunctionOperator()&&2===this.right.terms.length?e||[new c("NOR",this.right.terms[0],this.right.terms[1])]:!e&&[]};c.prototype.implication=function(a){var c,b,e;c=null!=a?a:{};a=null!=(b=c.reverse)?b:!1;b=null!=(e=c.test)?e:!1;return!a&&this.implicationOperator()?b||[new CTATLogicFlattenNode("OR",[this.left.negateNode(),this.right])]:
!b&&[]};c.prototype.negativeImplication=function(a){var c,b,e;c=null!=a?a:{};a=null!=(b=c.reverse)?b:!1;b=null!=(e=c.test)?e:!1;return!a&&this.negativeImplicationOperator()?b||[new CTATLogicFlattenNode("AND",[this.left,this.right.negateNode()])]:!b&&[]};c.prototype.negativeImplicationToImplication=function(a){var b,e,f;b=null!=a?a:{};a=null!=(e=b.reverse)?e:!1;e=null!=(f=b.test)?f:!1;return!a&&this.negativeImplicationOperator()?e||[(new c("IF",this.left,this.right)).negateNode()]:a&&this.negationOperator()&&
this.right.implicationOperator()?e||[new c("NIF",this.right.left,this.right.right)]:!e&&[]};c.prototype.biimplication=function(a){var c,b,e;c=null!=a?a:{};a=null!=(b=c.reverse)?b:!1;b=null!=(e=c.test)?e:!1;return!a&&this.biimplicationOperator()?b||[new CTATLogicFlattenNode("OR",[new CTATLogicFlattenNode("AND",[this.left,this.right]),new CTATLogicFlattenNode("AND",[this.left.negateNode(),this.right.negateNode()])])]:!b&&[]};c.prototype.biimplicationToImplication=function(a){var b,e,f;b=null!=a?a:{};
a=null!=(e=b.reverse)?e:!1;e=null!=(f=b.test)?f:!1;return!a&&this.biimplicationOperator()?e||[new CTATLogicFlattenNode("AND",[new c("IF",this.left,this.right),new c("IF",this.right,this.left)])]:!e&&[]};c.prototype.exclusiveDisjunction=function(a){var c,b,e;c=null!=a?a:{};a=null!=(b=c.reverse)?b:!1;b=null!=(e=c.test)?e:!1;return!a&&this.exclusiveDisjunctionOperator()?b||[new CTATLogicFlattenNode("OR",[new CTATLogicFlattenNode("AND",[this.left,this.right.negateNode()]),new CTATLogicFlattenNode("AND",
[this.left.negateNode(),this.right])])]:!b&&[]};c.prototype.exclusiveDisjunctionToImplication=function(a){var b,e,f;b=null!=a?a:{};a=null!=(e=b.reverse)?e:!1;e=null!=(f=b.test)?f:!1;return!a&&this.exclusiveDisjunctionOperator()?e||[new CTATLogicFlattenNode("AND",[new c("IF",this.left,this.right.negateNode()),new c("IF",this.right.negateNode(),this.left)])]:!e&&[]};c.prototype.normalFormOperators=function(){return c.__super__.normalFormOperators.call(this)&&(null==this.left||this.left.normalFormOperators())&&
this.right.normalFormOperators()};c.prototype.atomicNegation=function(){return this.atomic()||!this.negationOperator()&&!this.negated&&this.left.atomicNegation()&&this.right.atomicNegation()};c.prototype.atomicConjunction=function(){return this.atomic()||(null==this.left||this.left.atomicConjunction())&&this.right.atomicConjunction()};c.prototype.atomicDisjunction=function(){return this.atomic()||(null==this.left||this.left.atomicDisjunction())&&this.right.atomicDisjunction()};c.prototype.applySimplifications=
function(a,b){var d,e,f,g;this.rules=a;if(a=null!=(d=(null!=b?b:{}).global)?d:!1)this.left=(null!=(e=this.left)?null!=(f=e.setSteps(this.steps))?f.applySimplifications(this.rules,{global:a}):void 0:void 0)||null;a&&(this.right=this.right.setSteps((null!=(g=this.left)?g.steps:void 0)||this.steps).applySimplifications(this.rules,{global:a}));a&&this.setSteps(this.right.steps);return c.__super__.applySimplifications.call(this,this.rules)};c.prototype.replaceNodes=function(){var a,c,b,e;e=CTATLogicTreeNode.diff(this.rules,
["replaceNodes"]);switch(this.operator){case "NOT":return this.right.setSteps(this.steps).negate();case "NAND":case "NOR":return(new CTATLogicFlattenNode(this.unnegateOperator(),[this.left,this.right])).setSteps(this.steps+1).negate().applySimplifications(e);case "IF":return(new CTATLogicFlattenNode("OR",[a=this.left.setSteps(this.steps).negate().applySimplifications(e),this.right])).setSteps(a.steps+1);case "NIF":return(new CTATLogicFlattenNode("AND",[this.left,b=this.right.setSteps(this.steps).negate().applySimplifications(e)])).setSteps(b.steps+
1);case "IFF":return c=new CTATLogicFlattenNode("OR",[new CTATLogicFlattenNode("AND",[this.left,this.right]),new CTATLogicFlattenNode("AND",[a=this.left.clone().setSteps(this.steps).negate().applySimplifications(e),b=this.right.clone().setSteps(a.steps).negate().applySimplifications(e)])]),c.setSteps(b.steps),c.terms=c.terms.map(function(a){return function(a){a=a.setSteps(c.steps).applySimplifications(e);c.setSteps(a.steps);return a}}(this)),c.setSteps(c.steps+1);case "XOR":return c=new CTATLogicFlattenNode("OR",
[new CTATLogicFlattenNode("AND",[this.left,b=this.right.clone().setSteps(this.steps).negate().applySimplifications(e)]),new CTATLogicFlattenNode("AND",[a=this.left.clone().setSteps(b.steps).negate().applySimplifications(e),this.right])]),c.setSteps(a.steps),c.terms=c.terms.map(function(a){return function(a){a=a.setSteps(c.steps).applySimplifications(e);c.setSteps(a.steps);return a}}(this)),c.setSteps(c.steps+1)}};c.prototype.sort=function(){var a;("NAND"===(a=this.operator)||"NOR"===a||"IFF"===a||
"XOR"===a)&&0<this.left.compare(this.right)&&(a=[this.right,this.left],this.left=a[0],this.right=a[1]);return this};c.prototype.compare=function(a){return c.__super__.compare.call(this,a)||(this.negationOperator()&&a.negationOperator()?this.right.compare(a.right):this.negationOperator()?this.right.compare(a):a.negationOperator()?this.compare(a.right):this.left.compare(a.left)||this.right.compare(a.right))||this.compareNegations(a)};c.prototype.countVariables=function(){var a;return((null!=(a=this.left)?
a.countVariables():void 0)||0)+this.right.countVariables()};c.prototype.countLevels=function(){var a;return"NOT"===this.operator?this.right.countLevels():1+Math.max((null!=(a=this.left)?a.countLevels():void 0)||0,this.right.countLevels())};return c}(CTATLogicTreeNode);"undefined"!==typeof module&&null!==module?module.exports=b:this.CTATLogicRelationNode=b}).call(this);var CTATLogicVariableNode={};
(function(){var b,g=function(b,c){function a(){this.constructor=b}for(var d in c)f.call(c,d)&&(b[d]=c[d]);a.prototype=c.prototype;b.prototype=new a;b.__super__=c.prototype;return b},f={}.hasOwnProperty;b=function(b){function c(a,b,e,f,g){this.variableTable=a;this.variable=b;this.string=null!=e?e:"";this.location=null!=f?f:{};this.negated=null!=g?g:!1;c.__super__.constructor.call(this,"VAR")}g(c,b);c.prototype.clone=function(){return new c(this.variableTable,this.variable,this.string,this.location,
this.negated)};c.prototype.toString=function(){return c.__super__.toString.call(this,this.variable)};c.prototype.evaluate=function(a){null==a&&(a=null);return c.__super__.evaluate.call(this,function(){if(null!=a)return("function"===typeof a.get?a.get(this.variable):void 0)||a[this.variable];if(null!=this.variableTable)return this.variableTable.get(this.variable);try{return eval(this.variable)}catch(d){}}.call(this))};c.prototype.equals=function(a,b){var d;b=null!=(d=(null!=b?b:{}).inverse)?d:!1;return c.__super__.equals.call(this,
a,{inverse:b})&&this.variable===a.variable||a&&a.negationOperator()&&this.equals(a.right,{inverse:!b})};c.prototype.getVariables=function(){return[this.variable]};c.prototype.findOperator=function(a,b,e){var d;e=null!=(d=(null!=e?e:{}).paths)?d:!1;return c.__super__.findOperator.call(this,a,b,null,{paths:e})};c.prototype.findExpression=function(a,b,e){var d;e=null!=(d=(null!=e?e:{}).paths)?d:!1;return c.__super__.findExpression.call(this,a,b,null,{paths:e})};c.prototype.findRuleApplications=function(a,
b,e){var d,f,g;f=null!=e?e:{};e=null!=(d=f.reverse)?d:!1;d=null!=(g=f.paths)?g:!1;return c.__super__.findRuleApplications.call(this,a,b,null,{reverse:e,paths:d})};c.prototype.compare=function(a){return c.__super__.compare.call(this,a)||("NOT"===a.operator?this.compare(a.right):this.variable>a.variable&&1||this.variable<a.variable&&-1)||this.compareNegations(a)};c.prototype.countVariables=function(){return 1};return c}(CTATLogicTreeNode);"undefined"!==typeof module&&null!==module?module.exports=b:
this.CTATLogicVariableNode=b}).call(this);var CTATLogicConstantNode={};
(function(){var b,g=function(b,c){function a(){this.constructor=b}for(var d in c)f.call(c,d)&&(b[d]=c[d]);a.prototype=c.prototype;b.prototype=new a;b.__super__=c.prototype;return b},f={}.hasOwnProperty;b=function(b){function c(a,b,e,f,g){this.string=null!=e?e:"";this.location=null!=f?f:{};this.negated=null!=g?g:!1;c.__super__.constructor.call(this,"CONST",b,a);this.value=a}g(c,b);c.prototype.clone=function(){return new c(this.value,this.string,this.location,this.negated)};c.prototype.toString=function(){return c.__super__.toString.call(this,
this.constantString())};c.prototype.evaluate=function(a){return c.__super__.evaluate.call(this,this.value)};c.prototype.equals=function(a,b){var d;b=null!=(d=(null!=b?b:{}).inverse)?d:!1;return c.__super__.equals.call(this,a,{inverse:b})&&b!==(this.value===a.value)||a&&a.negationOperator()&&this.equals(a.right,{inverse:!b})};c.prototype.findOperator=function(a,b,e){var d;e=null!=(d=(null!=e?e:{}).paths)?d:!1;return c.__super__.findOperator.call(this,a,b,null,{paths:e})};c.prototype.findExpression=
function(a,b,e){var d;e=null!=(d=(null!=e?e:{}).paths)?d:!1;return c.__super__.findExpression.call(this,a,b,null,{paths:e})};c.prototype.findRuleApplications=function(a,b,e){var d,f,g;f=null!=e?e:{};e=null!=(d=f.reverse)?d:!1;d=null!=(g=f.paths)?g:!1;return c.__super__.findRuleApplications.call(this,a,b,null,{reverse:e,paths:d})};c.prototype.truthValues=function(a){var c,b,e;c=null!=a?a:{};a=null!=(b=c.reverse)?b:!1;b=null!=(e=c.test)?e:!1;return a?b||[this.negateNode()]:!b&&[]};c.prototype.compare=
function(a){return c.__super__.compare.call(this,a)||("NOT"===a.operator?this.compare(a.right):this.value-a.value)||this.compareNegations(a)};c.prototype.negate=function(){this.setSteps(this.steps+1);this.value=!this.value;this.string=CTATLogicTreeNode.toOperatorString(this.value);return this};c.prototype.constant=function(a){var c;a=null!=(c=(null!=a?a:{}).value)?c:null;return null==a||this.value===a};return c}(CTATLogicTreeNode);"undefined"!==typeof module&&null!==module?module.exports=b:this.CTATLogicConstantNode=
b}).call(this);var CTATLogicGrammar=function(){function b(){this.yy={}}var g=function(a,c,b,d){b=b||{};for(d=a.length;d--;b[a[d]]=c);return b},f=[1,3],e=[1,5],c=[1,6],a=[1,7],d=[1,8],h=[1,10],l=[1,11],n=[1,12],p=[1,13],q=[1,14],u=[1,15],v=[1,16],y=[1,17],w=[5,6,7,8,9,10,11,12,13,17],A=[5,6,8,9,10,11,12,13,17],z=[5,8,10,11,12,13,17],C={trace:function(){},yy:{},symbols_:{error:2,expression:3,logical:4,EOF:5,AND:6,NAND:7,OR:8,NOR:9,IF:10,NIF:11,IFF:12,XOR:13,NOT:14,atom:15,LPAREN:16,RPAREN:17,VARIABLE:18,TRUE:19,FALSE:20,
$accept:0,$end:1},terminals_:{2:"error",5:"EOF",6:"AND",7:"NAND",8:"OR",9:"NOR",10:"IF",11:"NIF",12:"IFF",13:"XOR",14:"NOT",16:"LPAREN",17:"RPAREN",18:"VARIABLE",19:"TRUE",20:"FALSE"},productions_:[0,[3,2],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,2],[4,1],[15,3],[15,1],[15,1],[15,1]],performAction:function(a,c,b,d,e,f,g){a=f.length-1;switch(e){case 1:return f[a-1];case 2:C.checkParentheses(f[a-2],g[a-2],d.lexer.matched);C.checkParentheses(f[a],g[a],d.lexer.matched);this.$=f[a-2].addOperand("AND",
f[a],f[a-1],C.string(d.lexer.matched,this._$),this._$.range);C.checkOperator(this.$,g[a-1],d.lexer.matched);break;case 3:C.checkParentheses(f[a-2],g[a-2],d.lexer.matched);C.checkParentheses(f[a],g[a],d.lexer.matched);this.$=new CTATLogicRelationNode("NAND",f[a-2],f[a],f[a-1],C.string(d.lexer.matched,this._$),this._$.range);C.checkOperator(this.$,g[a-1],d.lexer.matched);break;case 4:C.checkParentheses(f[a-2],g[a-2],d.lexer.matched);C.checkParentheses(f[a],g[a],d.lexer.matched);this.$=f[a-2].addOperand("OR",
f[a],f[a-1],C.string(d.lexer.matched,this._$),this._$);C.checkOperator(this.$,g[a-1],d.lexer.matched);break;case 5:C.checkParentheses(f[a-2],g[a-2],d.lexer.matched);C.checkParentheses(f[a],g[a],d.lexer.matched);this.$=new CTATLogicRelationNode("NOR",f[a-2],f[a],f[a-1],C.string(d.lexer.matched,this._$),this._$.range);C.checkOperator(this.$,g[a-1],d.lexer.matched);break;case 6:C.checkParentheses(f[a-2],g[a-2],d.lexer.matched);C.checkParentheses(f[a],g[a],d.lexer.matched);this.$=new CTATLogicRelationNode("IF",
f[a-2],f[a],f[a-1],C.string(d.lexer.matched,this._$),this._$.range);C.checkOperator(this.$,g[a-1],d.lexer.matched);break;case 7:C.checkParentheses(f[a-2],g[a-2],d.lexer.matched);C.checkParentheses(f[a],g[a],d.lexer.matched);this.$=new CTATLogicRelationNode("NIF",f[a-2],f[a],f[a-1],C.string(d.lexer.matched,this._$),this._$.range);C.checkOperator(this.$,g[a-1],d.lexer.matched);break;case 8:C.checkParentheses(f[a-2],g[a-2],d.lexer.matched);C.checkParentheses(f[a],g[a],d.lexer.matched);this.$=new CTATLogicRelationNode("IFF",
f[a-2],f[a],f[a-1],C.string(d.lexer.matched,this._$),this._$.range);C.checkOperator(this.$,g[a-1],d.lexer.matched);break;case 9:C.checkParentheses(f[a-2],g[a-2],d.lexer.matched);C.checkParentheses(f[a],g[a],d.lexer.matched);this.$=new CTATLogicRelationNode("XOR",f[a-2],f[a],f[a-1],C.string(d.lexer.matched,this._$),this._$.range);C.checkOperator(this.$,g[a-1],d.lexer.matched);break;case 10:C.checkParentheses(f[a],g[a],d.lexer.matched);this.$=new CTATLogicRelationNode("NOT",null,f[a],f[a-1],C.string(d.lexer.matched,
this._$),this._$.range);C.checkOperator(this.$,g[a-1],d.lexer.matched);break;case 11:this.$=f[a];break;case 12:this.$=f[a-1].setParens(!0,C.string(d.lexer.matched,this._$),this._$.range);break;case 13:this.$=new CTATLogicVariableNode(d.variableTable,f[a],C.string(d.lexer.matched,this._$),this._$.range);C.checkVariable(this.$,g[a],d.lexer.matched);break;case 14:this.$=new CTATLogicConstantNode(!0,f[a],C.string(d.lexer.matched,this._$),this._$.range);C.checkConstant(this.$,g[a],d.lexer.matched);break;
case 15:this.$=new CTATLogicConstantNode(!1,f[a],C.string(d.lexer.matched,this._$),this._$.range),C.checkConstant(this.$,g[a],d.lexer.matched)}},table:[{3:1,4:2,14:f,15:4,16:e,18:c,19:a,20:d},{1:[3]},{5:[1,9],6:h,7:l,8:n,9:p,10:q,11:u,12:v,13:y},{4:18,14:f,15:4,16:e,18:c,19:a,20:d},g(w,[2,11]),{4:19,14:f,15:4,16:e,18:c,19:a,20:d},g(w,[2,13]),g(w,[2,14]),g(w,[2,15]),{1:[2,1]},{4:20,14:f,15:4,16:e,18:c,19:a,20:d},{4:21,14:f,15:4,16:e,18:c,19:a,20:d},{4:22,14:f,15:4,16:e,18:c,19:a,20:d},{4:23,14:f,15:4,
16:e,18:c,19:a,20:d},{4:24,14:f,15:4,16:e,18:c,19:a,20:d},{4:25,14:f,15:4,16:e,18:c,19:a,20:d},{4:26,14:f,15:4,16:e,18:c,19:a,20:d},{4:27,14:f,15:4,16:e,18:c,19:a,20:d},g(w,[2,10]),{6:h,7:l,8:n,9:p,10:q,11:u,12:v,13:y,17:[1,28]},g(A,[2,2],{7:l}),g(A,[2,3]),g(z,[2,4],{6:h,7:l,9:p}),g(z,[2,5],{6:h,7:l}),g([5,12,13,17],[2,6],{6:h,7:l,8:n,9:p,10:q,11:u}),g([5,10,12,13,17],[2,7],{6:h,7:l,8:n,9:p}),g([5,17],[2,8],{6:h,7:l,8:n,9:p,10:q,11:u,12:v,13:y}),g([5,12,17],[2,9],{6:h,7:l,8:n,9:p,10:q,11:u,13:y}),
g(w,[2,12])],defaultActions:{9:[2,1]},parseError:function(a,c){if(c.recoverable)this.trace(a);else throw a=Error(a),a.hash=c,a;},parse:function(a){var c=[0],b=[null],d=[],e=this.table,f="",g=0,h=0,l=0,n=d.slice.call(arguments,1),p=Object.create(this.lexer),q={},w;for(w in this.yy)Object.prototype.hasOwnProperty.call(this.yy,w)&&(q[w]=this.yy[w]);p.setInput(a,q);q.lexer=p;q.parser=this;"undefined"==typeof p.yylloc&&(p.yylloc={});w=p.yylloc;d.push(w);var u=p.options&&p.options.ranges;this.parseError=
"function"===typeof q.parseError?q.parseError:Object.getPrototypeOf(this).parseError;for(var v,y,A,z,C={},D,T;;){A=c[c.length-1];if(this.defaultActions[A])z=this.defaultActions[A];else{if(null===v||"undefined"==typeof v)v=p.lex()||1,"number"!==typeof v&&(v=this.symbols_[v]||v);z=e[A]&&e[A][v]}if("undefined"===typeof z||!z.length||!z[0]){var fa;T=[];for(D in e[A])this.terminals_[D]&&2<D&&T.push("'"+this.terminals_[D]+"'");fa=p.showPosition?"Parse error on line "+(g+1)+":\n"+p.showPosition()+"\nExpecting "+
T.join(", ")+", got '"+(this.terminals_[v]||v)+"'":"Parse error on line "+(g+1)+": Unexpected "+(1==v?"end of input":"'"+(this.terminals_[v]||v)+"'");this.parseError(fa,{text:p.match,token:this.terminals_[v]||v,line:p.yylineno,loc:w,expected:T})}if(z[0]instanceof Array&&1<z.length)throw Error("Parse Error: multiple actions possible at state: "+A+", token: "+v);switch(z[0]){case 1:c.push(v);b.push(p.yytext);d.push(p.yylloc);c.push(z[1]);v=null;y?(v=y,y=null):(h=p.yyleng,f=p.yytext,g=p.yylineno,w=p.yylloc,
0<l&&l--);break;case 2:T=this.productions_[z[1]][1];C.$=b[b.length-T];C._$={first_line:d[d.length-(T||1)].first_line,last_line:d[d.length-1].last_line,first_column:d[d.length-(T||1)].first_column,last_column:d[d.length-1].last_column};u&&(C._$.range=[d[d.length-(T||1)].range[0],d[d.length-1].range[1]]);A=this.performAction.apply(C,[f,h,g,q,z[1],b,d].concat(n));if("undefined"!==typeof A)return A;T&&(c=c.slice(0,-2*T),b=b.slice(0,-1*T),d=d.slice(0,-1*T));c.push(this.productions_[z[1]][0]);b.push(C.$);
d.push(C._$);z=e[c[c.length-2]][c[c.length-1]];c.push(z);break;case 3:return!0}}},string:function(a,c){return a.slice.apply(a,[].concat($jscomp.arrayFromIterable(c.range)))},checkParentheses:function(a,c,b){CTATLogicTreeNode.options.strictParentheses&&!a.checkParens()&&C.raiseError(a,c,b,["'LPAREN'"])},checkOperator:function(a,c,b){CTATLogicTreeNode.options.strictOperators&&!a.checkOperator()&&C.raiseError(a,c,b,[CTATLogicTreeNode.toOperatorString(a.operator)]);CTATLogicTreeNode.options.selectedOperators&&
!a.checkSelectedOperator()&&C.raiseError(a,c,b,CTATLogicTreeNode.options.selectedOperators)},checkConstant:function(a,c,b){CTATLogicTreeNode.options.strictConstants&&!a.checkConstant()&&C.raiseError(a,c,b,[CTATLogicTreeNode.toConstantString(a.value)])},checkVariable:function(a,c,b){CTATLogicTreeNode.options.selectedVariables&&!a.checkSelectedVariable()&&C.raiseError(a,c,b,CTATLogicTreeNode.options.selectedVariables)},raiseError:function(a,c,b,d){var e=b+"\n"+"-".repeat(c.first_column)+"^",e="Parse error on line "+
c.first_line+":\n"+e+"\nExpecting '"+d.join(", ")+"'"+(" got '"+b.slice(c.first_column,c.last_column)+"'");this.parseError(e,{text:b,token:a.operator,line:c.first_line,loc:c,expected:d})}},g=function(){return{EOF:1,parseError:function(a,c){if(this.yy.parser)this.yy.parser.parseError(a,c);else throw Error(a);},setInput:function(a,c){this.yy=c||this.yy||{};this._input=a;this._more=this._backtrack=this.done=!1;this.yylineno=this.yyleng=0;this.yytext=this.matched=this.match="";this.conditionStack=["INITIAL"];
this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0};this.options.ranges&&(this.yylloc.range=[0,0]);this.offset=0;return this},input:function(){var a=this._input[0];this.yytext+=a;this.yyleng++;this.offset++;this.match+=a;this.matched+=a;a.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++;this.options.ranges&&this.yylloc.range[1]++;this._input=this._input.slice(1);return a},unput:function(a){var c=a.length,b=a.split(/(?:\r\n?|\n)/g);this._input=
a+this._input;this.yytext=this.yytext.substr(0,this.yytext.length-c);this.offset-=c;a=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1);this.matched=this.matched.substr(0,this.matched.length-1);b.length-1&&(this.yylineno-=b.length-1);var d=this.yylloc.range;this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:b?(b.length===a.length?this.yylloc.first_column:0)+a[a.length-b.length].length-b[0].length:
this.yylloc.first_column-c};this.options.ranges&&(this.yylloc.range=[d[0],d[0]+this.yyleng-c]);this.yyleng=this.yytext.length;return this},more:function(){this._more=!0;return this},reject:function(){if(this.options.backtrack_lexer)this._backtrack=!0;else return this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno});
return this},less:function(a){this.unput(this.match.slice(a))},pastInput:function(){var a=this.matched.substr(0,this.matched.length-this.match.length);return(20<a.length?"...":"")+a.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var a=this.match;20>a.length&&(a+=this._input.substr(0,20-a.length));return(a.substr(0,20)+(20<a.length?"...":"")).replace(/\n/g,"")},showPosition:function(){var a=this.pastInput(),c=Array(a.length+1).join("-");return a+this.upcomingInput()+"\n"+c+"^"},test_match:function(a,
c){var b,d;this.options.backtrack_lexer&&(d={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(d.yylloc.range=this.yylloc.range.slice(0)));if(b=
a[0].match(/(?:\r\n?|\n).*/g))this.yylineno+=b.length;this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:b?b[b.length-1].length-b[b.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+a[0].length};this.yytext+=a[0];this.match+=a[0];this.matches=a;this.yyleng=this.yytext.length;this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]);this._backtrack=this._more=!1;this._input=this._input.slice(a[0].length);
this.matched+=a[0];a=this.performAction.call(this,this.yy,this,c,this.conditionStack[this.conditionStack.length-1]);this.done&&this._input&&(this.done=!1);if(a)return a;if(this._backtrack)for(var e in d)this[e]=d[e];return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var a,c,b;this._more||(this.match=this.yytext="");for(var d=this._currentRules(),e=0;e<d.length;e++)if((c=this._input.match(this.rules[d[e]]))&&(!a||c[0].length>a[0].length))if(a=c,b=e,this.options.backtrack_lexer){a=
this.test_match(c,d[e]);if(!1!==a)return a;if(this._backtrack)a=!1;else return!1}else if(!this.options.flex)break;return a?(a=this.test_match(a,d[b]),!1!==a?a:!1):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var a=this.next();return a?a:this.lex()},begin:function(a){this.conditionStack.push(a)},popState:function(){return 0<this.conditionStack.length-1?this.conditionStack.pop():
this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(a){a=this.conditionStack.length-1-Math.abs(a||0);return 0<=a?this.conditionStack[a]:"INITIAL"},pushState:function(a){this.begin(a)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(a,c,b,d){switch(b){case 1:return 16;
case 2:return 17;case 3:return 11;case 4:return 11;case 5:return 11;case 6:return 11;case 7:return 11;case 8:return 10;case 9:return 10;case 10:return 10;case 11:return 10;case 12:return 10;case 13:return 13;case 14:return 13;case 15:return 13;case 16:return 13;case 17:return 13;case 18:return 13;case 19:return 13;case 20:return 12;case 21:return 12;case 22:return 12;case 23:return 12;case 24:return 12;case 25:return 12;case 26:return 12;case 27:return 13;case 28:return 7;case 29:return 7;case 30:return 7;
case 31:return 7;case 32:return 7;case 33:return 7;case 34:return 7;case 35:return 7;case 36:return 7;case 37:return 7;case 38:return 7;case 39:return 6;case 40:return 6;case 41:return 6;case 42:return 6;case 43:return 6;case 44:return 6;case 45:return 9;case 46:return 9;case 47:return 9;case 48:return 9;case 49:return 9;case 50:return 9;case 51:return 9;case 52:return 9;case 53:return 9;case 54:return 9;case 55:return 9;case 56:return 8;case 57:return 8;case 58:return 8;case 59:return 8;case 60:return 8;
case 61:return 8;case 62:return 14;case 63:return 14;case 64:return 14;case 65:return 14;case 66:return 19;case 67:return 19;case 68:return 19;case 69:return 19;case 70:return 19;case 71:return 20;case 72:return 20;case 73:return 20;case 74:return 20;case 75:return 20;case 76:return 18;case 77:return 5}},rules:[/^(?:\s+)/,/^(?:\()/,/^(?:\))/,/^(?:\u2260>)/,/^(?:~>)/,/^(?:\u21cf)/,/^(?:\u219b)/,/^(?:\u2285)/,/^(?:=>)/,/^(?:->)/,/^(?:\u21d2)/,/^(?:\u2192)/,/^(?:\u2283)/,/^(?:<\u2260>)/,/^(?:<~>)/,/^(?:\u21ae)/,
/^(?:\u2262)/,/^(?:\u2295)/,/^(?:\u22bb)/,/^(?:\^)/,/^(?:=)/,/^(?:<=>)/,/^(?:<->)/,/^(?:\u21d4)/,/^(?:\u2194)/,/^(?:\u2261)/,/^(?:\u2299)/,/^(?:\u2260)/,/^(?:\u2191)/,/^(?:\u22bc)/,/^(?:~\/\\)/,/^(?:~&&)/,/^(?:~&)/,/^(?:!\/\\)/,/^(?:!&&)/,/^(?:!&)/,/^(?:-\/\\)/,/^(?:-&&)/,/^(?:-&)/,/^(?:&&)/,/^(?:&)/,/^(?:\u2227)/,/^(?:\/\\)/,/^(?:\*)/,/^(?:\.)/,/^(?:\u2193)/,/^(?:\u22bd)/,/^(?:~\\\/)/,/^(?:~\|\|)/,/^(?:~\|)/,/^(?:!\\\/)/,/^(?:!\|\|)/,/^(?:!\|)/,/^(?:-\\\/)/,/^(?:-\|\|)/,/^(?:-\|)/,/^(?:\|\|)/,/^(?:\|)/,
/^(?:\u2225)/,/^(?:\u2228)/,/^(?:\\\/)/,/^(?:\+)/,/^(?:~)/,/^(?:\u00ac)/,/^(?:!)/,/^(?:-)/,/^(?:([Tt][Rr][Uu][Ee]))/,/^(?:T\b)/,/^(?:\u22a4)/,/^(?:1\b)/,/^(?:\u25a0)/,/^(?:([Ff][Aa][Ll][Ss][Ee]))/,/^(?:F\b)/,/^(?:\u22a5)/,/^(?:0\b)/,/^(?:\u25a1)/,/^(?:([A-Za-z][0-9]*))/,/^(?:$)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,
68,69,70,71,72,73,74,75,76,77],inclusive:!0}}}}();C.lexer=g;b.prototype=C;C.Parser=b;return new b}();var CTATLogicFlattenNode={};
(function(){var b,g=function(b,c){function a(){this.constructor=b}for(var d in c)f.call(c,d)&&(b[d]=c[d]);a.prototype=c.prototype;b.prototype=new a;b.__super__=c.prototype;return b},f={}.hasOwnProperty;b=function(b){function c(a,b,e,f,g,p){this.terms=b;null==e&&(e=null);this.string=null!=f?f:"";this.location=null!=g?g:{};this.negated=null!=p?p:!1;c.__super__.constructor.call(this,a,e)}g(c,b);c.prototype.addOperand=function(a,b,e,f,g){null==e&&(e=null);null==f&&(f="");null==g&&(g=null);if(a!==this.operator||
this.parens)return c.__super__.addOperand.call(this,a,b,e,f,g);this.terms.push(b);this.string=f;this.location=g;return this};c.prototype.clone=function(a){var b;a=null!=(b=(null!=a?a:{}).deep)?b:!0;return new c(this.operator,a?this.terms.map(function(a){return function(a){return a.clone()}}(this)):this.terms,this.operatorSymbol,this.string,this.location,this.negated)};c.prototype.toString=function(a,b){var d;null==a&&(a=null);b=null!=(d=(null!=b?b:{}).embedded)?d:!1;return c.__super__.toString.call(this,
this.terms.reduce(function(a){return function(c,b){return""+c+(c?""+a.operatorString():"")+b.toString(a,{embedded:!0})}}(this),""),a,{embedded:b})};c.prototype.evaluate=function(a){null==a&&(a=null);return c.__super__.evaluate.call(this,this.terms.reduce(function(c){return function(b,d){return c.applyOperator(c.operator,b,d.evaluate(a))}}(this),this.conjunctionOperator()))};c.prototype.equals=function(a,b){var d;b=null!=(d=(null!=b?b:{}).inverse)?d:!1;return c.__super__.equals.call(this,a,{inverse:b})&&
this.terms.length===a.terms.length&&this.terms.every(function(c){return function(c,b){return c.equals(a.terms[b])}}(this))||a&&a.negationOperator()&&this.equals(a.right,{inverse:!b})};c.prototype.subEquals=function(a,c){return a&&this.operator===a.operator&&!a.negated&&c+this.terms.length>=a.terms.length&&a.terms.every(function(a){return function(b,d){return b.equals(a.terms[c+d])}}(this))};c.prototype.subNode=function(a,b){null==a&&(a=0);null==b&&(b=this.countOperands());if(a<this.countOperands()&&
a<b-1&&(a||b<this.countOperands()))return new c(this.operator,this.terms.slice(a,b),this.operatorSymbol,this.string,this.mergeLocations(this.terms[a],this.terms[b-1]),this.negated);if(!(a>=this.countOperands()||a>=b))return a===b-1?this.terms[a]:this};c.prototype.countOperands=function(){return this.terms.length};c.prototype.subTree=function(a,c,b,e){var d,f;return this.wholeNode(a,c,b,e)||-1!==(f=this.terms.findIndex(function(c){return function(c){return a<=c.location[0]}}(this)))&&-1!==(d=this.terms.findLastIndex(function(a){return function(a){return c>=
a.location[1]}}(this)))&&this.subNode(f,d+1).wholeNode(a,c,null!=b?b:this.string,null!=e?e:this.location[0])||f<d&&this.terms.find(function(b){return function(d,e){return d.subTree(a,c,b.string,b.location[0])}}(this))||void 0};c.prototype.embed=function(a,b){var d;return(d=CTATLogicTreeNode.difference(this.terms,b)).length?new c(this.operator,(d.unshift(a),d),this.operatorSymbol):a};c.prototype.getOperators=function(a){var b,e,f,g;a=null!=a?a:{};g=null!=(e=a.symbols)?e:!1;return(b=null!=(f=a.local)?
f:!1)?c.__super__.getOperators.call(this,{symbols:g}):this.terms.slice(1).reduce(function(a){return function(d,e,f){return d.concat([c.__super__.getOperators.call(a,{symbols:g})],e.getOperators({symbols:g,local:b}))}}(this),this.terms[0].getOperators({symbols:g,local:b}))};c.prototype.getVariables=function(){return this.terms.slice(1).reduce(function(a){return function(a,c,b){return a.concat(c.getVariables())}}(this),this.terms[0].getVariables())};c.prototype.getOperands=function(){return this.terms.slice(0)};
c.prototype.findOperator=function(a,b,e){var d,f;d=null!=(f=(null!=e?e:{}).paths)?f:!1;return this.terms.slice(1).reduce(function(e){return function(f,g,h){return f.concat(c.__super__.findOperator.call(e,a,b,h,{paths:d}),g.findOperator(a,b.concat([h+1]),{paths:d}))}}(this),this.terms[0].findOperator(a,b.concat([0]),{paths:d}))};c.prototype.findExpression=function(a,b,e){var d,f;d=null!=(f=(null!=e?e:{}).paths)?f:!1;return this.terms.slice(1).reduce(function(e){return function(f,g,h){return f.concat(c.__super__.findExpression.call(e,
a,b,h,{paths:d}),g.findExpression(a,b.concat([h+1]),{paths:d}))}}(this),this.terms[0].findExpression(a,b.concat([0]),{paths:d}))};c.prototype.findRuleApplications=function(a,b,e){var d,f,g,h;e=null!=e?e:{};h=null!=(f=e.reverse)?f:!1;d=null!=(g=e.paths)?g:!1;return 2===this.terms.length?this.terms[0].findRuleApplications(a,b.concat([0]),{reverse:h,paths:d}).concat(c.__super__.findRuleApplications.call(this,a,b,null,{reverse:h,paths:d}),this.terms[1].findRuleApplications(a,b.concat([1]),{reverse:h,
paths:d})):this.terms.reduce(function(c){return function(c,e,f){return c.concat(e.findRuleApplications(a,b.concat([f]),{reverse:h,paths:d}))}}(this),c.__super__.findRuleApplications.call(this,a,b,null,{reverse:h,paths:d}))};c.prototype.removeNull=function(){this.terms=this.terms.map(function(a){return function(a){return null!=a?a.removeNull():void 0}}(this)).filter(function(a){return function(a){return a}}(this));return 1<this.terms.length?this:this.terms[0]||null};c.prototype.domination=function(a){var c,
b,e,f;b=null!=a?a:{};a=null!=(e=b.reverse)?e:!1;e=null!=(f=b.test)?f:!1;return!a&&this.junctionOperator()&&(c=this.terms.find(function(a){return function(c){return c.constant({value:a.disjunctionOperator()})}}(this)))?e||[c]:!e&&[]};c.prototype.complement=function(a){var c,b,e,f;b=null!=a?a:{};a=null!=(e=b.reverse)?e:!1;e=null!=(f=b.test)?f:!1;return!a&&this.junctionOperator()&&(c=this.terms.flatMap(function(a){return function(c,b){return a.terms.filter(function(a,d){return d>b&&a.equals(c,{inverse:!0})}).map(function(a){return[c,
a]})}}(this))).length?e||c.map(function(a){return function(c){return a.junctionNode(CTATLogicTreeNode.difference(a.terms,c).concat([new CTATLogicConstantNode(a.disjunctionOperator())]))}}(this)):!e&&[]};c.prototype.identity=function(a){var b,e,f,g;e=null!=a?a:{};a=null!=(f=e.reverse)?f:!1;f=null!=(g=e.test)?g:!1;return!a&&this.junctionOperator()&&(b=this.terms.filter(function(a){return function(c){return c.constant({value:a.conjunctionOperator()})}}(this))).length?f||b.map(function(a){return function(c){return a.junctionNode(CTATLogicTreeNode.difference(a.terms,
[c]))}}(this)):a&&this.junctionOperator()?f||[this.junctionNode(this.terms.concat([new CTATLogicConstantNode(this.conjunctionOperator())]))]:c.__super__.identity.call(this,{reverse:a,test:f})};c.prototype.idempotence=function(a){var b,e,f,g;e=null!=a?a:{};a=null!=(f=e.reverse)?f:!1;f=null!=(g=e.test)?g:!1;return!a&&this.junctionOperator()&&(b=this.terms.filter(function(a){return function(c,b){return a.terms.slice(b+1).some(function(a){return a.equals(c)})}}(this))).length?f||b.map(function(a){return function(c){return a.junctionNode(CTATLogicTreeNode.difference(a.terms,
[c]))}}(this)):a&&this.junctionOperator()?f||this.terms.map(function(a){return function(c){return a.junctionNode(a.terms.concat(c))}}(this)):c.__super__.idempotence.call(this,{reverse:a,test:f})};c.prototype.absorption=function(a){var c,b,e,f;b=null!=a?a:{};a=null!=(e=b.reverse)?e:!1;e=null!=(f=b.test)?f:!1;return!a&&this.junctionOperator()&&(c=this.terms.flatMap(function(a){return function(c){return c.findPairs(a.inverseOperator(),a.terms)}}(this))).length?e||c.map(function(a){return function(c){return a.junctionNode(CTATLogicTreeNode.replaceTerm(a.terms,
c,{inverse:!1}))}}(this)):!e&&[]};c.prototype.inverseAbsorption=function(a){var c,b,e,f;b=null!=a?a:{};a=null!=(e=b.reverse)?e:!1;e=null!=(f=b.test)?f:!1;return!a&&this.junctionOperator()&&(c=this.terms.flatMap(function(a){return function(c){return c.findPairs(a.inverseOperator(),a.terms,{inverse:!0})}}(this))).length?e||c.map(function(a){return function(c){return a.junctionNode(CTATLogicTreeNode.replaceTerm(a.terms,c,{inverse:!0}))}}(this)):!e&&[]};c.prototype.junctionNode=function(a){return 1===
a.length?a[0]:Object.assign(this.clone(),{terms:a})};c.prototype.commutativity=function(a){var b;a=null!=(b=(null!=a?a:{}).test)?b:!1;return this.junctionOperator()?a||this.terms.flatMap(function(a){return function(b,d){var e,f,g;return function(){g=[];for(var a=0,c=Math.max(0,d-1);0<=c?a<c:a>c;0<=c?a++:a--)g.push(a);return g}.apply(this).concat(function(){f=[];for(var c=e=d+1,b=a.terms.length;e<=b?c<b:c>b;e<=b?c++:c--)f.push(c);return f}.apply(this)).map(function(e){return new c(a.operator,CTATLogicTreeNode.addIndex(CTATLogicTreeNode.removeIndex(a.terms,
d),b,e))})}}(this)):!a&&[]};c.prototype.associativity=function(a){var b,e;a=null!=(e=(null!=a?a:{}).test)?e:!1;return this.junctionOperator()&&(b=this.terms.filter(function(a){return function(c){return c.operator===a.operator}}(this))).length?a||CTATLogicTreeNode.subsets(b).map(function(a){return function(b){var d;d=CTATLogicTreeNode.difference(a.terms,b);return new c(a.operator,b.flatMap(function(a){return a.terms}).concat(d))}}(this)):!a&&[]};c.prototype.distributivity=function(a){var b,e,f,g;b=
null!=a?a:{};a=null!=(e=b.reverse)?e:!1;e=null!=(f=b.test)?f:!1;return!a&&this.junctionOperator()&&(g=this.terms.filter(function(a){return function(c){return c.junctionOperator()&&c.operator!==a.operator}}(this))).length?e||g.flatMap(function(a){return function(b){return CTATLogicTreeNode.subsets(CTATLogicTreeNode.difference(g,[b])).map(function(d){return a.embed(new c(b.operator,b.terms.map(function(b){return new c(a.operator,[b].concat(d))})),d.concat([b]))})}}(this)):a&&this.junctionOperator()&&
(g=this.terms.filter(function(a){return function(c){return c.junctionOperator()&&c.operator!==a.operator}}(this))).length&&CTATLogicTreeNode.commonItems(g.map(function(a){return function(a){return a.terms}}(this)))?e||CTATLogicTreeNode.subsets(g,2).flatMap(function(a){return function(b){var d,e;e=CTATLogicTreeNode.intersection(b.map(function(a){return a.terms}));d=b.flatMap(function(a){return CTATLogicTreeNode.difference(a.terms,e,{deep:!0})});return a.embed(new c(g[0].operator,e.concat([new c(a.operator,
d)])),b)}}(this)):!e&&[]};c.prototype.deMorgan=function(a){var b,e,f,g;e=null!=a?a:{};a=null!=(f=e.reverse)?f:!1;f=null!=(g=e.test)?g:!1;return a&&this.junctionOperator()&&2<=(b=this.terms.filter(function(a){return function(a){return a.negationOperator()}}(this))).length?f||CTATLogicTreeNode.subsets(b,2).map(function(a){return function(b){return a.embed((new c(a.inverseOperator(),b.map(function(a){return a.unnegateNode()}))).negateNode(),b)}}(this)):!f&&[]};c.prototype.implication=function(a){var b,
e,f,g,p;f=null!=a?a:{};a=null!=(g=f.reverse)?g:!1;g=null!=(p=f.test)?p:!1;return a&&this.disjunctionOperator()&&(b=this.terms.filter(function(a){return function(a){return a.negationOperator()}}(this))).length&&(e=this.terms.filter(function(a){return function(a){return!a.negationOperator()}}(this))).length?g||b.flatMap(function(a){return function(b){return CTATLogicTreeNode.subsets(e).map(function(d){return a.embed(new CTATLogicRelationNode("IF",b.unnegateNode(),1<d.length?new c("OR",d):d[0]),d.concat([b]))})}}(this)):
!g&&[]};c.prototype.negativeImplication=function(a){var b,e,f,g,p;f=null!=a?a:{};a=null!=(g=f.reverse)?g:!1;g=null!=(p=f.test)?p:!1;return a&&this.conjunctionOperator()&&(b=this.terms.filter(function(a){return function(a){return a.negationOperator()}}(this))).length&&(e=this.terms.filter(function(a){return function(a){return!a.negationOperator()}}(this))).length?g||b.flatMap(function(a){return function(b){return CTATLogicTreeNode.subsets(e).map(function(d){return a.embed(new CTATLogicRelationNode("NIF",
1<d.length?new c("AND",d):d[0],b.unnegateNode()),d.concat([b]))})}}(this)):!g&&[]};c.prototype.biimplication=function(a){var c,b,e,f;b=null!=a?a:{};a=null!=(e=b.reverse)?e:!1;e=null!=(f=b.test)?f:!1;return a&&this.disjunctionOperator()&&(c=this.terms.flatMap(function(a){return function(c){return a.terms.filter(function(a){return c.conjunctionOperator()&&CTATLogicTreeNode.sameNegation(c.terms,{inverse:!0})&&a!==c&&a.conjunctionOperator()&&CTATLogicTreeNode.sameNegation(a.terms)&&CTATLogicConstantNode.sameOppositeTerms(c,
a)}).map(function(a){return[c,a]})}}(this))).length?e||c.map(function(a){return function(c){return a.embed(new CTATLogicRelationNode("IFF",c[0].terms[0].unnegateNode(),c[0].terms[1].unnegateNode()),c)}}(this)):!e&&[]};c.prototype.biimplicationToImplication=function(a){var c,b,e,f;b=null!=a?a:{};a=null!=(e=b.reverse)?e:!1;e=null!=(f=b.test)?f:!1;return a&&this.conjunctionOperator()&&(c=this.terms.flatMap(function(a){return function(c,b){return a.terms.filter(function(a,d){return d>b&&c.implicationOperator()&&
a.implicationOperator()&&c.left.equals(a.right)&&c.right.equals(a.left)}).map(function(a){return[c,a]})}}(this))).length?e||c.map(function(a){return function(c){return a.embed(new CTATLogicRelationNode("IFF",c[0].left,c[0].right),c)}}(this)):!e&&[]};c.prototype.exclusiveDisjunction=function(a){var c,b,e,f;b=null!=a?a:{};a=null!=(e=b.reverse)?e:!1;e=null!=(f=b.test)?f:!1;return a&&this.disjunctionOperator()&&(c=this.terms.flatMap(function(a){return function(c,b){return a.terms.filter(function(a,d){return d>
b&&c.conjunctionOperator()&&CTATLogicTreeNode.oppositeNegation(c.terms)&&a!==c&&a.conjunctionOperator()&&CTATLogicTreeNode.oppositeNegation(a.terms)&&CTATLogicConstantNode.sameOppositeTerms(c,a)}).map(function(a){return[c,a]})}}(this))).length?e||c.map(function(a){return function(c){return a.embed(new CTATLogicRelationNode("XOR",c[0].terms[0].unnegateNode(),c[0].terms[1].unnegateNode()),c)}}(this)):!e&&[]};c.prototype.exclusiveDisjunctionToImplication=function(a){var c,b,e,f;b=null!=a?a:{};a=null!=
(e=b.reverse)?e:!1;e=null!=(f=b.test)?f:!1;return a&&this.conjunctionOperator()&&(c=this.terms.flatMap(function(a){return function(c,b){return a.terms.filter(function(a,d){return d>b&&c.implicationOperator()&&a.implicationOperator()&&c.left.equals(a.right)&&c.right.equals(a.left)&&(c.left.negationOperator()||c.right.negationOperator())}).map(function(a){return[c,a]})}}(this))).length?e||c.map(function(a){return function(c){return a.embed(new CTATLogicRelationNode("XOR",c[0].left,c[0].right.unnegateNode()),
c)}}(this)):!e&&[]};c.prototype.normalFormOperators=function(){return c.__super__.normalFormOperators.call(this)&&this.terms.every(function(a){return function(a){return a.normalFormOperators()}}(this))};c.prototype.atomicNegation=function(){return!this.negated&&this.terms.every(function(a){return function(a){return a.atomicNegation()}}(this))};c.prototype.atomicConjunction=function(){return this.conjunctionOperator()&&this.terms.every(function(a){return function(a){return a.atomic()}}(this))||!this.conjunctionOperator()&&
this.terms.every(function(a){return function(a){return a.atomicConjunction()}}(this))};c.prototype.atomicDisjunction=function(){return this.disjunctionOperator()&&this.terms.every(function(a){return function(a){return a.atomic()}}(this))||!this.disjunctionOperator()&&this.terms.every(function(a){return function(a){return a.atomicDisjunction()}}(this))};c.prototype.applySimplifications=function(a,b){var d,e;this.rules=a;if(d=null!=(e=(null!=b?b:{}).global)?e:!1)this.terms=this.terms.map(function(a){return function(c){c=
c.setSteps(a.steps).applySimplifications(a.rules,{global:d});a.setSteps(c.steps);return c}}(this));return c.__super__.applySimplifications.call(this,this.rules)};c.prototype.pushNegation=function(){this.negated&&(this.negate(),this.invertOperator(),this.terms.forEach(function(a){return function(c){c.setSteps(a.steps).negate().pushNegation();return a.setSteps(c.steps)}}(this)),this.setSteps(this.steps+1));return this};c.prototype.flatten=function(){this.terms=this.terms.reduce(function(a){return function(c,
b){b.operator!==a.operator?c.push(b):c.push.apply(c,b.terms);return c}}(this),[]);return this};c.prototype.distributeDisjunction=function(){var a,c;return this.disjunctionOperator()&&this.terms.some(function(a){return function(a){return a.conjunctionOperator()}}(this))?(a=CTATLogicTreeNode.diff(this.rules,["replaceNodes","pushNegation"]),(c=this.terms.pop()).setParens(!1).setSteps(this.steps).terms=c.terms.map(function(b){return function(d){var e;(e=b.clone()).terms.push(d);e=e.setSteps(c.steps).applySimplifications(a);
c.setSteps(e.steps);return e}}(this)),c.setSteps(c.steps+1).applySimplifications(["flatten","sort","distributeDisjunction"])):this};c.prototype.distributeConjunction=function(){var a,c;return this.conjunctionOperator()&&this.terms.some(function(a){return function(a){return a.disjunctionOperator()}}(this))?(a=CTATLogicTreeNode.diff(this.rules,["replaceNodes","pushNegation"]),(c=this.terms.pop()).setParens(!1).setSteps(this.steps).terms=c.terms.map(function(b){return function(d){var e;(e=b.clone()).terms.push(d);
e=e.setSteps(c.steps).applySimplifications(a);c.setSteps(e.steps);return e}}(this)),c.setSteps(c.steps+1).applySimplifications(["flatten","sort","distributeConjunction"])):this};c.prototype.absorb=function(){this.terms=this.terms.reduce(function(a){return function(c,b){var d,e,f,g,h,v,y;c instanceof Array&&(a.disjunctionOperator()&&b.constant({value:!0})||a.conjunctionOperator()&&b.constant({value:!1})?c=b.setSteps(a.steps+1):b.constant()&&0===c.length?c.push(b):null!=(g=c[c.length-1])&&g.equals(b)?
a.setSteps(a.steps+1):null!=(h=c[c.length-1])&&h.equals(b,{inverse:!0})?c=(new CTATLogicConstantNode(a.disjunctionOperator())).setSteps(a.steps+1):b.junctionOperator()&&c.find(function(a){return b.hasMember(a)||b.hasSubTerms(a)})?a.setSteps(a.steps+1):b.junctionOperator()&&(f=c.find(function(a){return b.hasMember(a,{inverse:!0})}))?(c.push(b.removeTerm(f,{inverse:!0})),a.setSteps(a.steps+1)):b.junctionOperator()&&(f=b.findHalfInverse(c[c.length-1]))?(2===b.terms.length?c[c.length-1]=c[c.length-1].removeTerm(f):
c.push(b.removeTerm(f,{inverse:!0})),a.setSteps(a.steps+1)):b.junctionOperator()&&(y=c.find(function(a){return b.hasOneDifferentTerm(a)}))&&(e=b.findDifferentTerm(y))&&(d=y.findDifferentTerm(b))&&c.some(function(a){return a.junctionOperator()&&a.hasInverseTerms(e,d)})?(c.splice(c.indexOf(y),1,y.removeTerm(d)),a.setSteps(a.steps+1)):(null!=(v=c[0])&&v.constant()&&(c.pop(),a.setSteps(a.steps+1)),c.push(b)));return c}}(this),[]);return this.terms instanceof Array?this.prune():this.terms};c.prototype.hasMember=
function(a,c){var b,d;b=null!=(d=(null!=c?c:{}).inverse)?d:!1;return this.terms.some(function(c){return function(c){return a.equals(c,{inverse:b})}}(this))};c.prototype.hasSubTerms=function(a){return(null!=a?a.junctionOperator():void 0)&&a.terms.every(function(a){return function(c){return a.terms.some(function(a){return a.equals(c)})}}(this))};c.prototype.findHalfInverse=function(a){var c;return(null!=a?a.junctionOperator():void 0)&&(c=a.terms.find(function(a){return function(c){return a.terms.some(function(a){return a.equals(c,
{inverse:!0})})}}(this)))&&a.terms.every(function(a){return function(b){return b===c||a.terms.some(function(a){return a.equals(b)})}}(this))&&c};c.prototype.hasOneDifferentTerm=function(a){var c;return(null!=a?a.junctionOperator():void 0)&&this.terms.length===a.terms.length&&(c=CTATLogicTreeNode.intersection([this.terms,a.terms])).length&&1===this.terms.length-c.length};c.prototype.findDifferentTerm=function(a){return this.terms.find(function(c){return function(c){return a.terms.every(function(a){return!a.equals(c)})}}(this))};
c.prototype.hasInverseTerms=function(a,c){return this.junctionOperator()&&2===this.terms.length&&this.hasMember(a,{inverse:!0})&&this.hasMember(c,{inverse:!0})};c.prototype.removeTerm=function(a,c){var b,d;b=null!=(d=(null!=c?c:{}).inverse)?d:!1;this.terms=this.terms.filter(function(c){return function(c){return!a.equals(c,{inverse:b})}}(this));return this.prune()};c.prototype.prune=function(){return 1===this.terms.length?this.terms[0].setSteps(this.steps):this};c.prototype.sort=function(){this.terms=
this.terms.sort(function(a){return function(a,c){return a.compare(c)}}(this));return this};c.prototype.compare=function(a){return c.__super__.compare.call(this,a)||("NOT"===a.operator?this.compare(a.right):this.terms.some(function(c){return function(c,b){return c.compare(a.terms[b])}}(this)))||this.compareNegations(a)};c.prototype.countVariables=function(){return this.terms.reduce(function(a){return function(a,c){return a+c.countVariables()}}(this),0)};c.prototype.countLevels=function(){return 1+
this.terms.reduce(function(a){return function(a,c){return Math.max(a,c.countLevels())}}(this),0)};return c}(CTATLogicTreeNode);"undefined"!==typeof module&&null!==module?module.exports=b:this.CTATLogicFlattenNode=b}).call(this);var CTATLogicParser={};
(function(){var b,g=[].slice;b=function(){function b(b){this.parser=new CTATLogicGrammar.Parser;this.parser.lexer.options.ranges=!0;this.parser.yy={CTATLogicRelationNode:CTATLogicRelationNode,CTATLogicFlattenNode:CTATLogicFlattenNode,CTATLogicVariableNode:CTATLogicVariableNode,CTATLogicConstantNode:CTATLogicConstantNode,CTATLogicTreeNode:CTATLogicTreeNode};this.parser.yy.variableTable=b;this.parser.yy.options={strictParentheses:!1,strictOperators:!1,strictConstants:!1,parseErrors:!1};this.parser.yy.options.defaultOperatorSymbols=
{NOT:"\u00ac",AND:"\u2227",NAND:"\u22bc",OR:"\u2228",NOR:"\u22bd",IF:"\u2192",NIF:"\u219b",IFF:"\u2194",XOR:"\u21ae"};this.parser.yy.options.defaultConstantSymbols={"true":"\u22a4","false":"\u22a5"};this.setOptions()}b.SORTRule=["sort"];b.NNFRules="replaceNodes pushNegation flatten sort absorb sort".split(" ");b.CNFRules="replaceNodes pushNegation flatten sort distributeDisjunction absorb sort".split(" ");b.DNFRules="replaceNodes pushNegation flatten sort distributeConjunction absorb sort".split(" ");
b.NNFTests=["normalFormOperators","atomicNegation"];b.CNFTests=["normalFormOperators","atomicNegation","atomicDisjunction"];b.DNFTests=["normalFormOperators","atomicNegation","atomicConjunction"];b.prototype.setOptions=function(b){null==b&&(b={});Object.assign(this.parser.yy.options,b);return this.parser.yy.CTATLogicTreeNode.options=this.parser.yy.options};b.prototype.toTree=function(b,c){var a,d,e;a=null!=c?c:{};c=null!=(d=a.clone)?d:!1;d=null!=(e=a.steps)?e:!1;if(b instanceof CTATLogicTreeNode)e=
c?b.clone():b;else{var f;if(b)try{f=this.parser.parse(b)}catch(n){if(this.parser.yy.options.parseErrors)throw n;f=null}else f=null;e=f}e&&null!=b&&b.path&&(e.path=b.path);d&&null!=e&&e.setSteps(0);return e};b.prototype.toExpression=function(b,c,a){var d,e,f;e=null!=a?a:{};a=null!=(d=e.steps)?d:!1;d=null!=(f=e.paths)?f:!1;return b instanceof CTATLogicTreeNode?c:null!=c?(b=c.setParens(!1).toString(),a&&(b=Object.assign(new String(b),{steps:c.steps||0})),d&&(b=Object.assign(new String(b),{path:c.path||
[]})),b):c};b.prototype.equalExpressions=function(b,c){return b instanceof CTATLogicTreeNode&&c instanceof CTATLogicTreeNode?b.equals(c):b===c};b.prototype.logicSetOptions=function(b){null==b&&(b={});return this.setOptions(b)};b.prototype.logicParse=function(b){return this.toTree(b,{clone:!0})};b.prototype.logicGetError=function(b){try{return b instanceof CTATLogicTreeNode||this.parser.parse(String(b)),null}catch(c){return c}};b.prototype.logicStringify=function(b){return this.toExpression("",b)};
b.prototype.logicEvaluate=function(b,c){var a;null==c&&(c=null);return null!=(a=this.toTree(b))?a.evaluate(c):void 0};b.prototype.logicSort=function(e){var c;return this.toExpression(e,(null!=(c=this.toTree(e,{clone:!0}))?c.applySimplifications(b.SORTRule,{global:!0}):void 0)||null)};b.prototype.logicGetOperators=function(b,c){var a,d,e,f;d=null!=c?c:{};c=null!=(a=d.symbols)?a:!1;a=null!=(e=d.local)?e:!1;return(null!=(f=this.toTree(b))?f.getOperators({symbols:c,local:a}):void 0)||null};b.prototype.logicGetVariables=
function(b){var c;return(null!=(c=this.toTree(b))?c.getVariables():void 0)||null};b.prototype.logicGetOperands=function(b){var c;return(null!=(c=this.toTree(b))?c.getOperands().map(function(a){return function(c){return a.toExpression(b,c)}}(this)):void 0)||null};b.prototype.logicGetExpression=function(b,c){var a,d,e,f;d=null!=c?c:{};c=null!=(a=d.start)?a:0;a=null!=(e=d.end)?e:Infinity;return this.toExpression(b,(null!=(f=this.toTree(b))?f.getExpression({start:c,end:a}):void 0)||null)};b.prototype.logicFindOperator=
function(b,c,a){var d,e,f,g;d=null!=(e=(null!=a?a:{}).paths)?e:!1;return(null!=(f=this.toTree(b))?null!=(g=f.findOperator(c,[],{paths:d}))?g.map(function(a){return function(c){return a.toExpression(b,c,{paths:d})}}(this)):void 0:void 0)||null};b.prototype.logicFindExpression=function(b,c,a){var d,e,f,g;d=null!=(e=(null!=a?a:{}).paths)?e:!1;return(null!=(f=this.toTree(b))?null!=(g=f.findExpression(this.toTree(c,{clone:d}),[],{paths:d}))?g.map(function(a){return function(c){return a.toExpression(b,
c,{paths:d})}}(this)):void 0:void 0)||null};b.prototype.logicFindRuleApplications=function(b,c,a){var d,e,f,g,p,q;a=null!=a?a:{};q=null!=(e=a.reverse)?e:!1;d=null!=(f=a.paths)?f:!1;return(null!=(g=this.toTree(b))?null!=(p=g.findRuleApplications(c,[],{reverse:q,paths:d}))?p.map(function(a){return function(c){return a.toExpression(b,c,{paths:d})}}(this)):void 0:void 0)||null};b.prototype.logicApplyRule=function(b,c,a,d){var e,f,g,p;null==a&&(a=null);f=null!=d?d:{};d=null!=(e=f.reverse)?e:!1;e=f.index;
!a||"object"!==typeof a||a instanceof String||a instanceof CTATLogicTreeNode||(a=[a,null],e=a[0],d=e.reverse,e=e.index,a=a[1]);return(null!=(g=this.toTree(b,{clone:!0}))?null!=(p=g.applyRule(c,this.toTree(a),{reverse:d,index:e}))?p.map(function(a){return function(c){return a.toExpression(b,c)}}(this)):void 0:void 0)||null};b.prototype.logicApplyRules=function(b,c,a){var d,e,f,g,p;null==c&&(c=[]);e=null!=a?a:{};a=null!=(d=e.reverse)?d:!1;d=null!=(f=e.local)?f:!1;return(null!=(g=this.toTree(b,{clone:!d}))?
null!=(p=g.applyRules(c,{reverse:a,local:d}))?p.map(function(a){return function(c){return a.toExpression(b,c)}}(this)):void 0:void 0)||null};b.prototype.logicCreateExpression=function(){var b,c,a,d;a=arguments[0];b=arguments[1];c=3<=arguments.length?g.call(arguments,2):[];return this.toExpression(b,(null!=(d=this.toTree(b))?d.createExpression.apply(d,[a].concat(g.call(c.map(function(a){return function(c){return a.toTree(c)}}(this))))):void 0)||null)};b.prototype.logicReplaceExpression=function(b,
c,a,d){var e;d=(null!=d?d:{}).index;return this.toExpression(b,(null!=(e=this.toTree(b))?e.replaceExpression(this.toTree(c),this.toTree(a),{index:d}):void 0)||null)};b.prototype.logicDeleteExpression=function(b,c,a){var d;a=(null!=a?a:{}).index;return this.toExpression(b,(null!=(d=this.toTree(b))?d.deleteExpression(this.toTree(c),{index:a}):void 0)||null)};b.prototype.logicSimplifyNNF=function(e,c){var a,d;c=null!=(a=(null!=c?c:{}).steps)?a:!1;return this.toExpression(e,(null!=(d=this.toTree(e,{clone:!0,
steps:c}))?d.applySimplifications(b.NNFRules,{global:!0}):void 0)||null,{steps:c})};b.prototype.logicSimplifyCNF=function(e,c){var a,d;c=null!=(a=(null!=c?c:{}).steps)?a:!1;return this.toExpression(e,(null!=(d=this.toTree(e,{clone:!0,steps:c}))?d.applySimplifications(b.CNFRules,{global:!0}):void 0)||null,{steps:c})};b.prototype.logicSimplifyDNF=function(e,c){var a,d;c=null!=(a=(null!=c?c:{}).steps)?a:!1;return this.toExpression(e,(null!=(d=this.toTree(e,{clone:!0,steps:c}))?d.applySimplifications(b.DNFRules,
{global:!0}):void 0)||null,{steps:c})};b.prototype.logicSimplify=function(e,c){var a,d,f;d=null!=c?c:{};c=null!=(f=d.steps)?f:!1;f=null!=(a=d.flat)?a:!1;d=this.toTree(e,{steps:c});f=f?void 0:this.toTree(d,{clone:!0,steps:c}).applySimplifications(b.NNFRules,{global:!0});a=this.toTree(d,{clone:!0,steps:c}).applySimplifications(b.CNFRules,{global:!0});d=this.toTree(d,{clone:!0,steps:c}).applySimplifications(b.DNFRules,{global:!0});a=[null,f,a,d].map(function(a){return function(a){var c,b;a&&(a.length=
null!=(c=null!=a?null!=(b=a.getOperators())?b.length:void 0:void 0)?c:Infinity);return a}}(this)).reduce(function(a){return function(a,c){var b;return(null!=a?a.length:void 0)<(null!=(b=null!=c?c.length:void 0)?b:Infinity)?a:c}}(this));return this.toExpression(e,a||null,{steps:c})};b.prototype.logicValid=function(b){return null!=this.logicParse(b)};b.prototype.logicValued=function(b,c){null==c&&(c=null);return null!=this.logicEvaluate(b,c)};b.prototype.logicSorted=function(b){var c,a;return null!=
(c=this.toTree(b))&&null!=(a=this.logicSort(c))?this.equalExpressions(c,a):null};b.prototype.logicCheckTests=function(b,c){var a;null==c&&(c=[]);return null!=(a=this.toTree(b))?a.checkTests(c):void 0};b.prototype.logicCheckNNF=function(e){return this.logicCheckTests(e,b.NNFTests)};b.prototype.logicCheckCNF=function(e){return this.logicCheckTests(e,b.CNFTests)};b.prototype.logicCheckDNF=function(e){return this.logicCheckTests(e,b.DNFTests)};b.prototype.logicSimplifiedNNF=function(b){var c,a,d;return null!=
(c=this.toTree(b))&&(a=this.logicSimplifyNNF(c))&&null!=(d=this.logicSort(c))?this.equalExpressions(a,d):null};b.prototype.logicSimplifiedCNF=function(b){var c,a,d;return null!=(c=this.toTree(b))&&(a=this.logicSimplifyCNF(c))&&null!=(d=this.logicSort(c))?this.equalExpressions(a,d):null};b.prototype.logicSimplifiedDNF=function(b){var c,a,d;return null!=(c=this.toTree(b))&&(a=this.logicSimplifyDNF(c))&&null!=(d=this.logicSort(c))?this.equalExpressions(a,d):null};b.prototype.logicSimplified=function(b,
c){var a,d,e,f;c=null!=(a=(null!=c?c:{}).flat)?a:!1;return null!=(d=this.toTree(b))&&(e=this.logicSimplify(d,{flat:c}))&&null!=(f=this.logicSort(d))?this.equalExpressions(e,f):null};b.prototype.logicIdentical=function(b,c){var a,d;return null!=(a=this.logicSort(this.toTree(b)))&&null!=(d=this.logicSort(this.toTree(c)))?this.equalExpressions(a,d):null};b.prototype.logicEqual=function(b,c,a){null==a&&(a=null);b=this.logicEvaluate(b,a);c=this.logicEvaluate(c,a);if(null!=b&&null!=c)return b===c;if(null===
b||null===c)return null};b.prototype.logicEquivalent=function(b,c){var a,d;return null!=(a=this.toTree(b))&&null!=(d=this.toTree(c))?this.equalExpressions(this.logicSimplifyCNF(a),this.logicSimplifyCNF(d))||this.equalExpressions(this.logicSimplifyDNF(a),this.logicSimplifyDNF(d)):null};b.prototype.logicAlwaysEqual=function(b,c,a){var d;a=null!=(d=(null!=a?a:{}).counterexample)?d:!1;return null!=(b=this.toTree(b))&&null!=(c=this.toTree(c))?(b=b.findAlwaysEqualCounterexample(c),a?Object.assign(new Boolean(!b),
{counterexample:b}):!b):null};b.prototype.logicFindAlwaysEqualCounterexample=function(b,c){var a,d;return null!=(a=this.toTree(c))?null!=(d=this.toTree(b))?d.findAlwaysEqualCounterexample(a):void 0:null};return b}();"undefined"!==typeof module&&null!==module?module.exports=b:this.CTATLogicParser=b}).call(this);var CTATChemTreeNode={};
(function(){var b;b=function(){function b(){}b.operators=[["CONST"],["VAR"],["EXP","ROOT"],["UPLUS","UMINUS"],["ITIMES","TIMES","DIVIDE"],["IDIVIDE","REM"],["PLUS","MINUS"],"LESS LESSEQUAL EQUAL NOTEQUAL GREATEREQUAL GREATER".split(" ")];b.relationalOperators="LESS LESSEQUAL EQUAL NOTEQUAL GREATEREQUAL GREATER".split(" ");b.operatorPrecedence=function(b,e){return Math.sign(this.operators.findIndex(function(c){return c.includes(b)})-this.operators.findIndex(function(b){return b.includes(e)}))};b.operatorStrings=
{EXP:"^",ROOT:"|",UPLUS:"+",UMINUS:"-",ITIMES:"",TIMES:"*",DIVIDE:"/",IDIVIDE:"//",REM:"%",PLUS:"+",MINUS:"-",LESS:"<",LESSEQUAL:"<=",EQUAL:"=",NOTEQUAL:"!=",GREATEREQUAL:">=",GREATER:">"};b.toOperatorString=function(b){return this.operatorStrings[b]||""};b.diff=function(b,e){return b.filter(function(b){return!e.includes(b)})};b.round=function(b,e){"number"!==typeof b&&(b=parseFloat(b));e="number"===typeof e&&0===e%1?e:CTATChemParser.CHEM_DECIMAL_PRECISION;-1<e&&(e=Math.pow(10,e),b=Math.round(b*e)/
e);return b};b.prototype.toStringOld=function(b,e,c){var a;null==e&&(e="");null==c&&(c=!1);c&&(b=e+b+e);this.checkParens()&&(b="("+b+")");this.inverted()&&(b="1/"+b);this.negated()&&(b="-"+b);e=0;for(a=this.parens;0<=a?e<a:e>a;0<=a?++e:--e)b="("+b+")";this.units&&(b+=this.units.toStringOld(c));return b};b.prototype.toString=function(b,e,c,a,d){null==e&&(e="EQUAL");null==c&&(c=!1);null==a&&(a="");null==d&&(d=!1);d&&(b=a+b+a);a=0;for(d=this.parens;0<=d?a<d:a>d;0<=d?++a:--a)b="("+b+")";!this.parented()&&
this.checkParens(null,!0)&&(b="("+b+")");this.inverted()&&(b="1/"+b);this.negated()&&(b="-"+b);!this.parented()&&this.checkParens(e,c)&&(b="("+b+")");return b};b.prototype.addParens=function(){this.parens++;return this};b.prototype.setParens=function(b,e){null==e&&(e=!1);this.checkParens(b,e)&&(this.parens=1);return this};b.prototype.checkParens=function(f,e){var c;null==e&&(e=!1);null!=f?c=this.negated()?"UMINUS":this.inverted()?"DIVIDE":this.operator:(f=this.negated()?"MINUS":this.inverted()?"DIVIDE":
null,c=this.operator);c=b.operatorPrecedence(f,c);return null!=f&&(0>c||0===c&&e)};b.prototype.evaluate=function(b){return this.sign*Math.pow(b,this.exp)};b.prototype.applyOperator=function(f,e){var c;switch(this.operator){case "LESS":c=f<e;break;case "GREATER":c=f>e;break;case "LESSEQUAL":c=f<=e;break;case "GREATEREQUAL":c=f>=e;break;case "EQUAL":c=f===e;break;case "NOTEQUAL":c=f!==e;break;case "PLUS":c=b.round(f+e);break;case "MINUS":c=b.round(f-e);break;case "TIMES":case "ITIMES":c=b.round(f*e);
break;case "DIVIDE":c=b.round(f/e);break;case "EXP":c=b.round(Math.pow(f,e));break;case "ROOT":c=b.round(Math.pow(f,1)/e);break;case "REM":c=f%e;break;case "IDIVIDE":c=Math.floor(f/e);break;case "UPLUS":c=f;break;case "UMINUS":c=-f;break;case "LOG":c=Math.log10(f);break;case "LN":c=Math.log(f)}return c};b.prototype.equals=function(b){return b&&this.operator===b.operator&&this.sign===b.sign&&this.exp===b.exp&&this.parens===b.parens};b.prototype.simplify=function(b){this.methods=b;return this.simplifyNode(this.methods)};
b.prototype.simplifyNode=function(b){var e,c,a,d;this.methods=b;d=this;a=this.methods;b=0;for(e=a.length;b<e;b++)c=a[b],d=d[c].call(d),d.methods=this.methods;delete d.methods;return d};b.prototype.simpleFlatten=function(){return this};b.prototype.flatten=function(){this.parens=0;return this.simpleFlatten()};b.prototype.computeConstants=function(){return this};b.prototype.combineSimilar=function(){return this};b.prototype.expand=function(){return this};b.prototype.distribute=function(){return this};
b.prototype.removeIdentity=function(){return this};b.prototype.sort=function(){return this};b.prototype.spreadIdentity=function(){return this};b.prototype.stripIdentity=function(){return this};b.prototype.multiplyOne=function(b){null==b&&(b=!1);return(new CTATChemMultiplicationNode("TIMES",[new CTATChemConstantNode(1,b),this])).popNegation().pushNegation()};b.prototype.powerOne=function(b){null==b&&(b=!1);return(new CTATChemPowerNode("EXP",this,new CTATChemConstantNode(1,b))).popInversion().pushInversion().popNegation()};
b.prototype.compare=function(f,e){return b.operatorPrecedence(this.operator,f.operator)};b.prototype.compareSigns=function(b,e){return(Math.sign(this.sign-b.sign)||Math.sign(this.exp-b.exp))*e};b.prototype.countVariables=function(){return 0};b.prototype.pushNegation=function(){return this};b.prototype.popNegation=function(){return this};b.prototype.pushInversion=function(){return this};b.prototype.popInversion=function(){return this};b.prototype.negate=function(){this.sign=-this.sign;return this};
b.prototype.invert=function(){this.exp=-this.exp;return this};b.prototype.addition=function(){return"PLUS"===this.operator};b.prototype.subtraction=function(){return"MINUS"===this.operator};b.prototype.multiplication=function(){return"TIMES"===this.operator};b.prototype.division=function(){return"DIVIDE"===this.operator};b.prototype.intDivision=function(){return"IDIVIDE"===this.operator};b.prototype.power=function(){return"EXP"===this.operator};b.prototype.root=function(){return"ROOT"===this.operator};
b.prototype.negation=function(){return"UMINUS"===this.operator};b.prototype.unary=function(){var b;return"UPLUS"===(b=this.operator)||"UMINUS"===b};b.prototype.log=function(){var b;return"LOG"===(b=this.operator)||"LN"===b};b.prototype.constant=function(b){return!1};b.prototype.integer=function(){return!1};b.prototype.negated=function(){return 0>this.sign};b.prototype.inverted=function(){return 0>this.exp};b.prototype.parented=function(){return 0<this.parens};b.prototype.even=function(){return!1};
b.prototype.setUnit=function(b){this.units=b;return this};b.prototype.getVariables=function(){return[]};b.prototype.setVariable=function(){return this};return b}();"undefined"!==typeof module&&null!==module?module.exports=b:this.CTATChemTreeNode=b}).call(this);var CTATChemRelationNode={};
(function(){var b,g=function(b,c){function a(){this.constructor=b}for(var d in c)f.call(c,d)&&(b[d]=c[d]);a.prototype=c.prototype;b.prototype=new a;b.__super__=c.prototype;return b},f={}.hasOwnProperty;b=function(b){function c(a,b,c,e,f,g){this.operator=a;this.left=b;this.right=c;this.parens=null!=e?e:0;this.sign=null!=f?f:1;this.exp=null!=g?g:1}g(c,b);c.prototype.clone=function(){return new c(this.operator,this.left.clone(),this.right.clone(),this.parens,this.sign,this.exp)};c.prototype.toStringOld=
function(a){null==a&&(a=!1);this.left.setParens(this.operator);this.right.setParens(this.operator);return c.__super__.toStringOld.call(this,""+this.left.toStringOld(a)+CTATChemTreeNode.toOperatorString(this.operator)+this.right.toStringOld(a))};c.prototype.toString=function(a,b,e){null==a&&(a="EQUAL");null==b&&(b=!1);null==e&&(e=!1);return c.__super__.toString.call(this,""+this.left.toString(this.operator,!1,e)+CTATChemTreeNode.toOperatorString(this.operator)+this.right.toString(this.operator,!1,
e),a,b)};c.prototype.evaluate=function(){return this.applyOperator(this.left.evaluate(),this.right.evaluate())};c.prototype.equals=function(a){return c.__super__.equals.call(this,a)&&this.left.equals(a.left)&&this.right.equals(a.right)};c.prototype.simplify=function(a){this.methods=a;this.left=this.left.simplify(this.methods);this.right=this.right.simplify(this.methods);return c.__super__.simplify.apply(this,arguments)};c.prototype.computeConstants=function(){return this.left.constant()&&this.right.constant()?
new CTATChemConstantNode(this.evaluate()):this};c.prototype.sort=function(){var a;switch(this.operator){case "GREATER":this.operator="LESS";a=[this.right,this.left];this.left=a[0];this.right=a[1];break;case "GREATEREQUAL":this.operator="LESSEQUAL";a=[this.right,this.left];this.left=a[0];this.right=a[1];break;case "EQUAL":case "NOTEQUAL":0>this.left.compare(this.right)&&(a=[this.right,this.left],this.left=a[0],this.right=a[1])}return this};c.prototype.countVariables=function(){return this.left.countVariables()+
this.right.countVariables()};c.prototype.getVariables=function(){return this.left.getVariables().concat(this.right.getVariables())};c.prototype.setVariable=function(a,b,c){return[this.left,this.right].forEach(function(d){return function(e,f){var g;return"VAR"===e.operator&&e.variable===a?(g=c(),g.sign=e.sign,g.exp=e.exp,0===f?d.left=g:d.right=g):e.setVariable(a,b,c)}}(this))};return c}(CTATChemTreeNode);"undefined"!==typeof module&&null!==module?module.exports=b:this.CTATChemRelationNode=b}).call(this);var CTATChemAdditionNode={};
(function(){var b,g=function(b,c){function a(){this.constructor=b}for(var d in c)f.call(c,d)&&(b[d]=c[d]);a.prototype=c.prototype;b.prototype=new a;b.__super__=c.prototype;return b},f={}.hasOwnProperty;b=function(b){function c(a,b,c,e,f){this.operator=a;this.terms=b;this.parens=null!=c?c:0;this.sign=null!=e?e:1;this.exp=null!=f?f:1}g(c,b);c.prototype.clone=function(){return new c(this.operator,this.terms.map(function(a){return a.clone()}),this.parens,this.sign,this.exp)};c.prototype.toStringOld=function(a){null==
a&&(a=!1);return c.__super__.toStringOld.call(this,this.terms.reduce(function(b){return function(c,d){d.setParens(b.operator);return""+c+(c&&!d.negated()?"+":"")+d.toStringOld(a)}}(this),""))};c.prototype.toString=function(a,b,e){null==a&&(a="EQUAL");null==b&&(b=!1);null==e&&(e=!1);return c.__super__.toString.call(this,this.terms.reduce(function(a){return function(b,c){var d;d=b&&!c.negated()?a.operator:"";return""+b+CTATChemTreeNode.toOperatorString(d)+c.toString(a.operator,!1,e)}}(this),""),a,b)};
c.prototype.addPaths=function(a){this.terms.forEach(function(b,c){return b.addPaths(a.concat([["terms",c]]))});return c.__super__.addPaths.apply(this,arguments)};c.prototype.evaluate=function(){return c.__super__.evaluate.call(this,this.terms.reduce(function(a){return function(b,c){return a.applyOperator(b,c.evaluate())}}(this),0))};c.prototype.equals=function(a){return c.__super__.equals.call(this,a)&&this.terms.length===a.terms.length&&this.terms.every(function(b,c){return b.equals(a.terms[c])})};
c.prototype.simplify=function(a){this.methods=a;this.terms=this.terms.map(function(a){return function(b){return b.simplify(a.methods)}}(this));return c.__super__.simplify.apply(this,arguments)};c.prototype.simpleFlatten=function(){!this.terms[0].negation()||this.terms[0].inverted()||this.terms[0].parented()||(this.terms[0]=this.terms[0].base.negate());this.subtraction()&&(this.terms[1].negate(),this.operator="PLUS");this.terms=this.terms.reduce(function(a,b){b.inverted()||b.parented()||!b.addition()?
a.push(b):a.push.apply(a,b.pushNegation().terms);return a},[]);return this};c.prototype.flatten=function(){return c.__super__.flatten.apply(this,arguments).pushNegation()};c.prototype.computeConstants=function(){var a,b;0<=(b=this.terms.findIndex(function(a){return a.constant()}))&&(a=this.terms[b].evaluate(),this.terms=this.terms.filter(function(c){return function(d,e){return e<=b||!d.constant()||(a=c.applyOperator(a,d.evaluate()))&&!1}}(this)),0===a&&1<this.terms.length?this.terms.splice(b,1):this.terms[b].set(a));
return 1<this.terms.length?this:this.pushInversion().terms[0]};c.prototype.combineSimilar=function(){var a;a=[];this.terms.forEach(function(b){var c,d;c=null;b.constant()?c=[null,b]:(b=b.multiplyOne(),c=[b,b.factors.shift()]);d=c[1].evaluate();if(b=a.find(function(a){var b;return null!=(b=a[0])?b.equals(c[0]):void 0}))return b[1]+=d;b=[c[0],d];return a.push(b)});this.terms=a.reduce(function(a,b){0!==b[1]&&(b[1]=(new CTATChemConstantNode(b[1],!1,0,1,1,void 0)).popNegation(),b[0]?(b[0].factors.unshift(b[1]),
a.push(b[0].removeIdentity())):a.push(b[1]));return a},[]);if(1<this.terms.length)return this;1!==this.terms.length&&(this.terms[0]=new CTATChemConstantNode(0));return this.pushInversion().terms[0]};c.prototype.removeIdentity=function(a){var b;null==a&&(a=!1);b=this.terms.filter(function(b){return!b.constant(0,a)});this.terms=b.length?b:this.terms.slice(0,1);return 1<this.terms.length?this:this.pushInversion().terms[0]};c.prototype.sort=function(){this.spreadIdentity();this.terms=this.terms.sort(function(a,
b){return-a.compare(b,!0)});return this.stripIdentity()};c.prototype.spreadIdentity=function(){this.terms=this.terms.map(function(a){return a.multiplyOne(!0)});return this};c.prototype.stripIdentity=function(){this.terms=this.terms.map(function(a){return a.removeIdentity(!0)});return this};c.prototype.compare=function(a,b){var d;return(d=c.__super__.compare.apply(this,arguments))||this.countVariables()-a.countVariables()||this.terms.some(function(c,e){return d=c.compare(a.terms[e],b)})&&d||this.compareSigns(a,
b)};c.prototype.countVariables=function(){return this.terms.reduce(function(a,b){return a+b.countVariables()},0)};c.prototype.pushNegation=function(){this.negated()&&(this.negate(),this.terms.forEach(function(a){return a.negate()}));return this};c.prototype.popNegation=function(){this.terms[0].negated()&&(this.negate(),this.terms.forEach(function(a){return a.negate()}));return this};c.prototype.pushInversion=function(){this.inverted()&&(this.invert(),this.terms[0].invert());return this};c.prototype.even=
function(){return!this.inverted&&this.terms.every(function(a){return a.even()})};c.prototype.getVariables=function(){var a;a=[];this.terms.forEach(function(b){return function(b){return a=a.concat(b.getVariables())}}(this));return a};c.prototype.setVariable=function(a,b,c){var d,e,f;d=0;for(f=[];d<this.terms.length;)"VAR"===this.terms[d].operator&&this.terms[d].variable===a?(e=c(),e.sign=this.terms[d].sign,e.exp=this.terms[d].exp,this.terms[d]=e):this.terms[d].setVariable(a,b,c),f.push(d++);return f};
return c}(CTATChemTreeNode);"undefined"!==typeof module&&null!==module?module.exports=b:this.CTATChemAdditionNode=b}).call(this);var CTATChemMultiplicationNode={};
(function(){var b,g=function(b,c){function a(){this.constructor=b}for(var d in c)f.call(c,d)&&(b[d]=c[d]);a.prototype=c.prototype;b.prototype=new a;b.__super__=c.prototype;return b},f={}.hasOwnProperty;b=function(b){function c(a,b,c,e,f){this.operator=a;this.factors=b;this.parens=null!=c?c:0;this.sign=null!=e?e:1;this.exp=null!=f?f:1}g(c,b);c.prototype.clone=function(){return new c(this.operator,this.factors.map(function(a){return a.clone()}),this.parens,this.sign,this.exp)};c.prototype.toStringOld=
function(a){null==a&&(a=!1);return c.__super__.toStringOld.call(this,this.factors.reduce(function(b){return function(c,d){var e;d=d.inverted()?(d.invert(),d.setParens("DIVIDE",!!c),e=d.toStringOld(a),d.invert(),"/"):(d.setParens(b.operator,!!c),/^[\d+-]/.test(e=d.toStringOld(a))&&/\d$/.test(c)?"*":"");return""+c+(c?d:"")+e}}(this),this.factors[0].inverted()?"1":""))};c.prototype.toString=function(a,b,e){null==a&&(a="EQUAL");null==b&&(b=!1);null==e&&(e=!1);return c.__super__.toString.call(this,this.factors.reduce(function(a){return function(b,
c){var d,f;c.inverted()?(c.invert(),d=c.toString("DIVIDE",b,e),c.invert()):d=c.toString(a.operator,b,e);f=b?c.inverted()?"DIVIDE":"DIVIDE"===a.operator||/^[\d+-]/.test(d)&&/\d$/.test(b)?a.operator:"":"";d=""===f&&c.negated()?"("+d+")":d;return""+b+CTATChemTreeNode.toOperatorString(f)+d}}(this),"TIMES"===this.operator&&this.factors[0].inverted()?"1":""),a,b)};c.prototype.evaluate=function(){return c.__super__.evaluate.call(this,this.factors.reduce(function(a){return function(b,c){return a.applyOperator(b,
c.evaluate())}}(this),1))};c.prototype.equals=function(a){return c.__super__.equals.call(this,a)&&this.factors.length===a.factors.length&&this.factors.every(function(b,c){return b.equals(a.factors[c])})};c.prototype.simplify=function(a){this.methods=a;this.factors=this.factors.map(function(a){return function(b){return b.simplify(a.methods)}}(this));return c.__super__.simplify.apply(this,arguments)};c.prototype.simpleFlatten=function(){this.division()&&this.factors[1].invert();this.operator="TIMES";
this.factors=this.factors.reduce(function(a,b){b.parented()||!b.multiplication()?a.push(b):a.push.apply(a,b.pushNegation().pushInversion().factors);return a},[]);return this};c.prototype.flatten=function(){return c.__super__.flatten.apply(this,arguments).popNegation()};c.prototype.computeConstants=function(){var a,b;b=this.factors.findIndex(function(a){return a.constant()&&0<a.exp});b=0<=b?this.factors.splice(b,1)[0]:null;a=this.factors.findIndex(function(a){return a.constant()&&0>a.exp});a=0<=a?
this.factors.splice(a,1)[0]:null;[b,a].forEach(function(a){return function(b,c){var d;if(b&&(d=b.evaluate(),a.factors=a.factors.filter(function(c,e){return 0>c.exp*b.exp||!c.constant()||(d=a.applyOperator(d,c.evaluate()))&&!1}),!(1===d&&1<a.factors.length)&&(b.set(0===c?d:Math.pow(d,-1)),1===c)))return b.exp=-1}}(this));b&&a?(b.set(this.applyOperator(b.evaluate(),a.evaluate())),this.factors.unshift(b)):b?this.factors.unshift(b):a&&this.factors.push(a);return 1<this.factors.length?this:this.pushNegation().pushInversion().factors[0].pushNegation()};
c.prototype.combineSimilar=function(){var a;a=[];this.factors.forEach(function(b){var c,d,e,f;f=b.constant()?[null,b]:b.power()?b.exponent.constant()?(b.pushInversion(),[b.base,b.exponent]):(b.exponent=b.exponent.multiplyOne(),[b,b.exponent.factors.shift()]):(b=b.powerOne(),[b.base,b.exponent]);return(c=a.find(function(a){var b;return null!=(b=a[0])?b.equals(f[0]):void 0}))?c[1]+=(null!=(d=f[1])?d.evaluate():void 0)||1:a.push([f[0],(null!=(e=f[1])?e.evaluate():void 0)||1])});this.factors=a.reduce(function(a,
b){0!==b[1]&&(b[1]=(new CTATChemConstantNode(b[1])).popNegation(),b[0]?b[1].constant(1)?a.push(b[0]):b[1].constant(-1)?a.push(b[0].invert()):b[0].power()?(b[0].exponent.factors.unshift(b[1]),a.push(b[0])):a.push((new CTATChemPowerNode("EXP",b[0],b[1])).popInversion()):a.push(b[1]));return a},[]);if(1<this.factors.length)return this;1!==this.factors.length&&(this.factors[0]=new CTATChemConstantNode(1));return this.pushNegation().pushInversion().factors[0]};c.prototype.distribute=function(){var a,b,
c;a=this.factors.filter(function(a){return!a.inverted()});c=this.factors.filter(function(a){return a.inverted()});return!this.distributedOrSingle(a)||!this.distributedOrSingle(c)||this.single(a)&&c.length&&this.distributed(c)?(this.distributed(c)?(b=this.distributeFactors(this.factors),c=[]):this.distributed(a)?(c=this.distributeFactors(c,!0),b=[]):(b=this.distributeFactors(a),c=this.distributeFactors(c,!0)),this.factors=c.length?b.length?[this.packTerms(b),this.packTerms(c).invert()]:a.concat([this.packTerms(c).invert()]):
[this.packTerms(b)],1<this.factors.length?this:this.pushNegation().pushInversion().factors[0].pushNegation()):this};c.prototype.distributedOrSingle=function(a){return this.distributed(a)||this.single(a)};c.prototype.distributed=function(a){return a.every(function(a){return!a.addition()})};c.prototype.single=function(a){return 1===a.length&&a[0].addition()};c.prototype.distributeFactors=function(a,b){var c;null==b&&(b=!1);c=a[0].addition()?a[0].terms.map(function(a){return a.multiplication()?a.pushNegation().factors:
[a]}):[[a[0].inverted()&&b?a[0].clone().invert():a[0].clone()]];a.slice(1).forEach(function(a){var d;return a.addition()?1===c.length?c=a.terms.map(function(a){var b;b=c[0].map(function(a){return a.clone()});a.multiplication()?b.push.apply(b,a.pushNegation().factors):b.push(a);return b}):c=c.reduce(function(b,c){b.push.apply(b,a.terms.map(function(a){var b;b=c.map(function(a){return a.clone()});a.multiplication()?b.push.apply(b,a.pushNegation().factors.map(function(a){return a.clone()})):b.push(a.clone());
return b}));return b},[]):1===c.length?a.multiplication()?(d=c[0]).push.apply(d,a.pushNegation().factors.map(function(a){return a.inverted()&&b?a.clone().invert():a.clone()})):c[0].push(a.inverted()&&b?a.clone().invert():a.clone()):c.forEach(function(d,e){var f;return a.multiplication()?(f=c[e]).push.apply(f,a.pushNegation().factors.map(function(a){return a.inverted()&&b?a.clone.invert():a.clone()})):c[e].push(a.inverted()&&b?a.clone().invert():a.clone())})});return c};c.prototype.packTerms=function(a){var b;
b=CTATChemTreeNode.diff(this.methods,["flatten","distribute"]);return(new CTATChemAdditionNode("PLUS",a.map(function(a){return(new c("TIMES",a)).popNegation().simplifyNode(b)}))).simplifyNode(b)};c.prototype.removeIdentity=function(a){var b;null==a&&(a=!1);this.popNegation();b=this.factors.filter(function(b){return!b.constant(1,a)});this.factors=b.length?b:this.factors.slice(0,1);(b=this.factors.find(function(b){return b.constant(0,a)}))&&this.factors.every(function(a){return!a.inverted()&&(!a.power()||
a.exponent.constant())})&&(this.factors=[b]);return 1<this.factors.length?this:this.pushNegation().pushInversion().factors[0]};c.prototype.sort=function(){this.spreadIdentity();this.factors=this.factors.sort(function(a,b){return a.compare(b)});return this.stripIdentity()};c.prototype.spreadIdentity=function(){this.factors=this.factors.map(function(a){return a.powerOne(!0)});return this};c.prototype.stripIdentity=function(){this.factors=this.factors.map(function(a){return a.removeIdentity(!0)});return this.popNegation()};
c.prototype.multiplyOne=function(a){null==a&&(a=!1);this.factors[0].constant()||this.factors.unshift(new CTATChemConstantNode(1,a));return this.pushNegation()};c.prototype.compare=function(a,b){var d,e;return(e=c.__super__.compare.apply(this,arguments))||this.countVariables()-a.countVariables()||(d=a.factors.slice(0).reverse())&&this.factors.slice(0).reverse().some(function(a,c){return e=a.compare(d[c],b)})&&e||this.compareSigns(a,b)};c.prototype.countVariables=function(){return this.factors.reduce(function(a,
b){return a+b.countVariables()},0)};c.prototype.pushNegation=function(){this.negated()&&(this.negate(),this.factors[0].negate());return this};c.prototype.popNegation=function(){this.factors.forEach(function(a){return function(b){if(b.negated())return a.negate(),b.negate()}}(this));return this};c.prototype.pushInversion=function(){this.inverted()&&(this.invert(),this.factors.forEach(function(a){return a.invert()}));return this};c.prototype.even=function(){return!this.inverted()&&this.factors.every(function(a){return a.integer()})&&
this.factors.some(function(a){return a.even()})};c.prototype.getVariables=function(){var a;a=[];this.factors.forEach(function(b){return function(b){return a=a.concat(b.getVariables())}}(this));return a};c.prototype.setVariable=function(a,b,c){var d,e,f;d=0;for(f=[];d<this.factors.length;)"VAR"===this.factors[d].operator&&this.factors[d].variable===a?(e=c(),e.sign=this.factors[d].sign,e.exp=this.factors[d].exp,this.factors[d]=e):this.factors[d].setVariable(a,b,c),f.push(d++);return f};return c}(CTATChemTreeNode);
"undefined"!==typeof module&&null!==module?module.exports=b:this.CTATChemMultiplicationNode=b}).call(this);var CTATChemIntDivisionNode={};
(function(){var b,g=function(b,c){function a(){this.constructor=b}for(var d in c)f.call(c,d)&&(b[d]=c[d]);a.prototype=c.prototype;b.prototype=new a;b.__super__=c.prototype;return b},f={}.hasOwnProperty;b=function(b){function c(a,b,c,e,f,g){this.operator=a;this.dividend=b;this.divisor=c;this.parens=null!=e?e:0;this.sign=null!=f?f:1;this.exp=null!=g?g:1}g(c,b);c.prototype.clone=function(){return new c(this.operator,this.dividend.clone(),this.divisor.clone(),this.parens,this.sign,this.exp)};c.prototype.toStringOld=
function(a){null==a&&(a=!1);this.dividend.setParens(this.operator);this.divisor.setParens(this.operator,!0);return c.__super__.toStringOld.call(this,""+this.dividend.toStringOld(a)+CTATChemTreeNode.toOperatorString(this.operator)+this.divisor.toStringOld(a))};c.prototype.toString=function(a,b,e){null==a&&(a="EQUAL");null==b&&(b=!1);null==e&&(e=!1);return c.__super__.toString.call(this,""+this.dividend.toString(this.operator,!1,e)+CTATChemTreeNode.toOperatorString(this.operator)+this.divisor.toString(this.operator,
!1,e),a,b)};c.prototype.evaluate=function(){return c.__super__.evaluate.call(this,this.applyOperator(this.dividend.evaluate(),this.divisor.evaluate()))};c.prototype.equals=function(a){return c.__super__.equals.call(this,a)&&this.dividend.equals(a.dividend)&&this.divisor.equals(a.divisor)};c.prototype.simplify=function(a){this.methods=a;this.dividend=this.dividend.simplify(this.methods);this.divisor=this.divisor.simplify(this.methods);return c.__super__.simplify.apply(this,arguments)};c.prototype.computeConstants=
function(){return this.dividend.constant()&&this.divisor.constant()?new CTATChemConstantNode(this.evaluate()):this};c.prototype.removeIdentity=function(a){null==a&&(a=!1);return this.divisor.constant(1,a)?(this.intDivision()||(this.dividend=new CTATChemConstantNode(0,a)),this.pushNegation().pushInversion().dividend):this.popNegation()};c.prototype.compare=function(a,b){return c.__super__.compare.apply(this,arguments)||this.dividend.compare(a.dividend,b)||this.divisor.compare(a.divisor,b)||this.operator!==
a.operator&&(this.intDivision()&&-1||1)||this.compareSigns(a,b)};c.prototype.countVariables=function(){return this.dividend.countVariables()+divisor.countVariables()};c.prototype.pushNegation=function(){this.intDivision()&&this.negated()&&(this.negate(),this.dividend.negate());return this};c.prototype.pushInversion=function(){this.intDivision()&&this.inverted()&&(this.invert(),this.dividend.invert());return this};c.prototype.popNegation=function(){this.divisor.negated()&&(this.divisor.negate(),this.intDivision()&&
this.dividend.negate());return this};c.prototype.even=function(){return!this.inverted&&"REM"===this.operator&&this.dividend.even()&&this.divisor.even()};c.prototype.getVariables=function(){return this.dividend.getVariables().concat(this.divisor.getVariables())};c.prototype.setVariable=function(a,b,c){return[this.dividend,this.divisor].forEach(function(d){return function(e,f){var g;return"VAR"===e.operator&&e.variable===a?(g=c(),g.sign=e.sign,g.exp=e.exp,0===f?d.dividend=g:d.divisor=g):e.setVariable(a,
b,c)}}(this))};return c}(CTATChemTreeNode);"undefined"!==typeof module&&null!==module?module.exports=b:this.CTATChemIntDivisionNode=b}).call(this);var CTATChemUnaryNode={};
(function(){var b,g=function(b,c){function a(){this.constructor=b}for(var d in c)f.call(c,d)&&(b[d]=c[d]);a.prototype=c.prototype;b.prototype=new a;b.__super__=c.prototype;return b},f={}.hasOwnProperty;b=function(b){function c(a,b,c,e,f){this.operator=a;this.base=b;this.parens=null!=c?c:0;this.sign=null!=e?e:1;this.exp=null!=f?f:1}g(c,b);c.prototype.clone=function(){return new c(this.operator,this.base,this.parens,this.sign,this.exp)};c.prototype.toStringOld=function(a){null==a&&(a=!1);this.base.setParens(this.operator);
return c.__super__.toStringOld.call(this,""+CTATChemTreeNode.toOperatorString(this.operator)+this.base.toStringOld(a))};c.prototype.toString=function(a,b,e){null==a&&(a="EQUAL");null==b&&(b=!1);null==e&&(e=!1);return c.__super__.toString.call(this,""+CTATChemTreeNode.toOperatorString(this.operator)+this.base.toString(this.operator,!1,e),a,b)};c.prototype.evaluate=function(){return c.__super__.evaluate.call(this,this.applyOperator(this.base.evaluate()))};c.prototype.equals=function(a){return c.__super__.equals.call(this,
a)&&this.base.equals(a.base)};c.prototype.simplify=function(a){this.methods=a;this.base=this.base.simplify(this.methods);return c.__super__.simplify.apply(this,arguments)};c.prototype.flatten=function(){this.negation()&&(this.negate(),this.operator="UPLUS");return this.pushNegation().pushInversion().base.pushNegation()};c.prototype.compare=function(a,b){return a.unary()&&this.base.compare(a.base,b)||c.__super__.compare.apply(this,arguments)||this.compareSigns(a,b)};c.prototype.countVariables=function(){return this.base.countVariables()};
c.prototype.pushNegation=function(){this.negated()&&(this.negate(),this.base.negate());return this};c.prototype.pushInversion=function(){this.inverted()&&(this.invert(),this.base.invert());return this};c.prototype.constant=function(a,b){null==b&&(b=!1);return this.base.constant(a,b)};c.prototype.getVariables=function(){return this.base.getVariables()};c.prototype.setVariable=function(a,b,c){return"VAR"===this.base.operator&&this.base.variable===a?(a=c(),a.sign=this.base.sign,a.exp=this.base.exp,this.base=
a):this.base.setVariable(a,b,c)};return c}(CTATChemTreeNode);"undefined"!==typeof module&&null!==module?module.exports=b:this.CTATChemUnaryNode=b}).call(this);var CTATChemPowerNode={};
(function(){var b,g=function(b,c){function a(){this.constructor=b}for(var d in c)f.call(c,d)&&(b[d]=c[d]);a.prototype=c.prototype;b.prototype=new a;b.__super__=c.prototype;return b},f={}.hasOwnProperty;b=function(b){function c(a,b,c,e,f,g){this.operator=a;this.base=b;this.exponent=c;this.parens=null!=e?e:0;this.sign=null!=f?f:1;this.exp=null!=g?g:1}g(c,b);c.prototype.clone=function(){return new c(this.operator,this.base.clone(),this.exponent.clone(),this.parens,this.sign,this.exp)};c.prototype.toStringOld=
function(a){null==a&&(a=!1);this.base.setParens(this.operator);this.exponent.setParens(this.operator);return c.__super__.toStringOld.call(this,""+this.base.toStringOld(a)+CTATChemTreeNode.toOperatorString(this.operator)+this.exponent.toStringOld(a))};c.prototype.toString=function(a,b,e){null==a&&(a="EQUAL");null==b&&(b=!1);null==e&&(e=!1);return c.__super__.toString.call(this,""+this.base.toString(this.operator,!1,e)+CTATChemTreeNode.toOperatorString(this.operator)+this.exponent.toString(this.operator,
!1,e),a,b)};c.prototype.evaluate=function(){return c.__super__.evaluate.call(this,this.applyOperator(this.base.evaluate(),this.exponent.evaluate()))};c.prototype.equals=function(a){return c.__super__.equals.call(this,a)&&this.base.equals(a.base)&&this.exponent.equals(a.exponent)};c.prototype.simplify=function(a){this.methods=a;this.base=this.base.simplify(this.methods);this.exponent=this.exponent.simplify(this.methods);return c.__super__.simplify.apply(this,arguments)};c.prototype.flatten=function(){var a,
b;c.__super__.flatten.apply(this,arguments);this.root()&&(this.exponent.invert(),this.operator="EXP");this.popNegation().popInversion();return this.base.power()?(b=CTATChemTreeNode.diff(this.methods,["flatten"]),a=this.base.exponent.multiplication()?this.base.exponent.pushNegation().pushInversion().factors:[this.base.exponent],this.exponent.multiplication()?a.push.apply(a,this.exponent.pushNegation().pushInversion().factors):a.push(this.exponent),this.base.exponent=(new CTATChemMultiplicationNode("TIMES",
a)).simplifyNode(b),this.pushBaseNegation().pushBaseInversion().base):this};c.prototype.computeConstants=function(){return this.base.constant()&&(this.exponent.constant()||this.exponent.multiplication()&&this.exponent.factors[0].constant())?(this.exponent.constant()?(this.base=new CTATChemConstantNode(this.evaluate()),this.exponent=null):(this.base=new CTATChemConstantNode((new c("EXP",this.base,this.exponent.factors.shift())).evaluate()),1===this.exponent.factors.length&&(this.exponent=this.exponent.pushNegation().pushInversion().factors[0])),
this.exponent?this:this.pushBaseNegation().base):1===this.exponent.evaluate()?this.pushBaseNegation().pushBaseInversion().base:this};c.prototype.powerOne=function(a){null==a&&(a=!1);this.exponent=this.exponent.multiplyOne(a);return this.pushInversion()};c.prototype.expand=function(){var a,b,c;if(this.base.addition()&&(this.exponent.integer()&&1<this.exponent.value||this.exponent.multiplication()&&this.exponent.factors[0].integer()&&1<this.exponent.factors[0].value)){this.exponent.integer()?(a=this.exponent,
this.exponent=null):(a=this.exponent.factors.shift(),1===this.exponent.factors.length&&(this.exponent=this.exponent.pushNegation().pushInversion().factors[0]));b=[this.base];c=1;for(a=a.evaluate();1<=a?c<a:c>a;1<=a?++c:--c)b.push(this.base.clone());this.base=(new CTATChemMultiplicationNode("TIMES",b)).simplifyNode(["distribute"]);return this.exponent?this:this.pushBaseNegation().pushBaseInversion().base}return this};c.prototype.distribute=function(){var a;return this.base.multiplication()||this.exponent.addition()?
(a=this.base.multiplication()?this.base.pushNegation().pushInversion().factors:[this.base],a=this.exponent.addition()?a.reduce(function(a){return function(b,c){b.push.apply(b,a.exponent.terms.map(function(a){return[c.clone(),a.clone()]}));return b}}(this),[]):a.map(function(a){return function(b){return[b,a.exponent.clone()]}}(this)),this.base=this.packFactors(a),this.pushBaseNegation().pushBaseInversion().base):this};c.prototype.packFactors=function(a){var b;b=CTATChemTreeNode.diff(this.methods,["flatten"]);
return new CTATChemMultiplicationNode("TIMES",a.map(function(a){return(new c("EXP",a[0],a[1])).simplifyNode(b)}))};c.prototype.removeIdentity=function(a){null==a&&(a=!1);this.popInversion();if(this.exponent.constant(0,a))return this.base=new CTATChemConstantNode(1,a),this.pushBaseNegation().base;if(this.base.constant(0,a))return this.pushBaseInversion().base;if(this.exponent.constant(1,a))return this.pushBaseNegation().pushBaseInversion().base;this.exponent=this.exponent.removeIdentity(a);return this};
c.prototype.compare=function(a,b){return c.__super__.compare.apply(this,arguments)||(this.countVariables()-a.countVariables())*(b?-1:1)||this.exponent.compare(a.exponent,b)||this.base.compare(a.base,b)||this.compareSigns(a,b)};c.prototype.countVariables=function(){return this.base.countVariables()*(this.exponent.constant()?Math.abs(this.exponent.evaluate()):Infinity)};c.prototype.pushBaseNegation=function(){this.negated()&&(this.negate(),this.base.negate());return this};c.prototype.pushInversion=
function(){this.inverted()&&(this.invert(),this.exponent.negate());return this};c.prototype.pushBaseInversion=function(){this.inverted()&&(this.invert(),this.base.invert());return this};c.prototype.popNegation=function(){this.base.negated()&&this.exponent.constant()&&(this.base.negate(),this.exponent.even()||this.negate());return this};c.prototype.popInversion=function(){this.exponent.negated()&&(this.invert(),this.exponent.negate());this.base.inverted()&&(this.invert(),this.base.invert());return this};
c.prototype.even=function(){return!this.inverted()&&this.base.even()&&this.exponent.integer()};c.prototype.getVariables=function(){return this.base.getVariables().concat(this.exponent.getVariables())};c.prototype.setVariable=function(a,b,c){return[this.base,this.exponent].forEach(function(d){return function(e,f){var g;return"VAR"===e.operator&&e.variable===a?(g=c(),g.sign=e.sign,g.exp=e.exp,0===f?d.base=g:d.exponent=g):e.setVariable(a,b,c)}}(this))};return c}(CTATChemTreeNode);"undefined"!==typeof module&&
null!==module?module.exports=b:this.CTATChemPowerNode=b}).call(this);var CTATChemVariableNode={};
(function(){var b,g=function(b,c){function a(){this.constructor=b}for(var d in c)f.call(c,d)&&(b[d]=c[d]);a.prototype=c.prototype;b.prototype=new a;b.__super__=c.prototype;return b},f={}.hasOwnProperty;b=function(b){function c(a,b,c,e,f,g){this.variableTable=a;this.variable=b;this.parens=null!=c?c:0;this.sign=null!=e?e:1;this.exp=null!=f?f:1;this.symDelim=null!=g?g:"";this.operator="VAR"}g(c,b);c.prototype.clone=function(){return new c(this.variableTable,this.variable,this.parens,this.sign,this.exp,
this.symDelim)};c.prototype.toStringOld=function(a){null==a&&(a=!1);return c.__super__.toStringOld.call(this,this.variable,this.symDelim,a)};c.prototype.toString=function(a,b,e){null==a&&(a="EQUAL");null==b&&(b=!1);null==e&&(e=!1);return c.__super__.toString.call(this,this.variable,a,b,this.symDelim,e)};c.prototype.evaluate=function(){var a;return c.__super__.evaluate.call(this,(null!=(a=this.variableTable)?a.get(this.variable):void 0)||function(){try{return eval(this.variable)}catch(d){return NaN}}.call(this))};
c.prototype.equals=function(a){return c.__super__.equals.call(this,a)&&this.variable===a.variable};c.prototype.compare=function(a,b){b=null!=b?-1:1;return c.__super__.compare.apply(this,arguments)||this.variable>a.variable&&b||this.variable<a.variable&&-b||this.compareSigns(a,b)};c.prototype.countVariables=function(){return 1};c.prototype.getVariables=function(){return[this.variable]};return c}(CTATChemTreeNode);"undefined"!==typeof module&&null!==module?module.exports=b:this.CTATChemVariableNode=
b}).call(this);var CTATChemConstantNode={};
(function(){var b,g=function(b,c){function a(){this.constructor=b}for(var d in c)f.call(c,d)&&(b[d]=c[d]);a.prototype=c.prototype;b.prototype=new a;b.__super__=c.prototype;return b},f={}.hasOwnProperty;b=function(b){function c(a,b,c,e,f,g){this.marked=null!=b?b:!1;this.parens=null!=c?c:0;this.sign=null!=e?e:1;this.exp=null!=f?f:1;this.operator="CONST";this.precision=g||0;0===this.precision&&(this.precision=void 0);this.value=CTATChemParser.chemRoundTo("string"===typeof a?parseFloat(a):a,15)}g(c,b);
c.prototype.clone=function(){return new c(this.value,this.marked,this.parens,this.sign,this.exp,this.precision)};c.prototype.toStringOld=function(){return c.__super__.toStringOld.call(this,this.value.toPrecision?this.value.toPrecision(this.precision):this.value)};c.prototype.toString=function(a,b){null==a&&(a="EQUAL");null==b&&(b=!1);return c.__super__.toString.call(this,this.value.toPrecision?this.value.toPrecision(this.precision):this.value,a,b)};c.prototype.evaluate=function(){return c.__super__.evaluate.call(this,
this.value)};c.prototype.equals=function(a){return c.__super__.equals.call(this,a)&&this.value===a.value};c.prototype.multiplyOne=function(){return this};c.prototype.powerOne=function(){return this};c.prototype.compare=function(a,b){b=null!=b?1:-1;return c.__super__.compare.apply(this,arguments)||Math.sign(Math.abs(this.evaluate())-Math.abs(a.evaluate()))*b||this.compareSigns(a,b)};c.prototype.popNegation=function(){0>this.value&&(this.negate(),this.value=-this.value);return this};c.prototype.constant=
function(a,b){null==b&&(b=!1);return null==a||this.evaluate()===a&&this.marked===b};c.prototype.integer=function(){return Math.floor(this.evaluate())===this.value};c.prototype.even=function(){return 0===this.evaluate()%2};c.prototype.set=function(a,b){this.exp=1;this.value=CTATChemParser.chemRoundTo(Math.abs(a),15);this.sign=Math.sign(a);return this.precision=b||void 0};return c}(CTATChemTreeNode);"undefined"!==typeof module&&null!==module?module.exports=b:this.CTATChemConstantNode=b}).call(this);var CTATChemLogNode={};
(function(){var b,g=function(b,c){function a(){this.constructor=b}for(var d in c)f.call(c,d)&&(b[d]=c[d]);a.prototype=c.prototype;b.prototype=new a;b.__super__=c.prototype;return b},f={}.hasOwnProperty;b=function(b){function c(a,b,c,e){this.val=a;this.operator=b;this.sign=null!=c?c:1;this.exp=null!=e?e:1}g(c,b);c.prototype.clone=function(){return new c(this.val,this.val,this.sign,this.exp)};c.prototype.toStringOld=function(a){var b;null==a&&(a=!1);b="LOG"===this.operator?"log(":"ln(";b+=this.val.toStringOld(a);
return c.__super__.toStringOld.call(this,b+")")};c.prototype.toString=function(a,b,e){var d;null==a&&(a="EQUAL");null==b&&(b=!1);null==e&&(e=!1);d="LOG"===this.operator?"log(":"ln(";d+=this.val.toString(this.operator,!1,e);return c.__super__.toString.call(this,d+")",a,b)};c.prototype.evaluate=function(){return c.__super__.evaluate.call(this,this.applyOperator(this.val.evaluate()))};c.prototype.equals=function(a){return c.__super__.equals.call(this,a)&&this.val.equals(a.val)};c.prototype.simplify=
function(a){this.methods=a;this.val=this.val.simplify(this.methods);return c.__super__.simplify.apply(this,arguments)};c.prototype.flatten=function(){return this};c.prototype.computeConstants=function(){var a;console.log("logNode computeConstants");return this.val.constant()?(a=this.evaluate(),console.log("value is "+a),this.val=new CTATChemConstantNode(a),console.log("const node before set: "),console.log(this.val),this.val.set(a),console.log("const node after set: "),console.log(this.val),this.val):
this};c.prototype.compare=function(a,b){return a.log()&&this.val.compare(a.val,b)||c.__super__.compare.apply(this,arguments)||this.compareSigns(a,b)};c.prototype.countVariables=function(){return this.val.countVariables()};c.prototype.pushNegation=function(){return this};c.prototype.pushInversion=function(){return this};c.prototype.constant=function(a,b){null==b&&(b=!1);return this.val.constant(a,b)};c.prototype.getVariables=function(){return this.val.getVariables()};c.prototype.setVariable=function(a,
b,c){return"VAR"===this.val.operator&&this.val.variable===a?(a=c(),a.sign=this.val.sign,a.exp=this.val.exp,this.val=a):this.val.setVariable(a,b,c)};return c}(CTATChemTreeNode);"undefined"!==typeof module&&null!==module?module.exports=b:this.CTATChemLogNode=b}).call(this);var CTATChemGrammar=function(){function b(){this.yy={}}var g=function(a,b,c,d){c=c||{};for(d=a.length;d--;c[a[d]]=b);return c},f=[1,6],e=[1,7],c=[1,11],a=[1,12],d=[1,14],h=[1,13],l=[1,15],n=[1,16],p=[1,17],q=[1,25],u=[1,26],v=[5,7,8,9,10,11,12,13,15,32],y=[1,27],w=[1,28],A=[1,29],z=[1,32],C=[1,33],D=[5,7,8,9,10,11,12,13,15,16,18,19,22,23,29,30,31,32,33,34,35,36],F=[1,37],G=[5,7,8,9,10,11,12,13,15,16,18,19,22,23,26,29,30,31,32,33,34,35,36],x=[1,40],H=[1,41],K=[5,7,8,9,10,11,12,13,15,16,18,19,22,23,
26,28,29,30,31,32,33,34,35,36],g={trace:function(){},yy:{},symbols_:{error:2,expression:3,relational:4,EOF:5,arithmetic:6,LESS:7,GREATER:8,LESSEQUAL:9,GREATEREQUAL:10,EQUAL:11,NOTEQUAL:12,PLUS:13,term:14,MINUS:15,TIMES:16,signedunitfactor:17,DIVIDE:18,ROOT:19,unitfactor:20,factor:21,IDIVIDE:22,REM:23,signedfactor:24,unit:25,UNIT:26,atom:27,EXP:28,SQRT:29,LOG:30,LPAREN:31,RPAREN:32,LN:33,VARIABLE:34,NUMBER:35,SUBSTANCE:36,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",7:"LESS",8:"GREATER",9:"LESSEQUAL",
10:"GREATEREQUAL",11:"EQUAL",12:"NOTEQUAL",13:"PLUS",15:"MINUS",16:"TIMES",18:"DIVIDE",19:"ROOT",22:"IDIVIDE",23:"REM",26:"UNIT",28:"EXP",29:"SQRT",30:"LOG",31:"LPAREN",32:"RPAREN",33:"LN",34:"VARIABLE",35:"NUMBER",36:"SUBSTANCE"},productions_:[0,[3,2],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,1],[6,3],[6,3],[6,1],[14,3],[14,3],[14,3],[14,2],[14,2],[14,3],[14,3],[14,1],[17,2],[17,2],[17,1],[17,1],[24,2],[24,2],[24,1],[20,2],[25,1],[21,3],[21,2],[21,1],[27,4],[27,4],[27,3],[27,1],[27,1],[27,1]],performAction:function(a,
b,c,d,e,f,g){b=f.length-1;switch(e){case 1:return f[b-1];case 2:this.$=new d.CTATChemRelationNode("LESS",f[b-2],f[b]);break;case 3:this.$=new d.CTATChemRelationNode("GREATER",f[b-2],f[b]);break;case 4:this.$=new d.CTATChemRelationNode("LESSEQUAL",f[b-2],f[b]);break;case 5:this.$=new d.CTATChemRelationNode("GREATEREQUAL",f[b-2],f[b]);break;case 6:this.$=new d.CTATChemRelationNode("EQUAL",f[b-2],f[b]);break;case 7:this.$=new d.CTATChemRelationNode("NOTEQUAL",f[b-2],f[b]);break;case 8:case 11:case 19:case 22:case 23:case 26:case 31:this.$=
f[b];break;case 9:this.$=new d.CTATChemAdditionNode("PLUS",[f[b-2],f[b]]);break;case 10:this.$=new d.CTATChemAdditionNode("MINUS",[f[b-2],f[b]]);break;case 12:this.$=new d.CTATChemMultiplicationNode("TIMES",[f[b-2],f[b]]);break;case 13:this.$=new d.CTATChemMultiplicationNode("DIVIDE",[f[b-2],f[b]]);break;case 14:this.$=new d.CTATChemPowerNode("ROOT",f[b-2],f[b]);break;case 15:case 16:this.$=new d.CTATChemMultiplicationNode("ITIMES",[f[b-1],f[b]]);break;case 17:this.$=new d.CTATChemIntDivisionNode("IDIVIDE",
f[b-2],f[b]);break;case 18:this.$=new d.CTATChemIntDivisionNode("REM",f[b-2],f[b]);break;case 20:case 24:this.$=new d.CTATChemUnaryNode("UPLUS",f[b]);break;case 21:case 25:this.$=new d.CTATChemUnaryNode("UMINUS",f[b]);break;case 27:this.$=f[b-1].setUnit(f[b]);break;case 28:this.$=new d.CTATChemVariableNode(d.variableTable,a.replace(/\#/g,""),0,1,1,"#");break;case 29:this.$=new d.CTATChemPowerNode("EXP",f[b-2],f[b]);break;case 30:this.$=new d.CTATChemPowerNode("ROOT",f[b],new d.CTATChemConstantNode(2));
break;case 32:this.$=new d.CTATChemLogNode(f[b-1],"LOG");break;case 33:this.$=new d.CTATChemLogNode(f[b-1],"LN");break;case 34:this.$=f[b-1].addParens();break;case 35:this.$=new d.CTATChemVariableNode(d.variableTable,a.replace(/\&/g,""),0,1,1,"&");break;case 36:this.$=new d.CTATChemConstantNode(a);break;case 37:this.$=new d.CTATChemVariableNode(d.variableTable,a.replace(/\$/g,""),0,1,1,"$")}},table:[{3:1,4:2,6:3,13:f,14:4,15:e,17:5,20:8,21:9,27:10,29:c,30:a,31:d,33:h,34:l,35:n,36:p},{1:[3]},{5:[1,
18]},{5:[2,8],7:[1,19],8:[1,20],9:[1,21],10:[1,22],11:[1,23],12:[1,24],13:q,15:u},g(v,[2,11],{27:10,20:30,21:31,16:y,18:w,19:A,22:z,23:C,29:c,30:a,31:d,33:h,34:l,35:n,36:p}),g(D,[2,19]),{13:f,15:e,17:34,20:8,21:9,27:10,29:c,30:a,31:d,33:h,34:l,35:n,36:p},{13:f,15:e,17:35,20:8,21:9,27:10,29:c,30:a,31:d,33:h,34:l,35:n,36:p},g(D,[2,22]),g(D,[2,23],{25:36,26:F}),g(G,[2,31],{28:[1,38]}),{13:x,15:H,21:42,24:39,27:10,29:c,30:a,31:d,33:h,34:l,35:n,36:p},{31:[1,43]},{31:[1,44]},{6:45,13:f,14:4,15:e,17:5,20:8,
21:9,27:10,29:c,30:a,31:d,33:h,34:l,35:n,36:p},g(K,[2,35]),g(K,[2,36]),g(K,[2,37]),{1:[2,1]},{6:46,13:f,14:4,15:e,17:5,20:8,21:9,27:10,29:c,30:a,31:d,33:h,34:l,35:n,36:p},{6:47,13:f,14:4,15:e,17:5,20:8,21:9,27:10,29:c,30:a,31:d,33:h,34:l,35:n,36:p},{6:48,13:f,14:4,15:e,17:5,20:8,21:9,27:10,29:c,30:a,31:d,33:h,34:l,35:n,36:p},{6:49,13:f,14:4,15:e,17:5,20:8,21:9,27:10,29:c,30:a,31:d,33:h,34:l,35:n,36:p},{6:50,13:f,14:4,15:e,17:5,20:8,21:9,27:10,29:c,30:a,31:d,33:h,34:l,35:n,36:p},{6:51,13:f,14:4,15:e,
17:5,20:8,21:9,27:10,29:c,30:a,31:d,33:h,34:l,35:n,36:p},{13:f,14:52,15:e,17:5,20:8,21:9,27:10,29:c,30:a,31:d,33:h,34:l,35:n,36:p},{13:f,14:53,15:e,17:5,20:8,21:9,27:10,29:c,30:a,31:d,33:h,34:l,35:n,36:p},{13:f,15:e,17:54,20:8,21:9,27:10,29:c,30:a,31:d,33:h,34:l,35:n,36:p},{13:f,15:e,17:55,20:8,21:9,27:10,29:c,30:a,31:d,33:h,34:l,35:n,36:p},{13:f,15:e,17:56,20:8,21:9,27:10,29:c,30:a,31:d,33:h,34:l,35:n,36:p},g(D,[2,15]),g(D,[2,16],{25:36,26:F}),{13:f,15:e,17:57,20:8,21:9,27:10,29:c,30:a,31:d,33:h,
34:l,35:n,36:p},{13:f,15:e,17:58,20:8,21:9,27:10,29:c,30:a,31:d,33:h,34:l,35:n,36:p},g(D,[2,20]),g(D,[2,21]),g(D,[2,27]),g(D,[2,28]),{13:x,15:H,21:42,24:59,27:10,29:c,30:a,31:d,33:h,34:l,35:n,36:p},g(G,[2,30]),{13:x,15:H,21:42,24:60,27:10,29:c,30:a,31:d,33:h,34:l,35:n,36:p},{13:x,15:H,21:42,24:61,27:10,29:c,30:a,31:d,33:h,34:l,35:n,36:p},g(G,[2,26]),{6:62,13:f,14:4,15:e,17:5,20:8,21:9,27:10,29:c,30:a,31:d,33:h,34:l,35:n,36:p},{6:63,13:f,14:4,15:e,17:5,20:8,21:9,27:10,29:c,30:a,31:d,33:h,34:l,35:n,
36:p},{13:q,15:u,32:[1,64]},{5:[2,2],13:q,15:u},{5:[2,3],13:q,15:u},{5:[2,4],13:q,15:u},{5:[2,5],13:q,15:u},{5:[2,6],13:q,15:u},{5:[2,7],13:q,15:u},g(v,[2,9],{27:10,20:30,21:31,16:y,18:w,19:A,22:z,23:C,29:c,30:a,31:d,33:h,34:l,35:n,36:p}),g(v,[2,10],{27:10,20:30,21:31,16:y,18:w,19:A,22:z,23:C,29:c,30:a,31:d,33:h,34:l,35:n,36:p}),g(D,[2,12]),g(D,[2,13]),g(D,[2,14]),g(D,[2,17]),g(D,[2,18]),g(G,[2,29]),g(G,[2,24]),g(G,[2,25]),{13:q,15:u,32:[1,65]},{13:q,15:u,32:[1,66]},g(K,[2,34]),g(K,[2,32]),g(K,[2,
33])],defaultActions:{18:[2,1]},parseError:function(a,b){if(b.recoverable)this.trace(a);else throw a=Error(a),a.hash=b,a;},parse:function(a){var b=[0],c=[null],d=[],e=this.table,f="",g=0,h=0,n=0,l=d.slice.call(arguments,1),p=Object.create(this.lexer),q={},w;for(w in this.yy)Object.prototype.hasOwnProperty.call(this.yy,w)&&(q[w]=this.yy[w]);p.setInput(a,q);q.lexer=p;q.parser=this;"undefined"==typeof p.yylloc&&(p.yylloc={});w=p.yylloc;d.push(w);var u=p.options&&p.options.ranges;this.parseError="function"===
typeof q.parseError?q.parseError:Object.getPrototypeOf(this).parseError;for(var v,y,A,z,C={},H,x;;){A=b[b.length-1];if(this.defaultActions[A])z=this.defaultActions[A];else{if(null===v||"undefined"==typeof v)v=p.lex()||1,"number"!==typeof v&&(v=this.symbols_[v]||v);z=e[A]&&e[A][v]}if("undefined"===typeof z||!z.length||!z[0]){var D;x=[];for(H in e[A])this.terminals_[H]&&2<H&&x.push("'"+this.terminals_[H]+"'");D=p.showPosition?"Parse error on line "+(g+1)+":\n"+p.showPosition()+"\nExpecting "+x.join(", ")+
", got '"+(this.terminals_[v]||v)+"'":"Parse error on line "+(g+1)+": Unexpected "+(1==v?"end of input":"'"+(this.terminals_[v]||v)+"'");this.parseError(D,{text:p.match,token:this.terminals_[v]||v,line:p.yylineno,loc:w,expected:x})}if(z[0]instanceof Array&&1<z.length)throw Error("Parse Error: multiple actions possible at state: "+A+", token: "+v);switch(z[0]){case 1:b.push(v);c.push(p.yytext);d.push(p.yylloc);b.push(z[1]);v=null;y?(v=y,y=null):(h=p.yyleng,f=p.yytext,g=p.yylineno,w=p.yylloc,0<n&&n--);
break;case 2:x=this.productions_[z[1]][1];C.$=c[c.length-x];C._$={first_line:d[d.length-(x||1)].first_line,last_line:d[d.length-1].last_line,first_column:d[d.length-(x||1)].first_column,last_column:d[d.length-1].last_column};u&&(C._$.range=[d[d.length-(x||1)].range[0],d[d.length-1].range[1]]);A=this.performAction.apply(C,[f,h,g,q,z[1],c,d].concat(l));if("undefined"!==typeof A)return A;x&&(b=b.slice(0,-2*x),c=c.slice(0,-1*x),d=d.slice(0,-1*x));b.push(this.productions_[z[1]][0]);c.push(C.$);d.push(C._$);
z=e[b[b.length-2]][b[b.length-1]];b.push(z);break;case 3:return!0}}}},f=function(){return{EOF:1,parseError:function(a,b){if(this.yy.parser)this.yy.parser.parseError(a,b);else throw Error(a);},setInput:function(a,b){this.yy=b||this.yy||{};this._input=a;this._more=this._backtrack=this.done=!1;this.yylineno=this.yyleng=0;this.yytext=this.matched=this.match="";this.conditionStack=["INITIAL"];this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0};this.options.ranges&&(this.yylloc.range=[0,
0]);this.offset=0;return this},input:function(){var a=this._input[0];this.yytext+=a;this.yyleng++;this.offset++;this.match+=a;this.matched+=a;a.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++;this.options.ranges&&this.yylloc.range[1]++;this._input=this._input.slice(1);return a},unput:function(a){var b=a.length,c=a.split(/(?:\r\n?|\n)/g);this._input=a+this._input;this.yytext=this.yytext.substr(0,this.yytext.length-b);this.offset-=b;a=this.match.split(/(?:\r\n?|\n)/g);
this.match=this.match.substr(0,this.match.length-1);this.matched=this.matched.substr(0,this.matched.length-1);c.length-1&&(this.yylineno-=c.length-1);var d=this.yylloc.range;this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:c?(c.length===a.length?this.yylloc.first_column:0)+a[a.length-c.length].length-c[0].length:this.yylloc.first_column-b};this.options.ranges&&(this.yylloc.range=[d[0],d[0]+this.yyleng-b]);this.yyleng=this.yytext.length;
return this},more:function(){this._more=!0;return this},reject:function(){if(this.options.backtrack_lexer)this._backtrack=!0;else return this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno});return this},less:function(a){this.unput(this.match.slice(a))},pastInput:function(){var a=this.matched.substr(0,this.matched.length-
this.match.length);return(20<a.length?"...":"")+a.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var a=this.match;20>a.length&&(a+=this._input.substr(0,20-a.length));return(a.substr(0,20)+(20<a.length?"...":"")).replace(/\n/g,"")},showPosition:function(){var a=this.pastInput(),b=Array(a.length+1).join("-");return a+this.upcomingInput()+"\n"+b+"^"},test_match:function(a,b){var c,d;this.options.backtrack_lexer&&(d={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,
first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(d.yylloc.range=this.yylloc.range.slice(0)));if(c=a[0].match(/(?:\r\n?|\n).*/g))this.yylineno+=c.length;this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,
last_column:c?c[c.length-1].length-c[c.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+a[0].length};this.yytext+=a[0];this.match+=a[0];this.matches=a;this.yyleng=this.yytext.length;this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]);this._backtrack=this._more=!1;this._input=this._input.slice(a[0].length);this.matched+=a[0];a=this.performAction.call(this,this.yy,this,b,this.conditionStack[this.conditionStack.length-1]);this.done&&this._input&&(this.done=!1);
if(a)return a;if(this._backtrack)for(var e in d)this[e]=d[e];return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var a,b,c;this._more||(this.match=this.yytext="");for(var d=this._currentRules(),e=0;e<d.length;e++)if((b=this._input.match(this.rules[d[e]]))&&(!a||b[0].length>a[0].length))if(a=b,c=e,this.options.backtrack_lexer){a=this.test_match(b,d[e]);if(!1!==a)return a;if(this._backtrack)a=!1;else return!1}else if(!this.options.flex)break;return a?(a=this.test_match(a,
d[c]),!1!==a?a:!1):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var a=this.next();return a?a:this.lex()},begin:function(a){this.conditionStack.push(a)},popState:function(){return 0<this.conditionStack.length-1?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-
1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(a){a=this.conditionStack.length-1-Math.abs(a||0);return 0<=a?this.conditionStack[a]:"INITIAL"},pushState:function(a){this.begin(a)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(a,b,c,d){switch(c){case 1:return 31;case 2:return 32;case 3:return 28;case 4:return 28;case 5:return 19;case 6:return 29;case 7:return 29;case 8:return 30;
case 9:return 33;case 10:return 16;case 11:return 16;case 12:return 22;case 13:return 18;case 14:return 18;case 15:return 23;case 16:return 15;case 17:return 13;case 18:return 9;case 19:return 9;case 20:return 10;case 21:return 10;case 22:return 7;case 23:return 8;case 24:return 12;case 25:return 12;case 26:return 12;case 27:return 12;case 28:return 11;case 29:return 11;case 30:return 35;case 31:return 35;case 32:return 26;case 33:return 36;case 34:return 34;case 35:return 34;case 36:return 34;case 37:return 5}},
rules:[/^(?:\s+)/,/^(?:\()/,/^(?:\))/,/^(?:\*\*)/,/^(?:\^)/,/^(?:\|)/,/^(?:\u221a)/,/^(?:sqrt\b)/,/^(?:log\b)/,/^(?:ln\b)/,/^(?:\*)/,/^(?:\u00d7)/,/^(?:\/\/)/,/^(?:\/)/,/^(?:\u00f7)/,/^(?:%)/,/^(?:-)/,/^(?:\+)/,/^(?:<=)/,/^(?:\u2264)/,/^(?:>=)/,/^(?:\u2265)/,/^(?:<)/,/^(?:>)/,/^(?:!=)/,/^(?:\/=)/,/^(?:<>)/,/^(?:\u2260)/,/^(?:==)/,/^(?:=)/,/^(?:(([0-9])+\.?([0-9])*|\.([0-9])+)([Ee][+-]?([0-9])+)?)/,/^(?:(0[Bb]([0-1])+|0[Oo]([0-7])+|0[Xx]([0-9A-Fa-f])+))/,/^(?:#[^\#\s]+#)/,/^(?:\$[^\$\s]+\$)/,/^(?:&[^\&\s]+&)/,
/^(?:deltaT\b)/,/^(?:([A-Za-z]))/,/^(?:$)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37],inclusive:!0}}}}();g.lexer=f;b.prototype=g;g.Parser=b;return new b}();var CTATChemParser={};
(function(){var b;b=function(){function b(b){this.parser=new CTATChemGrammar.Parser;this.parser.yy={CTATChemRelationNode:CTATChemRelationNode,CTATChemAdditionNode:CTATChemAdditionNode,CTATChemMultiplicationNode:CTATChemMultiplicationNode,CTATChemIntDivisionNode:CTATChemIntDivisionNode,CTATChemUnaryNode:CTATChemUnaryNode,CTATChemLogNode:CTATChemLogNode,CTATChemPowerNode:CTATChemPowerNode,CTATChemVariableNode:CTATChemVariableNode,CTATChemConstantNode:CTATChemConstantNode,CTATChemTreeNode:CTATChemTreeNode};this.parser.yy.variableTable=
b}b.none=["simpleFlatten"];b.partial=["flatten","removeIdentity"];b.full="flatten computeConstants combineSimilar expand distribute removeIdentity".split(" ");b.compConstants=["flatten","computeConstants"];b.CHEM_DECIMAL_PRECISION=-1;b.prototype.toTree=function(b,e,c,a){null==e&&(e=!1);null==c&&(c=!1);null==a&&(a=!1);return(b instanceof CTATChemTreeNode?c?b.clone():b:this.parser.parse(String(b))).simplify([a?"flatten":"simpleFlatten"].concat(e?"sort":[]))};b.prototype.chemParse=function(f,e){var c;
null==e&&(e=!1);try{return c="string"===typeof f?this.parser.parse(f):f,c.simplify(b.none.concat(e?"sort":[]))}catch(a){return console.log("error parsing "+f+" : "),console.log(a),null}};b.prototype.chemStringify=function(b,e){null==e&&(e=!1);return null!=b?b.toString("EQUAL",!1,e):b};b.prototype.chemEvaluate=function(f){var e;try{return e=this.toTree(f,!1,!0),e.simplify(b.none).evaluate()}catch(c){return console.log(c),null}};b.prototype.chemPartialSimplify=function(f,e,c){var a;null==e&&(e=!1);
null==c&&(c=!1);try{return a=this.toTree(f,!1,!0),a.simplify(b.partial.concat(e?"sort":[])).toString("EQUAL",!1,c)}catch(d){return null}};b.prototype.chemSimplify=function(f,e,c){var a;null==e&&(e=!1);null==c&&(c=!1);try{return a=this.toTree(f,!1,!0),a.simplify(b.full.concat(e?"sort":[])).toString("EQUAL",!1,c)}catch(d){return console.log(d),null}};b.prototype.chemComputeConstants=function(f,e){var c;null==e&&(e=!1);try{return c=this.toTree(f,!1,!0),c.simplify(b.compConstants).toString("EQUAL",!1,
e)}catch(a){return console.log(a),null}};b.prototype.chemValid=function(b,e){var c,a;null==e&&(e=!1);return null!=(c=this.chemParse(b,!0))&&null!=(a=this.chemParse(b,!e))?c.toString()===a.toString():null};b.prototype.chemValued=function(b){var e;return null!=(e=this.chemEvaluate(b))?!isNaN(e):null};b.prototype.chemPartialSimplified=function(b,e){var c,a;null==e&&(e=!1);return null!=(c=this.chemPartialSimplify(b,!0))&&null!=(a=this.chemParse(b,!e))?c===a.toString():null};b.prototype.chemSimplified=
function(b,e){var c,a;null==e&&(e=!1);return null!=(c=this.chemSimplify(b,!0))&&null!=(a=this.chemParse(b,!e))?c===a.toString():null};b.prototype.chemConstantsComputed=function(b){var e,c;return null!=(e=this.chemComputeConstants(b))&&null!=(c=this.chemParse(b))?e===c.toString():null};b.prototype.chemIdentical=function(b,e,c){var a,d;null==c&&(c=!1);return null!=(a=this.chemParse(b,!c))&&null!=(d=this.chemParse(e,!c))?a.toString()===d.toString():null};b.prototype.chemEqual=function(b,e){var c,a;return null!=
(c=this.chemEvaluate(b))&&null!=(a=this.chemEvaluate(e))?c===a:null};b.prototype.chemPartialEquivalent=function(b,e,c){var a,d;null==c&&(c=!1);return null!=(a=this.chemPartialSimplify(b,!c))&&null!=(d=this.chemPartialSimplify(e,!c))?a===d:null};b.prototype.chemEquivalent=function(b,e,c,a){var d,f;null==c&&(c=!1);null==a&&(a=!1);b=this.chemSimplify(b,!c,!0);e=this.chemSimplify(e,!c,!0);!a||isNaN(d=this.chemGetPrecision(b))||isNaN(f=this.chemGetPrecision(e))||(console.log("here, precisions are ",d,
f),d<f?e=this.chemSetPrecision(e,d).toString("EQUAL",!1,!0):b=this.chemSetPrecision(b,f).toString("EQUAL",!1,!0),console.log("new strings: ",b,e));return b&&e?b===e:null};b.prototype.isChemValid=b.prototype.chemValid;b.prototype.chemEval=b.prototype.chemEvaluate;b.prototype.chemStrictEquivTermsSameOrder=function(b,e){return this.chemPartialEquivalent(b,e,!0)};b.prototype.chemEquivTermsSameOrder=b.prototype.chemStrictEquivTermsSameOrder;b.prototype.chemStrictEquivTerms=b.prototype.chemPartialEquivalent;
b.prototype.chemEquivTerms=b.prototype.chemStrictEquivTerms;b.prototype.chemEquiv=b.prototype.chemEquivalent;b.prototype.isSimplified=function(b){return this.chemSimplified(b,!0)};b.prototype.calc=b.prototype.chemEvaluate;b.prototype.calca=function(b){return(+this.chemEvaluate(b)).toFixed(2)};b.prototype.simplify=function(b){return this.chemSimplify(b,!0)};b.prototype.algebraicEqual=b.prototype.chemEqual;b.prototype.patternMatches=function(b,e){return this.chemIdentical(b,e,!0)};b.prototype.polyTermsEqual=
function(f,e){return this.parser.parse(f).simplify(b.partial).equals(this.parser.parse(e).simplify(b.partial))};b.prototype.algebraicMatches=function(b,e){return this.chemEquivalent(b,e,!0)};b.prototype.expressionMatches=b.prototype.algebraicMatches;b.prototype.chemGetQuadraticCoefficients=function(b,e){var c,a,d,f,g,n,p,q,u,v;b=e?this.chemSimplify(b,!1,!0):b;c=this.chemParse(b);b=null;e=[];v=null;"EQUAL"===c.operator&&("PLUS"===c.left.operator&&"CONST"===c.right.operator&&0===c.right.value?b=c.left:
"PLUS"===c.right.operator&&"CONST"===c.left.operator&&0===c.left.value&&(b=c.right));if(b&&1<b.terms.length&&4>b.terms.length){c=function(a){var b,c,d,e;c=e=b=null;d=1;"TIMES"===a.operator&&2===a.factors.length?(a.factors.forEach(function(b){return function(b,d){if("EXP"===b.operator)return e=b,c=a.factors[0===d?1:0]}}(this)),d=a.sign):"EXP"===a.operator&&(e=a);!e||"VAR"!==e.base.operator||2!==e.exponent.value||v&&e.base.variable!==v||((v||(v=e.base.variable),!c||"CONST"!==c.operator&&"UMINUS"!==
c.operator)?c||(b=a.sign):b=c.evaluate()*d);return b};a=function(a){var b,c,d;c=d=b=null;"TIMES"===a.operator&&2===a.factors.length?a.factors.forEach(function(b){return function(b,e){if("VAR"===b.operator&&(!v||b.variable===v))return v||(v=b.variable),d=b,c=a.factors[0===e?1:0]}}(this)):"VAR"!==a.operator||v&&a.variable!==v||(v||(v=a.variable),d=a);d&&(c&&"CONST"===c.operator?b=c.evaluate()*a.sign:c||(b=a.sign));return b};d=function(a){var b;b=null;"CONST"===a.operator&&(b=a.evaluate());return b};
c={a:c,b:a,c:d};g=["a","b","c"];for(d=f=0;3>f;d=++f)if(b.terms[d]){u=q=null;a=n=0;for(p=g.length;0<=p?n<p:n>p;a=0<=p?++n:--n)if(c[g[a]]&&(q=c[g[a]](b.terms[d]))){u=a;break}if(null===q)return null;e[u]=q;delete c[g[u]]}if(!e[0]||!e[1])return null;e[2]||(e[2]=0);return e}return null};b.prototype.chemSolveQuadratic=function(b,e,c){var a;a=Math.pow(e,2)-4*b*c;c=[];0===a?c.push(""+-e/(2*b)):0<a?(a=Math.sqrt(a),c.push(""+(-e+a)/(2*b)),c.push(""+(-e-a)/(2*b))):(a=Math.sqrt(Math.abs(a)),b*=2,a/=b,e=-e/b,
c.push(e+"+"+a+"i"),c.push(e+"-"+a+"i"));return c};b.prototype.chemGetVariables=function(b){var e,c;b=this.chemParse(b).getVariables();c=[];e={};b.forEach(function(a){return function(a){if(!e[a])return c.push(a),e[a]=!0}}(this));return c};b.prototype.chemSetVariable=function(b,e,c){b=this.chemParse(b);if("VAR"===b.operator)return b.variable===e?this.chemParse(c):b;b.setVariable(e,c,this.chemParse.bind(this,c));return b};b.prototype.chemSetPrecision=function(b,e){b="string"===typeof b?this.chemParse(b):
b;switch(b.operator){case "TIMES":b.factors.forEach(function(b){return function(a){return b.chemSetPrecision(a,e)}}(this));break;case "PLUS":b.terms.forEach(function(b){return function(a){return b.chemSetPrecision(a,e)}}(this));break;case "EXP":this.chemSetPrecision(b.base,e);this.chemSetPrecision(b.exponent,e);break;case "EQUAL":this.chemSetPrecision(b.left,e);this.chemSetPrecision(b.right,e);break;case "UMINUS":this.chemSetPrecision(b.base,e);break;case "CONST":b.precision=e}return b};b.prototype.chemGetPrecision=
function(b){var e,c,a;c=function(a){var b,c;b=Math.log(10);a=String(a);(c=/^(\d(\.\d+)?)e(\+|-)\d/.exec(a))&&(a=c[1]);c=(c=/\.[0-9]*?(0+)$/.exec(a))?c[1].length:0;a=Math.abs(a.replace(".",""));if(0===a)return 0;for(;0!==a&&0===a%10;)a/=10;return c+Math.floor(Math.log(a)/b)+1};if(!isNaN(b))return c(b);b="string"===typeof b?this.chemParse(b):b;a=NaN;e=function(a){return function(b){var c;c=Number.POSITIVE_INFINITY;b.forEach(function(b){b=a.chemGetPrecision(b);return c=!isNaN(b)&&b<c?b:c});return c}}(this);
switch(b.operator){case "TIMES":a=e(b.factors);break;case "PLUS":a=e(b.terms);break;case "EXP":a=e([b.base,b.exponent]);break;case "EQUAL":a=e([b.left,b.right]);break;case "UMINUS":a=this.chemGetPrecision(b.base);break;case "CONST":a=b.precision?b.precision:c(b.value)}return a};b.prototype.chemToPrecision=function(b,e,c,a){var d;b="string"===typeof b?this.chemParse(b):b;a=a||{};switch(b.operator){case "TIMES":b.factors.forEach(function(b){return function(d){return b.chemToPrecision(d,e,c,a)}}(this));
break;case "PLUS":b.terms.forEach(function(b){return function(d){return b.chemToPrecision(d,e,c,a)}}(this));break;case "EXP":this.chemToPrecision(b.base,e,c,a);this.chemToPrecision(b.exponent,e,c,a);break;case "EQUAL":this.chemToPrecision(b.left,e,c,a);this.chemToPrecision(b.right,e,c,a);break;case "UMINUS":this.chemToPrecision(b.base,e,c,a);break;case "CONST":d=b.value.toPrecision(e),a[d]=b.value,b.value=d}return{result:b.toString("EQUAL",!1,c),roundedVals:a}};b.chemRoundTo=function(b,e){b=String(Math.round(b*
("10e"+(e-1))));b.includes("e")?(b=b.split("e"),b=Number(b[0]+"e"+String(Number(b[1])-e))):b=Number(b+"e-"+e);return b};return b}();"undefined"!==typeof module&&null!==module?module.exports=b:this.CTATChemParser=b}).call(this);var CTATFormulaFunctions={};
(function(){var b,g,f,e,c,a,d,h,l,n,p,q,u,v=[].slice;a=/^([-+])?(?:(\d+)(?:$|\s))?(?:(\d+)\/(\d+))?$/;c=/^\d+(\.\d\d)?$/;d=/((\d+)\.?(\d+)?|\.(\d+))([Ee]([+-]?\d+))?/g;q=/^[+-]?((\d+)\.?(\d+)?|\.(\d+))([Ee]([+-]?\d+))?$/;e=/^s*([+-]?((\d+)\.?(\d+)?|\.(\d+))([Ee]([+-]?\d+))?)s*\/s*([+-]?((\d+)\.?(\d+)?|\.(\d+))([Ee]([+-]?\d+))?)s*$/;p=/^[+-]?((\d+)\.?(\d+)?|\.(\d+))([Ee]([+-]?\d+))?/;n=/^\s*\{\s*"x":\s*([+-]?((\d+)\.?(\d+)?|\.(\d+))([Ee]([+-]?\d+))?)\s*\,\s*"y":\s*([+-]?((\d+)\.?(\d+)?|\.(\d+))([Ee]([+-]?\d+))?)\s*\}\s*$/;l=
/([bcdfghjklmnpqrstvwxz]|qu)y$/;h=/([bcdfghjklmnpqrstvwxz]o|[sc]h|s)$/;u=function(a,b){var c;null==b&&(b=!1);var d,e,f;a=null!=(c=a[4])?c:a[2]+(a[3]||"");f=[];d=0;for(e=a.length;d<e;d++)c=a[d],(b||(b="0"!==c))&&f.push(c);return f.length};f=function(a){return(a[4]||a[3]||"").length-+(a[6]||0)};g=function(a,b,c){var d,e;return isNaN(d=+a)||isNaN(e=+b)?c(String(a).toLowerCase(),String(b).toLowerCase()):c(d,e)};b=function(){function b(){}b.printf=("undefined"!==typeof window&&null!==window?window:global).sprintf;
b.sum=function(){return(1<=arguments.length?v.call(arguments,0):[]).reduce(function(a,b){return a+ +b},0)};b.mod=function(a,b){return Math.round(a)%Math.round(b)};b.modf=function(a,b){return a%b};b.IEEEremainder=b.modf;b.isFactor=function(a,b){return 1!==+a&&0===b%a};b.isMultiple=function(a,b){return 0===a%b};b.isUnit=function(a){return 1===+a};b.isAny=function(a,b){return this.isFactor(a,b)||this.isMultiple(a,b)||this.isUnit(a)};b.gcf=function(a,b){b=[Math.abs(a),Math.abs(b)];a=b[0];for(b=b[1];0<
b;)b=[b,a%b],a=b[0],b=b[1];return a};b.lcm=function(a,b){return Math.abs(a*b)/this.gcf(a,b)};b.inRange=function(a,b,c){null==b&&(b=-Infinity);null==c&&(c=Infinity);return b<=a&&a<=c};b.integerInRange=function(a,b,c){var d;null==b&&(b=-Infinity);null==c&&(c=Infinity);return Math.round(b)<=(d=Math.round(a))&&d<=Math.round(c)};b.fmtDecimal=function(a,b){null==b&&(b=2);return(+a).toFixed(Math.round(+b))};b.fmtNormal=function(a,b){null==b&&(b=6);return this.fmtDecimal(a,b).replace(/\.0+$|(\..+?)0+$/,"$1")};
b.fmtDollar=function(a,b){null==b&&(b="");a=this.fmtDecimal(a);b=b.toLowerCase();0<=b.indexOf("i")&&(a=a.replace(/\.00$/,""));return 0<=b.indexOf("d")?"$"+a:a};b.dollarEquals=function(){var a,b;a=arguments[0];b=2<=arguments.length?v.call(arguments,1):[];a=this.fmtDollar(a,"i");return b.some(function(b){return function(c){return a===b.fmtDollar(c,"i")}}(this))};b.matchWithPrecision=function(a,b){var c,d;return(c=String(a).match(q))&&(d=String(b).match(q))&&u(c)===u(d)&&g(a,b,function(a,b){return a===
b})};b.matchWithoutPrecision=function(a,b){var c,d;return(c=String(a).match(q))&&(d=String(b).match(q))&&(a=u(c)>u(d)?(+a).toFixed(f(d)):String(a))&&g(a,b,function(a,b){return a===b})};b.constantsConform=function(){var a,b;a=arguments[0];b=2<=arguments.length?v.call(arguments,1):[];b=b.map(function(a){return"string"===typeof a?new RegExp(a,"i"):a});return(a.match(d)||[]).every(function(a){return b.some(function(b){return b.test(a)})})};b.constantsDollar=function(a){return this.constantsConform(a,
c)};b.isInteger=function(a,b){null==b&&(b=!0);return Number.isInteger(b&&+a||a)};b.isNumber=function(a,b){null==b&&(b=!0);return Number.isFinite(b&&+a||a)};b.isVar=function(a){return/^\s*[a-zA-Z]\s*$/.test(a)};b.makeFraction=function(a,b,c,d){""!==a&&"+"!==a&&"-"!==a&&(d=["",a,b,c],a=d[0],b=d[1],c=d[2],d=d[3]);null!=c&&null==d&&(d=[0,b,c],b=d[0],c=d[1],d=d[2]);b=+b||0;c=+c||0;d=+d||1;return this.isInteger(b)&&this.isInteger(c)&&this.isInteger(d)?a+(b?b+(c?" ":""):"")+(c?c+(1===d?"":"/"+d):""):null};
b.fractionMake=b.makeFraction;b.getSign=function(b){return null!=(b=String(b).match(a))?b[1]||"":null};b.getWhole=function(b){return null!=(b=String(b).match(a))?(b[1]||"")+(b[2]||"0"):null};b.getNumerator=function(b){return null!=(b=String(b).match(a))?(b[1]||"")+(b[3]||"0"):null};b.getDenominator=function(b){return null!=(b=String(b).match(a))?b[4]||"1":null};b.convertToMixed=function(b){return null!=(b=String(b).match(a))?this.makeFraction(b[1]||"",(+b[2]||0)+Math.floor((+b[3]||0)/(+b[4]||1)),
(+b[3]||0)%(+b[4]||1),b[4]):null};b.convertToImproper=function(b){return null!=(b=String(b).match(a))?this.makeFraction(b[1]||"",0,(+b[2]||0)*(+b[4]||1)+(+b[3]||0),b[4]||1):null};b.evaluateFraction=function(b){return null!=(b=String(b).match(a))?((b[1]||"+")+"1")*((+b[2]||0)*(+b[4]||1)+(+b[3]||0))/(+b[4]||1):null};b.simplifyFraction=function(b){var c;return null!=(b=String(b).match(a))?(null!=b[2]&&null!=b[3]&&(b[2]=+b[2]+Math.floor(+b[3]/+b[4]),b[3]=+b[3]%+b[4]),c=null!=b[3]?this.gcf(+b[3],+b[4]):
1,this.makeFraction(b[1]||"",b[2],b[3]/c,b[4]/c)):null};b.fractionsimplify=b.simplifyFraction;b.simplifyMixed=b.simplifyFraction;b.simplifiedFraction=function(a){var b;return null!=(b=this.simplifyFraction(a))?b===a:null};b.isSimplifiedMixed=b.simplifiedFraction;b.fractionEquals=function(a,b){var c,d;return null!=(c=this.evaluateFraction(a))&&null!=(d=this.evaluateFraction(b))?c===d:null};b.simplifiedFractionEquals=function(a,b){var c,d;return null!=(c=this.simplifiedFraction(a))&&null!=(d=this.simplifiedFraction(b))?
c&&d&&this.fractionEquals(a,b):null};b.rationalEquals=function(a,b){return this.matchWithoutPrecision(+b||this.evaluateFraction(b),+a||this.evaluateFraction(a))};b.getDividend=function(a){var b;return null!=(b=String(a).match(e))?b[1]:null};b.getDivisor=function(a){var b;return null!=(b=String(a).match(e))?b[8]:null};b.divEvaluate=function(a){var b;return null!=(b=String(a).match(e))?+b[1]/b[8]:null};b.matchQuantNumber=function(a,b,c){var d;return(d=+String(a).match(p)[0])&&d>=b-c&&d<=b+c};b.matchQuantUnit=
function(){var a,b,c,d;b=arguments[0];d=2<=arguments.length?v.call(arguments,1):[];return(a=String(b).match(p)[0])&&(c=b.slice(a.length).trim())&&d.includes(c)};b.quote=function(a){return'"'+a+'"'};b.compact=function(a){return String(a).replace(/\s*/g,"")};b.equalsIgnoreCase=function(a,b){return a===b||String(a).toLowerCase()===String(b).toLowerCase()};b.replaceFirst=function(a,b,c){return String(a).replace(new RegExp(b),c)};b.replaceAll=function(a,b,c){return String(a).replace(new RegExp(b,"g"),
c)};b.regExMatch=function(a,b,c){return("string"===typeof a?new RegExp(a,c):a).test(b)};b.rm1coeff=function(a){if(null!=a)return String(a).replace(/(^|[^0-9])1([a-zA-Z])/g,"$1$2")};b.setMatches=function(a,b,c){var d,e;d=a.split(c);e=b.split(c);return e.every(function(a){return d.includes(a)})&&d.every(function(a){return e.includes(a)})};b.pointInRange=function(a,b,c,d,e){var f,g,h;if(f=null!=b?"function"===typeof b.match?b.match(n):void 0:void 0)e=[f[1],f[8],c,d],b=e[0],c=e[1],d=e[2],e=e[3];null==
d&&(d=0);null==e&&(e=d);return(f=a.match(n))&&b-d<=(g=f[1])&&g<=+b+ +d&&c-e<=(h=f[8])&&h<=+c+ +e};b.hasPoint=function(a,b){return a.find(function(a){return function(a){var c;c=a.x;a=a.y;return c===b.x&&a===b.y}}(this))};b.plural=function(a,b,c,d){var e;if(!b||2>a)return b;null==c&&(c=l.test(e=b.toLowerCase())?"y":"");if(!b.endsWith(c))return b;null==d&&(d=l.test(e)?"ies":h.test(e)?"es":"s");c.length&&(b=b.split(c)[0]);return b+(/[A-Z]/.test(b[b.length-1])?d.toUpperCase():d)};b.first=function(){return(1<=
arguments.length?v.call(arguments,0):[])[0]};b.last=function(){var a;a=1<=arguments.length?v.call(arguments,0):[];return a[a.length-1]};b.chooseRandomly=function(){var a;a=1<=arguments.length?v.call(arguments,0):[];return a[Math.floor(Math.random()*a.length)]};b.firstNonNull=function(){var a;return null!=(a=(1<=arguments.length?v.call(arguments,0):[]).find(function(a){return null!=a}))?a:null};b.valueOrZero=function(){var a;return null!=(a=(1<=arguments.length?v.call(arguments,0):[]).find(function(a){return null!=
a}))?a:0};b.hasValue=function(){return(1<=arguments.length?v.call(arguments,0):[]).every(function(a){return null!=a})};b.equals=function(){var a,b,c;b=arguments[0];c=2<=arguments.length?v.call(arguments,1):[];null==b&&(b=void 0);return isNaN(a=+b)?c.every(function(a){return b===(null!=a?a:void 0)}):c.every(function(b){return a===+(null!=b?b:NaN)})};b.memberOf=function(){var a,b,c;b=arguments[0];c=2<=arguments.length?v.call(arguments,1):[];null==b&&(b=void 0);return isNaN(a=+b)?c.some(function(a){return b===
(null!=a?a:void 0)}):c.some(function(b){return a===+(null!=b?b:NaN)})};b.greaterThan=function(a,b){return g(a,b,function(a,b){return a>b})};b.lessThan=function(a,b){return g(a,b,function(a,b){return a<b})};b.greaterThanOrEqual=function(a,b){return g(a,b,function(a,b){return a>=b})};b.lessThanOrEqual=function(a,b){return g(a,b,function(a,b){return a<=b})};b.equal=function(a,b){return g(a,b,function(a,b){return a===b})};b.notEqual=function(a,b){return g(a,b,function(a,b){return a!==b})};b.and=function(){return(1<=
arguments.length?v.call(arguments,0):[]).reduce(function(a,b){return a&&b},!0)};b.or=function(){return(1<=arguments.length?v.call(arguments,0):[]).reduce(function(a,b){return a||b},!1)};b.not=function(a){return!a};b.ifThen=function(a,b,c){return a?b:c};b.assign=function(a,b){var c,d,e,f,g;g="undefined"!==typeof window&&null!==window?window:global;d=a.split(".");a=2<=d.length?v.call(d,0,c=d.length-1):(c=0,[]);e=d[c++];c=0;for(f=a.length;c<f;c++)d=a[c],g=null!=g[d]?g[d]:g[d]={};return g[e]=b};b.length=
function(a){return a.length};b.toString=function(a){return a.toString()};return b}();"undefined"!==typeof module&&null!==module?module.exports=b:this.CTATFormulaFunctions=b}).call(this);var CTATFormulaActions={};
(function(){var b;b=function(){function b(){}b.goToState=function(b){return CTAT.ToolTutor.tutor.goToState(b)};b.goToStartState=function(){return CTAT.ToolTutor.tutor.goToStartState()};b.performInterfaceAction=function(b,e,c){return CTAT.ToolTutor.sendToInterface((new CTATTutoringServiceMessageBuilder).createInterfaceActionMessage(CTATMessage.makeTransactionId(),new CTATSAI(b,e,c)))};return b}();"undefined"!==typeof module&&null!==module?module.exports=b:this.CTATFormulaActions=b}).call(this);var CTATFormulaParser={};
(function(){var b,g,f,e,c=[].slice,a=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};e=/"(?:[^\\"]|\\\")*"|'(?:[^\\'']|\\\')*'/;g=/[A-Za-z_][\w._]*(?![\w(._])/g;f="abstract await boolean break byte case catch char class const continue debugger default delete do double else enum export extends false final finally float for function goto if implements import in instanceof int interface let long native new null of package private protected public return short static super switch synchronized this throw throws transient true try typeof var void volatile while with yield Array Date eval function global hasOwnProperty Infinity isFinite isNaN isPrototypeOf length Math NaN name Number Object prototype String toString undefined valueOf window".split(" ");b=
function(){function b(a){var b,d,e;this.variableTable=a;this.algebraParser=new CTATAlgebraParser;this.logicParser=new CTATLogicParser;this.chemParser=new CTATChemParser;this.keys=[];this.values=[];e="EPSILON MAX_SAFE_INTEGER MAX_VALUE MIN_SAFE_INTEGER MIN_VALUE NEGATIVE_INFINITY POSITIVE_INFINITY isFinite isInteger isNaN isSafeInteger parseFloat parseInt".split(" ");a=0;for(d=e.length;a<d;a++)b=e[a],this.keys.push(b),this.values.push(Number[b]);e=["toExponential","toFixed","toLocaleString","toPrecision",
"valueOf"];a=0;for(d=e.length;a<d;a++)b=e[a],this.keys.push(b),this.values.push(function(a){return function(){var b,d;d=arguments[0];b=2<=arguments.length?c.call(arguments,1):[];return a.apply(d,b)}}(Number.prototype[b]));e="E LN10 LN2 LOG10E LOG2E PI SQRT1_2 SQRT2 abs acos acosh asin asinh atan atanh atan2 cbrt ceil clz32 cos cosh exp expm1 floor fround hypot imul log log10 log1p log2 max min pow random round sign sin sinh sqrt tan tanh trunc".split(" ");a=0;for(d=e.length;a<d;a++)b=e[a],this.keys.push(b),
this.values.push(Math[b]);e=["fromCharCode","fromCodePoint"];d=0;for(a=e.length;d<a;d++)b=e[d],this.keys.push(b),this.values.push(String[b]);e="charAt charCodeAt codePointAt concat endsWith includes indexOf lastIndexOf localeCompare match normalize padEnd padStart repeat replace search slice split startsWith substr substring toLocaleLowerCase toLocaleUpperCase toLowerCase toUpperCase trim trimEnd trimStart valueOf".split(" ");d=0;for(a=e.length;d<a;d++)b=e[d],this.keys.push(b),this.values.push(function(a){return function(){var b,
d;d=arguments[0];b=2<=arguments.length?c.call(arguments,1):[];return a.apply(d,b)}}(String.prototype[b]));e="algParse algGetError algStringify algEvaluate algSort algGetOperator algGetVariables algGetOperands algGetExpression algFindExpression algCreateExpression algReplaceExpression algDeleteExpression algSimplifyRules algPartiallySimplify algSimplify algValid algValued algPartiallySimplified algSimplified algIdentical algEqual algPartiallyEquivalent algEquivalent isAlgValid algEval algStrictEquivTermsSameOrder algEquivTermsSameOrder algStrictEquivTerms algEquivTerms algEquiv isSimplified calc calca simplify algebraicEqual patternMatches polyTermsEqual algebraicMatches expressionMatches".split(" ");
d=0;for(a=e.length;d<a;d++)b=e[d],this.keys.push(b),this.values.push(function(a,b){return function(){var d;d=1<=arguments.length?c.call(arguments,0):[];return a.apply(b,d)}}(this.algebraParser[b],this.algebraParser));e="logicSetOptions logicParse logicGetError logicStringify logicEvaluate logicSort logicGetMainOperator logicGetOperators logicGetVariables logicGetOperands logGetExpression logicFindOperator logicFindExpression logicFindRuleApplications logicApplyRule logicApplyRules logicCreateExpression logicReplaceExpression logicDeleteExpression logicSimplifyNNF logicSimplifyCNF logicSimplifyDNF logicValid logicValued logicSorted logicCheckTests logicCheckNNF logicCheckCNF logicCheckDNF logicSimplifiedNNF logicSimplifiedCNF logicSimplifiedDNF logicIdentical logicEqual logicEquivalent logicAlwaysEqual logicAlwaysEqualCounterexample".split(" ");
d=0;for(a=e.length;d<a;d++)b=e[d],this.keys.push(b),this.values.push(function(a,b){return function(){var d;d=1<=arguments.length?c.call(arguments,0):[];return a.apply(b,d)}}(this.logicParser[b],this.logicParser));for(b in CTATFormulaFunctions)this.keys.push(b),this.values.push(function(a,b){return function(){var d;d=1<=arguments.length?c.call(arguments,0):[];return a.apply(b,d)}}(CTATFormulaFunctions[b],CTATFormulaFunctions));for(b in CTATFormulaActions)this.keys.push(b),this.values.push(function(a,
b){return function(){var d;d=1<=arguments.length?c.call(arguments,0):[];return a.apply(b,d)}}(CTATFormulaActions[b],CTATFormulaActions))}b.prototype.currentTagStart=0;b.prototype.setVariableTable=function(a){return this.variableTable=a};b.prototype.addFunction=function(a,b){this.keys.push(a);return this.values.push(b)};b.prototype.getCurrentTagPos=function(){return this.currentTagStart};b.prototype.evaluate=function(b,d,n,p){var h,l,v,y,w,A,z,C,D,F,G,x;try{C="undefined"!==typeof window&&null!==window?
window:global;h=function(){var a;a=[];for(y in C)a.push(y);return a}().concat(["selection","action","input"]);D=b.split(e);l=0;for(w=D.length;l<w;l++)for(z=D[l],G=null!=(F=z.match(g))?F:[],v=0,A=G.length;v<A;v++)y=G[v],0>a.call(f,y)&&0>a.call(h,y)&&0>a.call(this.keys,y)&&CTATFormulaFunctions.assign(y,void 0);for(y in x=this.variableTable.getTable())C[y]=x[y];return function(a,b,c){c.prototype=a.prototype;c=new c;a=a.apply(c,b);return Object(a)===a?a:c}(Function,["selection","action","input"].concat(c.call(this.keys),
["return "+b.trim().replace(/[\\]/g,"\\$&")]),function(){}).apply(C,[d,n,p].concat(c.call(this.values)))}catch(H){return console.log(H),null}finally{for(y in C)null!=y&&0>a.call(h,y)&&(x[y]=C[y],delete C[y])}};b.prototype.evaluate_throw=function(b,d,n,p){var h,l,v,y,w,A,z,C,D,F,G,x;try{C="undefined"!==typeof window&&null!==window?window:global;h=function(){var a;a=[];for(y in C)a.push(y);return a}().concat(["selection","action","input"]);D=b.split(e);l=0;for(w=D.length;l<w;l++)for(z=D[l],G=null!=
(F=z.match(g))?F:[],v=0,A=G.length;v<A;v++)y=G[v],0>a.call(f,y)&&0>a.call(h,y)&&0>a.call(this.keys,y)&&CTATFormulaFunctions.assign(y,void 0);for(y in x=this.variableTable.getTable())C[y]=x[y];return function(a,b,c){c.prototype=a.prototype;c=new c;a=a.apply(c,b);return Object(a)===a?a:c}(Function,["selection","action","input"].concat(c.call(this.keys),["return "+b.trim().replace(/[\\]/g,"\\$&")]),function(){}).apply(C,[d,n,p].concat(c.call(this.values)))}finally{for(y in C)null!=y&&0>a.call(h,y)&&
(x[y]=C[y],delete C[y])}};b.prototype.interpolate=function(a,b,c,d){var e,f,g,h,n;h=/<%=|%>/g;for(f=g=0;n=h.exec(a);)g%2?(this.currentTagStart=f,e=String(this.evaluate(a.substring(f+3,n.index),b,c,d)),a=a.slice(0,f)+e+a.slice(n.index+n[0].length,a.length),h.lastIndex=f+e.length,f=h.lastIndex-1):f=n.index,g++;return a};return b}();"undefined"!==typeof module&&null!==module?module.exports=b:this.CTATFormulaParser=b}).call(this);var CTATNoolsTracer=function(b,g,f){var e,c,a,d;function h(a){Da=[];O.setDoBacktracking(!1);J("debug","starting initial match");Ha=function(b){J("debug","done initial match");ya=ra=!0;O.setPruneOldActivations(Z.prune_old_activations);O.setDoBacktracking(Z.use_backtracking);O.setSearchAllPermutations(Z.search_all_permutations);ia=!0;"function"===typeof a&&a(b)};F()}function l(){J("debug","start conflict tree pregeneration...");wa=!0;oa=[];var a=0;0===Aa.length&&Aa.push({selection:"not_specified",action:"not_specified",
input:"not_specified"});var b=function(){++a>=Aa.length?c():n(Aa[a],b)},c=function(){J("debug","done conflict tree pregeneration");wa=!1;La();La=function(){}};Z.use_hint_fact?(a--,n(null,b,!0)):n(Aa[a],b)}function n(a,b,c){O.prepForMatch();L();var d;d=c?D():C(a,!0);F(null,function(e){O.retract(d);ya=!0;var f=O.getConflictTree();c?oa.__hintTree=[U,f]:oa.push([a,U,f]);b(e)})}function p(a,b,c){var d=null,e=null,f=null;if("untutored_action"===c)return C(a,!1),l(),!0;"hint"===c&&oa.__hintTree&&(e=H(!0,
a.selection,oa.__hintTree[0]));if(!e)for(var g=0;g<oa.length;g++){var h=oa[g][0],n=oa[g][1],p=n.firstPredictedSolution,n=n.selectionMap;!f&&("hint"!==c||0<p.hints.length)&&(f=p);if(I(a,h).isMatch){!e&&("hint"!==c||0<p.hints.length)&&(e=p);for(var q in n){if(n.hasOwnProperty(q))for(h=n[q],p=0;p<h.length;p++){var r=h[p];if("tutored_action"===c){if(I(a,r.sai,r.saiComparator).isMatch){d=r;break}}else!e&&0<r.hints.length&&(e=r)}if(d||"hint"===c&&e)break}}}if(d)J("debug","Matched w/ pregen tree, refiring chain: "+
d.activationIds.join(" , ")),Fa=d,Aa=[],O.prepForMatch(),L(),C(a,!0),F(null,function(a){J("debug","done refiring activations, returning result");a=Fa.sai.isCorrect?"correct":"bug";1===d.halted&&(d.halted=2);ra="correct"===a;ya=!0;Fa=da=null;b(a,d);l()},d.activationIds);else return e||(f||(f=new na),e=f),"tutored_action"===c?(J("debug","didn't get a match :( "),b("no_model",e)):b(e),!0}function q(a,b){"string"===typeof a&&(e[e.length-1].successOrBugMsg={message:a,priority:b||0})}function u(a){e[e.length-
1].priority=a}function v(a){var b=e[e.length-1].sai;a.selection&&(b.selection=a.selection);a.action&&(b.action=a.action);a.input&&(b.input=a.input)}function y(a,b,c,d,e,f,g){J("debug","handleImports for "+b);c=c||{};e=e||{count:0,chunks:[]};f=f||0;g=g||0;for(var h=/\bimport\s?\(('|")?([^()'"\s]*)\1?\);/g,n,p=[];null!=(n=h.exec(a));){var l=ca.relativeToAbsolute(n[2],b);c[l]?J("debug","skipping duplicate import: "+l):(p.push(l),c[l]=!0);a=a.replace(n[0],"");h.lastIndex-=n[0].length}e.chunks[f]||(e.chunks[f]=
[]);e.chunks[f][g]=a;e.count+=p.length;J("debug",b+" is importing "+p.length+" files");if(0<p.length)for(a={i:0};a.i<p.length;a={url$96:a.url$96,i:a.i},a.i++)if(a.url$96=p[a.i],b=a.url$96.replace(/.*[.]([^?]*)([?].*)?$/,"$1"),"nools"==b)$.ajax(a.url$96,{dataType:"text",success:function(a){return function(b){y(b,a.url$96,c,d,e,f+1,a.i);e.count--;0==e.count&&d(w(e.chunks))}}(a),error:function(a,b,c){J("error","Error in _handleImports() : ");J("error",b);throw b;}});else if("js"==b)$.getScript(a.url$96).done(function(a){return function(b){J("debug",
"imported script from "+a.url$96);e.count--;0===e.count&&d(w(e.chunks))}}(a)).fail(function(a){return function(b,c,d){J("error","Error importing script from "+a.url$96);throw d;}}(a));else throw Error("unrecognized filetype in nools import: "+a.url$96);else 0==f&&d(w(e.chunks))}function w(a){for(var b="",c;0<a.length;)for(c=a.pop();0<c.length;)b+=c.shift()+"\n";return b}function A(a,b){var c={getRuntime:function(){return qa},getStudentInput:function(){return Y.getLastStudentSAI()},getStudentSAIs:function(){return Y.getStudentSAIs()},
checkSAI:K,setTutorSAI:v,setSuccessOrBugMsg:q,setChainPriority:u,setProblemAttribute:P,getInitialized:function(){return Y.getInitialized()},backtrack:function(){O.setAboutToBacktrack()},assert:V,modify:Q,bulkModify:R,retract:N,undoAll:E,addPregenSAI:W,halt:aa,pruneOldActivations:S,setCTNodeData:B,addScoreLabels:r};[CTATAlgebraParser,CTATLogicParser,CTATChemParser,CTATFormulaParser].forEach(function(a){var b=new a;a={};for(var d in b)a.f=d,"function"===typeof b[a.f]&&(c[a.f]=function(a){return function(){return b[a.f].apply(b,
arguments)}}(a)),a={f:a.f}});var d=new CTATFormulaFunctions,e={},f;for(f in d)e.f=f,"function"===typeof parser[e.f]&&(c.CTATFormulaFunctions[e.f]=function(a){return function(){return d[a.f].apply(d,arguments)}}(e)),e={f:e.f};try{ka=nools.compile(a,{name:b||"CTATFlow",scope:c})}catch(Oa){return J("error","Error compiling rule file"),ia=!1,Oa}z();return!0}function z(){var a,b;a=ka.__scope;var c={};ka.__rules.forEach(function(a){c[a.name]=!0});if(a&&a.skill_definitions)if(a=a.skill_definitions,a instanceof
Array)a.forEach(function(a){var d={name:a.skillName||a.ruleName,category:a.category,label:a.label||a.skillName,description:a.description||"",mastery:a.mastery||CTATExampleTracerSkill.DEFAULT_MASTERY_THRESHOLD,level:a.pKnown||CTATExampleTracerSkill.DEFAULT_P_KNOWN,pGuess:a.pGuess||CTATExampleTracerSkill.DEFAULT_P_GUESS,pLearn:a.pLearn||CTATExampleTracerSkill.DEFAULT_P_LEARN,pSlip:a.pSlip||CTATExampleTracerSkill.DEFAULT_P_SLIP};a.ruleName?(b=a.ruleName.split(","),b.forEach(function(b){b=b.trim();if(c[b])Ga[b]=
d;else throw Error("Rule "+a.ruleName+" named by skill "+a.skillName+" does not exist in model");})):Ga.__noRuleSkills.push(d)});else throw Error("Global variable 'skill_definitions' must be of type Array");}function C(a,b){J("debug","Assert sai ("+(b?"":"un")+"tutored) : "+JSON.stringify(a));var c=la[a.selection];if(c&&O.factExists(c))c.action=a.action,c.input=a.input,c.tutored=b,O.modify(c);else{c=ka.getDefined("StudentValues");if(!c)throw Error("StudentValues type not defined");c=new c(a.selection,
a.action,a.input);c.tutored=b;O.assert(c,"_student_input_"+Ia);la[a.selection]=c;wa||Ia++}return da=c}function D(){J("debug","Asserting hint fact...");if(!va){var a=ka.getDefined("IsHintMatch");if(!a)throw Error("IsHintMatch type not defined");va=new a}return O.assert(va,"_isHintMatch")}function F(a,b,c){za=!1;O.match(function(a){wa||(Ma=O.getConflictTree());a&&J("debug","nools encountered an error: "+a+" - propogating...");b&&"function"===typeof b?b(a):za?(Ca&&J("override","search complete, returning result"),
Ha(a)):a&&(J("debug","_handleStepMatchResult returning error"),Ha(a))},a,!1,ya,c);ya=!1}function G(a,b){var c="no_model",d,e,f;U.matchChain?(d=U.matchChain,c="correct"):(U.bugMatchChains.length&&(d=U.bugMatchChains.sort(function(a,b){return b.priority-a.priority})[0],c="bug",e=d.msg,f=d.bugMessages),d=H(!1),e&&(d.msg=e),f&&(d.bugMessages=f));ra="correct"===c;d.tpas=Ka;ya=!0;da=null;a(c,d,b)}function x(a,b,c,d){c=H(!0,c);b&&(ra=Ja=!1,ya=!0,da=null,Z.use_hint_fact&&O.retract(va));a(c,d)}function H(a,
b,c){var d=c||U;c=d.selectionMap;b=b||(da?da.selection:"");var e=d.firstPredictedSolution,d=d.firstTutorSelection,f=[];J("debug","getBiasedPrediction selecting chain to return.  includeHints is "+a+", studentSelection is "+b);for(s in c){var g=c[s];J("debug","\tchecking selection: "+s);if(g)for(var h=0;h<g.length;h++){var n=g[h];J("debug","\t\tchecking chain: "+JSON.stringify(n));if(a&&0<n.hints.length||n.sai.isCorrect){J("debug","\t\t^^^^^^^^valid chain found");for(var p=0;p<f.length;){var l;a:{l=
f[p];if(a){if(n.hints.length&&!l.hints.length){l=-1;break a}if(l.hints.length&&!n.hints.length){l=1;break a}}l=n.priority>l.priority?-1:l.priority>n.priority?1:n.sai.selection===b&&l.sai.selection!==b?-1:l.sai.selection===b&&n.sai.selection!==b?1:n===e?-1:l===e?1:n.sai.selection===d&&l.sai.selection!==d?-1:l.sai.selection===d&&n.sai.selection!==d?1:0}if(0>=l)break;p++}f.splice(p,0,n)}}}(a=f.shift())?J("debug","returning chain: "+JSON.stringify(a)):(J("debug","\tno chain found, returning blank chain"),
a=new na);return a}function K(b,c,d){var f=!1,g=b.selection,h=b.action,n=b.input,p=e,p=p[p.length-1],l="not_specified"===g||"not_specified"===h||"not_specified"===n;J("sai_check","check SAI against: "+JSON.stringify(b));if(Z.pregen_conflict_tree)return J("sai_check","in pregen mode, skipping check  (was "+(d?"":"not")+" a buggy step)"),p.sai={selection:g,action:h,input:n,isCorrect:!d&&!l},p.comparator=c,Fa&&(J("sai_check","currently re-firing; updating sai in matched chain..."),Fa.sai=p.sai),!0;if(!da)return J("sai_check",
"no student input to check, returning false"),!1;J("sai_check","student input: "+JSON.stringify(da));p.sai={selection:null!==g&&void 0!==g&&"not_specified"!==g&&"don't_care"!==g?g:"",action:null!==h&&void 0!==h&&"not_specified"!==h&&"don't_care"!==h?h:"",input:null!==n&&void 0!==n&&"not_specified"!==n&&"don't_care"!==n?n:"",isCorrect:!d&&!l};Ja?J("sai_check","Skipping check, we're hint matching"):(f=I(da,b,c),J("sai_check",(f.isMatch?"Match":"No match")+", "+(d?"was":"was not")+" a buggy step"),a=
f.isMatch?d?"buggy":"match":a||null,O.setNodeMatcherResult(f,d));return f.isMatch}function I(a,b,c){var d=b.selection,e=b.action,f=b.input,g=a.selection,h=a.action,n=a.input,p=["-","-","-"],l={student:a,tutor:b,isMatch:!1,matchedFields:null},n=isNaN(n)?n:parseFloat(n),f=isNaN(f)?f:parseFloat(f),q=function(a,b,c){return"don't_care"===a?"*":"not_specified"===a?" ":a===b?c:"-"};p[0]=q(d.toLowerCase(),g.toLowerCase(),"S");p[1]=q(e.toLowerCase(),h.toLowerCase(),"A");p[2]=q(f,n,"I");l.matchedFields=p;if(c&&
"function"===typeof c)l.isMatch=c(a,b);else for(l.isMatch=!0,a=0;3>a;a++)if("-"===p[a]){l.isMatch=!1;break}return l}function L(){U=new ma;e=[];c=[];a=null;za=d=!1}function P(a,b){J("debug","setProblemAttribute ("+a+", "+b+")");Z[a]=b}function B(a){O.setNodeData(a)}function r(){var a=e[e.length-1];a.scoreLabels=a.scoreLabels.concat(Array.prototype.slice.call(arguments))}function M(){for(var b=e,c=U.selectionMap,f,g,h={message:"",priority:Number.NEGATIVE_INFINITY},n,p=[],l=[],q=[],r=[],u=[],v=[],w=
[],Y,y={selection:"",action:"",input:""},z=[],A=null,x={},S=d?wa?1:2:0,H=0,C=0;C<b.length;C++)f=b[C],g=f.sai,l.push(f.ruleName),(n=Ga[f.ruleName])&&q.push(n.name+" "+n.category),q=q.concat(f.skills),r=r.concat(f.hints),w=w.concat(f.tpas),p.push(f.activationId),u=u.concat(f.successMessages),v=v.concat(f.bugMessages),f.successOrBugMsg&&f.successOrBugMsg.priority>h.priority&&(h=f.successOrBugMsg),g&&(g.selection&&(Y=y.selection=g.selection),g.action&&(y.action=g.action),g.input&&(y.input=g.input),y.isCorrect=
g.isCorrect,f.comparator&&"function"===typeof f.comparator&&(A=f.comparator)),z=z.concat(f.scoreLabels),f.customFields.forEach(function(a){return x[a.name]=a.value}),H=f.priority>H?f.priority:H;r.sort(function(a,b){var c=b.precedence-a.precedence;0===c&&(c=a.pos-b.pos);return c});Y?U.firstTutorSelection||(U.firstTutorSelection=Y):Y="_default_key";c[Y]||(c[Y]=[]);b=new na(y,l,q,r,h,x,p,A,w,S,H,u,v,z);y.isCorrect&&!U.firstPredictedSolution&&(U.firstPredictedSolution=b);c[Y].push(b);switch(a){case "buggy":U.bugMatchChains.push(b);
break;case "match":U.matchChain=b}U.numChains++;Ka=w;J("debug","stored last chain: \n\trules: "+l+"\n\tskills: "+q+"\n\thints: "+r.map(function(a){return a.msg})+"\n\tfinalSAI: "+JSON.stringify(y)+"\n\tmatchType: "+a+"\n\tmsg: "+h+"\n\tpriority: "+H+"\n\tsuccess messages: "+u.map(function(a){return a.msg})+"\n\tbug messages: "+v.map(function(a){return a.msg})+"\n\tscore labels: "+z.join())}function V(a){Z.use_backtracking&&O.pushUndo("assert",a);return O.assert(a)}function N(a){Z.use_backtracking&&
O.pushUndo("retract",a);return O.retract(a)}function Q(a,b,c){if(Z.use_backtracking)O.pushUndo("modify",a,b);else if(3>arguments.length)return O.modify.apply(O,arguments);a[b]=c;return O.modify(a)}function R(a,b){if(Z.use_backtracking)O.pushUndo("bulkModify",a,Object.keys(b));else if(2>arguments.length)return O.modify.apply(O,arguments);for(var c in b)a[c]=b[c];return O.modify(a)}function aa(){d=!0;wa?O.setAboutToBacktrack():(O.halt(!0),za=!0)}function E(){O.undoAll(!0)}function S(){var a=O.pruneOldActivations();
J("debug","pruned old activations: "+a.join(","))}function W(){if(!wa)for(var a=0;a<arguments.length;a++){var b=arguments[a];!b.selection&&(b.selection="not_specified");!b.action&&(b.action="not_specified");!b.input&&(b.input="not_specified");Aa.push(b)}}function T(){M()}function fa(a){Ea||c.pop();Ea=!1;Ka=[];J("backtrack","backtracking, initiated by "+(a?"model":"engine"))}function Ba(a,b,c,d){var f;try{f=JSON.stringify(a)}catch(Pa){f="< Error converting fact to JSON >"}J("assert",b+" fact asserted with ID "+
d+": "+f);c=e[e.length-1];switch(b){case "tpa":J("tpa","TPA asserted: "+JSON.stringify(a));ia?Z.use_backtracking?c.tpas.push(a):pa(a):Da.push(ca.buildStartStateMsg(a));break;case "hint":ia&&(a.pos=+(e.length+"."+c.hints.length),c.hints.push(a));break;case "skill":ia&&c.skills.push(a.name+" "+a.category);break;case "customfield":ia&&c.customFields.push(a);break;case "successmessage":ia&&c.successMessages.push(a);break;case "bugmessage":ia&&c.bugMessages.push(a)}}function sa(a,b,c,d){J("modify",b+" fact modified with ID "+
d)}function ga(a,b,c,d){J("retract",b+" fact retracted with ID "+d)}function ta(b){J("state_save","Hit branch point, agenda: "+JSON.stringify(b.agenda)+", factIdCntr: "+b.state.factIdCounter);c.push({numLinks:e.length,matchType:a})}function ua(b){J("state_restore","State restored, agenda: "+JSON.stringify(b.agenda)+", factIdCntr: "+b.state.factIdCounter);b=c;b=b[b.length-1];links=e;links.splice(b.numLinks);a=b.matchType}function ha(a,b,c){J("fire","Firing activation: "+c);e.push(new xa(a,c));Ea=!0}
function ja(a,b,c){J("agenda_insert",a+" added to agenda, is "+(b?" ":"not ")+"new, was "+(c?" ":"not ")+"skipped")}function ea(a){J("agenda_retract",a+" removed from agenda")}function X(){J("agenda_empty","No more activations in agenda, all branches have been explored");za=!0}function ba(a){J("override","hit breakpoint on rule "+a+" (call resume() to resume matching)")}var ma=function(){this.firstTutorSelection=null;this.selectionMap={};this.matchChain=null;this.bugMatchChains=[];this.numChains=
0;this.firstPredictedSolution=null},na=function(a,b,c,d,e,f,g,h,n,p,l,q,r,u){this.sai=a||{selection:"",action:"",input:""};this.rules=b||[];this.skills=c||[];this.hints=d||[];this.msg=e?e.message:"";this.customFields=f||{};this.activationIds=g||[];this.saiComparator=h||null;this.tpas=n||[];this.halted=p;this.priority=l||0;this.successMessages=q||[];this.bugMessages=r||[];this.scoreLabels=u||[]},xa=function(a,b){this.ruleName=a;this.activationId=b;this.hints=[];this.tpas=[];this.skills=[];this.customFields=
[];this.successMessages=[];this.bugMessages=[];this.scoreLabels=[]},J=b,pa=g,qa=f,Y=this,ia=!1,ka=null,O=null,la={},U=new ma,da=null,Ia=0;e=[];c=[];a=null;var Ea=d=!1,ca=null,Da=[],Z={use_backtracking:!0,prune_old_activations:!1,use_hint_fact:!1,search_all_permutations:!0,hint_out_of_order:!1,substitute_input:!1,auto_hint:"none",auto_hint_threshold:3},ra=!0,Ja=!1,va=null,Ga={__noRuleSkills:[]},Ka=[],Ca=!1,ya=!0,Ha=function(){},za=!1,Aa=[],wa=!1,La=function(){},oa=[],Fa=null,Ma=null,Na;this.getSession=
function(){return O};this.getInitialized=function(){return ia};this.getSkills=function(){return Ga};this.getProblemAttribute=function(a){return Z[a]};this.setProblemAttribute=function(a,b){return P(a,b)};this.getProblemStateStatus=function(){return qa.getOutputStatus()};this.init=function(a,b,c){J("debug","noolstracer init w/ source file: "+a);if(nools){ca=new CTATNoolsTracerUtil;var d=ca.relativeToAbsolute(a);$.ajax(a,{dataType:"text",success:function(e){y(e,d,null,function(d){J("debug","compiling model...");
!0!==(d=A(d,a))?(J("debug","CTATNoolsTracer: Error compiling model"),c(d)):(J("debug","done compile"),Y.createSession()||c("CTATNoolsTracer: Error creating session"),registerTracerWrapper(new CTATNoolsTracerWrapper(Y)),h(function(a){J("override","tracer initialized, log flags: ");getTracerLogFlags();printBreakpoints();a?c(a):(b(Da,Z),a=new Event("noolsModelLoaded"),window.dispatchEvent(a),Z.pregen_conflict_tree&&l())}))})},error:function(a,b,d){ctatdebug("Error retrieving rule file: ");ctatdebug(b);
c(b)}})}else J("error","Error: nools is not defined"),c("nools is not defined")};this.createSession=function(){J("debug","creating session...");(O=ka.getSession({iAmEventListeners:!0,assert:Ba,retract:ga,modify:sa,state_save:ta,state_restore:ua,backtrack:fa,fire:ha,agenda_insert:ja,agenda_retract:ea,agenda_empty:X,endOfChain:T,breakpoint:ba}))&&J("debug","session created");return!!O};this.evaluate=function(a,b,c){J("debug","noolsTracer.evaluate, matchType = "+c+", sai "+JSON.stringify(a)+", "+ra);
Na=Date.now();if(Z.pregen_conflict_tree)return p(a,b,c);var d=G.bind(Y,b);O.prepForMatch();switch(c){case "hint":if(ra||Z.use_hint_fact)Ja=!0,d=x.bind(Y,b,!0,a.selection),Z.use_hint_fact&&D();else return J("debug","re-using hints from last match"),x(b,!1,a.selection),!0;case "tutored_action":L();C(a,!0);Ha=function(a){O.prepForMatch();O.restoreAgenda();Y.printTraceTime();Y.printAgenda("agenda_post");Y.printConflictTree("conflict_tree");d(a)};Ca||(Y.printAgenda("agenda_pre"),F());break;case "untutored_action":return C(a,
!1),!0}return!1};this.setListener=function(a,b){O&&O.on(a,b)};this.getStudentSAIs=function(){return la};this.getLastStudentSAI=function(){return da};this.getTutorSAIs=function(){return U.selectionMap};this.reset=function(a){Y.createSession();ia=!1;la={};U=new ma;da=null;ra=!0;h(a)};this.printTraceTime=function(){var a=(Date.now()-Na)/1E3;J("time","trace took "+a+" seconds.")};this.printAgenda=function(a){J(a,ca.printAgenda(O))};this.getAgenda=function(){return O.getAgenda()};this.printConflictTree=
function(a,b,c){J(a,"\n"+Ma.toString(b,c))};this.printPregenTrees=function(a,b,c){oa.__hintTree&&J(a," hint tree: \n"+oa.__hintTree[1].toString(b,c));oa.forEach(function(d){J(a," tree for sai: "+JSON.stringify(d[0])+"\n"+d[2].toString(b,c))})};this.printTutorSAIs=function(a,b){var c="";Ma.getMatchChains().forEach(function(a){var d=a.match.tutor;c+="\n"+d.selection+" ; "+d.action+" ; "+d.input;b&&(c+=" \n "+a.rules.join(",")+"\n")});J(a,c)};this.printFact=function(a){J("override",ca.printFact(O,a))};
this.printFacts=function(a){J("override",ca.printFacts(O,a))};this.printRules=function(a){J("override",ca.printRules(O,a))};this.getFact=function(a){return ca.getFact(O,a)};this.getFacts=function(a){return ca.getFacts(O,a)};this.printCtNodeMatch=function(a){J("override",ca.printCtNodeMatch(O,a))};this.printRuleNodes=function(a){J("override",ca.printRuleNodes(O,a))};this.printBreakpoints=function(){J("override",ca.printBreakpoints(O))};this.setInStepMode=function(a){a=a&&"false"!==a;J("override","Stepper mode "+
(a?"on":"off"));!Ca||a||za||F();Ca=a};this.takeSteps=function(a){Ca?da?(a=a||1,J("override","taking "+a+" steps"),F(a)):J("override","no new student input, ignoring"):J("override","not in step mode, ignoring")};this.setBreakpoint=function(a,b){a?(b=b||"first",O.setBreakpoint(a,b)?J("override","breakpoint "+("none"===b?"cleared":"set")+" for rule "+a):J("override","breakpoint not "+("none"===b?"cleared":"set")+" -- rule "+a+" doesn't exist")):J("override","need a rule name to break on")};this.resume=
function(){Ca?J("override","can't resume; engine is in stepper mode"):za?J("override","not at a breakpoint, ignoring"):F()};this.getIAmPregenerating=function(){return wa};this.setDonePregenCallback=function(a){J("debug","setDonePregenCallback()");La=a};this.getAllNextSteps=function(){var a=U.selectionMap,b=[],c;for(c in a){var d=a[c];if(d)for(var e=0;e<d.length;e++){var f=d[e];f.sai.isCorrect&&b.push({sai:f.sai,hints:f.hints,rules:f.rules,skills:f.skills})}}J("debug","getAllNextSteps returning steps: "+
JSON.stringify(b));return b}};var CTATRuleTracerGlobals={},COMM_SHELL_LISTENER_FLAG="message";
function _addOrRemoveCommShellListener(b,g){b==COMM_SHELL_LISTENER_FLAG&&Promise.resolve({flag:b,value:g}).then(function(b){return b.value?CTATCommShell.commShell&&CTATCommShell.commShell.addGlobalEventListener({processCommShellEvent:function(b,c){return console.log("["+COMM_SHELL_LISTENER_FLAG+": "+b+"]",c&&c.getXMLString?c.getXMLString():c)}},b.flag):CTATCommShell.commShell&&CTATCommShell.commShell.removeGlobalEventListener(b.flag)})}
var NOOLS_LOG_FLAGS="time conflict_tree assert modify retract state_save state_restore backtrack agenda_insert agenda_retract agenda_empty fire error debug sai_check agenda_pre agenda_post tpa".split(" "),CTATNoolsTracerLogger=new CTATLogger(NOOLS_LOG_FLAGS.concat(COMM_SHELL_LISTENER_FLAG));document.addEventListener("tutorInitialized",function(b){return _addOrRemoveCommShellListener(COMM_SHELL_LISTENER_FLAG,CTATNoolsTracerLogger.isSet(COMM_SHELL_LISTENER_FLAG))});var globalTracerRef=null;
function registerTracerWrapper(b){globalTracerRef=b}function addTracerLogFlag(b,g){CTATNoolsTracerLogger.addFlag(b,g);_addOrRemoveCommShellListener(b,g)}function setTracerLogFlag(b){var g=CTATNoolsTracerLogger.set(b)?"set flag "+b:"Error - invalid flag: "+b;_addOrRemoveCommShellListener(b,!0);CTATNoolsTracerLogger.log("override",g)}
function setTracerLogFlags(b){var g=[],f=[];(b instanceof Array?b:Array.prototype.slice.call(arguments)).forEach(function(b){CTATNoolsTracerLogger.set(b)?(_addOrRemoveCommShellListener(b,!0),g.push(b)):f.push(b)});g.length&&CTATNoolsTracerLogger.log("override","set flags: "+g.join(","));f.length&&CTATNoolsTracerLogger.log("override","Error - invalid flag(s): "+f.join(","))}
function getTracerLogFlags(){var b=CTATNoolsTracerLogger.getFlags(),g=[],f=[],e;for(e in b)b[e]?g.push(e):f.push(e);CTATNoolsTracerLogger.log("override","set: "+g.join(",")+"\nunset: "+f.join(","))}function unsetTracerLogFlag(b){CTATNoolsTracerLogger.unset(b);_addOrRemoveCommShellListener(b,!1)}function unsetTracerLogFlags(b){(b instanceof Array?b:Array.prototype.slice.call(arguments)).forEach(function(b){unsetTracerLogFlag(b)})}function printAgenda(){globalTracerRef.printAgenda()}
function getAgenda(){return globalTracerRef.getAgenda()}function printConflictTree(b,g){globalTracerRef.printConflictTree(b,g)}function printPregenTrees(b,g){globalTracerRef.printPregenTrees(b,g)}function printTutorSAIs(b){globalTracerRef.printTutorSAIs()}function printFact(b){globalTracerRef.printFact(b)}function getFact(b){return globalTracerRef.getFact(b)}function printFacts(b){globalTracerRef.printFacts(b)}function getFacts(b){return globalTracerRef.getFacts(b)}
function printRules(b){globalTracerRef.printRules(b)}function printMatch(b){globalTracerRef.printMatch(b)}function whyNot(b){globalTracerRef.printRuleNodes(b)}function setStepperMode(b){globalTracerRef.setStepperMode(b)}function takeSteps(b,g){globalTracerRef.takeSteps(b,g)}function setBreakpoint(b,g){globalTracerRef.setBreakpoint(b,g)}function printBreakpoints(){globalTracerRef.printBreakpoints()}function resume(){globalTracerRef.resume()}
function getProblemStateStatus(){return globalTracerRef.getProblemStateStatus()};var CTATRuleTracer=function(b,g){function f(a){var b=[],c=Object.keys(a).flatMap(function(b){return a[b]});p("debug","skills from model: "+JSON.stringify(c));c.forEach(function(a){var c=new CTATExampleTracerSkill(a.category,a.name,a.pGuess,a.level,a.pSlip,a.pLearn,null);c.setLabel(a.label);b.push(c)});n.addSkillsFromProblemFile?n.addSkillsFromProblemFile(b):p("debug","skipped adding skills from model -- CTATExampleTracer.addSkillsFromProblemFile is not defined")}function e(a,b,e,f,g){var h=f.msg,
n=f.successMessages.map(function(a){return a.msg}),u=f.bugMessages.map(function(a){return a.msg}),w=f.sai,y=new CTATSAI(w.selection,w.action,w.input),z=a.getStudentSAI(),A=f.customFields,C=A.step_id?A.step_id:""+w.selection+(w.selection&&w.action?" ":"")+w.action+"";n.length||n.push(h);u.length||u.push(h);var B;B=CTATGlobals.languageManager.interpolateStrings("correct"===e?n:u,new CTATVariableTable,z);p("debug","ruleTracer.handleResult, result = "+e+"\n\ttutorSAI = "+JSON.stringify(w)+"\n\tmsg = "+
h+"\n\tsuccess messages = "+n+"\n\tbug messages = "+u+"\n\tassociated rules = "+f.rules+"\n\tassociated skills = "+f.skills+"\n\tstep ID = "+C+"\n\tscore labels = "+f.scoreLabels+"\n\ttpas = "+f.tpas+"\n\tcustom fields = "+JSON.stringify(A)+"\n\thalted = "+f.halted);g&&p("debug","error: "+g);a.setStepID(C);a.setTutorSAI("correct"!==e||q.getProblemAttribute("substitute_input")?y:z);a.setSuccessOrBuggyMsg(B);a.setAssociatedRules(f.rules);a.setAssociatedSkills(f.skills);a.setCustomFields(A);a.addScoreLabels&&
f.scoreLabels.length&&a.addScoreLabels(f.scoreLabels);switch(e){case "correct":a.setResult(CTATExampleTracerLink.CORRECT_ACTION);a.setTraceOutcome(CTATExampleTracerLink.CORRECT_ACTION);v={all:0};break;case "bug":case "no_model":c(a,z,"bug"===e),p("debug","consecutive errors: \n\t"+Object.keys(v).map(function(a){return a+": "+v[a]}).join("\n\t")),l()}0<CTATNoolsTracerLogger.getNFlagsSet()&&p("override","------ end of trace ------\n");2===f.halted&&f.tpas.forEach(function(a){d(a)});b(g)}function c(a,
b,c){b.getSelection().includes("done")&&"ButtonPressed"===b.getAction()&&a.setDoneStepFailed(!0);c?(a.setResult(CTATExampleTracerLink.BUGGY_ACTION),a.setTraceOutcome(CTATExampleTracerLink.BUGGY_ACTION)):(a.setResult(CTATExampleTracerLink.NO_MODEL),a.setTraceOutcome(CTATExampleTracerLink.NO_MODEL));q.getProblemAttribute("report_next_steps")&&(c=q.getAllNextSteps(),a.setTracerInfo(c,"next_steps"));a=b.getSelection();v.all++;v[a]?v[a]++:v[a]=1}function a(a,b,c,d){var e=c.hints.map(function(a){return a.msg}),
f=c.rules,g=c.skills,h=c.sai,n=a.getStudentSAI();c=c.customFields;var l=c.step_id?c.step_id:""+h.selection+(h.selection&&h.action?" ":"")+h.action+"",e=CTATGlobals.languageManager.interpolateStrings(e,new CTATVariableTable,n);p("debug","ruleTracer.handleHintResult,\n\ttutorSAI = "+JSON.stringify(h)+"\n\tassociated rules = "+f+"\n\tassociated skills = "+g+"\n\tstep ID = "+l+"\n\tcustom fields = "+JSON.stringify(c)+"\n\thints (interpolated) = "+JSON.stringify(e));a.setTutorSAI(new CTATSAI(h.selection,
h.action,h.input));a.setResult(CTATExampleTracerLink.HINT_ACTION);a.setTraceOutcome(e.length?CTATExampleTracerLink.HINT_ACTION:CTATExampleTracerLink.NO_MODEL);a.setReportableHints(e);a.setActor(CTATMsgType.DEFAULT_STUDENT_ACTOR);a.setStepID(l);a.setAssociatedSkills(g);a.setAssociatedRules(f);a.setCustomFields(c);v={all:0};b(d)}function d(a){n&&n.enqueueToolActionToStudent(a.selection,a.action,a.input,"tutor-performed")}function h(a){return{selection:a.getSelection()||"",action:a.getAction()||"",input:a.getInput()||
""}}function l(){var a=q.getProblemAttribute("auto_hint"),b=q.getProblemAttribute("auto_hint_threshold");if("all"===a?v.all>=b:"selection"===a&&Object.keys(v).some(function(a){return"all"!==a&&v[a]>=b}))p("debug","at consecutive error threshold, sending hint request..."),CTATCommShell.commShell.processComponentAction(new CTATSAI("hint","ButtonPressed","hint request"))}var n=g,p=CTATNoolsTracerLogger.log,q=null,u=null,v={all:0},y=this;this.getEngine=function(){return q};this.initEngine=function(a,
c,e){switch(b){case "nools":q=new CTATNoolsTracer(p,d,n)}var g=function(a,b){console.log("CTATRuleTracer.doneInit");f(q.getSkills());c(a,b)};q&&q.init(a,g,e)};this.getModelInitialized=function(){return q&&q.getInitialized()};this.getProblemStateStatus=function(){return n.getOutputStatus()};this.setListener=function(a,b){q.setListener(a,b)};this.evaluate=function(a,b){a.setTutorType("rule");var c=h(a.getStudentSAI());a=e.bind(y,a,b);c=q.evaluate.bind(q,c,a,"tutored_action");return q.getIAmPregenerating()?
(q.setDonePregenCallback(c),!1):c()};this.doHint=function(b,c,d){b.setTutorType("rule");b.setTransactionID(c);return q.evaluate(h(b.getStudentSAI()),a.bind(this,b,d),"hint")};this.handleUntutoredAction=function(a,b){p("debug","ruleTracer.handleUntutoredAction()",JSON.stringify(a),b);q.evaluate({selection:a.selection[0],action:a.action[0],input:a.input[0]},null,"untutored_action")};this.checkOutOfOrder=function(a,b){q.getProblemAttribute("hint_out_of_order")?(a=h(a.getStudentSAI()),a=!q.getTutorSAIs()[a.selection]):
a=!1;b(a)};this.setDefaultBuggyMsg=function(a){a&&"string"===typeof a&&(u=a)};this.getDefaultBuggyMsg=function(){return u};this.reset=function(a){q.reset(a)}};var CTATHintPolicyEnum=function(){};Object.defineProperty(CTATHintPolicyEnum,"HINTS_UNBIASED",{enumerable:!0,configurable:!1,writable:!1,value:"Always Follow Best Path"});Object.defineProperty(CTATHintPolicyEnum,"HINTS_BIASED_BY_CURRENT_SELECTION_ONLY",{enumerable:!0,configurable:!1,writable:!1,value:"Bias Hints by Current Selection Only"});Object.defineProperty(CTATHintPolicyEnum,"HINTS_BIASED_BY_PRIOR_ERROR_ONLY",{enumerable:!0,configurable:!1,writable:!1,value:"Bias Hints by Prior Error Only"});
Object.defineProperty(CTATHintPolicyEnum,"HINTS_BIASED_BY_ALL",{enumerable:!0,configurable:!1,writable:!1,value:"Use Both Kinds of Bias"});Object.defineProperty(CTATHintPolicyEnum,"DEFAULT",{enumerable:!0,configurable:!1,writable:!1,value:CTATHintPolicyEnum.HINTS_BIASED_BY_ALL});CTATHintPolicyEnum.prototype=Object.create(Object.prototype);CTATHintPolicyEnum.prototype.constructor=CTATHintPolicyEnum;CTATHintPolicyEnum.AllPolicies=[];for(var hp in CTATHintPolicyEnum)/^HINTS_/.test(hp)&&CTATHintPolicyEnum.AllPolicies.push(CTATHintPolicyEnum[hp]);
CTATHintPolicyEnum.lookup=function(b){for(policy in CTATHintPolicyEnum)if(CTATHintPolicyEnum[policy]==b)return CTATHintPolicyEnum[policy];return CTATHintPolicyEnum.DEFAULT};"undefined"!==typeof module&&(module.exports=CTATHintPolicyEnum);var CTATMatcher=function(b,g,f){CTATBase.call(this,"CTATMatcher","");this.lastResult=null;var e=new CTATSAI("","",""),c=f,a=CTATMsgType.DEFAULT_ACTOR,d=!1,h=this;this.resetMatcher=function(){};this.MatcherSAItoXML=function(a){return a+"<matcher>\n"+(a+"    <matcherType>Matcher</matcherType>\n")+(a+'    <matcherParameter name="single">null</matcherParameter>\n')+(a+"</matcher>\n")};this.getSelection=function(){return h.getDefaultSelection()};this.getAction=function(){return h.getDefaultAction()};this.getInput=
function(){return h.getDefaultInput()};this.getActor=function(){return a};this.setCaseInsensitive=function(a){c=a};this.getEvaluatedInput=function(a,b){return h.getInput()};this.getTraversalIncrement=function(){return 1};this.getTutorSAI=function(a,b,c){a=String(c).toLowerCase()==CTATExampleTracerLink.CORRECT_ACTION.toLowerCase()?a:h.getDefaultSAI();console.log("CTATMatcher.getTutorSAI() superclass method called, should be subclass;\n  returning: "+a);return a};this.getDefaultSelection=function(){return h.getDefaultSAI().getSelection()};
this.getDefaultAction=function(){return h.getDefaultSAI().getAction()};this.getDefaultInput=function(){return h.getDefaultSAI().getInput()};this.getDefaultSAI=function(){return e};this.setDefaultSAI=function(a){e=a};this.getDefaultActor=function(){switch(String(getActor()).toLowerCase()){case CTATMsgType.DEFAULT_STUDENT_ACTOR.toLowerCase():return CTATMsgType.DEFAULT_STUDENT_ACTOR;case CTATMsgType.DEFAULT_TOOL_ACTOR.toLowerCase():return CTATMsgType.DEFAULT_TOOL_ACTOR;case CTATMsgType.UNGRADED_TOOL_ACTOR.toLowerCase():return CTATMsgType.DEFAULT_TOOL_ACTOR;
case CTATMsgType.ANY_ACTOR.toLowerCase():return CTATMsgType.DEFAULT_TOOL_ACTOR;default:return console.log("CTATMatcher.getDefaultActor() unexpected value for actor: "+a+"; returning "+CTATMsgType.DEFAULT_ACTOR),CTATMsgType.DEFAULT_ACTOR}};this.getInput=function(){return h.getDefaultInput()};this.getCaseInsensitive=function(){return c};this.match=function(a,b,c,d,e){console.log("CTATMatcher superclass method called: match("+a+", "+b+", "+c+", "+d+")");return!1};this.matchForHint=function(a,b,c,d){console.log("CTATMatcher superclass method called: matchForHint("+
a+", "+b+", "+c+", vt)");return!1};this.matchActor=function(a){a=String(a).toUpperCase();var b=String(h.getActor()).toUpperCase();ctatdebug("CTATMatcher.matchActor("+a+") myActor is "+b);return CTATMsgType.ANY_ACTOR.toString().toUpperCase()==b||CTATMsgType.UNGRADED_TOOL_ACTOR.toString().toUpperCase()==b&&CTATMsgType.DEFAULT_TOOL_ACTOR.toString().toUpperCase()==a||CTATMsgType.UNGRADED_TOOL_ACTOR.toString().toUpperCase()==a&&CTATMsgType.DEFAULT_TOOL_ACTOR.toString().toUpperCase()==b?!0:b==a};this.getDefaultSelectionArray=
function(){return h.getDefaultSAI().getSelectionArray()};this.getDefaultActionArray=function(){return h.getDefaultSAI().getActionArray()};this.getDefaultInputArray=function(){return h.getDefaultSAI().getInputArray()};this.getLastResult=function(){return null===h.lastResult||"undefined"===typeof h.lastResult?"":h.lastResult.toString()};this.setActor=function(b){ctatdebug("CTATMatcher --\x3e in setActor("+b+")");if(null===b||"undefined"===typeof b)b=CTATMsgType.DEFAULT_ACTOR;b=String(b).toLowerCase().trim();
a="tool"==b||"tutor"==b?CTATMsgType.DEFAULT_TOOL_ACTOR:b==CTATMsgType.DEFAULT_STUDENT_ACTOR.toLowerCase()?CTATMsgType.DEFAULT_STUDENT_ACTOR:b==CTATMsgType.DEFAULT_TOOL_ACTOR.toLowerCase()?CTATMsgType.DEFAULT_TOOL_ACTOR:b==CTATMsgType.UNGRADED_TOOL_ACTOR.toLowerCase()?CTATMsgType.UNGRADED_TOOL_ACTOR:b==CTATMsgType.ANY_ACTOR.toLowerCase()?CTATMsgType.ANY_ACTOR:CTATMsgType.DEFAULT_ACTOR};this.array2ConcatString=function(a){var b="";if(null==a)return b;if(!Array.isArray(a))return a.toString();a.forEach(function(a){null!=
a&&(b+=a.toString()+"\n")});return b.substring(0,0<b.length?b.length-1:0)};this.getLastEvaluation=function(){console.log("CTATMatcher.getLastEvaluation() called on superclass");return null};this.isLinkTriggered=function(){return d};this.setLinkTriggered=function(a){d=a};this.evaluateReplacement=function(a,b,c){return""};this.replaceInput=function(){return!!h.getReplacementFormula()};this.getReplacementFormula=function(){return""}};
CTATMatcher.prototype.toString=function(){console.log("Error: CTATMatcher.toString() called; should be overridden in subclass");return"This is CTATMatcher."};CTATMatcher.prototype.setParameter=function(b,g,f){};CTATMatcher.isTutorActor=function(b,g){return CTATMsgType.DEFAULT_TOOL_ACTOR.toUpperCase()===b.toUpperCase()||CTATMsgType.UNGRADED_TOOL_ACTOR.toUpperCase()===b.toUpperCase()||g&&CTATMsgType.ANY_ACTOR.toUpperCase()===b.toUpperCase()?!0:!1};
Object.defineProperty(CTATMatcher,"NON_SINGLE",{enumerable:!1,configurable:!1,writable:!1,value:-1});Object.defineProperty(CTATMatcher,"SELECTION",{enumerable:!1,configurable:!1,writable:!1,value:0});Object.defineProperty(CTATMatcher,"ACTION",{enumerable:!1,configurable:!1,writable:!1,value:1});Object.defineProperty(CTATMatcher,"INPUT",{enumerable:!1,configurable:!1,writable:!1,value:2});Object.defineProperty(CTATMatcher,"VECTOR",{enumerable:!1,configurable:!1,writable:!1,value:3});
Object.defineProperty(CTATMatcher,"ACTOR",{enumerable:!1,configurable:!1,writable:!1,value:"Actor"});CTATMatcher.prototype=Object.create(CTATBase.prototype);CTATMatcher.prototype.constructor=CTATMatcher;"undefined"!==typeof module&&(module.exports=CTATMatcher);var CTATSingleMatcher=function(b,g){CTATMatcher.call(this,!0,b,g);var f=this,e="",c="";this.lastEvaluation={match:null,studentValue:null,matcherValue:null,matcherTest:null,matchTime:null};this.getSingle=function(a){return e};this.setSingle=function(a){null===a||"undefined"===typeof a?f.ctatdebug('CTATSingleMatcher --\x3e bad argument "'+a+'" to setSingle()'):e=a};this.toString=function(){console.log("Error: CTATSingleMatcher.toString() called: should be overridden")};this.matchSingle=function(a){console.log("Error: CTATSingleMatcher.matchSingle("+
a+") called: should be overridden");return!1};this.replacementFormulaToXML=function(){return c?' replacementFormula="'+c.replaceAll(/"/g,"&quot;")+'"':""};this.getReplacementFormula=function(){return c};this.setReplacementFormula=function(a){c=a?a:""};this.evaluateReplacement=function(a,b,e){e=null;if(!c)return e;f.ctatdebug("CTATSingleMatcher.evaluateReplacement("+a+", "+b+")");var d=a.getSelection(),g=a.getAction();a=CTATVariableTable.standardizeType(a.getInput());b||(b=new CTATVariableTable);b=
new CTATFormulaParser(b);f.ctatdebug("CTATSingleMatcher calling CTATFormulaParser.evaluate("+c+", "+d+", "+g+", "+a+")");try{e=b.evaluate(c,d,g,a)}catch(p){f.ctatdebug("CTATSingleMatcher error from CTATFormulaParser.evaluate("+c+") "+p.name+": "+p.message),e=null}f.ctatdebug("CTATSingleMatcher.evaluateReplacement() returns "+e+", type "+typeof e);return e};this.getLastEvaluation=function(){return f.lastEvaluation};this.setLastEvaluation=function(a,b,c,e){f.lastEvaluation.match=a;f.lastEvaluation.studentValue=
b;f.lastEvaluation.matcherValue=c;f.lastEvaluation.matcherTest=void 0===e?null:e;f.lastEvaluation.matchTime=new Date}};CTATSingleMatcher.prototype=Object.create(CTATMatcher.prototype);CTATSingleMatcher.prototype.constructor=CTATSingleMatcher;CTATSingleMatcher.prototype.matchConcatenation=function(b){b=this.array2ConcatString(b);var g=this.matchSingle(b);this.setLastEvaluation(g,b,this.toString());return g};CTATSingleMatcher.prototype.match=function(b,g,f,e){return this.matchConcatenation(b)};
CTATSingleMatcher.prototype.setParameter=function(b,g,f){this.ctatdebug("CTATSingleMatcher.setParameter("+b+", "+g+", "+f+") calling\n  "+this.setSingle.toString());this.setSingle(b)};"undefined"!==typeof module&&(module.exports=CTATSingleMatcher);var CTATAnyMatcher=function(b,g){CTATSingleMatcher.call(this,b,!0);var f=this;this.toString=function(){return f.getSingle()};this.getSingle=function(){return"*"};this.matchSingle=function(b){return!0};this.MatcherSAItoXML=function(b){var c=b+"<matcher"+f.replacementFormulaToXML()+">\n",c=c+(b+"    <matcherType>AnyMatcher</matcherType>\n")+(b+'    <matcherParameter name="single">'+f.getSingle()+"</matcherParameter>\n");return c+(b+"</matcher>\n")}};CTATAnyMatcher.prototype=Object.create(CTATSingleMatcher.prototype);
CTATAnyMatcher.prototype.constructor=CTATAnyMatcher;"undefined"!==typeof module&&(module.exports=CTATAnyMatcher);var CTATExactMatcher=function(b,g){CTATSingleMatcher.call(this,b,!0);var f=this;this.toString=function(){return f.getSingle().toString()};this.matchSingle=function(b){var c=f.getSingle();ctatdebug("CTATExactMatcher --\x3e in matchSingle: s = "+b+", singleval = "+c+", caseInsensitive "+f.getCaseInsensitive()+", "+typeof f.getCaseInsensitive());return f.getCaseInsensitive()?String(b).toUpperCase()==String(c).toUpperCase():String(b)==String(c)};this.MatcherSAItoXML=function(b){var c=b+"<matcher"+f.replacementFormulaToXML()+
">\n",c=c+(b+"    <matcherType>ExactMatcher</matcherType>\n")+(b+'    <matcherParameter name="single"><![CDATA['+f.getSingle()+"]]\x3e</matcherParameter>\n");return c+(b+"</matcher>\n")}};CTATExactMatcher.prototype=Object.create(CTATSingleMatcher.prototype);CTATExactMatcher.prototype.constructor=CTATExactMatcher;"undefined"!==typeof module&&(module.exports=CTATExactMatcher);var CTATExpressionMatcher=function(b,g){function f(b,c,f,g,l){h=d=null;n.ctatdebug("CTATExpressionMatcher.testVector["+g+"]("+b+", "+c+", "+f+", "+l+") to call evaluate");var p=CTATVariableTable.standardizeType(f);n.ctatdebug("CTATExpressionMatcher.testVector typeof input "+typeof f+"; inputConv "+p+", typeof "+typeof p);d=n.evaluate(b,c,p,l);n.ctatdebug("CTATExpressionMatcher.testVector evaluate("+b+", "+c+", "+p+", "+l+") returned "+d+", type "+typeof d);f=null;switch(g){case CTATMatcher.SELECTION:f=
b;break;case CTATMatcher.ACTION:f=c;break;case CTATMatcher.INPUT:case CTATMatcher.NON_SINGLE:f=p}a=f;n.ctatdebug("CTATExpressionMatcher.testVector comparee "+f+", type "+typeof f+", relation "+e+"( "+CTATExpressionMatcher.RELATIONS[e]+" )");try{switch(e){case CTATExpressionMatcher.BOOL_RELATION:return!!d;case CTATExpressionMatcher.EQ_RELATION:if(null==f)return null==d;if(null==d)break;return n.compareNumberOrString(f,d,e);case CTATExpressionMatcher.NOT_EQ_RELATION:return null==f?null!=d:null==d?!0:
n.compareNumberOrString(f,d,e);case CTATExpressionMatcher.LT_RELATION:case CTATExpressionMatcher.GT_RELATION:if(null==f||null==d)break;return n.compareNumberOrString(f,d,e);case CTATExpressionMatcher.LTE_RELATION:case CTATExpressionMatcher.GTE_RELATION:if(null==f)return null==d;if(null!=d)return n.compareNumberOrString(f,d,e)}}catch(A){h=h?h:A.message}return!1}CTATSingleMatcher.call(this,b,g);var e=CTATExpressionMatcher.EQ_RELATION,e=CTATExpressionMatcher.BOOL_RELATION,c=g,a=null,d=null,h=null,l=
!1,n=this;this.getLastInput=function(){n.ctatdebug("CTATExpressionMatcher.getLastInput() returns "+a);return a};this.isEqualRelation=function(){n.ctatdebug("CTATExpressionMatcher --\x3e in isEqualRelation");return e===CTATExpressionMatcher.EQ_RELATION};this.getEvaluatedInput=function(a,b){n.ctatdebug("CTATExpressionMatcher --\x3e in getEvaluatedInput("+a+", "+b+")");var c=CTATVariableTable.standardizeType(a.getInput());a=n.evaluate(a.getSelection(),a.getAction(),c,b);n.ctatdebug("CTATExpressionMatcher.getEvaluatedInput() returns "+
a);return a};this.toString=function(){return CTATExpressionMatcher.RELATIONS[e]+' "'+c+'"'};this.MatcherSAItoXML=function(a){var b=a+"<matcher"+n.replacementFormulaToXML()+">\n",b=b+(a+"    <matcherType>ExpressionMatcher</matcherType>\n")+(a+'    <matcherParameter name="InputExpression"><![CDATA['+n.getInputExpression()+"]]\x3e</matcherParameter>\n"),b=b+(a+'    <matcherParameter name="relation"><![CDATA['+CTATExpressionMatcher.RELATIONS[e]+"]]\x3e</matcherParameter>\n");return b+(a+"</matcher>\n")};
this.matchSingle=function(a){throw new CTATExampleTracerException("UnsupportedOperationException");};this.setInputExpression=function(a){c=a};this.setRelation=function(a){e=CTATExpressionMatcher.nameToRelation(a)};this.getRelation=function(){return CTATExpressionMatcher.RELATIONS[e]};this.interpolate=function(a,b,c,d){try{h=null;var e=new CTATVariableTable;return(new CTATFormulaParser(e)).interpolate(a,b,c,d)}catch(w){return h=w.message,null}};this.evaluate=function(a,b,c,d){h=null;if("undefined"==
typeof d||null==d)d=new CTATVariableTable;n.ctatdebug("CTATExpressionMatcher.evaluate(..., vt="+d+") creating CTATFormulaParser");d=new CTATFormulaParser(d);n.ctatdebug("calling CTATFormulaParser.evaluate("+n.getInputExpression()+", "+a+", "+b+", "+c+")");try{return d.evaluate_throw(n.getInputExpression(),a,b,c)}catch(y){return n.ctatdebug("CTATExpressionMatcher --\x3e "+y.name+": "+y.message),h=y.toString(),null}};this.matchConcatenation=function(c,e,g,v){c=n.array2ConcatString(c);null===e||"undefined"===
typeof e||null===g||"undefined"===typeof g?l=f(c,null,null,b,v):(e=n.array2ConcatString(e),g=n.array2ConcatString(g),l=f(c,e,g,b,v));n.setLastEvaluation(l,a,h||d,n.getRelation());return l};this.match=function(a,b,c,d,e){return n.matchConcatenation(a,b,c,e)};this.getInputExpression=function(){return c};(function(){if(null!==g&&"undefined"!==typeof g){var a;a=g.indexOf('"');var b=g.lastIndexOf('"');0<=a&&0<=b?(a=g.substring(a+1,b),b=g.substring(0,g.indexOf(" ")),e=CTATExpressionMatcher.nameToRelation(b)):
a=g;n.setInputExpression(a)}})()};Object.defineProperty(CTATExpressionMatcher,"EQ_RELATION",{enumerable:!1,configurable:!1,writable:!1,value:0});Object.defineProperty(CTATExpressionMatcher,"LT_RELATION",{enumerable:!1,configurable:!1,writable:!1,value:1});Object.defineProperty(CTATExpressionMatcher,"GT_RELATION",{enumerable:!1,configurable:!1,writable:!1,value:2});Object.defineProperty(CTATExpressionMatcher,"NOT_EQ_RELATION",{enumerable:!1,configurable:!1,writable:!1,value:3});
Object.defineProperty(CTATExpressionMatcher,"GTE_RELATION",{enumerable:!1,configurable:!1,writable:!1,value:4});Object.defineProperty(CTATExpressionMatcher,"LTE_RELATION",{enumerable:!1,configurable:!1,writable:!1,value:5});Object.defineProperty(CTATExpressionMatcher,"BOOL_RELATION",{enumerable:!1,configurable:!1,writable:!1,value:6});Object.defineProperty(CTATExpressionMatcher,"RELATIONS",{enumerable:!1,configurable:!1,writable:!1,value:"= < > != >= <= boolean".split(" ")});
CTATExpressionMatcher.nameToRelation=function(b){for(var g=0;g<CTATExpressionMatcher.RELATIONS.length;g++)if(b==CTATExpressionMatcher.RELATIONS[g])return g;return CTATExpressionMatcher.EQ_RELATION};CTATExpressionMatcher.prototype=Object.create(CTATSingleMatcher.prototype);CTATExpressionMatcher.prototype.constructor=CTATExpressionMatcher;
CTATExpressionMatcher.prototype.setParameter=function(b,g,f){b&&g&&f&&(b=f.getNodeTextValue(b),this.ctatdebug("CTATExpressionMatcher.setParameter("+g+", "+b+")"),"InputExpression"==g?this.setInputExpression(b):"relation"==g&&this.setRelation(b))};
CTATExpressionMatcher.prototype.compareNumberOrString=function(b,g,f){b=String(b);g=String(g);var e=Number(b),c=Number(g);if(isNaN(e)||isNaN(c))switch(f){case CTATExpressionMatcher.EQ_RELATION:return b==g;case CTATExpressionMatcher.NOT_EQ_RELATION:return b!=g;case CTATExpressionMatcher.LT_RELATION:return b.toLowerCase()<g.toLowerCase();case CTATExpressionMatcher.GT_RELATION:return b.toLowerCase()>g.toLowerCase();case CTATExpressionMatcher.LTE_RELATION:return b.toLowerCase()<=g.toLowerCase();case CTATExpressionMatcher.GTE_RELATION:return b.toLowerCase()>=
g.toLowerCase();case CTATExpressionMatcher.BOOL_RELATION:return!!g;default:return!1}else switch(f){case CTATExpressionMatcher.EQ_RELATION:return e==c;case CTATExpressionMatcher.NOT_EQ_RELATION:return e!=c;case CTATExpressionMatcher.LT_RELATION:return e<c;case CTATExpressionMatcher.GT_RELATION:return e>c;case CTATExpressionMatcher.LTE_RELATION:return e<=c;case CTATExpressionMatcher.GTE_RELATION:return e>=c;case CTATExpressionMatcher.BOOL_RELATION:return!!c;default:return!1}};
"undefined"!==typeof module&&(module.exports=CTATExpressionMatcher);var CTATRangeMatcher=function(b,g){CTATSingleMatcher.call(this,b,!0);var f=this,e=0,c=0;this.toString=function(){return"[ "+e+" , "+c+" ]"};this.MatcherSAItoXML=function(a){var b=a+"<matcher"+f.replacementFormulaToXML()+">\n",b=b+(a+"    <matcherType>RangeMatcher</matcherType>\n")+(a+'    <matcherParameter name="minimum"><![CDATA['+f.getMinimum()+"]]\x3e</matcherParameter>\n"),b=b+(a+'    <matcherParameter name="maximum"><![CDATA['+f.getMaximum()+"]]\x3e</matcherParameter>\n");return b+(a+"</matcher>\n")};
this.setMinimum=function(a){try{e=parseFloat(a)}catch(d){throw new CTATExampleTracerException('Number format exception while parsing minimum value "'+a+'": '+d);}};this.getMinimum=function(){return e};this.setMaximum=function(a){try{c=parseFloat(a)}catch(d){throw new CTATExampleTracerException('Number format exception while parsing maximum value "'+a+'": '+d);}};this.getMaximum=function(){return c};this.matchSingle=function(a){var b;try{b=parseFloat(a)}catch(h){throw new CTATExampleTracerException("Number format exception while parsing .");
}return e<=b&&b<=c?!0:!1}};CTATRangeMatcher.prototype=Object.create(CTATSingleMatcher.prototype);CTATRangeMatcher.prototype.constructor=CTATRangeMatcher;CTATRangeMatcher.prototype.setParameter=function(b,g){switch((g?g:"").toString().trim().toLowerCase()){case "minimum":this.setMinimum(b);break;case "maximum":this.setMaximum(b);break;default:console.log('CTATRangeMatcher.setParameter() undefined parameter name "'+g+'"'),this.setMinimum(b),this.setMaximum(b)}};
CTATRangeMatcher.prototype.match=function(b,g,f,e){return this.matchSingle(b,g,f,e)};"undefined"!==typeof module&&(module.exports=CTATRangeMatcher);var CTATRegexMatcher=function(b,g){function f(b){null!=b&&(h=b,c=null);b=(new String(h)).valueOf();a.matchWholeString?(b.startsWith("^")||(b="^"+b),b.endsWith("$")||(b+="$")):(b.startsWith("^")&&!e.startsWith("^")&&(b=b.slice(1)),b.endsWith("$")&&!e.endsWith("$")&&(b=b.slice(0,-1)));c&&h==b||(h=b,c=a.getCaseInsensitive()?new RegExp(b,"i"):new RegExp(b));return!0}CTATSingleMatcher.call(this,b,!0);var e=null,c=null,a=this,d=a.setCaseInsensitive;this.matchWholeString=CTATRegexMatcher.getMatchWholeString();
this.toString=function(){return e};this.MatcherSAItoXML=function(b){var c=b+"<matcher"+a.replacementFormulaToXML()+">\n",c=c+(b+"    <matcherType>RegexMatcher</matcherType>\n")+(b+'    <matcherParameter name="single"><![CDATA['+a.getSinglePattern()+"]]\x3e</matcherParameter>\n");return c+(b+"</matcher>\n")};var h=null;this.setSinglePattern=function(a){return"undefined"===typeof a||null==a?(console.log("CTATRegexMatcher: null or undefined pattern"),!1):f(e=String(a))};this.getSinglePattern=function(){return e};
this.getSinglePatternObj=function(){return c};this.setCaseInsensitive=function(b){ctatdebug("CTATRegexMatcher --\x3e in setCaseInsensitive("+b+"), typeof(parentSetCaseInsensitive) "+typeof d);d(b);null!=a.getSinglePattern()&&a.setSinglePattern(a.getSinglePattern())};this.getSingle=function(){return a.getSinglePattern()};this.setSingle=function(b){a.setSinglePattern(b)};this.matchSingle=function(b){return null==b?null==a.getSingle():f()?null!=c.exec(b):(console.log("Error: CTATRegexMatcher.matchSingle called before pattern has been set"),
!1)}};CTATRegexMatcher.defaultMatchWholeString=!0;CTATRegexMatcher.getMatchWholeString=function(){return CTATRegexMatcher.defaultMatchWholeString};CTATRegexMatcher.setMatchWholeString=function(b){CTATRegexMatcher.defaultMatchWholeString=(new Boolean(b)).valueOf()};CTATRegexMatcher.prototype=Object.create(CTATSingleMatcher.prototype);CTATRegexMatcher.prototype.constructor=CTATRegexMatcher;"undefined"!==typeof module&&(module.exports=CTATRegexMatcher);var CTATWildcardMatcher=function(b,g){function f(a){if(null==a||"undefined"===typeof a)return null;var b=(new String(a)).replace(/\?/g,"."),c=b.replace(/\*/g,".*"),f="^"+c.replace(/\[\!/g,"[^")+"$";e.ctatdebug("CTATWildcardMatcher.convertToFullRegex("+a+") after qm: "+b+"; after aster: "+c+"; after negate: "+f+";");return f}CTATRegexMatcher.call(this,b,g);this.matchWholeString=!0;var e=this,c=null;this.toString=function(){return c};this.MatcherSAItoXML=function(a){var b=a+"<matcher"+e.replacementFormulaToXML()+
">\n",b=b+(a+"    <matcherType>WildcardMatcher</matcherType>\n")+(a+'    <matcherParameter name="single"><![CDATA['+e.getSingle()+"]]\x3e</matcherParameter>\n");return b+(a+"</matcher>\n")};this.getSingle=function(){return c};this.setSingle=function(a){c=a;e.setSinglePattern.call(e,f(a))};this.setSingle(g)};CTATWildcardMatcher.prototype=Object.create(CTATRegexMatcher.prototype);CTATWildcardMatcher.prototype.constructor=CTATWildcardMatcher;"undefined"!==typeof module&&(module.exports=CTATWildcardMatcher);var CTATVectorMatcher=function(b,g,f,e){function c(b,c,e,f,g){n.ctatdebug("CTATVectorMatcher --\x3e in _match("+b+", "+c+", "+e+", "+f+")");if(0===a.length||0===d.length||0===h.length)a.push(new CTATExactMatcher(CTATMatcher.SELECTION,n.array2ConcatString(n.getDefaultSelectionArray()))),d.push(new CTATExactMatcher(CTATMatcher.ACTION,n.array2ConcatString(n.getDefaultActionArray()))),h.push(new CTATExactMatcher(CTATMatcher.INPUT,n.array2ConcatString(n.getDefaultInputArray())));var p=[];p[CTATMatcher.SELECTION]=
b;p[CTATMatcher.ACTION]=c;p[CTATMatcher.INPUT]=e;for(var q=0;3>q;q++){var u=l[q][0],v=u instanceof CTATExpressionMatcher?u.matchConcatenation(b,c,e,f):u.matchConcatenation(p[q]);n.ctatdebug("CTATVectorMatcher --\x3e in _match["+q+"] after "+u+".concat returns: "+v);if(g)g.push(v);else if(!1===v)return!1}if(g)for(b=0;b<g.length;++b)if(!g[b])return!1;return!0}CTATMatcher.call(this,!0,CTATMatcher.VECTOR,!0);var a=b instanceof Array?b:[],d=g instanceof Array?g:[],h=f instanceof Array?f:[],l=[];l[CTATMatcher.SELECTION]=
a;l[CTATMatcher.ACTION]=d;l[CTATMatcher.INPUT]=h;var n=this;this.getLastEvaluation=function(){return l.map(function(a,b){return[a[0].getLastEvaluation()]})};this.match=function(a,b,d,e,f){return!1!==c(a,b,d,f)&&n.matchActor(e)?!0:!1};this.setMatcher=function(a,b){var c=Array.isArray(b)?b:[b];0<=a&&a<l.length&&c[0]instanceof CTATSingleMatcher?l[a]=c:console.error("CTATVectorMatcher.setMatcher() bad vector",a,"or matcher",b)};this.getMatchers=function(a){return l[a]};this.getTutorSAI=function(a,b,d){n.ctatdebug("CTATVectorMatcher.getTutorSAI("+
a+", vt, "+d+")");if(d&&CTATExampleTracerLink.CORRECT_ACTION.toLowerCase()==d.toLowerCase())return a;var e=[];if(c(a.getSelectionArray(),a.getActionArray(),a.getInputArray(),b,e))return d=a.clone(),a=n.evaluateReplacement(a,b,null),null!=a&&d.setInput("object"==typeof a?a.toString():a),d;d=a.clone();for(a=0;a<e.length;a++)switch(a){case CTATMatcher.SELECTION:if(e[a])continue;d.setSelection(n.getDefaultSelection());d.setSelectionArray(n.getDefaultSelectionArray());break;case CTATMatcher.ACTION:if(e[a])continue;
d.setAction(n.getDefaultAction());d.setActionArray(n.getDefaultActionArray());break;case CTATMatcher.INPUT:if(e[a])continue;d.setInput(n.getDefaultInput());d.setInputArray(n.getDefaultInputArray());break;default:console.log("CTATVectorMatcher.getTutorSAI() unexpected no. of details: "+a)}return d};this.getInputMatcher=function(){var a=h[0];return a instanceof CTATExactMatcher&&a.toString()==="".toString()?n.getDefaultInput():a.toString()};this.getActionMatcher=function(){var a=d[0];return a instanceof
CTATExactMatcher&&a.toString()==="".toString()?n.getDefaultAction():a.toString()};this.getSelectionMatcher=function(){var b=a[0];return b instanceof CTATExactMatcher&&b.toString()==="".toString()?n.getDefaultSelection():b.toString()};this.getSingleMatcher=function(b){return"selection".toString().toUpperCase()===b.toString().toUpperCase()?a[0]:"action".toString().toUpperCase()===b.toString().toUpperCase()?d[0]:h[0]};var p=n.getDefaultSAI;this.getDefaultSAI=function(){var b=p.apply(n),c=0<a.length&&
a[0]instanceof CTATExactMatcher?a[0].getSingle():b.getSelection(),e=0<d.length&&d[0]instanceof CTATExactMatcher?d[0].getSingle():b.getAction(),b=0<h.length&&h[0]instanceof CTATExactMatcher?h[0].getSingle():b.getInput();return new CTATSAI(c,e,b)};this.getSelection=function(){return 0===a.length?n.getDefaultSelection():a[0].toString()};this.getAction=function(){return 0===d.length?n.getDefaultAction():d[0].getAction()};this.setDefaultSelection=function(b){return 0===a.length?n.internalSetDefaultSelection(b):
a[0].setDefaultSelection(b)};this.setDefaultAction=function(a){return 0===d.length?n.internalSetDefaultAction(a):d[0].setDefaultAction(a)};this.setDefaultInput=function(a){return 0===h.length?n.internalSetDefaultInput(a):h[0].setDefaultInput(a)};this.getEvaluatedInput=function(a,b){if(0===h.length)return n.getInput();var c=h[0];return!1===c instanceof CTATExpressionMatcher?n.getInput():!0===c.isEqualRelation()?c.getEvaluatedInput(a,b):n.getInput()};this.matchForHint=function(b,c,d,e){ctatdebug("CTATVectorMatcher.matchForHint("+
b+", "+c+", "+d+", vt)");if(!n.matchActor(d))return!1;c=a[0];return Array.isArray(b)?c.matchConcatenation(b,n.getDefaultActionArray(),n.getDefaultInputArray(),e):c.matchConcatenation([b],n.getDefaultActionArray(),n.getDefaultInputArray(),e)};this.setCaseInsensitive=function(a){ctatdebug("CTATVectorMatcher.setCaseInsensitive("+a+")");for(var b=0;b<l.length;++b)if(Array.isArray(l[b]))for(var c=0;c<l[b].length;++c)l[b][c].setCaseInsensitive(a);else l[b]instanceof CTATMatcher&&l[b].setCaseInsensitive(a)};
this.toString=function(){return"this is CTATVectorMatcher"};this.getReplacementFormula=function(){var a=h[0];return null===a||"undefined"===typeof a?null:a.getReplacementFormula()};this.evaluateReplacement=function(a,b,c){return h[0].evaluateReplacement(a,b,c)};this.setActor(e)};CTATVectorMatcher.prototype=Object.create(CTATMatcher.prototype);CTATVectorMatcher.prototype.constructor=CTATVectorMatcher;"undefined"!==typeof module&&(module.exports=CTATVectorMatcher);var CTATExampleTracerNodeVisualData=function(){CTATBase.call(this,"ExampleTracerNodeVisualData","visualdata");var b="****",g="undefined",f=-1,e=-1,c=null;this.setID=function(a){b=a};this.getID=function(){return b};this.setLabel=function(a){g=a};this.getLabel=function(){return g};this.setX=function(a){f=a};this.getX=function(){return f};this.setY=function(a){e=a};this.getY=function(){return e};this.setVizReference=function(a){c=a};this.getVizReference=function(){return c}};
CTATExampleTracerNodeVisualData.prototype=Object.create(CTATBase.prototype);CTATExampleTracerNodeVisualData.prototype.constructor=CTATExampleTracerNodeVisualData;"undefined"!==typeof module&&(module.exports=CTATExampleTracerNodeVisualData);var CTATExampleTracerNode=function(b,g){CTATBase.call(this,"CTATExampleTracerNode",b);var f=null,e={x:1,y:1},c="",a=g?g:new Set,d=new Set;a.forEach(function(a,b,c){b.isCorrect()&&d.add(b)});var h=new Set,l=!1,n=this;this.toString=function(){return"node"+b};this.toXML=function(a){var b=a+'<node locked="'+this.getLocked()+'" doneState="'+this.IsDoneState()+'">\n',b=b+(a+"    <text>"+this.getNodeName()+"</text>\n"),b=b+(a+"    <uniqueID>"+this.getNodeID()+"</uniqueID>\n"),c=this.getDimension(),d=a+"    ",
e;e=d+"<dimension>\n"+(d+"    <x>"+c.x+"</x>\n");e+=d+"    <y>"+c.y+"</y>\n";return b+(e+(d+"</dimension>")+"\n")+(a+"</node>")};this.getNodeID=function(){return b};this.getLocked=function(){return!1};this.IsDoneState=function(){return this.getNodeName().startsWith("Done")?!0:l};this.setDoneState=function(a){l=a};this.getDimension=function(){return e};this.setDimension=function(a){a&&"object"==typeof a&&(e.x=Math.floor(a.x||0),e.y=Math.floor(a.y||0))};this.getNodeName=function(){return c};this.setNodeName=
function(a){n.ctatdebug("CTATExampleTracerGraph --\x3e in setNodeName("+a+")");c=a};this.getOutLinks=function(){ctatdebug("CTATExampleTracerNode --\x3e getOutLinks");return a};this.getCorrectOutLinks=function(){return d};this.addOutLink=function(b,c){ctatdebug("CTATExampleTracerNode --\x3e addOutLink( "+b+" )");a.add(b);b.isCorrect()&&(d.add(b),!1!==c&&b.setIsPreferredLink(1==d.size))};this.deleteOutLink=function(b,c){ctatdebug("CTATExampleTracerNode --\x3e deleteOutLink( "+b+" )");a.delete(b);b.isCorrect()&&
(d.delete(b),!1!==c&&b.getIsPreferredLink()&&0<d.size&&d.values().next().value.setIsPreferredLink(!0))};this.clearInLinks=function(){h=new Set};this.addInLink=function(a){h.add(a)};this.deleteInLink=function(a){h.delete(a)};this.getInLinks=function(){return h};this.getOutDegree=function(){return a.size};this.getCorrectOutDegree=function(){return d.size};this.getTraversableOutDegree=function(){var b=0;a.forEach(function(a){return a.isTraversable()&&++b});return b};this.setVisualData=function(a){f=
a};this.getVisualData=function(){return f}};CTATExampleTracerNode.prototype=Object.create(CTATBase.prototype);CTATExampleTracerNode.prototype.constructor=CTATExampleTracerNode;"undefined"!==typeof module&&(module.exports=CTATExampleTracerNode);var CTATExampleTracerLinkVisualData=function(){CTATBase.call(this,"CTATExampleTracerLinkVisualData","visualdata");var b="****",g="undefined",f="****",e="****";this.setID=function(c){b=c};this.getID=function(){return b};this.setLabel=function(b){g=b};this.getLabel=function(){return g};this.setSource=function(b){f=b};this.getSource=function(){return f};this.setDestination=function(b){e=b};this.getDestination=function(){return e}};CTATExampleTracerLinkVisualData.prototype=Object.create(CTATBase.prototype);
CTATExampleTracerLinkVisualData.prototype.constructor=CTATExampleTracerLinkVisualData;"undefined"!==typeof module&&(module.exports=CTATExampleTracerLinkVisualData);var CTATExampleTracerLink=function(b,g,f){function e(a){var b=x.getMatcher().getMatchers(0)[0],c=x.getMatcher().getMatchers(1)[0],d=x.getMatcher().getMatchers(2)[0],b=a+'<matchers Concatenation="true">\n'+(a+"    <Selection>\n")+b.MatcherSAItoXML(a+"        "),b=b+(a+"    </Selection>\n")+(a+"    <Action>\n")+c.MatcherSAItoXML(a+"        "),b=b+(a+"    </Action>\n")+(a+"    <Input>\n")+d.MatcherSAItoXML(a+"        "),b=b+(a+"    </Input>\n")+(a+'    <Actor linkTriggered="'+x.getMatcher().isLinkTriggered()+
'">'+x.getMatcher().getActor()+"</Actor>\n");return b+(a+"</matchers>\n")}CTATBase.call(this,"CTATExampleTracerLink","("+g+"-"+f+")");var c="undefined"===typeof b||null===b?null:b,a=null,d="",h="",l="undefined"===typeof g||null===g?null:g,n="undefined"===typeof f||null===f?null:f,p=null,q=1,u=1,v=CTATExampleTracerLink.CORRECT_ACTION,y=[],w=!1,A=[],z=[],C=u.toString(),D=q.toString(),F=null,G=null,x=this;this.logger=new CTATLogger(["link","skills","trace"]);this.log=x.logger.log;this.getUniqueID=function(){return c};
this.getMatcher=function(){x.ctatdebug("CTATExampleTracerLink --\x3e in getMatcher");return p};this.isCorrect=function(){return v==CTATExampleTracerLink.CORRECT_ACTION};this.matchesSAI=function(a,b,c){var d=x.getMatcher();x.ctatdebug("CTATExampleTracerLink --\x3e in matchesSAI(); matcher "+d+", typeof "+typeof d+", sai "+a);a=d.match(a.getSelectionArray(),a.getActionArray(),a.getInputArray(),b,c);x.ctatdebug("CTATExampleTracerLink --\x3e out of matchesSAI: result = "+a);return a};this.matchesSAIforHint=
function(a,b,c,d){x.ctatdebug("CTATExampleTracerLink --\x3e in matchesSAIforHint("+a+", "+b+") selectionArray "+a.getSelectionArray());if(!1===x.getMatcher().matchForHint(a.getSelectionArray(),a.getActionArray(),b,d))return x.ctatdebug("CTATExampleTracerLink --\x3e matchesSAIforHint() returning false because no match"),!1;if(null!==c&&"undefined"!==typeof c&&!0===c.getWantReportableHints()&&(a=null===x.getAllHints()||"undefined"===typeof x.getAllHints()?0:x.getAllHints().length,1>a))return x.ctatdebug("CTATExampleTracerLink --\x3e matchesSAIforHint() returning false nStaticHints "+
a+"< 1"),!1;x.ctatdebug("CTATExampleTracerLink --\x3e matchesSAIforHint() returning true");return!0};this.getDepth=function(){return a};this.getBuggyMsg=function(a){null==a&&(a=0);return z[a]||""};this.getBuggyMsgs=function(){return z||[]};this.getSuccessMsg=function(a){null==a&&(a=0);return A[a]||""};this.getSuccessMsgs=function(){return A||[]};this.getType=function(){return v};this.getPrevNode=function(){return l};this.getNextNode=function(){return n};this.setPrevNode=function(a){l=a};this.setNextNode=
function(a){n=a};this.toString=function(){var a;a="[link "+x.getUniqueID();a+=" ("+x.getPrevNode()+"-"+x.getNextNode();a+=") "+x.getType();return a+"]"};this.toXML=function(a){var b;b=a+"    ";var c=b+'<actionLabel preferPathMark="'+x.getIsPreferredLink()+'" minTraversals="'+x.getMinTraversalsStr()+'" maxTraversals="'+x.getMaxTraversalsStr()+'">\n',c=c+(b+"    <studentHintRequest></studentHintRequest>\n")+(b+"    <stepSuccessfulCompletion></stepSuccessfulCompletion>\n")+(b+"    <stepStudentError></stepStudentError>\n")+
(b+"    <uniqueID>"+x.getUniqueID()+"</uniqueID>\n"),d=b+"    ",f="";x.getDemoMsgObj()&&(f+=d+x.getDemoMsgObj().getXMLString(!0)+"\n");c+=f;for(d=0;d<z.length;d++)c+=b+"    <buggyMessage><![CDATA["+x.getBuggyMsg(d)+"]]\x3e</buggyMessage>\n";1>z.length&&(c+=b+"    <buggyMessage></buggyMessage>\n");for(d=0;d<A.length;d++)c+=b+"    <successMessage><![CDATA["+x.getSuccessMsg(d)+"]]\x3e</successMessage>\n";1>A.length&&(c+=b+"    <successMessage></successMessage>\n");d=x.getAllHints();for(f=0;f<d.length;f++)c+=
b+"    <hintMessage><![CDATA["+d[f]+"]]\x3e</hintMessage>\n";c=c+(b+"    <callbackFn></callbackFn>\n")+(b+"    <actionType>"+x.getActionType()+"</actionType>\n");c=c+(b+"    <oldActionType>Correct Action</oldActionType>\n")+(b+"    <checkedStatus>Never Checked</checkedStatus>\n")+e(b+"    ");b=a+"<edge>\n"+(c+(b+"</actionLabel>\n"))+(a+"    <preCheckedStatus>No-Applicable</preCheckedStatus>\n");c=this.getSkillNames();d=a+"    ";f="";if(0<c.length)for(var g=0;g<c.length;g++)f+=d+"<rule>\n",f+=d+"    <text><![CDATA["+
c[g]+"]]\x3e</text>\n",f+=d+"    <indicator>-1</indicator>\n",f+=d+"</rule>\n";else f=f+(d+"<rule>\n")+(d+"    <text>unnamed</text>\n")+(d+"    <indicator>-1</indicator>\n")+(d+"</rule>\n");b=b+f+(a+"    <sourceID>"+this.getPrevNode()+"</sourceID>\n");b+=a+"    <destID>"+this.getNextNode()+"</destID>\n";return b+(a+"    <traversalCount>0</traversalCount>\n")+(a+"</edge>")};this.getDemoMsgObj=function(){return d};this.setDemoMsgObj=function(a){d=a};this.getTransactionID=function(){return h};this.setTransactionID=
function(a){h=a};this.getXMLString=function(a){if(messageObj.xml)return messageObj.xml;if(XMLSerializer)return(new XMLSerializer).serializeToString(messageObj);alert("ERROR: Extremely old browser");return""};this.getTutorSAI=function(a,b){return x.getMatcher().getTutorSAI(a,b,x.getActionType())};this.getEvaluatedInput=function(a,b){return x.getMatcher().getEvaluatedInput(a,b)};this.setDepth=function(b){a=b};this.getMaxTraversals=function(){return q};this.getMaxTraversalsStr=function(){return D};this.isDone=
function(){var a=x.getDefaultSAI().isDone();x.ctatdebug("CTATExampleTracerLink.isDone() returns "+a);return a};this.interpolateHints=function(a){x.ctatdebug("CTATExampleTracerLink --\x3e interpolateHints("+a+")");null==a&&(a=new CTATVariableTable);var b=x.getDefaultSAI(),b=new CTATSAI(b.getSelection(),b.getAction(),CTATVariableTable.standardizeType(b.getInput()));a=CTATGlobals.languageManager.interpolateStrings(y,a,b);x.ctatdebug("CTATExampleTracerLink --\x3e out of interpolateHints "+a);return a};
this.getHints=function(){x.ctatdebug("CTATExampleTracerLink --\x3e in getHints");var a=[];x.interpolateHints(null).forEach(function(b){x.ctatdebug("CTATExampleTracerLink --\x3e in getHints loop");b.toString()!=="".toString()&&a.push(b)});x.ctatdebug("CTATExampleTracerLink --\x3e out of getHints");return a};this.getAllNonEmptyHints=function(){var a=[];y.forEach(function(b){b.trim().toString()!=="".toString()&&a.push(b)});return a};this.isTraversable=function(){return 1>x.getMaxTraversals()?!1:CTATExampleTracerLink.CORRECT_ACTION.toString().toUpperCase()==
x.getActionType().toString().toUpperCase()||CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString().toUpperCase()==x.getActionType().toString().toUpperCase()?!0:!1};this.replaceInput=function(){return CTATExampleTracerLink.CORRECT_ACTION.toString().toUpperCase()!==x.getActionType().toString().toUpperCase()&&CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString().toUpperCase()!==x.getActionType().toString().toUpperCase()?!1:x.getMatcher().replaceInput()};this.evaluateReplacement=function(a,b,c){return x.getMatcher().evaluateReplacement(a,
b,c)};this.getActor=function(){return x.getMatcher().getActor()};this.getDefaultSAI=function(){x.ctatdebug(x.toString()+".getSAI(): "+(p?p.getDefaultSAI():"(matcher null)"));return p.getDefaultSAI()};this.getActionType=function(){return v};this.getMinTraversals=function(){return u};this.getMinTraversalsStr=function(){return C};this.getIsPreferredLink=function(){return w};this.getAllHints=function(){return y};this.setMatcher=function(a){p=a};this.setHints=function(a){Array.isArray(a)&&(y=a.map(function(a){return String(a)}))};
this.addHint=function(a){null!==a&&"undefined"!==typeof a&&a.toString()!=="".toString()&&y.push(a)};this.setSelection=function(a){x.getMatcher().setDefaultSelection(null===a[0]||"undefined"===typeof a[0]?"":a[0].toString())};this.setAction=function(a){x.getMatcher().setDefaultAction(null===a[0]||"undefined"===typeof a[0]?"":a[0].toString())};this.setActionType=function(a){if(null===a||"undefined"===typeof a||a.toString()!==CTATExampleTracerLink.CORRECT_ACTION.toString()&&a.toString()!==CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString()&&
a.toString()!==CTATExampleTracerLink.BUGGY_ACTION.toString()&&a.toString()!==CTATExampleTracerLink.HINT_ACTION.toString()&&a.toString()!==CTATExampleTracerLink.UNTRACEABLE_ERROR.toString()&&a.toString()!==CTATExampleTracerLink.CLT_ERROR_ACTION.toString()&&a.toString()!==CTATExampleTracerLink.GIVEN_ACTION.toString())throw new CTATExampleTracerException("invalid action type "+v);v=a};this.setBuggyMsg=this.setBuggyMsgs=function(a){z=a instanceof Array?a:[String(a)]};this.addBuggyMsg=function(a){(a=String(a))&&
z.push(a)};this.setSuccessMsg=this.setSuccessMsgs=function(a){A=a instanceof Array?a:[String(a)]};this.addSuccessMsg=function(a){(a=String(a))&&A.push(a)};this.setMinTraversalsStr=function(a){if(null===a||"undefined"===typeof a||1>a.length)C="1",u=1;else try{C=a,u=parseInt(a.trim()),isNaN(u)&&(u=1)}catch(K){u=1}};this.setMaxTraversalsStr=function(a){if(null===a||"undefined"===typeof a||1>a.length)D=C,q=u;else try{D=a,q=parseInt(a.trim()),isNaN(q)&&(q=1)}catch(K){q=u}};this.setUniqueID=function(a){c=
a};this.deleteSkillName=function(a,b){var c=[];if(a&&"unnamed"!=a&&null!=G){var d=G.findIndex(function(b){return b==a});-1<d&&(c=G.splice(d,1),b?b.deleteSkill(a):x.log("skills","link "+x.getUniqueID()+".deleteSkillName("+a+") missing tracer argument"))}return 0<c.length?c[0]:""};this.addSkill=function(a,b,c,d){a=x.addSkillName(CTATExampleTracerSkill.makeKey(a,b),d);a.setLabel(c);return a};this.addSkillName=function(a,b){x.ctatdebug("ETLink["+c+"].addSkillName("+a+")");"unnamed"!==a&&(null==G&&(G=
[]),G.includes(a)||(b=b?b.addSkill(a):x.log("skills","link "+x.getUniqueID()+".addSkillName("+a+") missing tracer argument"),b instanceof CTATExampleTracerSkill&&1>b.getOpportunityCount()&&b.setOpportunityCount(1),G.push(a)));return null};this.getSkill=function(a,b){var c=CTATExampleTracerSkill.makeKey(a,b);return x.getSkills().find(function(a){return a==c})};this.getSkills=function(a){return x.getSkillNames().map(function(b){return a.getSkill(b)})};this.getSkillNames=function(){if(null===G||"undefined"===
typeof G)G=[];return G};this.isTutorPerformed=function(a){if(CTATExampleTracerLink.CORRECT_ACTION.toUpperCase()!==x.getActionType().toUpperCase())return!1;var b=x.getMatcher();if(null===b||"undefined"===typeof b||null!==a&&"undefined"!==typeof a&&a!==b.isLinkTriggered())return!1;a=x.getActor();return CTATMatcher.isTutorActor(a,!0)?!0:!1};this.setIsPreferredLink=function(a){x.ctatdebug("ETLink.setIsPreferredLink() was "+w+", now "+a);w=a};this.getGroups=function(a,b,c){b=b||a.getGraph().getGroupModel().getTopLevelGroup();
c=c||[];b.getLinks().has(x)&&(c.push(b),b.getSubgroups().forEach(function(b){return x.getGroups(a,b,c)}));return c};this.getGroupNames=function(a,b,c){b=b||a.getGraph().getGroupModel().getTopLevelGroup();c=c||[];b.getLinks().has(x)&&(c.push(b.getName()),b.getSubgroups().forEach(function(b){return x.getGroupNames(a,b,c)}));return c};this.copyContent=function(a){x.getSkillNames().forEach(function(b){return a.addSkillName(b)});a.setMinTraversalsStr(x.getMinTraversalsStr());a.setMaxTraversalsStr(x.getMaxTraversalsStr());
var b=new CTATXML,c=new CTATMessage(b.parse(x.getDemoMsgObj().getXMLString()));a.setDemoMsgObj(c);a.setActionType(x.getActionType());a.setBuggyMsgs(x.getBuggyMsgs().slice());a.setSuccessMsgs(x.getSuccessMsgs().slice());a.setHints(x.getAllHints().slice());a.setMatcher(CTATExampleTracerLink.matchersFromXML(b.parse(e("")),c.getSAI(),x.getMatcher().getCaseInsensitive()));return a};this.setVisualData=function(a){F=a};this.getVisualData=function(){return F}};
CTATExampleTracerLink.matchersFromXML=function(b,g,f){function e(a,b){a=c.getElementChildren(a);for(var d=[],e=0;e<a.length;e++)if("matcher"===c.getElementName(a[e])){for(var f=null,g=c.getElementAttr(a[e],"replacementFormula"),h=c.getElementChildren(a[e]),n=0;n<h.length;n++){if("matcherType"===c.getElementName(h[n]))switch(f=c.getNodeTextValue(h[n]),f){case "ExactMatcher":f=new CTATExactMatcher(b,null);break;case "RegexMatcher":f=new CTATRegexMatcher(b,null);break;case "AnyMatcher":f=new CTATAnyMatcher(b,
null);break;case "RangeMatcher":f=new CTATRangeMatcher(b,null);break;case "WildcardMatcher":f=new CTATWildcardMatcher(b,null);break;case "ExpressionMatcher":f=new CTATExpressionMatcher(b,null);break;default:console.log("CTATGraphParser.processMatchers() unknown matcherType["+n+"] = "+f+"; using CTATExactMatcher"),f=new CTATExactMatcher(b,null)}if("matcherParameter"===c.getElementName(h[n])){var p=c.getElementAttr(h[n],"name");"single"===p?f.setParameter(c.getNodeTextValue(h[n])):"minimum"===p?f.setParameter(c.getNodeTextValue(h[n]),
"minimum"):"maximum"===p?f.setParameter(c.getNodeTextValue(h[n]),"maximum"):f.setParameter(h[n],p,c)}}f&&f.setReplacementFormula(g);d.push(f)}return d}var c=new CTATXML,a,d,h,l=CTATMsgType.DEFAULT_ACTOR,n=!1;b=c.getElementChildren(b);for(var p=0;p<b.length;p++)"Selection"===c.getElementName(b[p])&&(a=e(b[p],0)),"Action"===c.getElementName(b[p])&&(d=e(b[p],1)),"Input"===c.getElementName(b[p])&&(h=e(b[p],2)),"Actor"===c.getElementName(b[p])&&(l=c.getNodeTextValue(b[p]),n=(n=c.getElementAttr(b[p],"linkTriggered"))&&
"false"!=n.toLowerCase().trim()?!0:!1);a=new CTATVectorMatcher(a,d,h,l);void 0!==f&&a.setCaseInsensitive(!!f);g&&a.setDefaultSAI(g);a.setCaseInsensitive(f);a.setLinkTriggered(n);return a};
CTATExampleTracerLink.compareLinkTypes=function(b,g){ctatdebug("CTATExampleTracerLink --\x3e in compareLinkTypes("+b+", "+g+")");return null===b||"undefined"===typeof b?null===g||"undefined"===typeof g?0:1:null===g||"undefined"===typeof g?-1:b.toString()===g.toString()?0:b.toString()===CTATExampleTracerLink.CORRECT_ACTION.toString()?-1:g.toString()===CTATExampleTracerLink.CORRECT_ACTION.toString()?1:b.toString()===CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString()?-1:g.toString()===CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString()?
1:b.toString()===CTATExampleTracerLink.BUGGY_ACTION.toString()?-1:g.toString()===CTATExampleTracerLink.BUGGY_ACTION.toString()?1:0};Object.defineProperty(CTATExampleTracerLink,"BUGGY_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"Buggy Action"});Object.defineProperty(CTATExampleTracerLink,"FIREABLE_BUGGY_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"Fireable Buggy Action"});
Object.defineProperty(CTATExampleTracerLink,"CORRECT_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"Correct Action"});Object.defineProperty(CTATExampleTracerLink,"NO_MODEL",{enumerable:!1,configurable:!1,writable:!1,value:"NO-MODEL"});Object.defineProperty(CTATExampleTracerLink,"HINT_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"Hint Action"});Object.defineProperty(CTATExampleTracerLink,"UNTRACEABLE_ERROR",{enumerable:!1,configurable:!1,writable:!1,value:"Untraceable Error"});
Object.defineProperty(CTATExampleTracerLink,"CLT_ERROR_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"Error Action"});Object.defineProperty(CTATExampleTracerLink,"GIVEN_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"Given Action"});Object.defineProperty(CTATExampleTracerLink,"SUCCESS",{enumerable:!1,configurable:!1,writable:!1,value:"SUCCESS"});
CTATExampleTracerLink.createDefaultHint=function(b,g,f){b=CTATGlobals.languageManager;g=String(g);f=f&&"function"==typeof f.toString?f.toString():String(f);return/UpdateText/i.test(g)?b.getString("DEFAULT_HINT_PREFIX_TEXT")+f+b.getString("DEFAULT_HINT_SUFFIX_TEXT"):/Combo/i.test(g)?b.getString("DEFAULT_HINT_PREFIX_SELECT")+f+b.getString("DEFAULT_HINT_SUFFIX_SELECT"):/Button/i.test(g)?b.getString("DEFAULT_HINT_BUTTON"):b.getString("DEFAULT_HINT_PREFIX")+f+b.getString("DEFAULT_HINT_SUFFIX")};
CTATExampleTracerLink.prototype=Object.create(CTATBase.prototype);CTATExampleTracerLink.prototype.constructor=CTATExampleTracerLink;"undefined"!==typeof module&&(module.exports=CTATExampleTracerLink);var CTATExampleTracerPathComparator=function(){CTATBase.call(this,"CTATExampleTracerPathComparator","");var b=this;this.compare=function(g,f){b.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare");b.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p1.isDonePath(): "+(g&&g.isDonePath()));b.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p2.isDonePath(): "+(f&&f.isDonePath()));if(g&&!f)return-1;if(!g&&f)return 1;if(!0===g.isDonePath()&&!1===f.isDonePath())return-1;
if(!0===f.isDonePath()&&!1===g.isDonePath())return 1;b.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p2.isIncorrectPath(): "+f.isIncorrectPath());b.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p1.isIncorrectPath()(): "+g.isIncorrectPath());if(!0===f.isIncorrectPath()&&!1===g.isIncorrectPath())return-1;if(!0===g.isIncorrectPath()&&!1===f.isIncorrectPath())return 1;b.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p1.getNumberOfPreferredPrefixLinks(): "+g.getNumberOfPreferredPrefixLinks());
b.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p2.getNumberOfPreferredPrefixLinks(): "+f.getNumberOfPreferredPrefixLinks());var e=g.getNumberOfPreferredPrefixLinks(),c=f.getNumberOfPreferredPrefixLinks();if(e>c)return-1;if(e<c)return 1;b.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p1.getNumberOfSuboptimalLinks(): "+g.getNumberOfSuboptimalLinks());b.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p2.getNumberOfSuboptimalLinks(): "+f.getNumberOfSuboptimalLinks());
e=g.getNumberOfSuboptimalLinks();c=f.getNumberOfSuboptimalLinks();if(e<c)return-1;if(e>c)return 1;b.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p1.getNumberOfPreferredLinks(): "+g.getNumberOfPreferredLinks());b.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p2.getNumberOfPreferredLinks(): "+f.getNumberOfPreferredLinks());e=g.getNumberOfPreferredLinks();c=f.getNumberOfPreferredLinks();if(e>c)return-1;if(e<c)return 1;e=g.getLinks().size;c=f.getLinks().size;b.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p1.getLinks().size: "+
e);b.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p1.getLinks().size: "+c);if(e<c)return-1;if(e>c)return 1;b.ctatdebug("CTATExampleTracerPathComparator --\x3e out of comapre, about to call breakByLowerLinkID");return b.breakByLowerLinkID(g,f)};this.breakByLowerLinkID=function(g,f){b.ctatdebug("CTATExampleTracerPathComparator --\x3e in breakByLowerLinkID");g=g.getSortedLinks();f=f.getSortedLinks();var e=null,c=null,a=0,d=0;do b.ctatdebug("CTATExampleTracerPathComparator --\x3e in breakByLowerLinkID in do while"),
d>=g.length?(b.ctatdebug("CTATExampleTracerPathComparator --\x3e in breakByLowerLinkID path 1 is shorter"),a=-1):d>=f.length?(b.ctatdebug("CTATExampleTracerPathComparator --\x3e in breakByLowerLinkID path 2 is shorter"),a=1):(b.ctatdebug("CTATExampleTracerPathComparator --\x3e in breakByLowerLinkID path are same, compare IDS"),e=g[d],c=f[d]),d++;while(0===a&&e.getUniqueID()===c.getUniqueID());0===a&&(b.ctatdebug("CTATExampleTracerPathComparator --\x3e in breakByLowerLinkID result is zero: "+e.getUniqueID()),
b.ctatdebug("CTATExampleTracerPathComparator --\x3e in breakByLowerLinkID result is zero: "+c.getUniqueID()),a=e.getUniqueID()<c.getUniqueID()?-1:1);return a}};CTATExampleTracerPathComparator.prototype=Object.create(CTATBase.prototype);CTATExampleTracerPathComparator.prototype.constructor=CTATExampleTracerPathComparator;"undefined"!==typeof module&&(module.exports=CTATExampleTracerPathComparator);var CTATExampleTracerPath=function(b){CTATBase.call(this,"CTATExampleTracerPath","");var g=new Set;"undefined"!==typeof b&&null!==b&&b.forEach(function(a){ctatdebug("CTATExampleTracerPath --\x3e in constructor building links with "+a);g.add(a)});var f=null,e=null,c=null,a=null,d=null,h=null,l=this;this.isIncorrectPath=function(){ctatdebug("CTATExampleTracerPath --\x3e in isIncorrectPath");if(null!==h&&"undefined"!==typeof h)return h;var a=!1;l.getLinks().forEach(function(b){!0!==a&&b.getType().toString()===
CTATExampleTracerLink.BUGGY_ACTION.toString()&&(a=h=!0)});if(!0===a)return!0;h=!1;ctatdebug("CTATExampleTracerPath --\x3e out of isIncorrectPath");return!1};this.getNumberOfSuboptimalLinks=function(){ctatdebug("CTATExampleTracerPath --\x3e in getNumberOfSuboptimalLinks");l.getSortedLinks();if(null!==a&&"undefined"!==typeof a)return a;var b=0;l.getLinks().forEach(function(a){CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString()===a.getType().toString()&&b++});a=b;ctatdebug("CTATExampleTracerPath --\x3e out of getNumberOfSuboptimalLinks");
return b};this.getNumberOfPreferredPrefixLinks=function(){ctatdebug("CTATExampleTracerPath --\x3e in getNumberOfPreferredPrefixLinks");if(null!==e&&"undefined"!==typeof e)return e;var a=0,b=!1;l.getSortedLinks().forEach(function(c){!0!==b&&(!0===c.getIsPreferredLink()?a++:b=!0)});e=a;ctatdebug("CTATExampleTracerPath --\x3e out of getNumberOfPreferredPrefixLinks");return a};this.size=function(){return g.size};this.containsAll=function(a){var b=!0;if(a)for(var c=0;b&&c<a.length;++c)b=l.getLinks().has(a[c]);
l.ctatdebug("CTATExampleTracerPath containsAll(testLinks.length "+a.length+") returning "+b);return b};this.getLinksRestricted=function(a){ctatdebug("CTATExampleTracerPath --\x3e in getLinksRestricted "+(a&&a.length));var b=CTATExampleTracerPath.getDeepestLink(a),c=new Set;g.forEach(function(a){a.getDepth()<=b.getDepth()&&c.add(a)});ctatdebug("CTATExampleTracerPath --\x3e out of getLinksRestricted "+c.size);return c};this.getLinks=function(){ctatdebug("CTATExampleTracerPath --\x3e in getLinks");return g};
this.getSortedLinks=function(){ctatdebug("CTATExampleTracerPath --\x3e in getSortedLinks that.getLinks(): "+l.getLinks());f=[];l.getLinks().forEach(function(a){f.push(a)});ctatdebug("CTATExampleTracerPath --\x3e in getSortedLinks sortedLinks.length(): "+f.length);f.sort(function(a,b){return a.getDepth()-b.getDepth()});ctatdebug("CTATExampleTracerPath --\x3e out of getSortedLinks, returning "+f);return f};this.isDonePath=function(){ctatdebug("CTATExampleTracerPath --\x3e in isDonePath");if(null!==
d&&"undefined"!==typeof d)return d;var a=!1;l.getLinks().forEach(function(b){!0!==a&&!0===b.isDone()&&(a=d=!0)});if(!0===a)return!0;d=!1;ctatdebug("CTATExampleTracerPath --\x3e out of isDonePath");return!1};this.addLink=function(b){ctatdebug("CTATExampleTracerPath --\x3e in addLink ("+b+")");g.add(b);h=d=a=c=e=f=null;ctatdebug("CTATExampleTracerPath --\x3e out of addLink")};this.getNumberOfPreferredLinks=function(){ctatdebug("CTATExampleTracerPath --\x3e in getNumberOfPreferredLinks");if(null!==c&&
"undefined"!==typeof c)return c;var a=0;l.getLinks().forEach(function(b){!0===b.getIsPreferredLink()&&a++});c=a;ctatdebug("CTATExampleTracerPath --\x3e out of getNumberOfPreferredLinks");return a};this.subpath=function(a){for(var b=new CTATExampleTracerPath,c=l.getSortedLinks(),d=0;d<c.length;++d)if(b.addLink(c[d]),c[d].getNextNode()==a.getNodeID())return b;return null};this.toString=function(){var a="CTATExampleTracerPath: links";l.getSortedLinks().forEach(function(b){a+=" "+b});return a};CTATExampleTracerPath.getDeepestLink=
function(a){ctatdebug("CTATExampleTracerPath --\x3e in getDeepestLink "+(a&&a.length));var b=null;a.forEach(function(a){if(null===b||"undefined"===typeof b||b.getDepth()<a.getDepth())b=a});ctatdebug("CTATExampleTracerPath --\x3e out of getDeepestLink "+b);return b};CTATExampleTracerPath.getBestPath=function(a){ctatdebug("CTATExampleTracerPath --\x3e in getBestPath");var b=null,c=new CTATExampleTracerPathComparator;a.forEach(function(a){ctatdebug("CTATExampleTracerPath --\x3e in getBestPath loop");
if(null===b||"undefined"===typeof b||0<c.compare(b,a))b=a});ctatdebug("CTATExampleTracerPath --\x3e out of getBestPath");return b}};CTATExampleTracerPath.prototype=Object.create(CTATBase.prototype);CTATExampleTracerPath.prototype.constructor=CTATExampleTracerPath;"undefined"!==typeof module&&(module.exports=CTATExampleTracerPath);var CTATLinkGroup=function(){CTATBase.call(this,"CTATLinkGroup","")};CTATLinkGroup.prototype=Object.create(CTATBase.prototype);CTATLinkGroup.prototype.constructor=CTATLinkGroup;"undefined"!==typeof module&&(module.exports=CTATLinkGroup);var CTATDefaultLinkGroup=function(b,g,f,e){CTATLinkGroup.call(this,"CTATDefaultLinkGroup",b);var c=b,a=g,d=f,h=new Set;null!==e&&"undefined"!==typeof e&&e.forEach(function(a){h.add(a)});var l=new Set,n=null,p=null,q=this;q.ctatdebug("CTATDefaultLinkGroup constructor group name: "+b);q.ctatdebug("CTATDefaultLinkGroup constructor group isOrdered: "+g);q.ctatdebug("CTATDefaultLinkGroup constructor group isReenterable: "+f);this.toXML=function(a,b){var c=a+'<group name="'+q.getName(),c=c+('" ordered="'+
q.getIsOrdered()),c=c+('" reenterable="'+q.getIsReenterable()+'">\n');b.getUniqueLinks(q).forEach(function(b){c+=a+'    <link id="'+b.getUniqueID()+'"/>\n'});l.forEach(function(d){c+=d.toXML(a+"    ",b)});return c+=a+"</group>\n"};this.setOrdered=function(b){q.ctatdebug("CTATDefaultLinkGroup --\x3e in setOrdered group name: "+c);q.ctatdebug("CTATDefaultLinkGroup --\x3e in setOrdered:: "+b);a=b};this.setName=function(a){q.ctatdebug("CTATDefaultLinkGroup --\x3e in setName: "+a);c=a};this.containsLink=
function(a){q.ctatdebug("CTATDefaultLinkGroup --\x3e in containsLink: "+a.getUniqueID());return h.has(a)};this.removeLink=function(a){q.ctatdebug("CTATDefaultLinkGroup --\x3e in removeLink: "+a.getUniqueID());return h.delete(a)};this.removeSubgroup=function(a){q.ctatdebug("CTATDefaultLinkGroup.removeSubgroup: "+(grp&&grp.getName()));return l.delete(a)};this.getParent=function(){q.ctatdebug("CTATDefaultLinkGroup --\x3e in getParent");return n};this.addLink=function(a){q.ctatdebug("CTATDefaultLinkGroup --\x3e in addLink: "+
a.getUniqueID());h.add(a)};this.getIsOrdered=function(){q.ctatdebug("CTATDefaultLinkGroup --\x3e in getIsOrdered: "+a);return a};this.getIsReenterable=function(){q.ctatdebug("CTATDefaultLinkGroup --\x3e in getIsReenterable: "+d);return d};this.getSubgroups=function(){q.ctatdebug("CTATDefaultLinkGroup --\x3e in getSubgroups");return l};this.setSubgroups=function(a){l=a};this.getLinks=function(){q.ctatdebug("CTATDefaultLinkGroup --\x3e in getLinks");return h};this.setReenterable=function(a){q.ctatdebug("CTATDefaultLinkGroup --\x3e in setReenterable: "+
a);d=a};this.setParent=function(a){q.ctatdebug("CTATDefaultLinkGroup --\x3e in setParent: "+a.getName());n=a};this.addSubgroup=function(a){q.ctatdebug("CTATDefaultLinkGroup --\x3e in addSubgroup groupName: "+a.getName());l.add(a)};this.getName=function(){return c};this.getDefaultBuggyMsg=function(){return p};this.setDefaultBuggyMsg=function(a){p=""==a?null:a};this.toString=function(){return"Group Name: "+this.getName()}};CTATDefaultLinkGroup.prototype=Object.create(CTATLinkGroup.prototype);
CTATDefaultLinkGroup.prototype.constructor=CTATDefaultLinkGroup;"undefined"!==typeof module&&(module.exports=CTATDefaultLinkGroup);var InternalGroupIterator=function(b,g){CTATBase.call(this,"InternalGroupIterator",b);var f=this,e=g.length,c=[],a=0;b.getSubgroups().forEach(function(a){a&&c.push(a)});g.push(f);f.ctatdebug("InternalGroupIterator() constructor group "+b+", stack.length "+g.length+", sgList.length "+c.length);this.toString=function(){return"{"+b+" at "+e+" with "+c.length+" subgroups}"};this.next=function(){return a>=c.length?(g.pop(),f.ctatdebug("InternalGroupIterator at deepest next() returning "+b+" with stack.length "+
g.length),{value:b,done:!1}):(new InternalGroupIterator(c[a++],g)).next()}};InternalGroupIterator.prototype=Object.create(CTATBase.prototype);InternalGroupIterator.prototype.constructor=InternalGroupIterator;var CTATGroupIterator=function(b){CTATBase.call(this,"CTATGroupIterator",b);this.ctatdebug("CTATGroupIterator("+b+") begin constructor");var g=null;this.next=function(){null===g&&(g=[],new InternalGroupIterator(b,g));return 0>=g.length?{value:null,done:!0}:g[g.length-1].next()}};
CTATGroupIterator.prototype=Object.create(CTATBase.prototype);CTATGroupIterator.prototype.constructor=CTATGroupIterator;"undefined"!==typeof module&&(module.exports=CTATGroupIterator);var CTATGroupModel=function(){CTATBase.call(this,"CTATGroupModel","");var b=this;this.clear=function(){};this.setDefaultReenterable=function(b){};this.setGroupOrdered=function(b,f){};this.getTopLevelGroup=function(){};this.setGroupName=function(b,f){};this.addLinkToGroup=function(b,f){};this.isGroupOrdered=function(b){};this.isGroupReenterable=function(b){};this.isLinkInGroup=function(){};this.getGroupsContainingLink=function(b){};this.getGroupLinkCount=function(g){return b.getGroupLinks(g).size};
this.getLowestLevelGroupOfLink=function(b){};this.getGroupSubgroups=function(b){};this.getUniqueLinks=function(b){};this.getGroupLinks=function(b){};this.removeLinkFromGroup=function(b,f){};this.getGroupParent=function(b){};this.addGroup=function(b,f,e){};this.setGroupReenterable=function(b,f){}};CTATGroupModel.prototype=Object.create(CTATBase.prototype);CTATGroupModel.prototype.constructor=CTATGroupModel;"undefined"!==typeof module&&(module.exports=CTATGroupModel);var CTATDefaultGroupModel=function(){function b(a,d){var e=a.containsLink(d);q.ctatdebug("removeLinkUpdateGroups(G="+group.getName()+",L="+d.getUniqueID()+") hasLink "+e);if(e){var h=[];q.getGroupSubgroups(a).forEach(function(a){b(a,d);1>a.getLinks().size&&h.push(a)});h.forEach(function(a){return f(a)});c(a,d)||console.log("removeLinkUpdateGroups(G="+a.getName()+",L="+d.getUniqueID()+") link not found on delete");1>a.getLinks().size&&g(a)}}function g(a){a=new GroupIterator(group);var b=[];for(a.next();a.hasNext();)b.add(a.next());
group.removeAllSubGroups()}function f(a){var b=a.getParent();b&&((new Set(a.getSubgroups())).forEach(function(a){return l(b,a)}),b.removeSubgroup(a))}function e(a,b,d){q.ctatdebug("CTATDefaultGroupModel --\x3e in internalRemoveLinkFromGroupRecursive");!0===a.containsLink(b)&&(q.getGroupSubgroups(a).forEach(function(a){q.removeLinkFromGroup(a,b)}),(a!==n||d)&&c(a,b))}function c(a,b){q.ctatdebug("CTATDefaultGroupModel --\x3e in internalRemoveLinkFromGroup");return a.removeLink(b)}function a(b,c){q.ctatdebug("CTATDefaultGroupModel --\x3e in getImmediateGroupOfLink");
var d=null,e=!1,f=null;q.getGroupSubgroups(c).forEach(function(c){!0!==e&&!0===q.isLinkInGroup(c,b)&&(d=a(b,c),f=null!==d&&"undefined"!==typeof d?d:c,e=!0)});return!0===e?f:null}function d(a,b){q.logger.log("groups","CTATDefaultGroupModel.getNaturalContainingGroup(",a,b,")");if(b.size===q.getGroupLinks(a).size){q.getGroupLinks(a).forEach(function(c){if(!1===b.has(c))throw c="Invalid link selection: Partial overlap with existing group: "+a,q.logger.log("groups","CTATDefaultGroupModel.getNaturalContainingGroup",
c),new CTATExampleTracerException(c);});var c="Group containing this set of links already exists: "+a;q.logger.log("groups","CTATDefaultGroupModel.getNaturalContainingGroup",c);throw new CTATExampleTracerException(c);}if(b.size>=q.getGroupLinks(a).size)throw c="Invalid link selection: Partial overlap with existing group: "+a,q.logger.log("groups","CTATDefaultGroupModel.getNaturalContainingGroup",c),new CTATExampleTracerException(c);var e=!1,f=null;b.forEach(function(c){if(!0!==e){if(!1===q.isLinkInGroup(a,
c))throw new CTATExampleTracerException("Invalid link selection: Partial overlap with existing group: "+a);q.getGroupSubgroups(a).forEach(function(g){!0!==e&&!0===q.isLinkInGroup(g,c)&&(q.getGroupLinkCount(g)>=b.size?(f=d(g,b),e=!0):q.getGroupLinks(g).forEach(function(c){if(!1===b.has(c))throw new CTATExampleTracerException("Invalid link selection: Partial overlap with existing group: "+a);}))})}});return!0===e?f:a}function h(a,b){q.ctatdebug("CTATDefaultGroupModel --\x3e in addSubgroupPreserveSanity parent: "+
a.getName());q.ctatdebug("CTATDefaultGroupModel --\x3e in addSubgroupPreserveSanity child: "+b.getName());q.ctatdebug("CTATDefaultGroupModel --\x3e in addSubgroupPreserveSanity size: "+q.getGroupSubgroups(a).size);q.getGroupSubgroups(a).forEach(function(c){var d=q.getGroupLinks(c);if(0===d.size)q.getGroupSubgroups(a).delete(c),l(b,c);else{var e=null,f=!1;d.forEach(function(a){!1===f&&(e=a,f=!0)});!0===q.isLinkInGroup(b,e)&&(q.getGroupSubgroups(a).delete(c),l(b,c))}});l(a,b)}function l(a,b){q.ctatdebug("CTATDefaultGroupModel --\x3e in addSubgroup");
a.addSubgroup(b);b.setParent(a)}CTATGroupModel.call(this);var n=null,p=!1,q=this;this.logger=new CTATLogger("groups");this.removeLinkFromModel=function(a){var d=[];q.getGroupSubgroups(n).forEach(function(c){c.containsLink(a)&&d.push(a);b(c,a)});d.forEach(function(a){1>a.getLinks().size()&&f(a)});c(n,a)};this.clear=function(){q.ctatdebug("CTATDefaultGroupModel --\x3e in clear");n=new CTATDefaultLinkGroup("defaultName",!0,p,null)};this.setDefaultReenterable=function(a){q.ctatdebug("CTATDefaultGroupModel --\x3e in setDefaultReenterable");
p=a};this.setGroupOrdered=function(a,b){q.ctatdebug("CTATDefaultGroupModel --\x3e in setGroupOrdered");a.setOrdered(b)};this.getTopLevelGroup=function(){ctatdebug("CTATDefaultGroupModel --\x3e in getTopLevelGroup");return n};this.setGroupName=function(a,b){q.ctatdebug("CTATDefaultGroupModel --\x3e in setGroupName");a.setName(b)};this.removeLink=function(a){q.removeLinkFromGroup(n,a);return n.removeLink(a)};this.addLinkToGroupsByName=function(a,b){for(var c=null,d=0,e;d<a.length&&(e=q.getGroupByName(a[d]));++d)q.addLinkToGroup(c=
e,b);return c};this.addLinkToGroup=function(a,b){q.ctatdebug("CTATDefaultGroupModel --\x3e in addLinkToGroup");for(q.removeLinkFromGroup(n,b);null!==a&&"undefined"!==typeof a;a=q.getGroupParent(a)){var c=a,d=b;q.ctatdebug("CTATDefaultGroupModel --\x3e in internalAddLinkToGroup");c.addLink(d)}};this.isGroupOrdered=function(a){q.ctatdebug("CTATDefaultGroupModel --\x3e in isGroupOrdered group name: "+a.getName());q.ctatdebug("CTATDefaultGroupModel --\x3e in isGroupOrdered: "+a.getIsOrdered());return a.getIsOrdered()};
this.isGroupReenterable=function(a){q.ctatdebug("CTATDefaultGroupModel --\x3e in isGroupReenterable");return a.getIsReenterable()};this.isLinkInGroup=function(a,b){q.ctatdebug("CTATDefaultGroupModel --\x3e in isLinkInGroup");return a.containsLink(b)};this.getGroupsContainingLink=function(a){q.ctatdebug("CTATDefaultGroupModel --\x3e in getGroupsContainingLink("+a+"): TopLevel "+n+", typeof(TopLevel) "+typeof n);var b=new Set,c=new CTATGroupIterator(n);q.ctatdebug("CTATDefaultGroupModel --\x3e in getGroupsContainingLink before loop: groupIter "+
c+", typeof(groupIter) "+typeof c);for(var d=c.next();!d.done;d=c.next())d=d.value,!0===q.isLinkInGroup(d,a)&&b.add(d);q.ctatdebug("CTATDefaultGroupModel --\x3e in getGroupsContainingLink returning groups.size "+b.size);return b};this.getLowestLevelGroupOfLink=function(b){q.ctatdebug("CTATDefaultGroupModel --\x3e in getLowestLevelGroupOfLink");var c=a(b,n);return null!==c&&"undefined"!==typeof c?c:!0===q.isLinkInGroup(n,b)?n:null};this.getGroupSubgroups=function(a){q.ctatdebug("CTATDefaultGroupModel --\x3e in getGroupSubgroups");
return null!==a&&"undefined"!==typeof a?a.getSubgroups():null};this.getUniqueLinks=function(a){q.ctatdebug("CTATDefaultGroupModel --\x3e in getUniqueLinks");var b=new Set;q.getGroupLinks(a).forEach(function(a){b.add(a)});q.getGroupSubgroups(a).forEach(function(a){q.getGroupLinks(a).forEach(function(a){b.delete(a)})});return b};this.getGroupLinks=function(a){q.ctatdebug("CTATDefaultGroupModel --\x3e in getGroupLinks: "+a.getName());return a.getLinks()};this.removeLinkFromGroup=function(a,b){q.ctatdebug("CTATDefaultGroupModel --\x3e in removeLinkFromGroup");
e(a,b,!1)};this.getGroupParent=function(a){q.ctatdebug("CTATDefaultGroupModel --\x3e in getGroupParent");return a.getParent()};this.addGroup=function(a,b,c,e){q.ctatdebug("CTATDefaultGroupModel --\x3e in addGroup");var f=null;try{f=d(n,c)}catch(z){return z.toString()}e||(a=new CTATDefaultLinkGroup(a,b,p,c),q.ctatdebug("CTATDefaultGroupModel --\x3e in addGroup after creating new group"),h(f,a));return""};this.setGroupReenterable=function(a,b){q.ctatdebug("CTATDefaultGroupModel --\x3e in setGroupReenterable");
a.setReenterable(b)};this.createIdToLinkMap=function(){q.ctatdebug("CTATDefaultGroupModel --\x3e in createIdToLinkMap");var a={};q.getGroupLinks(n).forEach(function(b){a[b.getUniqueID()]=b});return a};this.getGroupByName=function(a){q.ctatdebug("CTATDefaultGroupModel --\x3e in getGroupByName TopLevel has: "+n.getSubgroups().size);for(var b=new CTATGroupIterator(n),c=b.next();!c.done;c=b.next())if(c=c.value,q.getGroupName(c).toString()===a.toString())return c;return null};this.getGroupName=function(a){return a.getName()};
q.clear()};CTATDefaultGroupModel.prototype=Object.create(CTATGroupModel.prototype);CTATDefaultGroupModel.prototype.constructor=CTATDefaultGroupModel;"undefined"!==typeof module&&(module.exports=CTATDefaultGroupModel);var CTATMatcherComparator=function(){CTATBase.call(this,"CTATMatcherComparator","");CTATMatcherComparator.compare=function(b,g){ctatdebug("CTATMatcherComparator--\x3e in compare");var f=CTATMatcherComparator.compareBasedOnType(b,g);if(0!==f||!1===b instanceof CTATVectorMatcher&&!1===g instanceof CTATVectorMatcher)return f;f=CTATMatcherComparator.compareBasedOnType(b.getSingleMatcher("input"),g.getSingleMatcher("input"));if(0!==f)return f;f=CTATMatcherComparator.compareBasedOnType(b.getSingleMatcher("selection"),
g.getSingleMatcher("selection"));return 0!==f?f:CTATMatcherComparator.compareBasedOnType(b.getSingleMatcher("action"),g.getSingleMatcher("action"))};CTATMatcherComparator.compareBasedOnType=function(b,g){ctatdebug("CTATMatcherComparator --\x3e in compareBasedOnType");for(var f in CTATMatcherComparator.matcherPrecedenceOrder)if(CTATMatcherComparator.matcherPrecedenceOrder.hasOwnProperty(f)&&b instanceof CTATMatcherComparator.matcherPrecedenceOrder[f])break;for(var e in CTATMatcherComparator.matcherPrecedenceOrder)if(CTATMatcherComparator.matcherPrecedenceOrder.hasOwnProperty(e)&&
g instanceof CTATMatcherComparator.matcherPrecedenceOrder[e])break;return f<e?1:f>e?-1:0}};Object.defineProperty(CTATMatcherComparator,"matcherPrecedenceOrder",{enumerable:!1,configurable:!1,writable:!1,value:{0:CTATExactMatcher,1:CTATRangeMatcher,2:CTATExpressionMatcher,3:CTATWildcardMatcher,4:CTATRegexMatcher,5:CTATAnyMatcher}});CTATMatcherComparator.prototype=Object.create(CTATBase.prototype);CTATMatcherComparator.prototype.constructor=CTATMatcherComparator;
"undefined"!==typeof module&&(module.exports=CTATMatcherComparator);new CTATMatcherComparator;var CTATExampleTracerLinkComparator=function(b,g){CTATBase.call(this,"CTATExampleTracerLinkComparator","");this.compare=function(f,e){ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare l1.getUniqueID(): "+f.getUniqueID());ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare l2.getUniqueID(): "+e.getUniqueID());var c=f.getType(),a=e.getType(),c=CTATExampleTracerLink.compareLinkTypes(c,a);if(0!==c)return ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare m: "+c),c;c=g.nonEmptyHints(f,
b.getVariableTable());a=g.nonEmptyHints(e,b.getVariableTable());ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare h1, h2: "+c+", "+a);if(0<c&&0>=a)return-1;if(0>=c&&0<a)return 1;ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare l1.getDepth(), l2.getDepth(): "+f.getDepth()+", "+e.getDepth());if(f.getDepth()<e.getDepth())return-1;if(f.getDepth()>e.getDepth())return 1;c=b.getTraversalCount(f)-f.getMinTraversals();a=b.getTraversalCount(e)-e.getMinTraversals();ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare tc1, tc2: "+
c+", "+a);if(0>c&&0<=a)return-1;if(0<=c&&0>a)return 1;ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare l1.getIsPreferredLink(): "+f.getIsPreferredLink());ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare l2.getIsPreferredLink(): "+e.getIsPreferredLink());if(f.getIsPreferredLink())return-1;if(e.getIsPreferredLink())return 1;if(0!==(c=CTATMatcherComparator.compare(f.getMatcher(),e.getMatcher())))return c;ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare l1.getUniqueID(): "+
f.getUniqueID());ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare l2.getUniqueID(): "+e.getUniqueID());return f.getUniqueID()<e.getUniqueID()?-1:1}};CTATExampleTracerLinkComparator.prototype=Object.create(CTATBase.prototype);CTATExampleTracerLinkComparator.prototype.constructor=CTATExampleTracerLinkComparator;"undefined"!==typeof module&&(module.exports=CTATExampleTracerLinkComparator);var CTATExampleTracerEvent=function(b,g,f){CTATBase.call(this,"CTATExampleTracerEvent",g?g.toString():"null");var e="",c=!1,a=CTATExampleTracerLink.NO_MODEL,d=!1,h=null,l=null,n="student",p=null,q=null,u=[],v="",y="",w="",A="",z="",C=null,D="",F="",G=null,x=null,H=null,K=null,I=[],L=!1,P=null,B=null,r=this,M=null,V=[],N=[],Q={};this.getMsgToRestore=function(){return M};this.setMsgToRestore=function(a){M=a};this.getActor=function(){return n};this.setActor=function(a){r.ctatdebug("CTATExampleTracerEvent --\x3e setActor("+
a+")");n=a};this.getStudentSAI=function(){r.ctatdebug("CTATExampleTracerEvent.getStudentSAI() returning type "+typeof h+", value "+h);return h};this.setStudentSAI=function(a){r.ctatdebug("CTATExampleTracerEvent --\x3e in setStudentSAI("+a+")");null!==a&&"undefined"!==typeof a&&(h=a);r.ctatdebug("CTATExampleTracerEvent --\x3e out of setStudentSAI")};this.getPreloadedLinkMatches=function(){r.ctatdebug("CTATExampleTracerEvent --\x3e in getPreloadedLinkMatches");return G};this.setTutorSAI=function(a){r.ctatdebug("CTATExampleTracerEvent --\x3e in setTutorSAI");
null!==a&&"undefined"!==typeof a&&(l=a);r.ctatdebug("CTATExampleTracerEvent --\x3e out of setTutorSAI")};this.setNumberOfInterpretations=function(a){r.ctatdebug("CTATExampleTracerEvent --\x3e in setNumberOfInterpretations( "+a+" )")};this.getTransactionID=function(){r.ctatdebug("CTATExampleTracerEvent --\x3e in getTransactionID() returning "+e);return e};this.setTransactionID=function(a){r.ctatdebug("CTATExampleTracerEvent --\x3e in setTransactionID( "+a+" )");e=a};this.setDoneStepFailed=function(a){r.ctatdebug("CTATExampleTracerEvent --\x3e in setDoneStepFailed( "+
a+" )");c=a};this.setHintRequest=function(a){d=a};this.getHintRequest=function(){return d};this.setResult=function(b){r.ctatdebug("CTATExampleTracerEvent --\x3e in setResult( "+b+" )");a=b};this.isBuggyResult=function(){return a.toString()===CTATExampleTracerLink.BUGGY_ACTION||a.toString()===CTATExampleTracerLink.FIREABLE_BUGGY_ACTION};this.isSolverResult=function(){r.ctatdebug("CTATExampleTracerEvent --\x3e in isSolverResult");return!1};this.getResult=function(){r.ctatdebug("CTATExampleTracerEvent --\x3e in getResult() returning "+
a);return a};this.setReportableLink=function(a){r.ctatdebug("CTATExampleTracerEvent --\x3e in setReportableLink("+a+")");p=a};this.setReportableInterpretation=function(a){r.ctatdebug("CTATExampleTracerEvent --\x3e in setReportableInterpretation("+a+")");q=a};this.addScoreLabels=function(a){null!=a&&(Array.isArray(a)||(a=[].concat($jscomp.arrayFromIterable(arguments))),a.forEach(function(a){null!=a&&(a=String(a),u.includes(a)||u.push(a))}))};this.getTracerInfo=function(a){return a?v&&JSON.parse(v)||
null:v};this.setTracerInfo=function(a,b){if("string"==typeof b&&b.length){var c=v&&JSON.parse(v)||{};c[b]=a;v=JSON.stringify(c)}else v="string"==typeof a?a:JSON.stringify(a)};this.setStepID=function(a){r.ctatdebug("CTATExampleTracerEvent --\x3e in setStepID("+a+")");y=a?a.toString():""};this.setBuggyStepID=function(a){w=a?a.toString():""};this.setAddedStepID=function(a){A=a?a.toString():""};this.setSenderStepID=function(a){z=a?a.toString():""};this.setReportableVariableTable=function(a){H=a.clone()};
this.setSuccessOrBuggyMsg=function(a){r.ctatdebug("CTATExampleTracerEvent --\x3e in setSuccessOrBuggyMsg("+a+")");K=a instanceof Array?a:[a]};this.setReportableHints=function(a){r.ctatdebug("CTATExampleTracerEvent --\x3e in setReportableHints("+a+")");I=Array.isArray(a)&&0<a.length?a:[]};this.getWantReportableHints=function(){r.ctatdebug("CTATExampleTracerEvent --\x3e in getWantReportableHints() returning "+L);return L};this.setOutOfOrder=function(a){r.ctatdebug("CTATExampleTracerEvent --\x3e in setOutOfOrder("+
a+")");C=a};this.isOutOfOrder=function(){r.ctatdebug("CTATExampleTracerEvent --\x3e in getOutOfOrder() returning "+C);return C};this.setTraceOutcome=function(a){D=a};this.getTraceOutcome=function(){return D};this.setTutorType=function(a){F=a};this.getTutorType=function(){return F};this.setEvaluatedInput=function(a){r.ctatdebug("CTATExampleTracerEvent --\x3e in setEvaluatedInput("+a+")");if(null===x||"undefined"===typeof x)x=[];x.push(a)};this.addPreloadedLinkMatch=function(a){r.ctatdebug("CTATExampleTracerEvent --\x3e in addPreloadedLinkMatch("+
a+")");if(null===G||"undefined"===typeof G)G=[];G.push(a)};this.setInterpolatedSAI=function(a){r.ctatdebug("CTATExampleTracerEvent --\x3e in setInterpolatedSAI("+a+")");a&&(P=a)};this.getInterpolatedSAI=function(){return P?P:r.getStudentSAI()};this.setInterpolatedHints=function(a){r.ctatdebug("CTATExampleTracerEvent --\x3e in setInterpolatedHints("+a+")");B&&(B.length=0);a&&(B=a.slice(0));r.ctatdebug("CTATExampleTracerEvent --\x3e out of setInterpolatedHints")};this.setWantReportableHints=function(a){r.ctatdebug("CTATExampleTracerEvent --\x3e in setWantReportableHints("+
a+")");L=a};this.setAssociatedRules=function(a){V=a instanceof Array?a:a instanceof String?[a]:[]};this.setAssociatedSkills=function(a){N=a instanceof Array?a:a instanceof String?[a]:[]};this.setCustomFields=function(a){Q=a instanceof Object?a:{}};this.getSuccessOrBuggyMsg=function(){r.ctatdebug("CTATExampleTracerEvent --\x3e in getSuccessOrBuggyMsg() returning "+K+","+typeof K+",");return K};this.getReportableHints=function(){r.ctatdebug("CTATExampleTracerEvent --\x3e in getReportableHints() returning "+
I);return I};this.getReportableLink=function(){r.ctatdebug("CTATExampleTracerEvent --\x3e in getReportableLink() returning "+p);return p};this.getReportableVariableTable=function(){r.ctatdebug("CTATExampleTracerEvent --\x3e in getReportableVariableTable() returning "+H);return H};this.getReportableInterpretation=function(){r.ctatdebug("CTATExampleTracerEvent --\x3e in getReportableInterpretation() returning "+q);return q};this.getScoreLabels=function(){r.ctatdebug("CTATExampleTracerEvent --\x3e in getScoreLabels() returning "+
u);return u};this.getStepID=function(){r.ctatdebug("CTATExampleTracerEvent --\x3e in getStepID() returning "+y);return y};this.getBuggyStepID=function(){return w};this.getAddedStepID=function(){return A};this.getSenderStepID=function(){return z};this.getTutorSelection=function(){return null===l||"undefined"===typeof l?null:l.getSelectionArray()};this.getTutorAction=function(){return null===l||"undefined"===typeof l?null:l.getActionArray()};this.getTutorInput=function(){return null!==x&&"undefined"!==
typeof x?r.getEvaluatedInputArray():null!==l&&"undefined"!==typeof l?l.getInputArray():null};this.getEvaluatedInputArray=function(){return x};this.toString=function(){var a;a="["+r.getResult();a+=", StudentSAI "+(r.getStudentSAI()||"null").toString();null!==r.getReportableLink()&&"undefined"!==typeof r.getReportableLink()&&(a+=", reportableLink "+r.getReportableLink());!0===r.isDoneStepFailed()&&(a+=", doneStepFailed");null!==r.getTutorSAI()&&"undefined"!==typeof r.getTutorSAI()&&(a+=", TutorSAI "+
r.getTutorSAI());return a+"]"};this.isDoneStepFailed=function(){return c};this.getTutorSAI=function(){return l};this.getAssociatedRules=function(){return V};this.getAssociatedSkills=function(){return N};this.getCustomFields=function(){return Q};this.fromAssociatedRules=function(a){r.setResult(a.getProperty("TraceOutcome"));r.setTutorSAI(a.getSAI());r.setStudentSAI(new CTATSAI(a.getProperty("StudentSelection"),a.getProperty("StudentAction"),a.getProperty("StudentInput")));r.setActor(a.getProperty("Actor"));
r.setSuccessOrBuggyMsg(a.getProperty("TutorAdvice"));r.setAssociatedSkills(a.getSkillsObject()?a.getSkillsObject().getSkillSet().map(function(a){return CTATExampleTracerSkill.makeKey(a.getSkillName(),a.getCategory()||"")}):[]);r.setTransactionID(a.getProperty("transaction_id"));r.setTracerInfo(a.getProperty("TracerInfo"));r.setStepID(a.getProperty("StepID"));r.setTraceOutcome(a.getProperty("TraceOutcome"));r.setBuggyStepID(a.getProperty("BuggyStepID"));r.setAddedStepID(a.getProperty("AddedStepID"));
r.setSenderStepID(a.getProperty("SenderStepID"));r.setTutorType(a.getProperty("TutorType"));return r};this.toAssociatedRules=function(){return(new CTATTutorMessageBuilder).createAssociatedRulesMessageForAction(r.getResult(),r.getTutorSAI(),r.getActor(),r.getStudentSAI(),r.getAssociatedSkills(),r.getStepID(),r.getTransactionID(),r.getSuccessOrBuggyMsg(),r.isOutOfOrder(),r.getCustomFields(),{traceOutcome:r.getTraceOutcome(),tracerInfo:r.getTracerInfo(),buggyStepID:r.getBuggyStepID(),addedStepID:r.getAddedStepID(),
senderStepID:r.getSenderStepID(),tutorType:r.getTutorType()})};this.setStudentSAI(g||new CTATSAI("No_Selection","No_Action","No_Input"));this.setActor(f||CTATMsgType.DEFAULT_ACTOR)};CTATExampleTracerEvent.prototype=Object.create(CTATBase.prototype);CTATExampleTracerEvent.prototype.constructor=CTATExampleTracerEvent;"undefined"!==typeof module&&(module.exports=CTATExampleTracerEvent);var CTATExampleTracerInterpretation=function(b){CTATBase.call(this,"CTATExampleTracerInterpretation","");var g=null,f=[],e={},c=new CTATVariableTable,a=new Set;b.forEach(function(b){a.add(b)});var d=CTATExampleTracerLink.CORRECT_ACTION,h=null,l=this;this.getVariableTable=function(){return c};this.setVariableTable=function(a){c=a};this.setLatestHints=function(a,b){l.ctatdebug("In evaluate after calling setInterpolatedHints");if(!Array.isArray(a)||1>a.length)a=b;!Array.isArray(a)||1>a.length||c.put("hints",
a)};this.getLatestHints=function(){return c.get("hints")};this.setLatestBuggyMessage=function(a){!a||1>(a=String(a)).length||c.put("buggy_message",a)};this.setLatestSuccessMessage=function(a){!a||1>(a=String(a)).length||c.put("success_message",a)};this.getLatestBuggyMessage=function(){return c.get("buggy_message")};this.getLatestSuccessMessage=function(){return c.get("success_message")};this.getTraversalCount=function(a){a=e[a.getUniqueID()];return"undefined"===typeof a||null===a?0:a[0]};this.getPaths=
function(){return a};this.clone=function(){var b=new CTATExampleTracerInterpretation(a);b.setInterpolatedSAI(l.getInterpolatedSAI());b.addTraversedLinks(f);for(var g in e)e.hasOwnProperty(g)&&b.putInlinkIdTraversalCountMap(g,e[g].slice());b.setWorstLinkType(d);g=c.clone();b.setVariableTable(g);b.setLatestHints(l.getLatestHints());b.setLatestSuccessMessage(l.getLatestSuccessMessage());b.setLatestBuggyMessage(l.getLatestBuggyMessage());h&&b.setPathToDone(new CTATExampleTracerPath(h.getLinks()));ctatdebug("CTATExampleTracerInterpretation --\x3e out of clone");
return b};this.addTraversedLinks=function(a){f=f.concat(a)};this.putInlinkIdTraversalCountMap=function(a,b){ctatdebug("CTATExampleTracerInterpretation --\x3e in putInlinkIdTraversalCountMap");ctatdebug("CTATExampleTracerInterpretation --\x3e in putInlinkIdTraversalCountMap key: "+a);ctatdebug("CTATExampleTracerInterpretation --\x3e in putInlinkIdTraversalCountMap value: "+b);e[a]=b};this.setWorstLinkType=function(a){d=a};this.addLink=function(a){!a.isTraversable()||h&&h.getLinks().has(a)||(h=null);
ctatdebug("CTATExampleTracerInterpretation.addLink("+(a&&a.getUniqueID())+") pathToDone "+(h&&h.size()));f.push(a);var b=a.getMatcher(),b=null===b||"undefined"===typeof b?1:b.getTraversalIncrement(),c=e[a.getUniqueID()];null!==c&&"undefined"!==typeof c?c[0]+=b:(c=[],c.push(b),e[a.getUniqueID()]=c);a=a.getType();0>CTATExampleTracerLink.compareLinkTypes(d,a)&&(d=a)};this.setPathToDone=function(a){h=a};this.getPathToDone=function(a){if(h)return h;var b=a.getStartNode();b&&a.getDoneStates().forEach(function(c){h||
(h=a.getBestSubpath(b,c,f))});return h};this.countStepsForScore=function(a){var b=Number.MAX_VALUE,c=l.getPathToDone(a);if((a=a.getStudentStartsHereNode()||a.getStartNode())&&c&&c.getLinks()){var d=a.getNodeID(),b=0;c.getSortedLinks().forEach(function(a){if(!(0<d&&a.getPrevNode()!=d||(d=-1,CTATMatcher.isTutorActor(a.getActor(),!0)))){var c=l.getTraversalCount(a);a=a.getMinTraversals();b=c>a?b+c:b+a}})}return b};this.getCurrentState=function(a){var b=a&&l.getPathToDone(a);if(!b)try{b=new CTATExampleTracerPath(f)}catch(v){return console.error("CTATExampleTracerInterpretation error creating path from traversedLinks",
v,f),a&&a.getStartNode()&&a.getStartNode().getNodeID()}for(var c=null,b=b.getSortedLinks(),d=0;d<b.length&&!(l.getTraversalCount(b[d])<b[d].getMinTraversals());++d)c=b[d];return c?c.getNextNode():a.getStartNode().getNodeID()};this.getTraversedNodeIDs=function(a){var b=new Set;a&&a.getStartNode()&&b.add(a.getStartNode().getNodeID());if(a=a&&l.getPathToDone(a)){a=a.getSortedLinks();for(var c=0;c<a.length&&!(l.getTraversalCount(a[c])<a[c].getMinTraversals());++c)b.add(a[c].getNextNode())}return b};this.updateVariableTable=
function(a,b,d,e){var f=a,g=a.getInput();null!==b&&"undefined"!==typeof b&&(g=b,f=new CTATSAI(a.getSelection(),a.getAction(),g));c.put("link"+e.getUniqueID()+".selection",a.getSelection());c.put("link"+e.getUniqueID()+".action",a.getAction());b="link"+e.getUniqueID()+".input";c.put(b,g);c.put(CTATVariableTable.nameAsString(b),CTATVariableTable.valueAsString(g));CTATExampleTracerLink.CORRECT_ACTION.toString().toUpperCase()!==e.getActionType().toString().toUpperCase()&&CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString().toUpperCase()!==
e.getActionType().toString().toUpperCase()||CTATInterfaceDescriptions.updateVariableTable(c,a.getSelection(),a.getAction(),g,d);return f};this.getInterpolatedSAI=function(){return g};this.setInterpolatedSAI=function(a){g=a};this.getLastMatchedLink=function(){return 0===f.length?null:f[f.length-1]};this.getMatchedLinks=function(){return f};this.getFarthestMatchedLink=function(){return!f||1>f.length?null:(new CTATExampleTracerPath(f)).getSortedLinks().pop()};this.getType=function(){return d};this.isTraversed=
function(a,b){ctatdebug("CTATExampleTracerInterpretation --\x3e in isTraversed: "+a.getUniqueID());var c=e[a.getUniqueID()];if(null===c||"undefined"===typeof c)return ctatdebug("CTATExampleTracerInterpretation --\x3e in isTraversed in if condition (traversalCount === null): "+(null===c)),ctatdebug("CTATExampleTracerInterpretation --\x3e in isTraversed in if condition (typeof(traversalCount) === 'undefined'): "+("undefined"===typeof c)),!0===b?0>=a.getMinTraversals():!1;ctatdebug("CTATExampleTracerInterpretation --\x3e in isTraversed out of if condition traversalCount[0]: "+
c[0]);ctatdebug("CTATExampleTracerInterpretation --\x3e in isTraversed out of if condition link.getMinTraversals(): "+a.getMinTraversals());return c[0]>=a.getMinTraversals()};this.toString=function(){var b="{";f.forEach(function(a){b+=a.getUniqueID()+", "});b.substring(b.length-2,b.length).toString()===", ".toString()&&(b=b.substring(0,b.length-2));b+=" ("+(null===a||"undefined"===typeof a?-1:a.size)+" paths)";b+=" var tbl "+c;return b+="}"}};CTATExampleTracerInterpretation.prototype=Object.create(CTATBase.prototype);
CTATExampleTracerInterpretation.prototype.constructor=CTATExampleTracerInterpretation;"undefined"!==typeof module&&(module.exports=CTATExampleTracerInterpretation);var CTATExampleTracerInterpretationComparator=function(){CTATBase.call(this,"CTATExampleTracerInterpretationComparator","");var b=this;this.compare=function(g,f){b.ctatdebug("CTATExampleTracerInterpretationComparator --\x3e in compare");var e=g.getType(),c=CTATExampleTracerLink.compareLinkTypes(e,f.getType());ctatdebug("CTATExampleTracerInterpretationComparator comparing i1Type: "+g.getType());ctatdebug("CTATExampleTracerInterpretationComparator comparing i2Type: "+f.getType());ctatdebug("CTATExampleTracerInterpretationComparator comparing link types result: "+
c);if(0!==c)return ctatdebug("CTATExampleTracerInterpretationComparator result is not equal to 0"),0>c?1:-1;if(CTATExampleTracerLink.BUGGY_ACTION.toString().toUpperCase()===e.toString().toUpperCase()&&(ctatdebug("CTATExampleTracerInterpretationComparator checking for buggy actions"),e=g.getLastMatchedLink(),c=f.getLastMatchedLink(),e=CTATMatcherComparator.compare(e.getMatcher(),c.getMatcher()),0!==e))return e;g=CTATExampleTracerPath.getBestPath(g.getPaths());f=CTATExampleTracerPath.getBestPath(f.getPaths());
e=new Set;e.add(g);e.add(f);g=CTATExampleTracerPath.getBestPath(e);ctatdebug("CTATExampleTracerInterpretationComparator found best path: "+(g===f));g.getLinks().forEach(function(a){b.ctatdebug("My best link==: "+a.getUniqueID())});return g===f?-1:1}};CTATExampleTracerInterpretationComparator.prototype=Object.create(CTATBase.prototype);CTATExampleTracerInterpretationComparator.prototype.constructor=CTATExampleTracerInterpretationComparator;"undefined"!==typeof module&&(module.exports=CTATExampleTracerInterpretationComparator);var CTATExampleTracerTracer_count=0,CTATExampleTracerTracer=function(b,g){function f(a,b,c,d,e,f){B.ctatdebug("finishEvaluate() doUpdate "+b+", link "+d+", bestInterp.getLastMatchedLink() "+e.getLastMatchedLink());null==d&&(d=e.getLastMatchedLink());(b||a.getWantReportableHints())&&f.forEach(function(b){var c=[],d=b.getLastMatchedLink();d&&(d.getActionType()==CTATExampleTracerLink.CORRECT_ACTION?a.getHintRequest()?a.getWantReportableHints()&&b.setLatestHints(d.interpolateHints(b.getVariableTable()),
d.getHints()):(c=CTATGlobals.languageManager.interpolateStrings(d.getSuccessMsgs(),b.getVariableTable(),a.getStudentSAI()),c[0]&&b.setLatestSuccessMessage(c[0])):(c=CTATGlobals.languageManager.interpolateStrings(d.getBuggyMsgs(),b.getVariableTable(),a.getStudentSAI()),c[0]&&b.setLatestBuggyMessage(c[0])),b==e&&(B.ctatdebug('ETT.finishEvaluate() successOrBuggyMsg "'+c.toString()+'"'),a.setSuccessOrBuggyMsg(c)))});if(b){b={sai:a.getStudentSAI(),actor:a.getActor(),stepID:d.getUniqueID()};G.push(b);d!=
e.getLastMatchedLink()&&(e.addLink(d),a.setResult(d.getActionType()),a.setTraceOutcome(d.getActionType()));if(c.toString()===CTATExampleTracerLink.CORRECT_ACTION.toString()||c.toString()===CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString()){B.ctatdebug("In evaluate -- in first branch doUpdate()");f.forEach(function(a){a.getLastMatchedLink().getType().toString()===CTATExampleTracerLink.BUGGY_ACTION.toString()&&(B.ctatdebug("In evaluate -- deleting an incorrect interp"),f.delete(a))});B.ctatdebug("In evaluate -- to call setInterpretations(), if 0 < newInterps.size "+
f.size);0<f.size&&(q(f),L=e);for(var g in F)F.hasOwnProperty(g)&&delete F[g];B.ctatdebug("In evaluate -- out of DoUpdate if branch")}else{B.ctatdebug("In evaluate -- in else branch of doUpdate");a.setNumberOfInterpretations(0);for(var h in F)F.hasOwnProperty(h)&&delete F[h];f.forEach(function(a){F[a.getLastMatchedLink().getUniqueID()]=a.getLastMatchedLink()})}c.toString()===CTATExampleTracerLink.BUGGY_ACTION.toString()&&G.splice(G.length-1,1)}a.isSolverResult()||(B.ctatdebug("In evaluate inside the NOT solver result if condition "+
c),a.setResult(c),a.setTraceOutcome(c));c.toString()!==CTATExampleTracerLink.BUGGY_ACTION.toString()&&c.toString()!==CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString()||a.setBuggyStepID(d.getUniqueID());B.ctatdebug("In evaluate out the solver result if condition");a.setReportableLink(d);a.setAssociatedSkills(d.getSkillNames());a.setStepID(d.getUniqueID());a.setReportableInterpretation(e);a.setInterpolatedSAI(e.getInterpolatedSAI());a.setReportableVariableTable(e.getVariableTable());a.getHintRequest()?
(a.setReportableHints(e.getLatestHints()),B.ctatdebug("In evaluate --\x3e after setReportableHints")):(d=d.getTutorSAI(a.getInterpolatedSAI(),e.getVariableTable()),B.ctatdebug("In evaluate -- TUTORSAI: "+d+", studentSAI was "+a.getStudentSAI()),a.setTutorSAI(d));B.ctatdebug("In evaluate after fireExampleTracerEvent");B.ctatdebug("CTATExampleTracerTracer --\x3e out of finishEvaluate");return c.toString()!==CTATExampleTracerLink.BUGGY_ACTION.toString()}function e(a,b,d,e){B.ctatdebug("checkDoneStep() hintTrace "+
b+", sai "+a.getStudentSAI()+", exitOnIncorrectDone "+x.exitOnIncorrectDone()+", hideButRequireSteps "+x.hideButRequireSteps()+", nInterps "+e.size);if(!a.getStudentSAI().isDone())return B.ctatdebug("checkDoneStep() not isDone(), so setDoneStepFailed(false) & return null "),null;if(x.exitOnIncorrectDone())return B.ctatdebug("checkDoneStep() exitOnIncorrectDone() with setDoneStepFailed(false), so return CORRECT"),c(a,d,null,e);if(!b&&x.hideButRequireSteps()){b=x.getDoneLinks();B.ctatdebug("checkDoneStep getDoneLinks().size "+
b.size);b=b.values();for(var f;!(f=b.next()).done;)if(x.pathToLinkIsSubset(f.value,P))return c(a,d,f.value,e)}1>e.size&&a.setDoneStepFailed(!0);return null}function c(a,b,c,d){var e;a.setDoneStepFailed(!1);1>d.size?(d=B.getInterpretationsInternal(),e=B.getBestInterpretation()):e=p(d);e.setInterpolatedSAI(new CTATSAI("done","ButtonPressed","-1"));return f(a,b,CTATExampleTracerLink.CORRECT_ACTION,c,e,d)}function a(a,b,c){B.ctatdebug("CTATExampleTracerTracer --\x3e _evaluate("+a+", "+b+", "+c+")");K=
a;var g=new Set,r=a.getPreloadedLinkMatches();B.ctatdebug("interps # : "+D.length);B.ctatdebug("interps: "+D);D.forEach(function(e){B.ctatdebug("In evaluate -- entered the interpretations loop");if("undefined"===typeof r||null===r)B.ctatdebug("In evaluate -- entered if check for saiLinkMatches"),r=h(a.getStudentSAI(),a.getActor(),b,e.getVariableTable(),a),B.ctatdebug("In evaluate -- exiting if check for saiLinkMatches");else for(var f=0;f<r.length;++f)d(a.getStudentSAI(),!0,r[f],r[f].getActor(),e.getVariableTable());
B.ctatdebug("Link matches # : "+r.length);r.forEach(function(b){B.ctatdebug("In evaluate -- entered the saiLinkMatches loop + "+b);if(!x.relaxOrderConstraints()&&e.getTraversalCount(b)>=b.getMaxTraversals())return B.ctatdebug("In evaluate -- skipped a saiLinkMatches loop \n Skipped due to max traversals"+b.getMaxTraversals()),!1;var d=e.clone();d.setInterpolatedSAI(null);B.ctatdebug("In evaluate size of getPaths "+d.getPaths().size);d.getPaths().forEach(function(c){B.ctatdebug("In evaluate -- looping through the newInterp.getPaths()\n Examining path: "+
c);(a.getPreloadedLinkMatches()||[]).includes(b)||!1!==l(b,d,c,z(),a)||(B.ctatdebug("In evaluate -- in if condition, checking if isPathOK"),d.getPaths().delete(c),B.ctatdebug("In evaluate -- out of if condition, checking if isPathOK\n Tried to delete path."))});B.ctatdebug("In evaluate -- done looping through the newInterp.getPaths(), size "+d.getPaths().size);if(0<d.getPaths().size){B.ctatdebug("In evaluate -- if number of paths is greater than 0");d.addLink(b);B.ctatdebug("In evaluate -- new link added");
if(!0===c){B.ctatdebug("In evaluate -- we are in the doUpdate if condition");var f=n(b,a.getStudentSAI(),d);B.log("tracervars","ETT._evaluate to call updateVariableTable",a.getStudentSAI()&&a.getStudentSAI().toString());d.setInterpolatedSAI(d.updateVariableTable(a.getStudentSAI(),f,H,b));B.log("tracervars","ETT._evaluate after updateVariableTable",d.getVariableTable()&&d.getVariableTable().toString())}g.add(d);B.ctatdebug("In evaluate -- added new interp")}B.ctatdebug("In evaluate -- out of saiLinkMatches loop")});
B.ctatdebug("In evaluate -- out of interpretation loops")});a.setNumberOfInterpretations(g.size);B.ctatdebug("In evaluate -- number of interpretations "+g.size+" set");var q=e(a,b,c,g);if(null!==q)return q;if(0===g.size)return B.ctatdebug("In evaluate -- if condition no new interpretations"),0!==r.length&&!0===r[0].isDone()&&a.setDoneStepFailed(!0),a.setResult(CTATExampleTracerLink.NO_MODEL),a.setTraceOutcome(CTATExampleTracerLink.NO_MODEL),B.ctatdebug("In evaluate -- if condition no new interpretations returning false"),
!1;q=p(g);B.ctatdebug("In evaluate -- just found bestInterp");var v=null;!0===a.isSolverResult()?(B.ctatdebug("In evaluate -- in if branch of isSolverResult"),v=CTATExampleTracerLink.NO_MODEL.toString().toUpperCase()===a.getResult().toString().toUpperCase()?CTATExampleTracerLink.BUGGY_ACTION.toString():a.getResult().toString()):(B.ctatdebug("In evaluate -- in else branch of isSolverResult"),v=q.getLastMatchedLink().getType());return f(a,c,v,null,q,g)}function d(a,b,c,d,e){var f=b&&c.isCorrect();if("undefined"!=
typeof P[c.getUniqueID()]||c.matchesSAIforHint(a,d,null,e))P[c.getUniqueID()]=f;B.ctatdebug("updateMatchedSelections(): link "+c.getUniqueID()+", matched "+b+", newResult "+f+", matchedSelections[link] "+P[c.getUniqueID()])}function h(a,b,c,e,f){B.ctatdebug("CTATExampleTracerTracer --\x3e in findSAIMatchingLinks("+a+", "+b+", "+c+")");var g=[];x.getLinks().forEach(function(h){if(!1===c){B.ctatdebug("Calling link.matchesSAI() on link "+h+", sai "+a);var l=h.matchesSAI(a,b,e);B.ctatdebug("Result from link.matchesSAI() on link "+
h+": "+l+", typeof "+typeof l);!0===l&&g.push(h);x.hideButRequireSteps()&&d(a,l,h,b,e)}else!0===h.matchesSAIforHint(a,b,f,e)&&g.push(h)});B.ctatdebug("CTATExampleTracerTracer --\x3e out of findSAIMatchingLinks: #matchingLinks "+g.length);return g}function l(a,b,c,d,e){B.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK");var f=null;if(!0===d){B.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK in demonstrate mode");var g=b.getMatchedLinks().slice();g.push(a);f=c.getLinksRestricted(g)}else B.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK NOT in demonstrate mode"),
f=c.getLinks();B.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK path.getLinks() "+c.getLinks().size);B.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK pathLinks "+f.size);if(!0===d){var h=[],l=!0;b.getMatchedLinks().forEach(function(a){!1!==l&&(!1===x.observesOrderingConstraints(h,a,f,e)||!1===v(b,a,f)?(B.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK returning false1"),l=!1):h.push(a))});if(!1===l)return B.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK returning false2"),
!1}if(a.getType().toString()===CTATExampleTracerLink.BUGGY_ACTION.toString()){if(!1===x.isIncorrectLinkOK(b.getMatchedLinks(),a,f,b))return B.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK returning false3"),!1}else{if(!1===x.observesOrderingConstraints(b.getMatchedLinks(),a,f,e))return B.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK returning false4"),!1;if(!1===v(b,a,f))return B.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK returning false5"),!1}B.ctatdebug("CTATExampleTracerTracer --\x3e out of isPathOK returning true");
return!0}function n(a,b,c){B.ctatdebug("CTATExampleTracerTracer.replaceInput("+a+", "+b+", ...)");if(null===a||"undefined"===typeof a||!1===a.replaceInput())return B.ctatdebug("replaceInput false, returning null"),null;a=a.evaluateReplacement(b,c.getVariableTable(),B);B.ctatdebug("CTATExampleTracerTracer.replaceInput() returning "+a);return a}function p(a){B.ctatdebug("CTATExampleTracerTracer --\x3e in findBestInterpretation");var b=new CTATExampleTracerInterpretationComparator,c=null;a.forEach(function(a){B.ctatdebug("CTATExampleTracerTracer --\x3e in findBestInterpretation iteration");
null===c||"undefined"===typeof c?(B.ctatdebug("CTATExampleTracerTracer --\x3e in findBestInterpretation first if condition"),c=a):(B.ctatdebug("CTATExampleTracerTracer --\x3e in findBestInterpretation else of first if condition"),0<b.compare(a,c)&&(B.ctatdebug("CTATExampleTracerTracer --\x3e in findBestInterpretation second if condition"),c=a))});B.ctatdebug("CTATExampleTracerTracer --\x3e out of findBestInterpretation");return c}function q(a){B.ctatdebug("CTATExampleTracerTracer --\x3e in setInterpretations");
D.length=0;0===a.size?B.ctatdebug("CTATExampleTracerTracer --\x3e returning from setInterpretations"):(B.ctatdebug("CTATExampleTracerTracer --\x3e setInterpretations c.size: "+a.size),a.forEach(function(a){D.push(a)}),L=null,B.ctatdebug("CTATExampleTracerTracer --\x3e out of setInterpretations"))}function u(){B.ctatdebug("CTATExampleTracerTracer --\x3e in getAllPaths");var a=x.findAllPaths();B.ctatdebug("CTATExampleTracerTracer --\x3e in getAllPaths: #paths "+a.size);a.forEach(function(a){B.ctatdebug("CTATExampleTracerTracer --\x3e in getAllPaths loopring through paths");
B.ctatdebug("CTATExampleTracerTracer --\x3e in getAllPaths size of path"+a.getLinks().size)});return a}function v(a,b,c){B.ctatdebug("CTATExampleTracerTracer --\x3e in doneStepOK: link "+b+", isDone() "+b.isDone());if(null===b||"undefined"===typeof b||!b.isDone())return B.ctatdebug("doneStepOK in first if condition"),!0;if(b.isDone()&&x.exitOnIncorrectDone())return!0;if(b.getType().toString()===CTATExampleTracerLink.BUGGY_ACTION.toString())return B.ctatdebug("doneStepOK in second if condition"),!0;
B.ctatdebug("doneStepOK before loop");var d=!0;c.forEach(function(c){if(!1===d)B.ctatdebug("CTATExampleTracerTracer --\x3e we are breaking from the loop");else if(c.getUniqueID()===b.getUniqueID())B.ctatdebug("CTATExampleTracerTracer --\x3e inside second if condition");else{var e=a.getTraversalCount(c);x.hideButRequireSteps()&&(0<e||1>c.getMinTraversals())||!(e<c.getMinTraversals())||(B.ctatdebug("CTATExampleTracerTracer --\x3e we should return false from the second if condition"),d=!1)}});if(!1===
d)return B.ctatdebug("CTATExampleTracerTracer --\x3e out of doneStepOK returning false"),!1;B.ctatdebug("CTATExampleTracerTracer --\x3e out of doneStepOK returning true");return!0}function y(a,b){B.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink");var c=null!==b&&"undefined"!==typeof b&&null!==b[0]&&"undefined"!==typeof b[0]?b[0]:null;if(null===c||"undefined"===typeof c)B.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink first if condition"),c=B.getBestInterpretation();null!==
b&&"undefined"!==typeof b&&(b[0]=c);B.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink interp.getPaths(): "+c.getPaths().size);var d=CTATExampleTracerPath.getBestPath(c.getPaths());B.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink path: "+d);b=w(c,d,a,!1);B.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink highestLink: "+b);if(null!==b&&"undefined"!==typeof b)return B.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink returning highestLink"),b;var e=
null;B.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink returning path.getLinks() "+d.getLinks().size);B.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink returning path.getSortedLinks() "+d.getSortedLinks());var f=!1,g=null;d.getSortedLinks().forEach(function(b){!0!==f&&(B.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink in for loop"+b),e=b,c.getTraversalCount(b)<b.getMaxTraversals()&&(!1===a||0<B.nonEmptyHints(b,c.getVariableTable()))&&x.observesOrderingConstraints(c.getMatchedLinks(),
b,d.getLinks(),null)&&v(c,b,d.getLinks())&&(B.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink in link: "+b),g=b,f=!0))});if(!0===f)return g;B.ctatdebug("CTATExampleTracerTracer --\x3e out of _getBestNextLink, returning: "+e);return null}function w(a,b,c,d){B.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink");var e=new CTATExampleTracerEvent(B,null,CTATMsgType.DEFAULT_STUDENT_ACTOR);e.setTutorType("example");var f=!0,g=[];b.getSortedLinks().forEach(function(b){B.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink in loop link.getUniqueID(): "+
b.getUniqueID());B.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink in loop interp.isTraversed(link, countOptionalAsTraversed): "+a.isTraversed(b,d));B.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink in loop isNoOp(link): "+A(b));!0===a.isTraversed(b,d)||!0===A(b)?(B.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink in if condition"),f=!0):(!0===f&&(B.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink in second if condition"),
x.getNode(b.getPrevNode()).getOutLinks().forEach(function(b){c&&1>B.nonEmptyHints(b,a.getVariableTable())||a.getTraversalCount(b)>=b.getMaxTraversals()||(B.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink pushing outlink: "+b.getUniqueID()),g.push(b))})),f=null===b||"undefined"===typeof b?!1:b.getMinTraversals()<=a.getTraversalCount(b))});g.sort(function(b,c){return(new CTATExampleTracerLinkComparator(a,B)).compare(b,c)});B.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink before sorting");
var h=!1,n=null;g.forEach(function(c){!0!==h&&(B.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink after sorting in fro loop"),!0===l(c,a,b,z(),e)?(B.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink after sorting first if"),n=c,h=!0):a.getPaths().forEach(function(d){!0!==h&&(B.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink after sorting in inner loop"),b!==d&&(B.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink after sorting second if"),
!0===l(c,a,d,z(),e)&&(B.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink after sorting third if"),n=c,h=!0)))}))});if(!0===h)return B.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink returning: "+n.getUniqueID()),n;B.ctatdebug("CTATExampleTracerTracer --\x3e out of getHighestUntraversedLink");return null}function A(a){return null===a||"undefined"===typeof a?!1:1>a.getMinTraversals()&&1>a.getMaxTraversals()}function z(){return!(!B.isDemonstrateMode()&&!B.isInitialValuesDemonstrateMode())}
CTATBase.call(this,"CTATExampleTracerTracer",b);var C=!1,D=null,F=null,G=[],x=b,H=null,K=null;CTATExampleTracerTracer_count++;var I=CTATConfiguration.get("graph_for_results")?"demonstrate":!1,L=null,P={},B=this;this.logger=new CTATLogger(["tracervars","tracer"]);this.log=B.logger.log;this.getModelInitialized=function(){return C};this.setModelInitialized=function(a){C=a};this.goToDone=function(a,b,c){return(a=a.getPathToDone(b))?c.traceLinks(a.getSortedLinks()):!1};this.getMatchedSelections=function(){return P};
this.getLastResult=function(){B.ctatdebug("CTATExampleTracerTracer --\x3e in getResult");return K};this.resetTracer=function(){B.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer entering");null===D||"undefined"===typeof D?(B.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer making interpretations array"),D=[]):(B.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer clearing interpretations array"),D.length=0);x.redoLinkDepths();var a=new CTATExampleTracerInterpretation(u());B.ctatdebug("CTATExampleTracerTracer tempInterp--\x3e in resetTracer tempInterp "+
a);null!==g&&"undefined"!==typeof g&&(B.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer startStateVT if condition"),a.setVariableTable(g));D.push(a);L=a;if(null===F||"undefined"===typeof F)B.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer incorrectActionMatches if condition"),F={};else{B.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer else branch of incorrectActionMatches if condition");for(var b in F)F.hasOwnProperty(b)&&delete F[b]}P={};a=G?G.slice():[];null===G||"undefined"===
typeof G?B.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer saisForReplay empty"):B.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer else branch of last if condition");G=[];B.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer before iterating over all the links in the graphs");x.getLinks().forEach(function(a){a.getMatcher().resetMatcher()});B.ctatdebug("CTATExampleTracerTracer --\x3e out of resetTracer, oldSAIsForReplay.length "+a.length);return a};this.evaluate=function(b){B.ctatdebug("CTATExampleTracerTracer --\x3e in public evaluate(), calling private _evaluate; given event "+
b);b.setTutorType("example");return a(b,!1,!0)};this.nonEmptyHints=function(a,b){B.ctatdebug("CTATExampleTracerTracer --\x3e in nonEmptyHints");if(null===a||"undefined"===typeof a)return 0;b=a.interpolateHints(b);B.ctatdebug("CTATExampleTracerTracer --\x3e in nonEmptyHints: link.interpolateHints() "+a.interpolateHints().length);if(null===b||"undefined"===typeof b||1>b.length)return 0;for(var c=a=0;c<b.length;++c)0<String(b[c]).trim().length&&a++;B.ctatdebug("CTATExampleTracerTracer --\x3e returning from nonEmptyHints "+
a);return a};this.traceForHint=function(b){B.ctatdebug("CTATExampleTracerTracer --\x3e in traceForHint");b.setTutorType("example");var c=a(b,!0,!1);B.ctatdebug("CTATExampleTracerTracer --\x3e in traceForHint return from evaluate "+c);B.ctatdebug("CTATExampleTracerTracer --\x3e in traceForHint result from evaluate "+b.getResult().toString());B.ctatdebug("CTATExampleTracerTracer --\x3e in traceForHint link   from evaluate "+b.getReportableLink());if(b.getResult().toString()===CTATExampleTracerLink.CORRECT_ACTION.toString())return c=
b.getReportableLink(),b.setTutorSAI(new CTATSAI(b.getStudentSAI().getSelection(),c.getDefaultSAI().getAction(),c.getDefaultSAI().getInput())),b.setActor(CTATMsgType.DEFAULT_STUDENT_ACTOR),B.ctatdebug("CTATExampleTracerTracer --\x3e traceForHint returning hintLink "+c+", result "+b),c;B.ctatdebug("CTATExampleTracerTracer --\x3e out of traceForHint, returning null");return null};this.matchForHint=function(a){B.ctatdebug("CTATExampleTracerTracer --\x3e in matchForHint");var b;if((b=(b=a.getStudentSAI())?
b.getSelectionArray():null)&&0<b.length&&(B.ctatdebug("CTATExampleTracerTracer --\x3e in matchForHint first if"),(b=B.traceForHint(a))&&0<a.getReportableHints().length))return B.ctatdebug("CTATExampleTracerTracer --\x3e matchForHint via traceForHint returning "+b+", reportable hints "+a.getReportableHints()),a.setResult(CTATExampleTracerLink.HINT_ACTION),a.setTraceOutcome(CTATExampleTracerLink.HINT_ACTION),b;b=B.getBestNextLink(!0,a);a.setResult(CTATExampleTracerLink.HINT_ACTION);a.setTraceOutcome(0<
a.getReportableHints().length?CTATExampleTracerLink.HINT_ACTION:CTATExampleTracerLink.NO_MODEL);B.ctatdebug("CTATExampleTracerTracer --\x3e matchForHint() traceForHint via getBestNextLink returning "+b+", reportable hints "+a.getReportableHints());return b};this.getBestNextLink=function(a,b){B.ctatdebug("CTATExampleTracerTracer --\x3e in getBestNextLink");var c=[];a=y(a,c);if(null===a||"undefined"===typeof a)return B.ctatdebug("CTATExampleTracerTracer --\x3e in getBestNextLink returning null"),null;
if(a.getType().toString()===CTATExampleTracerLink.BUGGY_ACTION.toString())return B.ctatdebug("CTATExampleTracerTracer --\x3e in getBestNextLink return null no correct suboptimal step"),null;B.ctatdebug("CTATExampleTracerTracer --\x3e in getBestNextLink else branch");B.ctatdebug("CTATExampleTracerTracer --\x3e in getBestNextLink got interp "+(null==c?"null":c[0]));if(b){var d=a.interpolateHints(c[0].getVariableTable());b.setInterpolatedHints(d);B.ctatdebug("CTATExampleTracerTracer --\x3e in getBestNextLink setInterpolatedHints");
Array.isArray(d)&&0<d.length?b.setReportableHints(d):b.setReportableHints(a.getHints());B.ctatdebug("In evaluate --\x3e after setReportableHints");c&&c[0]&&c[0].setLatestHints(d,a.getHints());b.setReportableLink(a);b.setAssociatedSkills(a.getSkillNames());b.setReportableInterpretation(c[0]);b.setResult(a.getType());b.setTraceOutcome(a.getType());b.setStepID(a.getUniqueID());b.setTutorSAI(a.getDefaultSAI())}B.ctatdebug("CTATExampleTracerTracer --\x3e in getBestNextLink return etLink");return a};this.doHint=
function(a,b){B.ctatdebug("CTATExampleTracerTracer --\x3e in doHint");a.setTutorType("example");var c=B.matchForHint(a);Array.isArray(b)&&(B.ctatdebug("CTATExampleTracerTracer --\x3e in doHint last if condition"),b.push(a));B.ctatdebug("CTATExampleTracerTracer --\x3e returning from doHint: "+c);return c};this.getBestInterpretation=function(){B.ctatdebug("CTATExampleTracerTracer --\x3e in getBestInterpretation");if(null===L||"undefined"===typeof L)B.ctatdebug("CTATExampleTracerTracer --\x3e in getBestInterpretation in if condition"),
L=p(B.getInterpretationsInternal());B.ctatdebug("CTATExampleTracerTracer --\x3e out of getBestInterpretation "+(null===L||void 0===L));return L};this.getInterpretationsInternal=function(){B.ctatdebug("CTATExampleTracerTracer --\x3e in getInterpretationsInternal");return D};this.toString=function(){var a="TracerState\n";null===D?a+="(no interpretations)\n":D.forEach(function(b){a+=b.toString()+"\n"});return a};this.addInterfaceVariablesFromEvent=function(a){B.log("tracervars","ETT.addInterfaceVariablesFromEvent evt",
a,"evt.getTutorSAI()",a&&a.getTutorSAI()&&a.getTutorSAI().toString(),"Descs size",H&&H.size());if(a){var b=a.getTutorSelection(),c=a.getTutorAction();a=a.getTutorInput();B.addInterfaceVariables(b,c,a)}};this.addInterfaceVariables=function(a,b,c){B.log("tracervars","ETT.addInterfaceVariables",a,b,c,"Descs size",H&&H.size());B.ctatdebug("CTATExampleTracerTracer.addInterfaceVariables("+a+", "+c+")");if(a&&c){for(var d=Math.min(a.length,c.length),e=0;e<d;e++)B.log("tracervars","ETT.addInterfaceVariables",
e,b[e],H&&H.getAction(a[e])),CTATInterfaceDescriptions.updateVariableTable(g,a[e],b[e],c[e],H);B.log("tracervars","ETT.addInterfaceVariables startStateVT ",g);D&&D.forEach(function(e){if(e=e.getVariableTable()){for(var f=0;f<d;f++)CTATInterfaceDescriptions.updateVariableTable(e,a[f],b[f],c[f],H);B.log("tracervars","ETT.addInterfaceVariables interp.vt",e)}})}};this.findCurrentState=function(){B.ctatdebug("Entering findCurrentState");var a=B.getBestInterpretation(),b=null,c=-1;if(a&&(b=a.getLastMatchedLink())&&
(c=b.getNextNode(),B.log("tracer","ETT.findCurrentState lmLink",b.toString(),b),b.isDone()))return c;a=y(!1,[a]);B.log("tracer","ETT.findCurrentState bestNextLink",a&&a.toString(),a,"isDemonstrating",z());return a?a.getPrevNode():0<c&&1>x.getNode(c).getTraversableOutDegree()?c:x?x.getStartNode().getNodeID():null};this.saveLastReport=function(a){D&&a&&D.forEach(function(b){b.setLatestHints(a.getReportableHints()||[]);var c=a.getSuccessOrBuggyMsg()||[];a.getResult()==CTATExampleTracerLink.CORRECT_ACTION?
(b.setLatestSuccessMessage(0<c.length?c[0]:""),b.setLatestBuggyMessage("")):(b.setLatestSuccessMessage(""),b.setLatestBuggyMessage(0<c.length?c[0]:""))})};this.getMatchedLinks=function(){var a=B.getBestInterpretation();return a?a.getMatchedLinks():[]};this.getFarthestMatchedLink=function(){var a=B.getBestInterpretation();return a?a.getFarthestMatchedLink():null};this.addDemonstratedLink=function(a){var b=B.getFarthestMatchedLink(),b=b&&x.getNode(b.getNextNode())||x.getStartNode();if(!b)return console.error("CTATExampleTracerTracer.addDemonstratedLink(",
a,"): cannot find source node"),null;var c=b.getDimension()||{x:50,y:50},c=x.addNewNode({x:c.x,y:c.y+40});return x.addNewEdge(b,c,a)};this.getCurrentState=function(){var a=B.getBestInterpretation();return a?a.getCurrentState(x):x&&x.getStartNode()&&x.getStartNode().getNodeID()};this.getTraversedNodeIDs=function(){var a=B.getBestInterpretation();if(a)return a.getTraversedNodeIDs(x);a=new Set;x&&x.getStartNode()&&a.add(x.getStartNode().getNodeID());return a};this.getSAIsForReplay=function(){return G.slice()};
this.replay=function(a){var b=B.resetTracer();if(!Array.isArray(a)||1>a.length)a=b;for(var b=null,c=0;c<a.length;++c){var d=a[c],b=new CTATExampleTracerEvent(B,d.sai,d.actor);b.setTutorType("example");B.logger.log("tracer","ETT.replay["+c+"]("+d.sai+","+d.actor+") returns",B.evaluate(b,!1,!0),"result",b.toString(),"current state",B.findCurrentState())}return b};this.isDemonstrateMode=function(){return"demonstrate"==I};this.isInitialValuesDemonstrateMode=function(){return"initialValuesDemonstrate"==
I};this.setMode=function(a){I=a};this.getMode=function(){return I};this.setInterfaceDescriptions=function(a){H=a};this.getInterfaceDescriptions=function(){return H};this.getStartStateVT=function(){return g}};CTATExampleTracerTracer.prototype=Object.create(CTATBase.prototype);CTATExampleTracerTracer.prototype.constructor=CTATExampleTracerTracer;"undefined"!==typeof module&&(module.exports=CTATExampleTracerTracer);var CTATExampleTracerGraph=function(b,g,f){function e(b,c,e){E.ctatdebug("CTATExampleTracerGraph --\x3e in isOrderOK");if(E.relaxOrderConstraints()||c.isDone()&&E.exitOnIncorrectDone())return!0;for(var f=a(c),g=0;g<f.length;g++){var l=f[g];if(!0===M.isGroupOrdered(l))if(g!==f.length-1){if(!1===d(l,h(f[g+1],e),b,e))return!1}else if(!1===d(l,c,b,e))return!1}E.ctatdebug("CTATExampleTracerGraph --\x3e out of isOrderOK");return!0}function c(b,c,d){E.ctatdebug("CTATExampleTracerGraph --\x3e in isReenteringOK");
if(E.relaxOrderConstraints()||c.isDone()&&E.exitOnIncorrectDone())return!0;c=a(c);for(var e=!0,f=0;f<c.length;f++)if(!0===e&&!1===M.isGroupReenterable(c[f]))for(var e=!1,g=0;g<b.length;g++)if(!0===M.isLinkInGroup(c[f],b[g]))e=!0;else{if(!0===e)return!1}else if(!1===e)break;if(0!==b.length){var h=a(b[b.length-1]);E.ctatdebug("CTATExampleTracerGraph --\x3e in isReentrableOK: exitedGroups null? "+(null===h));E.ctatdebug("CTATExampleTracerGraph --\x3e in isReentrableOK: exitedGroups undefined? "+("undefined"===
typeof h));E.ctatdebug("CTATExampleTracerGraph --\x3e in isReentrableOK: exitedGroups last traversedLink "+b[b.length-1].getUniqueID());E.ctatdebug("CTATExampleTracerGraph --\x3e in isReentrableOK: exitedGroups length "+(h?h.length:null));c.forEach(function(a){a=h.indexOf(a);0<=a&&h.splice(a,1)});E.ctatdebug("CTATETGraph.isReentrableOK: exitedGroups.length after removing newLink's groups: "+h.length);for(k=h.length-1;0<=k;k--)M.isGroupReenterable(h[k])&&h.splice(k,1);E.ctatdebug("CTATETGraph --\x3e in isReentrableOK: exitedGroups after removing reenterables: "+
h.length);E.ctatdebug("CTATETGraph --\x3e in isReentrableOK: traversedLinks: "+b+", path: "+d);var n=!0;h.forEach(function(a){!1!==n&&d.forEach(function(c){!1!==n&&l(b,c)<c.getMinTraversals()&&!0===M.isLinkInGroup(a,c)&&(n=!1)})});if(!1===n)return!1}E.ctatdebug("CTATExampleTracerGraph --\x3e out of isReenteringOK");return!0}function a(a){E.ctatdebug("in findGroupsOfLink(link "+a+"): typeof(groupModel) "+typeof M);a=M.getGroupsContainingLink(a);E.ctatdebug("in findGroupsOfLink groupsSet.size "+a.size);
var b=[];a.forEach(function(a){E.ctatdebug("in findGroupsOfLink group element "+a.getName());b.push(a)});b.sort(function(a,b){return M.getGroupLinkCount(b)-M.getGroupLinkCount(a)});return b}function d(a,b,c,d){var e=-1,f=null,g=Number.MAX_VALUE,n=null;M.getGroupSubgroups(a).forEach(function(a){if(!1===M.isLinkInGroup(a,b)&&0!==M.getGroupLinkCount(a)){var l=h(a,d);null!==l&&"undefined"!==typeof l&&(l=l.getDepth(),l<b.getDepth()&&l>e&&(!1===p(a)||!0===q(a,c))&&(e=l,f=a),l>b.getDepth()&&l<g&&(!1===p(a)||
!0===q(a,c))&&(g=l,n=a))}});M.getUniqueLinks(a).forEach(function(a){if(!0===d.has(a)){var h=a.getDepth();h<b.getDepth()&&h>e&&(0<a.getMinTraversals()||-1<c.indexOf(a))&&(e=h,f=a);h>b.getDepth()&&h<g&&(0<a.getMinTraversals()||-1<c.indexOf(a))&&(g=h,n=a)}});if(null!==f&&"undefined"!==typeof f)if(f instanceof CTATExampleTracerLink){if(l(c,f)<f.getMinTraversals())return!1}else if(f instanceof CTATLinkGroup&&!1===u(f,c,d))return!1;return null!==n&&"undefined"!==typeof n&&(n instanceof CTATExampleTracerLink&&
-1<c.indexOf(n)||n instanceof CTATLinkGroup&&!0===q(n,c))?!1:!0}function h(a,b){var c=Number.MAX_VALUE,d=null;M.getGroupLinks(a).forEach(function(a){a.getDepth()<c&&!0===b.has(a)&&(c=a.getDepth(),d=a)});return d}function l(a,b){for(var c=0,d=0;d<a.length;d++)b===a[d]&&c++;E.ctatdebug("CTATETGraph.getTraversalCount("+b+"): "+c);return c}function n(a,b,c){var d=!1,e=!0,f=!1;(new CTATExampleTracerPath(b)).getSortedLinks().forEach(function(b){if(!1!==e&&!0!==f){if(!1===d)!0===M.isLinkInGroup(a,b)&&(d=
!0);else if(!1===M.isLinkInGroup(a,b)){f=!0;return}c.getTraversalCount(b)<b.getMaxTraversals()&&(e=!1)}});return!1===e?!1:!0}function p(a){var b=!0;M.getGroupLinks(a).forEach(function(a){!1!==b&&0!==a.getMinTraversals()&&(b=!1)});return!1===b?!1:!0}function q(a,b){for(var c=0;c<b.length;c++)if(!0===M.isLinkInGroup(a,b[c]))return!0;return!1}function u(a,b,c){var d=!0;M.getGroupLinks(a).forEach(function(a){!1!==d&&!0===c.has(a)&&l(b,a)<a.getMinTraversals()&&(d=!1)});return!1===d?!1:!0}function v(){for(var a=
E.getAllNodes().filter(function(a){return 1>a.getInLinks().size}),b=0;b<D.length;b++)D[b].clearInLinks();a.forEach(function(a){null!==a&&"undefined"!==typeof a&&null!==a.getOutLinks()&&"undefined"!==typeof a.getOutLinks()&&(b=0,a.getOutLinks().forEach(function(a){y(a,b++)}))})}function y(a,b){ctatdebug("updateInLinkSubGraph("+a+", "+b+")");b=E.getNode(a.getNextNode());if(null!==b&&"undefined"!==typeof b){b.addInLink(a);var c=0;b.getOutLinks().forEach(function(a){y(a,c++)})}}function w(a){var b=E.getNode(a.getPrevNode());
if(null!==b&&"undefined"!==typeof b){var c=-1;b.getInLinks().forEach(function(a){-1===a.getDepth()&&w(a);a.getDepth()>c&&(c=a.getDepth())});a.setDepth(c+1)}}function A(a,b){var c="",d=new Map;a.getSkills().forEach(function(a){return d.set(a.getSkillName(),Object.assign(a.toProductionRuleObject(),{opportunity_count:0}))});E.findBestPathToDone(E.getStudentStartsHereNode()).getSortedLinks().forEach(function(b){!/tutor/i.test(b.getActor())&&0<b.getMinTraversals()&&b.getSkills(a).forEach(function(a){var b=
a.getSkillName();a=d.get(b)||Object.assign(a.toProductionRuleObject(),{opportunity_count:0});a.opportunity_count++;d.set(b,a)})});d.forEach(function(a){return c+=CTATExampleTracerSkill.toXMLForBRDStatic(a,b)+"\n"});return c}function z(a){var b=E.getGroupModel(),c=b.getTopLevelGroup(),d="",e=c.getSubgroups(),d=a+'<EdgesGroups ordered="'+c.getIsOrdered()+'">\n';e.forEach(function(c){d+=c.toXML(a+"    ",b)});return d+=a+"</EdgesGroups>\n"}CTATBase.call(this,"CTATExampleTracerGraph","visualdata");var C=
null,D=null,F=null,G=null,x=null,H=!0,K=null,I="",L=[],P=new Set,B=new Set,r=null,M=null,V=!0,N=!0,Q=CTATHintPolicyEnum.DEFAULT,R=CTATMsgType.DEFAULT_FEEDBACK,aa=null,E=this;this.src="";this.getAllNodes=function(){var a=[],b;for(b in G)a.push(G[b]);return a};this.getHintPolicy=function(){return Q};this.setHintPolicy=function(a){Q=a};this.getFeedbackPolicy=function(){return R};this.setFeedbackPolicy=function(a){E.ctatdebug("Graph.setFeedbackPolicy("+a+") old policy "+R);R="false"===a?CTATMsgType.SHOW_ALL_FEEDBACK:
"true"===a?CTATMsgType.HIDE_ALL_FEEDBACK:a};this.hideButRequireSteps=function(){return R==CTATMsgType.HIDE_BUT_COMPLETE};this.hideAllFeedback=function(){return R==CTATMsgType.HIDE_ALL_FEEDBACK};this.relaxOrderConstraints=function(){return E.hideAllFeedback()||E.hideButRequireSteps()||R==CTATMsgType.DELAY_FEEDBACK||R==CTATMsgType.SHOW_FEEDBACK_AS_QUIZ};this.exitOnIncorrectDone=function(){switch(R){case CTATMsgType.SHOW_FEEDBACK_AS_QUIZ:case CTATMsgType.HIDE_ALL_FEEDBACK:case CTATMsgType.HIDE_BUT_ENFORCE:return!0;
default:return!1}};this.getDefaultBuggyMsg=function(){return M.getTopLevelGroup()?M.getTopLevelGroup().getDefaultBuggyMsg():null};this.getLinks=function(){E.ctatdebug("CTATExampleTracerGraph --\x3e in getLinks");return F};this.addLink=function(a,b){E.ctatdebug("CTATExampleTracerGraph --\x3e in addLink");E.updateMaxEdgeID(a.getUniqueID());F.push(a);a.isDone()?B.add(a):B.delete(a);null===b||"undefined"===typeof b?M.addLinkToGroup(M.getTopLevelGroup(),a):M.addLinkToGroup(b,a);E.ctatdebug("CTATExampleTracerGraph --\x3e out of addLink")};
this.addNode=function(a){E.ctatdebug("CTATExampleTracerGraph --\x3e in addNode");D.push(a);G[E.updateMaxNodeID(a.getNodeID())]=a;E.ctatdebug("CTATExampleTracerGraph --\x3e out of addNode")};this.addNewNode=function(a){var b=++E.maxNodeID,c=new CTATExampleTracerNode(b,new Set);c.setNodeName("state"+b);a&&c.setDimension({x:a.x,y:a.y});E.addNode(c);return c};this.addNewEdge=function(a,b,c,d){var e=++E.maxEdgeID,e=new CTATExampleTracerLink(e,a.getNodeID(),b.getNodeID());a.addOutLink(e);b.addInLink(e);
e.setDemoMsgObj(CTATMessage.fromString((new CTATTutoringServiceMessageBuilder).createInterfaceActionMessage(CTATGuid.guid(),c)));e.addHint(CTATExampleTracerLink.createDefaultHint(c.getSelection(),c.getAction(),c.getInput()));var f=new CTATExactMatcher(CTATMatcher.SELECTION,null);f.setParameter(String(c.getSelection()));var g=new CTATExactMatcher(CTATMatcher.ACTION,null);g.setParameter(String(c.getAction()));var h=new CTATExactMatcher(CTATMatcher.INPUT,null);h.setParameter(String(c.getInput()));d=
new CTATVectorMatcher([f],[g],[h],d||CTATMsgType.DEFAULT_STUDENT_ACTOR);d.setDefaultSAI(c);d.setCaseInsensitive(E.getCaseInsensitive());d.setLinkTriggered(!1);e.setMatcher(d);E.checkForDoneState(e);E.addLink(e);window.postMessage({command:"tutorEdited",details:{edit:"addLink",linkid:e.getUniqueID(),prevNode:a.getNodeID(),nextNode:b.getNodeID(),linktype:e.getType(),selection:c.getSelection(),action:c.getAction(),input:c.getInput()}},location.origin);return e};this.maxEdgeID=0;this.updateMaxEdgeID=
function(a){return E.maxEdgeID<a?E.maxEdgeID=a:a};this.maxNodeID=0;this.updateMaxNodeID=function(a){return E.maxNodeID<a?E.maxNodeID=a:a};this.findAllPaths=function(a){ctatdebug("CTATExampleTracerGraph --\x3e in findAllPaths "+E.getStartNode().getNodeID());return E.findPathsFromNode(E.getStartNode(),a)};this.pathToLinkIsSubset=function(a,b){var c=E.getNode(a.getPrevNode());E.ctatdebug("pathToLinkIsSubset("+a+") sourceNode "+c.getNodeID());if(0<a.getMinTraversals()&&"undefined"==typeof b[a.getUniqueID()])return!1;
if(c==E.getStartNode())return!0;for(a=c.getInLinks().values();!(a=a.next()).done;)return E.pathToLinkIsSubset(a.value,b);return!1};this.observesOrderingConstraints=function(a,b,d,f){E.ctatdebug("CTATExampleTracerGraph --\x3e in observesOrderingConstraints");null!==f&&"undefined"!==typeof f&&(E.ctatdebug("CTATExampleTracerGraph --\x3e in observesOrderingConstraints initializing out of order false"),f.setOutOfOrder(!1));if(null===d||"undefined"===typeof d||0===d.size||null===b||"undefined"===typeof b)return E.ctatdebug("CTATExampleTracerGraph --\x3e returning first true observesOrderingConstraints"),
!0;if(b.isDone()&&E.exitOnIncorrectDone())return E.ctatdebug("CTATExampleTracerGraph.observesOrderingConstraints --\x3e returning true for doneStep && exitOnIncorrectDone"),!0;if(!0===d.has(b)&&!0===e(a,b,d)&&!0===c(a,b,d))return E.ctatdebug("CTATExampleTracerGraph.observesOrderingConstraints --\x3e returning isOrderOK true && isisReenteringOK() true"),!0;null!==f&&"undefined"!==typeof f&&(E.ctatdebug("CTATExampleTracerGraph --\x3e in observesOrderingConstraints setting out of order true"),f.setOutOfOrder(!0));
E.ctatdebug("CTATExampleTracerGraph --\x3e returning false observesOrderingConstraints");return!1};this.isIncorrectLinkOK=function(a,b,c,d){E.ctatdebug("CTATExampleTracerGraph --\x3e in isIncorrectLinkOK");var f=!1,g=null,h=!0,l=!1;E.getNode(b.getPrevNode()).getOutLinks().forEach(function(b){!0!==l&&!1!==h&&b.getType().toString()!==CTATExampleTracerLink.BUGGY_ACTION.toString()&&!0===c.has(b)&&(f=!0,!1===e(a,b,c)?h=!1:(g=b,l=!0))});if(!1===h||null===g||"undefined"===typeof g)return!1;if(!1===f)return E.ctatdebug("isIncorrectLinkOK(): no siblings of link in path"),
!1;if(!0===f&&(b=E.getSmallestContainingGroup(b),!0===M.isLinkInGroup(b,g)&&!1===M.isGroupOrdered(b)&&!0===n(b,c,d)))return!1;E.ctatdebug("CTATExampleTracerGraph --\x3e out of isIncorrectLinkOK");return!0};this.getStateGraphMsg=function(a){return(new CTATTutorMessageBuilder).createStateGraphMessage(E.getCaseInsensitive(),!E.getGroupModel().getTopLevelGroup().getIsOrdered(),E.getLockWidget(),a.isSourceFlash()?E.exitOnIncorrectDone():a.isFeedbackSuppressed(),E.isHighlightRightSelection(),String(a.getConfirmDone()),
a.getSkillBarVector(!1,!0))};this.toXML=function(a){var b=this.getLinks(),c=E.getGroupModel().getTopLevelGroup().getIsOrdered(),d;d='<?xml version="1.0" standalone="yes"?>\n<stateGraph firstCheckAllStates="true" caseInsensitive="'+E.getCaseInsensitive();d=d+('" unordered="'+!c)+('" lockWidget="'+E.getLockWidget());d+='" hintPolicy="'+E.getHintPolicy();d=d+'" version="4.0'+('" suppressStudentFeedback="'+E.getFeedbackPolicy());d+='" highlightRightSelection="'+E.isHighlightRightSelection();d+='" confirmDone="'+
a.getConfirmDone();null!=aa&&(d+='" regexMatchWholeString="'+E.getRegexMatchWholeString());d+='" startStateNodeName="'+E.getStudentStartStateNodeName();d+='" tutorType="Example-tracing Tutor">\n';for(var c=this.getStartStateMsgs(),e="    <startNodeMessages>\n",f=0;f<c.length;f++)e+="        "+c[f].outerHTML+"\n";d+=e+"    </startNodeMessages>\n";for(c=0;c<D.length;c++)d+=D[c].toXML("    ")+"\n";for(c=0;c<b.length;c++)d+=b[c].toXML("    ")+"\n";d+=A(a,"    ");d+=z("    ");return d+"</stateGraph>\n"};
this.getSkillUseCount=function(a,b){var c=CTATExampleTracerSkill.makeKey(a,b),d=0;F.forEach(function(a){return a.getSkillNames().includes(c)&&++d});return d};this.addGroup=function(a,b,c){};this.getCaseInsensitive=function(){return N};this.setCaseInsensitive=function(a){N=a};this.getLockWidget=function(){return V};this.setLockWidget=function(a){V=a};this.isHighlightRightSelection=function(){return H};this.setHighlightRightSelection=function(a){H=a};this.getStartStateMsgs=function(){return L};this.setStartStateMsgs=
function(a){L=a};this.convertStartStateToTPAs=function(a,b){var c=[],d=[],e=new XMLSerializer;a.forEach(function(a){if("message"==b.getElementName(a)){var f=e.serializeToString(a),f=CTATMsgType.getMessageType(f);CTATMsgType.UNTUTORED_ACTION==f||CTATMsgType.INTERFACE_ACTION==f?(a=CTATMsgType.getSAIArraysFromElement(a,b),d.push(new CTATSAI(a.selection[0]||"",a.action[0]||"",a.input[0]||""))):c.push(a)}});a=E.addStartStateLinks(d);E.setStartStateMsgs(c);console.log("convertStartStateToTPAs() addedLinkIDs",
a);return c};this.addStartStateLinks=function(a){var b=[],c=null,d=E.getStartNode().getNodeID();a.forEach(function(a){return(c=E.addStartStateLink(a,d))&&(d=c.getNextNode())&&b.push(c.getUniqueID())});return b};this.addStartStateLink=function(a,b){b=E.getNode(0<b?b:E.findEndOfStartState());if(!b)return console.log("CTATExTrGraph.addStartStateLink(",a,"): findEndOfStartState() returns null or 0"),null;var c=b.getDimension()||{x:50,y:50},c=E.addNewNode({x:c.x+60,y:c.y+40}),d=E.moveOutLinks(b,c,!1);
console.log("addSSL.moveOutLinks(",b.getNodeID(),c.getNodeID(),")",d);a=E.addNewEdge(b,c,a,CTATMsgType.UNGRADED_TOOL_ACTOR);E.redoLinkDepths();return a};this.moveOutLinks=function(a,b,c){var d=[];a.getOutLinks().forEach(function(a){return d.push(a.getUniqueID())});var e="";d.forEach(function(a){return(e=E.rerouteLink(a,b.getNodeID(),!1,c))&&console.log("Error in moveOutLinks.rerouteLink(",a,b.getNodeID(),"):",e)});return d};this.getNode=function(a){E.ctatdebug("CTATExampleTracerGraph --\x3e in getNode("+
a+") returning "+G[a]);return G[a]};this.findNode=function(a){if(a){a=a.toLowerCase();for(var b in G)if(G[b].getNodeName().toLowerCase()==a)return E.getNode(b);if("start"==a)return E.getStudentStartsHereNode()||E.getStartNode()}return null};this.isStartStateLink=function(a){return E.getStartStateLink(a)};this.getStartStateLinks=function(a){for(var b=[],c=E.getStartNode().getOutLinks(),d=null;2>c.size&&(d=c.entries().next())&&(d=d.value&&d.value[0])&&d.isTutorPerformed(null)&&0<d.getMaxTraversals();c=
E.getNode(d.getNextNode()).getOutLinks()){if(a==d.getUniqueID())return d;b.push(d)}return Number.isInteger(a)?null:b};this.findEndOfStartState=function(){var a=E.getStartStateLinks().pop();return a?a.getNextNode():E.getStartNode().getNodeID()};this.deleteSubtree=function(a,b,c){var d=E.getNode(a);if(!d)return"Could not find state with ID "+a;if(d==E.getStartNode())return"Cannot delete the origin state "+d.getNodeName()+"(ID "+a+")";b=b?b.add(a):new Set;c=c||new Set;console.log("deleteSubtree nodeID",
a,"nInLinks",d.getInLinks().size,"nodeSet",b,"linkSet",c);var e="";try{var f=0;d.getInLinks().forEach(function(a){return c.has(a.getUniqueID())&&++f});console.log("countInLinksInSet",f,"size",d.getInLinks().size);if(!b.has(a)||f>=d.getInLinks().size)d.getOutLinks().forEach(function(a){c.add(a.getUniqueID());var d=a.getNextNode(),f=E.getNode(d),g=f&&f.getNodeName()||"null";if(e=f?E.deleteSubtree(f.getNodeID(),b,c):"Could not find destination state with ID "+d+" from link with ID "+a.getUniqueID())throw Error("Error deleting subtree at state "+
g()+"(ID "+d+"): "+e);}),b.has(a)&&E.deleteNode(a);if(!b.has(a)){var g=[];d.getOutLinks().forEach(function(a){return g.push(a.getUniqueID())});console.log("nodeID",a,"linksToDelete",g);g.forEach(function(a){return E.deleteLink(a)})}return""}catch(ta){throw Error("Error deleting nodeID "+destNodeID+": "+e);}};this.deleteNode=function(a){var b=E.getNode(a);if(!b)return"Could not find state with ID "+a;if(b==E.getStartNode())return"Cannot delete the origin state "+b.getNodeName()+"(ID "+a+")";var c=
"";try{b.getOutLinks().forEach(function(d){if(c=E.deleteLink(d.getUniqueID()))throw Error("Error deleting outgoing link "+d.getUniqueID()+" from state "+b.getNodeName()+"(ID "+a+"): "+c);})}catch(fa){return fa.toString()}try{b.getInLinks().forEach(function(d){if(c=E.deleteLink(d.getUniqueID()))throw Error("Error deleting incoming link "+d.getUniqueID()+" from state "+b.getNodeName()+"(ID "+a+"): "+c);})}catch(fa){return fa.toString()}b.getNodeName()==E.getStudentStartStateNodeName()&&E.setStudentStartsHereNode(E.getStartNode());
D.splice(D.indexOf(b),1);delete G[a];return""};this.okToMergeNodesIfDelete=function(a){var b=E.getLinkByID(a);if(!b)return!1;var c=b.getNextNode(),d=b.getPrevNode();if(E.isReachableFrom(c,d,a))return!1;var b=E.getNode(c),e=E.getNode(d);if(!b||!e||b==e)throw Error("okToMergeNodesIfDelete("+a+") dest",c,"or src",d,"missing or equal");var f=new Set;b.getInLinks().forEach(function(a){return f.add(a.getPrevNode())});a=e.getInLinks().values();for(var g;(g=a.next())&&!g.done;)if(f.has(g.value.getPrevNode()))return!1;
f.clear();b.getOutLinks().forEach(function(a){return f.add(a.getNextNode())});for(a=e.getOutLinks().values();(g=a.next())&&!g.done;)if(f.has(g.value.getNextNode()))return!1;return!0};this.isReachableFrom=function(a,b,c){b||(b=E.getStartNode().getNodeID());if(a==b)return!0;a=E.getNode(a).getInLinks().values();for(var d;(d=a.next())&&!d.done;)if(d.value.getUniqueID()!=c&&E.isReachableFrom(d.value.getPrevNode(),b,c))return!0;return!1};this.deleteLink=function(a){for(var b=null,c=-1;!b&&++c<F.length;)F[c].getUniqueID()==
a&&(b=F[c]);if(!b)return"Error: cannot find link with ID "+a;var d=E.getNode(b.getPrevNode()),e=E.getNode(b.getNextNode());if(!d)return"Error: cannot find source state (ID "+b.getPrevNode()+") for link "+a;if(!e)return"Error: cannot find destination state (ID "+b.getNextNode()+") for link "+a;E.getGroupModel().removeLink(b);B.delete(b);F.splice(c,1);d.deleteOutLink(b);e.deleteInLink(b);return""};this.rerouteLink=function(a,b,c,d){var e=E.getLinkByID(a),f=E.getNode(b);if(!e)return"Error: cannot find link with ID "+
a;if(!f)return"Error: cannot find state with ID "+b;if(b==e.getNextNode()||b==e.getPrevNode())return"Error: link "+a+" is already connected to state "+f.getNodeName();a=$jscomp.makeIterator(f.getInLinks().values());for(var g=a.next();!g.done;g=a.next())if(g.value.getType()==CTATExampleTracerLink.BUGGY_ACTION)return"Error: cannot attach links after incorrect actions";if(c){d=E.getNode(e.getNextNode());if(!d)return"Error: could not find state for previous destination, id "+e.getNextNode();d.deleteInLink(e);
f.addInLink(e);e.setNextNode(b)}else{c=E.getNode(e.getPrevNode());if(!c)return"Error: could not find state for previous source, id "+e.getPrevNode();c.deleteOutLink(e,d);f.addOutLink(e,d);e.setPrevNode(b)}E.redoLinkDepths();E.getExampleTracer().resetTracer();return""};this.findBestPathToDone=function(a){var b=Array.from(E.getDoneStates().values()).map(function(b){return E.getBestSubpath(a,b)});return CTATExampleTracerPath.getBestPath(b||[])||new CTATExampleTracerPath};this.findPathsFromNode=function(a,
b){E.ctatdebug("CTATExampleTracerGraph --\x3e in findPathsFromNode outlinks "+a.getOutLinks().size);var c=new Set;if(!a||0===a.getOutLinks().size)return c.add(new CTATExampleTracerPath(null)),c;E.ctatdebug("CTATExampleTracerGraph --\x3e before forEach ");a.getOutLinks().forEach(function(a){E.ctatdebug("CTATExampleTracerGraph --\x3e in forEach "+a.getType().toString());if(![CTATExampleTracerLink.BUGGY_ACTION,CTATExampleTracerLink.UNTRACEABLE_ERROR].includes(a.getType().toString())||b){var d=E.findPathsFromNode(E.getNode(a.getNextNode()),
b);E.ctatdebug("findPathsFromNode childPaths.size "+d.size);d.forEach(function(b){E.ctatdebug("findPathsFromNode childPath.size "+b.size+", outLink "+a);b.addLink(a);c.add(b)})}},a);0===c.size&&c.add(new CTATExampleTracerPath(null));E.ctatdebug("CTATExampleTracerGraph --\x3e out of findPathsFromNode "+c.size);return c};this.getDoneStates=function(){return P};this.checkForDoneState=function(a){if(a.isDone()&&a.isTraversable()){var b=E.getNode(a.getNextNode());E.ctatdebug("CTATExampleTracerGraph.addDoneState(linkID "+
a.getUniqueID()+") adding destNode "+b);P.add(b)}};this.getBestSubpath=function(a,b,c){if(!a||!b)return null;var d=E.findPathsFromNode(a),e=new Set;d.forEach(function(a){a=a.subpath(b);!a||c&&!a.containsAll(c)||e.add(a)});E.ctatdebug("CTATExampleTracerGraph.getBestSubpath("+a+", "+b+", ["+(c?c.length:-1)+"]) pathsFrom "+d.size+", pathsFromTo "+e.size);return 1>e.size?null:CTATExampleTracerPath.getBestPath(e)};this.getStartNode=function(){E.ctatdebug("CTATExampleTracerGraph --\x3e in getStartNode() returning "+
x);return x};this.getLinkByID=function(a){E.ctatdebug("CTATExampleTracerGraph --\x3e in getLinkByID");for(var b=0;b<F.length;b++)if(F[b].getUniqueID()===a)return F[b];E.ctatdebug("CTATExampleTracerGraph --\x3e out of getLinkByID");return null};this.setStartNode=function(a){E.ctatdebug("CTATExampleTracerGraph --\x3e in setStartNode("+a+")");x=a};this.getStudentStartsHereNode=function(){return null!=K?K:E.getStartNode()};this.setStudentStartsHereNode=function(a){E.ctatdebug("CTATExampleTracerGraph --\x3e in setStudentStartsHereNode("+
a+")");K=a};this.setStudentStartStateNodeName=function(a){I=a};this.getStudentStartStateNodeName=function(){return I};this.getExampleTracer=function(){E.ctatdebug("CTATExampleTracerGraph --\x3e in getExampleTracer() returning "+C);return C};this.forDebugging=function(){E.ctatdebug("CTATExampleTracerGraph --\x3e in forDebugging");E.ctatdebug("Nodes in the graph -- ids");D.forEach(function(a){E.ctatdebug(a.getNodeID())});E.ctatdebug("Links in the graph -- ids, from, to");F.forEach(function(a){E.ctatdebug(a)})};
this.getSmallestContainingGroup=function(a){return M.getLowestLevelGroupOfLink(a)};this.redoLinkDepths=function(){v();E.getLinks().forEach(function(a){a.setDepth(-1)});E.getLinks().forEach(function(a){-1===a.getDepth()&&w(a)})};this.getGroupModel=function(){return M};this.setVisualData=function(a){E.ctatdebug("CTATExampleTracerGraph --\x3e in setVisualData");r=a};this.getVisualData=function(){E.ctatdebug("CTATExampleTracerGraph --\x3e in getVisualData() returning "+r);return r};this.getDoneLinks=
function(){return B};this.getRegexMatchWholeString=function(){return CTATRegexMatcher.getMatchWholeString()};this.setRegexMatchWholeString=function(a){CTATRegexMatcher.setMatchWholeString(/^false$/i.test(a)||!1===a?!1:a);aa=CTATRegexMatcher.getMatchWholeString()};(function(a,b){E.ctatdebug("CTATExampleTracerGraph --\x3e in initGraph ("+a+" , "+b);F=[];D=[];G={};if(null===M||"undefined"===typeof M)M=new CTATDefaultGroupModel,E.ctatdebug("CTATExampleTracerGraph --\x3e created a group model from here");
M.clear();M.setDefaultReenterable(!b);M.setGroupOrdered(M.getTopLevelGroup(),a);M.setGroupName(M.getTopLevelGroup(),CTATExampleTracerGraph.TOP_LEVEL);C=new CTATExampleTracerTracer(E,f);E.ctatdebug("CTATExampleTracerGraph --\x3e out of initGraph")})(!b,g)};Object.defineProperty(CTATExampleTracerGraph,"TOP_LEVEL",{enumerable:!1,configurable:!1,writable:!1,value:"Top Level"});Object.defineProperty(CTATExampleTracerGraph,"STUDENT_BEGINS_HERE_VAR",{enumerable:!1,configurable:!1,writable:!1,value:"%(startStateNodeName)%"});
Object.defineProperty(CTATExampleTracerGraph,"IS_ORDERED",{enumerable:!1,configurable:!1,writable:!1,value:"ordered"});Object.defineProperty(CTATExampleTracerGraph,"EMPTY_GRAPH",{enumerable:!1,configurable:!1,writable:!1,value:'<?xml version="1.0" standalone="yes"?>\n<stateGraph firstCheckAllStates="true" caseInsensitive="true" unordered="true" lockWidget="true" hintPolicy="Use Both Kinds of Bias" version="4.0" suppressStudentFeedback="Show All Feedback" highlightRightSelection="true" confirmDone="false" startStateNodeName="%(startStateNodeName)%" tutorType="Example-tracing Tutor">\n  <startNodeMessages>\n    <message>\n      <verb>NotePropertySet</verb>\n      <properties>\n        <MessageType>StartProblem</MessageType>\n        <ProblemName>empty</ProblemName>\n      </properties>\n    </message>\n    <message>\n      <verb>NotePropertySet</verb>\n      <properties>\n        <MessageType>StartStateEnd\n        </MessageType>\n      </properties>\n    </message>\n  </startNodeMessages>\n  <node locked="false" doneState="false">\n    <text>empty</text>\n    <uniqueID>1</uniqueID>\n    <dimension>\n      <x>217</x>\n      <y>25</y>\n    </dimension>\n  </node>\n  <EdgesGroups ordered="false"></EdgesGroups>\n</stateGraph>'});
CTATExampleTracerGraph.prototype=Object.create(CTATBase.prototype);CTATExampleTracerGraph.prototype.constructor=CTATExampleTracerGraph;"undefined"!==typeof module&&(module.exports=CTATExampleTracerGraph);var CTATGraphParser=function(){function b(b,c){ctatdebug("processEdge()");c=new CTATExampleTracerLink(null,null,null);for(var f=d.getElementChildren(b),h,l,p,q,u,D=b=-1,F=CTATMsgType.DEFAULT_ACTOR,G=!1,x=0;x<f.length;x++){"sourceID"===d.getElementName(f[x])&&(b=parseInt(d.getNodeTextValue(f[x])),c.setPrevNode(b));"destID"===d.getElementName(f[x])&&(D=parseInt(d.getNodeTextValue(f[x])),c.setNextNode(D));if("rule"===d.getElementName(f[x]))for(var H=d.getElementChildren(f[x]),K=0;K<H.length;K++)"text"===
d.getElementName(H[K])&&c.addSkillName(d.getNodeTextValue(H[K]).toString());if("actionLabel"===d.getElementName(f[x]))for(c.setIsPreferredLink("false"!=d.getElementAttr(f[x],"preferPathMark")),c.setMinTraversalsStr(d.getElementAttr(f[x],"minTraversals")),c.setMaxTraversalsStr(d.getElementAttr(f[x],"maxTraversals")),H=d.getElementChildren(f[x]),K=0;K<H.length;K++){"uniqueID"===d.getElementName(H[K])&&(u=d.getNodeTextValue(H[K]),c.setUniqueID(parseInt(d.getNodeTextValue(H[K]))));"message"===d.getElementName(H[K])&&
(q=new CTATMessage(H[K]),c.setDemoMsgObj(q));"actionType"===d.getElementName(H[K])&&c.setActionType(d.getNodeTextValue(H[K]));"buggyMessage"===d.getElementName(H[K])&&c.addBuggyMsg(d.getNodeTextValue(H[K]));"successMessage"===d.getElementName(H[K])&&c.addSuccessMsg(d.getNodeTextValue(H[K]));"hintMessage"===d.getElementName(H[K])&&c.addHint(d.getNodeTextValue(H[K]));if("matchers"===d.getElementName(H[K]))for(var I=d.getElementChildren(H[K]),L=0;L<I.length;L++)"Selection"===d.getElementName(I[L])&&
(h=g(I[L],0)),"Action"===d.getElementName(I[L])&&(l=g(I[L],1)),"Input"===d.getElementName(I[L])&&(p=g(I[L],2)),"Actor"===d.getElementName(I[L])&&(F=d.getNodeTextValue(I[L]),G=(G=d.getElementAttr(I[L],"linkTriggered"))&&"false"!=G.toLowerCase().trim()?!0:!1);if("matcher"===d.getElementName(H[K])){p=H[K];l=q;h=d.getElementAttr(p,"replacementFormula");var P=d.getElementChildren(p),B=I=void 0,r,M=void 0,L=CTATMsgType.DEFAULT_ACTOR;p=new CTATExactMatcher(CTATMatcher.SELECTION,null);F=new CTATExactMatcher(CTATMatcher.ACTION,
null);e.ctatdebug("processMatcher(): nChildren "+P.length+", saiMessage "+l);for(var V=0;V<P.length;V++)"matcherType"===d.getElementName(P[V])&&(r=d.getNodeTextValue(P[V]),"ExactMatcher"===r&&(B=CTATExactMatcher),"RegexMatcher"===r&&(B=CTATRegexMatcher),"AnyMatcher"===r&&(B=CTATAnyMatcher),"RangeMatcher"===r&&(B=CTATRangeMatcher),"WildcardMatcher"===r&&(B=CTATWildcardMatcher),"ExpressionMatcher"===r&&(B=CTATExpressionMatcher),e.ctatdebug("processMatcher(): child "+V+", eltText "+r+", matcher "+B)),
"matcherParameter"===d.getElementName(P[V])&&(r=d.getElementAttr(P[V],"name"),M=d.getNodeTextValue(P[V]),"selection"==r&&p.setParameter(M),"action"==r&&F.setParameter(M),"input"==r&&(I=I?I:new B(CTATMatcher.INPUT,null),I.setParameter(M)),"actor"==r&&(L=M),"minimum"==r&&(I=I?I:new B(CTATMatcher.INPUT,null),I.setParameter(M,"minimum")),"maximum"==r&&(I=I?I:new B(CTATMatcher.INPUT,null),I.setParameter(M,"maximum")),"InputExpression"==r&&(I=I?I:new B(CTATMatcher.INPUT,null),I.setParameter(P[V],r,d)),
"relation"==r&&(I=I?I:new B(CTATMatcher.INPUT,null),I.setParameter(P[V],r,d)),e.ctatdebug("processMatcher(): child "+V+", eltAttrName "+r+", inputMatcher "+I));I||(I=B?new B(CTATMatcher.INPUT,null):new CTATExactMatcher(CTATMatcher.INPUT,null),I.setParameter(M?M:""),"undefined"!=typeof l&&"function"==typeof l.getSAI&&(l=l.getSAI(),p.setSingle(l.getSelection()),F.setSingle(l.getAction()),I.setSingle(l.getInput())));I.setReplacementFormula(h);F=[[p],[F],[I],L];h=F[0];l=F[1];p=F[2];F=F[3]}}}a.getStartNode()&&
D==a.getStartNode().getNodeID()&&console.log("***WARNING*** edge "+u+" destination is graph startNode "+a.getStartNode());u=new CTATVectorMatcher(h,l,p,F);u.setDefaultSAI(q.getSAI());u.setCaseInsensitive(n);u.setLinkTriggered(G);c.setMatcher(u);ctatdebug("GraphParser.processEdge() "+b+"->"+D+", edge "+c);a.getNode(b).addOutLink(c,!1);a.checkForDoneState(c);return c}function g(a,b){e.ctatdebug("processMatchers()");a=d.getElementChildren(a);for(var c=[],f=0;f<a.length;f++)if("matcher"===d.getElementName(a[f])){for(var g=
null,h=d.getElementAttr(a[f],"replacementFormula"),l=d.getElementChildren(a[f]),n=0;n<l.length;n++){if("matcherType"===d.getElementName(l[n]))switch(g=d.getNodeTextValue(l[n]),e.ctatdebug("CTATGraphParser.processMatchers() matcherType["+n+"] = "+g),g){case "ExactMatcher":g=new CTATExactMatcher(b,null);break;case "RegexMatcher":g=new CTATRegexMatcher(b,null);break;case "AnyMatcher":g=new CTATAnyMatcher(b,null);break;case "RangeMatcher":g=new CTATRangeMatcher(b,null);break;case "WildcardMatcher":g=
new CTATWildcardMatcher(b,null);break;case "ExpressionMatcher":g=new CTATExpressionMatcher(b,null);break;default:console.log("CTATGraphParser.processMatchers() unknown matcherType["+n+"] = "+g+"; using CTATExactMatcher"),g=new CTATExactMatcher(b,null)}if("matcherParameter"===d.getElementName(l[n])){var p=d.getElementAttr(l[n],"name");"single"===p?g.setParameter(d.getNodeTextValue(l[n])):"minimum"===p?g.setParameter(d.getNodeTextValue(l[n]),"minimum"):"maximum"===p?g.setParameter(d.getNodeTextValue(l[n]),
"maximum"):g.setParameter(l[n],p,d)}}g&&g.setReplacementFormula(h);c.push(g)}return c}function f(a,b){var c=new Set;if("group"!==d.getElementName(a))return c;var g=d.getElementAttr(a,"name");e.logger.log("graphparser","readGroupFromXML",g,"entered");var h="true"===d.getElementAttr(a,"ordered"),n="true"===d.getElementAttr(a,"reenterable");e.logger.log("graphparser","readGroupFromXML",g,"isOrdered",h,typeof h);var p=function(a){c.add(a)};a=d.getElementChildren(a);for(var q=0;q<a.length;q++){if("link"===
d.getElementName(a[q])){var u=Number(d.getElementAttr(a[q],"id")),F=b[u];if(null!==F||void 0!==F)e.logger.log("graphparser","readGroupFromXML",g,"Added link ID",u),c.add(F)}"group"===d.getElementName(a[q])&&(e.logger.log("graphparser","readGroupFromXML",g,"encountered a subgroup"),u=f(a[q],b),e.logger.log("graphparser","readGroupFromXML",g,"return from subgroup",u),u.forEach(p))}e.logger.log("graphparser","readGroupFromXML",g,"to add this group",c);(b=l.addGroup(g,h,c))&&console.error("Error in CTATGraphParser.readGroupFromXML("+
g+"): "+b);e.logger.log("graphparser","readGroupFromXML",g,"to setGroupReenterable",n);l.setGroupReenterable(l.getGroupByName(g),n);return c}CTATBase.call(this,"CTATGraphParser","__undefined__");var e=this,c,a,d=new CTATXML,h=[];new XMLSerializer;var l,n=!0,p=[];this.logger=new CTATLogger("graphparser");this.parseGraph=function(g,u){ctatdebug("parseBRD()");var q=0,y="true"===d.getElementAttr(g,"unordered");n="false"!=String(d.getElementAttr(g,"caseInsensitive")).toLowerCase();var w=d.getElementAttr(g,
"lockWidget"),A=new CTATVariableTable;a=new CTATExampleTracerGraph(y,!1,A);a.setCaseInsensitive(n);a.setStudentStartStateNodeName(d.getElementAttr(g,"startStateNodeName"));a.setLockWidget(w);w=d.getElementChildren(g);A=d.getElementAttr(g,"suppressStudentFeedback");A==CTATMsgType.SHOW_FEEDBACK_AS_QUIZ&&a.setLockWidget(!1);null==A&&(A=CTATMsgType.SHOW_ALL_FEEDBACK);a.setFeedbackPolicy(A);u.setFeedbackSuppressed(A);A=d.getElementAttr(g,"highlightRightSelection");a.setHighlightRightSelection("false"!=
A);A=d.getElementAttr(g,"confirmDone");u.setConfirmDone("true"===A?!0:"false"===A?!1:a.getFeedbackPolicy()===CTATMsgType.HIDE_ALL_FEEDBACK);a.setHintPolicy(d.getElementAttr(g,"hintPolicy"));u.setOutOfOrderMessage(d.getElementAttr(g,"outOfOrderMessage"));g=d.getElementAttr(g,"regexMatchWholeString");null!=g&&""!=g&&a.setRegexMatchWholeString(g);g=null;for(A=0;A<w.length;A++)switch(d.getElementName(w[A])){case "startNodeMessages":h=d.getElementChildren(w[A]);a.setStartStateMsgs(h);break;case "node":q++;
var z;z=w[A];ctatdebug("processNode("+z+")");var C=d.getElementChildren(z),D=-1;z="";for(var F=[],G=0;G<C.length;G++)switch(d.getElementName(C[G])){case "uniqueID":D=parseInt(d.getNodeTextValue(C[G]));break;case "text":z=d.getNodeTextValue(C[G]);break;case "dimension":for(var x=d.getElementChildren(C[G]),H=0;H<x.length;H++)ctatdebug("grandkids "+H+", "+x[H]+", "+d.getNodeTextValue(x[H])+", "+parseInt(d.getNodeTextValue(x[H]))),F[H]=parseInt(d.getNodeTextValue(x[H]));ctatdebug("grandkids d "+F)}C=
new CTATExampleTracerNode(D,new Set);""!==z&&C.setNodeName(z);2<=F.length&&C.setDimension({x:F[0],y:F[1]});z=C;a.addNode(z);1==q&&(a.setStartNode(z),a.setStudentStartsHereNode(z));z.getNodeName()==a.getStudentStartStateNodeName()&&a.setStudentStartsHereNode(z);break;case "edge":a.addLink(b(w[A],u));break;case "EdgesGroups":g=w[A];break;case "productionRule":x=w[A];ctatdebug("processSkill()");F=z="";D=C=null;G=d.getElementAttr(x,"opportunities");x=d.getElementChildren(x);for(H=0;H<x.length;H++){var K=
d.getElementName(x[H]);"ruleName"==K&&(z=d.getNodeTextValue(x[H]),ctatdebug("ruleName="+z));"productionSet"==K&&(F=d.getNodeTextValue(x[H]),ctatdebug("productionSet="+F));"label"==K&&(C=d.getNodeTextValue(x[H]),ctatdebug("label="+C));"description"==K&&(D=d.getNodeTextValue(x[H]),ctatdebug("description="+D))}z&&(x=new CTATExampleTracerSkill(F,z,CTATExampleTracerSkill.DEFAULT_P_GUESS,CTATExampleTracerSkill.DEFAULT_P_KNOWN,CTATExampleTracerSkill.DEFAULT_P_SLIP,CTATExampleTracerSkill.DEFAULT_P_LEARN,
CTATExampleTracerSkill.DEFAULT_HISTORY),x.setOpportunityCount(G),null!=C?x.setLabel(C):x.setLabel(z),null!=D?x.setDescription(D):x.setDescription(z+(F?" "+F:"")),p.push(x))}if(g){q=d.getElementAttr(g,"ordered");if(null===q||"undefined"==typeof isordered)q=!y;ctatdebug("parseGraph() value of isOrdered = "+q);ctatdebug("parseGraph() value of isUnordered = "+y);ctatdebug("parseGraph() typeof isOrdered: "+typeof q);ctatdebug("parseGraph()typeof isUnordered: "+typeof y);w=g;e.logger.log("graphparser",
"processGroup()");l=a.getGroupModel();y=l.createIdToLinkMap();l.setGroupOrdered(l.getTopLevelGroup(),q);e.logger.log("graphparser","processGroup() name of group: "+l.getGroupName(l.getTopLevelGroup()));e.logger.log("graphparser","processGroup() group isOrdered?: "+l.isGroupOrdered(l.getTopLevelGroup()));e.logger.log("graphparser","processGroup() order of group: isOrdered= "+q);e.logger.log("graphparser","processGroup() order of group: isOrdered typeof= "+typeof q);q=d.getElementChildren(w);for(w=
0;w<q.length;w++)switch(d.getElementName(q[w])){case "group":f(q[w],y);break;case "outOfOrderMessage":l.getTopLevelGroup().setDefaultBuggyMsg(d.getNodeTextValue(q[w]))}a.addGroup(void 0)}u.addSkillsFromProblemFile(p);a.redoLinkDepths();c=a.getExampleTracer();c.resetTracer();a.forDebugging();ctatdebug("Graph loaded.");return{gr:a,tracer:c,ssm:h,sgMsg:a.getStateGraphMsg(u)}}};CTATGraphParser.prototype=Object.create(CTATBase.prototype);CTATGraphParser.prototype.constructor=CTATGraphParser;
"undefined"!==typeof module&&(module.exports=CTATGraphParser);var CTATProblemStateStatus=function(){var b="empty";this.getStatus=function(){return b};this.setStatus=function(g){b=g}};Object.defineProperty(CTATProblemStateStatus,"empty",{enumerable:!1,configurable:!1,writable:!1,value:"empty"});Object.defineProperty(CTATProblemStateStatus,"incompleteStartState",{enumerable:!1,configurable:!1,writable:!1,value:"incompleteStartState"});Object.defineProperty(CTATProblemStateStatus,"startState",{enumerable:!1,configurable:!1,writable:!1,value:"startState"});
Object.defineProperty(CTATProblemStateStatus,"incomplete",{enumerable:!1,configurable:!1,writable:!1,value:"incomplete"});Object.defineProperty(CTATProblemStateStatus,"goingToState",{enumerable:!1,configurable:!1,writable:!1,value:"goingToState"});Object.defineProperty(CTATProblemStateStatus,"normalFeedback",{enumerable:!1,configurable:!1,writable:!1,value:"normalFeedback"});Object.defineProperty(CTATProblemStateStatus,"complete",{enumerable:!1,configurable:!1,writable:!1,value:"complete"});
Object.defineProperty(CTATProblemStateStatus,"completedEarlier",{enumerable:!1,configurable:!1,writable:!1,value:"completedEarlier"});CTATProblemStateStatus.prototype=Object.create(CTATBase.prototype);CTATProblemStateStatus.prototype.constructor=CTATProblemStateStatus;CTATProblemStateStatus.prototype.isSendingSavedMsgsForRestore=function(){switch(this.getStatus()){case CTATProblemStateStatus.normalFeedback:return!0;default:return!1}};
CTATProblemStateStatus.prototype.mustSaveForRestore=function(){switch(this.getStatus()){case CTATProblemStateStatus.incomplete:case CTATProblemStateStatus.incompleteStartState:case CTATProblemStateStatus.goingToState:case CTATProblemStateStatus.completedEarlier:return!1;default:return!0}};
CTATProblemStateStatus.prototype.countForProblemSummary=function(){switch(this.getStatus()){case CTATProblemStateStatus.incompleteStartState:case CTATProblemStateStatus.incomplete:return void 0!==CTATConfiguration.get("freeze_restore")||!1;case CTATProblemStateStatus.goingToState:case CTATProblemStateStatus.startState:case CTATProblemStateStatus.completedEarlier:return!1;default:return!0}};
CTATProblemStateStatus.prototype.isOutputSuppressed=function(){switch(this.getStatus()){case CTATProblemStateStatus.goingToState:return!0;default:return!1}};CTATProblemStateStatus.prototype.isComplete=function(){switch(this.getStatus()){case CTATProblemStateStatus.complete:case CTATProblemStateStatus.completedEarlier:return!0;default:return!1}};
CTATProblemStateStatus.prototype.canRestore=function(){switch(this.getStatus()){case CTATProblemStateStatus.incompleteStartState:case CTATProblemStateStatus.incomplete:case CTATProblemStateStatus.complete:case CTATProblemStateStatus.completedEarlier:return!0;default:return!1}};CTATProblemStateStatus.prototype.mustRetrieveProblemState=function(){return this.canRestore()};
CTATProblemStateStatus.prototype.transition=function(b,g){var f=this.getStatus();if(CTATProblemStateStatus.completedEarlier!=f)if(CTATProblemStateStatus.complete==f&&g==CTATProblemStateStatus.completedEarlier)this.setStatus(CTATProblemStateStatus.completedEarlier);else{switch(b){case CTATMsgType.SET_PREFERENCES:CTATProblemStateStatus[g]&&(CTATProblemStateStatus.incomplete==CTATProblemStateStatus[g]?this.setStatus(CTATProblemStateStatus.incompleteStartState):CTATProblemStateStatus.complete==CTATProblemStateStatus[g]?
this.setStatus(CTATProblemStateStatus.completedEarlier):this.setStatus(CTATProblemStateStatus.startState));break;case CTATMsgType.STATE_GRAPH:this.getStatus()==CTATProblemStateStatus.incomplete||this.getStatus()==CTATProblemStateStatus.incompleteStartState?this.setStatus(CTATProblemStateStatus.incompleteStartState):this.setStatus(CTATProblemStateStatus.startState);break;case CTATMsgType.START_STATE_END:this.getStatus()==CTATProblemStateStatus.incompleteStartState?this.setStatus(CTATProblemStateStatus.incomplete):
this.getStatus()==CTATProblemStateStatus.incomplete?this.setStatus(CTATProblemStateStatus.incomplete):this.setStatus(CTATProblemStateStatus.normalFeedback);break;case CTATMsgType.PROBLEM_RESTORE_END:this.setStatus(CTATProblemStateStatus.normalFeedback);break;case CTATMsgType.END_GO_TO_STATE:this.setStatus(CTATProblemStateStatus.normalFeedback);break;case CTATMsgType.BEGIN_GO_TO_STATE:this.setStatus(CTATProblemStateStatus.startState);break;case CTATMsgType.BEGIN_RESTORE:this.getStatus()!=CTATProblemStateStatus.incompleteStartState&&
this.setStatus(CTATProblemStateStatus.incomplete)}ctatdebug("CTATProblemStateStatus.transition("+b+", "+g+") old "+f+" => new "+this.getStatus());return this.getStatus()}};CTATProblemStateStatus.prototype.toString=function(){return"{"+this.getStatus()+"}"};var CTATMessageTank=function(b,g){function f(a,b){u.log("tracervars","MTank.processInterfaceVariables",a,b,l&&l.getTracer()&&l.getTracer().getBestInterpretation().getVariableTable().toString());u.ctatdebug("entering processInterfaceVariables() msgType "+a+", evt "+b);if(a){var c=l?l.getTracer():null;u.ctatdebug("entering processInterfaceVariables() et "+l+", tracer "+c);/^(CorrectAction|InterfaceAction|UntutoredAction)$/i.test(a.toLowerCase())&&c&&c.addInterfaceVariablesFromEvent(b,l.interfaceDescs)}}
function e(a){u.ctatdebug("entering updateProblemSummary()");a&&n&&n.forEach(function(b){if(b.msgType==CTATMsgType.ASSOCIATED_RULES&&(b=b.evt,u.ctatdebug("entering updateProblemSummaryWithEvent("+b+")"),b))if(l&&l.getOutputStatus().isComplete())a.setCompletionStatus(CTATMsgType.CompletionValue[1],!1);else{var c=b.getResult();b.getHintRequest()&&(c=CTATExampleTracerLink.HINT_ACTION);var d=CTATMsgType.CompletionValue[0],e=c&&c==CTATExampleTracerLink.CORRECT_ACTION,f=!1,g=null,h=null,n=null,p=b.getStudentSAI();
p&&(g=p.getSelection())&&(h=p.getAction())&&(f="done"==String(g).toLowerCase()&&"buttonpressed"==String(h).toLowerCase());a.setCompletionStatus(d,CTATGlobals.confirmDone);u.ctatdebug("updateProblemSummary() Completion status "+d+", doneStep "+f+", correct "+e);f&&(d=e?(n=p.getInput())&&"-1"!=n?n:CTATMsgType.CompletionValue[1]:CTATMsgType.CompletionValue[0],a.setCompletionStatus(d,!0));d.startsWith(CTATMsgType.CompletionValue[1])?(a.stopTimer(),l&&l.setOutputStatus(CTATProblemStateStatus.complete)):
a.restartTimer();d=b.getActor();e=b.getStepID();u.ctatdebug("updateProblemSummmary() actor "+d+", indicatorObj "+c+", stepID "+e);!CTATMatcher.isTutorActor(d)&&l.getOutputStatus().countForProblemSummary()&&(CTATTutorMessageBuilder.isHint(c)?a.addHint(e):CTATTutorMessageBuilder.isCorrect(c)?null!==c&&"undefined"!==typeof c&&a.addCorrect(e,b.getScoreLabels()):a.addError(e))}})}function c(a){switch(u.suppressFeedback(a,l.getFeedbackPolicy())){case CTATMsgType.SHOW_ALL_FEEDBACK:return!1;case CTATMsgType.DELAY_FEEDBACK:a=
a.msg;var b=CTATMsgType.getProperty(a,"Selection");u.ctatdebug("CTATMessageTank.addToDelayedFeedbackTank(\n  "+a+") selection "+b);b&&(l.getDelayedFeedback()[b.toLowerCase()]=a);return!0;case CTATMsgType.HIDE_ALL_FEEDBACK:return!0;case CTATMsgType.HIDE_BUT_COMPLETE:return!0;case CTATMsgType.HIDE_BUT_ENFORCE:return!0;default:return!1}}function a(a,b){var c,d;if(!(a&&a.sai&&(c=a.sai.getAction())&&(d=CTATSAI.delayedActionRegExp.exec(c)))||3>d.length||1>=d[2])return!1;var e=b.length-1,e=0>e?null:b[e];
a.msg=a.msg.replace(c,d[1]);e&&e.timeout==d[2]?e.msgTuples.push(a):b.push({timeout:Number(d[2]),msgTuples:[a]});return!0}function d(a){u.log("tank","processDelayedMsgs() delayedMsgs.timeout",a.timeout,".msgTuples.length",a.msgTuples.length);setTimeout(h,a.timeout,l,a.msgTuples)}function h(a,b){a=new CTATMessageTank(a,null);for(var c=0;c<b.length;++c){var d=b[c];u.log("tank","sendNewTankful() mto["+c+"] msgType",d.msgType);a.addToMessageTank(d.msgType,d.msg,d.evt,null)}a.flushMessageTank(null,!0)}
CTATBase.call(this,"CTATMessageTank",null);var l=b;this.options=g||{};this.msgBundle=[];this.feedbackMsgs=[];this.delayedMsgsBundle=[];var n=null,p=null,q=null;b=new Set;b.add("SuccessMessage");b.add("BuggyMessage");b.add("HighlightMsg");b.add("NotDoneMessage");var u=this;this.logger=new CTATLogger(["tracervars","tank"]);this.log=u.logger.log;this.getGroupTransaction=function(){return u.options.groupTransaction||""};this.setGroupTransaction=function(a){return u.options.groupTransaction=a};this.toString=
function(){u.ctatdebug("toString tank "+n);if(!n||1>n.length)return"MessageTank empty";var a="";n.forEach(function(b){a+=b.msgType+", "});return"MessageTank["+a.substr(0,a.length-2)+"]"};this.enqueueToolActionToStudent=function(a,b,c,d,e){u.ctatdebug("Entering enqueueToolActionToStudent("+a+", "+b+", "+c+", "+d+")");var f=CTATMsgType.INTERFACE_ACTION;u.ctatdebug("entering enqueueMessageToStudent()");var g=CTATMessage.makeTransactionId();a=new CTATSAI(a,b,c);b=(new CTATTutoringServiceMessageBuilder).createInterfaceActionMessage(g,
a);b=CTATMsgType.setProperty(b,CTATTutorMessageBuilder.TRIGGER,"DATA");b=CTATMsgType.setProperty(b,CTATTutorMessageBuilder.SUBTYPE,!d||1>d.length?CTATTutorMessageBuilder.TUTOR_PERFORMED:d);d=new CTATExampleTracerEvent(l,a,CTATMsgType.DEFAULT_TOOL_ACTOR);d.setTutorType(e);d.setTransactionID(g);d.setTutorSAI(a);u.addToMessageTank(f,b,d,a);return g};this.addToMessageTank=function(a,b,c,d){u.log("tank","addToMessageTank() msgType",a,"newMessage",b,"givenEvent",c,"sai",d);if(b){n||(n=[],p={},q={});var e=
{};e.msgType=a;e.msg=b;e.evt=c;e.sai=d;n.push(e);p[a]=p[a]?p[a]+1:1;a=c.getResult();c.getHintRequest()&&(a=CTATExampleTracerLink.HINT_ACTION);q[a]=q[a]?q[a]+1:1;u.log("tank","addToMessageTank() at return ",u.toString())}};this.flushMessageTank=function(b,g,h){u.log("tank","flushMessageTank(",b,g,h,"), messageTank",n);e(b);u.log("tank","flushMessageTank() after updateProblemSummary; messageTank.length",n&&n.length);for(g=void 0;g=n&&n.shift();)g.msg&&(f(g.msgType,g.evt),c(g)||a(g,u.delayedMsgsBundle)||
(u.getGroupTransaction()&&CTATMsgType.hasTextFeedback(g.msgType)?u.feedbackMsgs.push(g):u.msgBundle.push(g.msg)));u.log("tank","flushMessageTank(): lengths of msgBundle",u.msgBundle.length,"delayedMsgsBundle",u.delayedMsgsBundle.length,"feedbackMsgs",u.feedbackMsgs.length);if(u.getGroupTransaction()&&h!=u.getGroupTransaction())u.log("tank","flushMessageTank() returning early groupTransaction",u.getGroupTransaction(),"groupSAI",h);else{if(0<u.feedbackMsgs.length){var v=[],w=[];u.feedbackMsgs.forEach(function(a){return w=
CTATMsgType.getFeedbackTexts(a.msg).filter(function(a){return String(a).trim()}),v.push.apply(v,[].concat($jscomp.arrayFromIterable(w))),u.log("tank","flushMessageTank allMsgsFB",v)});u.msgBundle.push((new CTATTutorMessageBuilder)[u.feedbackMsgs.every(function(a){return a.msgType==CTATMsgType.SUCCESS_MESSAGE})?"createSuccessMessage":"createBuggyMessage"](CTATGuid.guid(),v))}for(h=0;h<u.delayedMsgsBundle.length;++h)d(u.delayedMsgsBundle[h]);0<u.msgBundle.length&&(u.log("tank","Bottom of flushMessageTank(); to send bundle of length",
u.msgBundle.length,"via",l),l.sendBundle(u.msgBundle)&&(u.ctatdebug("CTATMessageTank.shouldSaveNow() resultTypes "+q+", msgTypes "+p),(q[CTATExampleTracerLink.CORRECT_ACTION]||q[CTATExampleTracerLink.FIREABLE_BUGGY_ACTION]||q[CTATExampleTracerLink.BUGGY_ACTION]||q[CTATExampleTracerLink.NO_MODEL]||q[CTATExampleTracerLink.HINT_ACTION]||p.CorrectAction||p.InterfaceAction||p.UntutoredAction||l.isFeedbackSuppressed()&&p.AssociatedRules)&&l.isSendingSavedMsgsForRestore()&&(CTATGlobalFunctions.isInstructorMode()?
u.log("tank","We're in reviewer mode: we shouldn't save as we go"):l.getProblemStateSaver().saveAsYouGo(b))),u.msgBundle=[],u.log("tank","Exiting flushMessageTank() #CorrectAction",p&&p.CorrectAction,"#InterfaceAction",p&&p.InterfaceAction,"#UntutoredAction",p&&p.UntutoredAction));p=n=null}};this.flushDelayedFeedback=function(){u.ctatdebug("Entering flushDelayedFeedback()");var a=l.getDelayedFeedback(),b;for(b in a)a.hasOwnProperty(b)&&CTAT.ToolTutor.sendToInterface(a[b]);l.clearDelayedFeedback()};
this.suppressFeedback=function(a,b){u.ctatdebug("CTATMessageTank.suppressFeedback("+a.msgType+", "+b+")");b==CTATMsgType.SHOW_ALL_FEEDBACK||b==CTATMsgType.SHOW_FEEDBACK_AS_QUIZ?(u.ctatdebug("if.1"),a=b):CTATMsgType.hasTextFeedback(a.msgType)?(u.ctatdebug("if.2"),b==CTATMsgType.HIDE_ALL_FEEDBACK||b==CTATMsgType.HIDE_BUT_ENFORCE?(u.ctatdebug("if.2.1"),a=b):(u.ctatdebug("if.2.2"),(a=CTATMsgType.getProperty(a.msg,CTATMsgType.BUGGY_MSG))&&a.startsWith("<value>")&&(a=CTATMsgType.getValue(a,0)),a&&-1!=a.toLowerCase().indexOf(CTATMsgType.NOT_DONE_MSG.toLowerCase())?
(u.ctatdebug("if.2.2.1"),a=CTATMsgType.SHOW_ALL_FEEDBACK):(u.ctatdebug("if.2.2.2"),a=CTATMsgType.HIDE_ALL_FEEDBACK))):CTATMsgType.isCorrectOrIncorrect(a.msgType)?(u.ctatdebug("if.3: "+a.msg),CTATMsgType.isDoneMessage(a.msg)?(u.ctatdebug("if.3.1"),a=CTATMsgType.SHOW_ALL_FEEDBACK):(u.ctatdebug("if.3.2"),a=b)):(u.ctatdebug("if.4"),a=CTATMsgType.SHOW_ALL_FEEDBACK);u.ctatdebug("CTATMessageTank.suppressFeedback() returning "+a);return a}};
Object.defineProperty(CTATMessageTank,"END_OF_TRANSACTION",{enumerable:!1,configurable:!1,writable:!1,value:"end_of_transaction"});CTATMessageTank.prototype=Object.create(CTATBase.prototype);CTATMessageTank.prototype.constructor=CTATMessageTank;"undefined"!==typeof module&&(module.exports=CTATMessageTank);var ProblemStateSaver=function(b){CTATBase.call(this,"ProblemStateSaver",b);this.tracer=b;var g=this,f=[],e=null,c="",a="",d=0;this.saveAsYouGo=function(e){g.ctatdebug("saveAsYouGo() curriculum_service_url "+c+", tracer "+b);if(b&&e){var h={};h.session_id=b.getSessionID();h.authenticity_token=a;h.summary=CTATLMS.is.TutorShop()?e.toJSONforTutorshop():e.toXML(!0);h.problem_state=e?'{"summary":'+JSON.stringify(e)+',"state":'+ProblemStateSaver.xmlToJSON(f)+"}":ProblemStateSaver.xmlToJSON(f);++d;g.ctatdebug("saveAsYouGo["+
d+"] to send problem_state length "+h.problem_state.length);CTATLMS.saveProblemState&&CTATLMS.saveProblemState(h);CTATLMS.gradeStudent&&CTATLMS.gradeStudent(parseInt(e.getCorrect()),parseInt(e.getRequiredSteps()),e.toJSONforTutorshop());CTATLMS.commit&&CTATLMS.commit()}else g.ctatdebug("Error: no tracer or no problem summary available, aborting save as you go")};this.setCurriculumServiceUrl=function(a){g.ctatdebug("ProblemStateSaver.setCurriculumServiceUrl() old "+c+", new "+a);c=a};this.setAuthenticityToken=
function(b){g.ctatdebug("ProblemStateSaver.setAuthenticityToken() old "+a+", new "+b);b&&(a=b)};this.getStepToIndexMap=function(){null===e&&(e=new Map);return e};this.getProblemState=function(){return f};this.getProblemStateLength=function(){return f.length}};ProblemStateSaver.prototype=Object.create(CTATBase.prototype);ProblemStateSaver.prototype.constructor=ProblemStateSaver;
ProblemStateSaver.prototype.replaceInProblemState=function(b,g,f,e,c,a){this.ctatdebug("PSS.replaceInProblemState("+CTATMsgType.getMessageType(b)+", "+e+", "+c+", "+a+")");return!1===a||"false"===a?!1:!0===a||"true"===a||f.mustSaveForRestore()&&ProblemStateSaver.mustSaveForRestore(CTATMsgType.getMessageType(b))?(f=this.getProblemState(),b=this.editForProblemState(b),c||(e=ProblemStateSaver.makeStepKey(e),c=this.getStepToIndexMap(),this.ctatdebug("PSS.replaceInProblemState() stepKey"+e+", index "+
c.get(e)+")"),c.has(e)&&(a=c.get(e),f[a]=null),c.set(e,f.length)),f.push({outcome:ProblemStateSaver.getOutcome(b,g,1),msg:b}),!0):!1};ProblemStateSaver.prototype.appendToProblemState=function(b,g,f,e){return!1===e||"false"===e?!1:!0===e||"true"===e||f.mustSaveForRestore()&&ProblemStateSaver.mustSaveForRestore(CTATMsgType.getMessageType(b))?(f=this.getProblemState(),b=this.editForProblemState(b),f.push({outcome:ProblemStateSaver.getOutcome(b,g,1),msg:b}),!0):!1};ProblemStateSaver.Outcomes={};
[CTATExampleTracerLink.BUGGY_ACTION,CTATExampleTracerLink.FIREABLE_BUGGY_ACTION,CTATExampleTracerLink.CORRECT_ACTION,CTATExampleTracerLink.NO_MODEL,CTATExampleTracerLink.HINT_ACTION,CTATExampleTracerLink.UNTRACEABLE_ERROR,CTATExampleTracerLink.GIVEN_ACTION].forEach(function(b,g){ProblemStateSaver.Outcomes[b]={name:b,abbr:b.charAt(0)};ProblemStateSaver.Outcomes[b.charAt(0)]={name:b,abbr:b.charAt(0)}});
ProblemStateSaver.getOutcome=function(b,g,f){if(b)b="function"==typeof b.getMessageType?String(b.getMessageType()):"U"==String(b)?CTATMsgType.UNTUTORED_ACTION:CTATMsgType.getMessageType(String(b.msg||b));else return"";return b.toLowerCase()==CTATMsgType.UNTUTORED_ACTION.toLowerCase()?"":(g=ProblemStateSaver.Outcomes[g])?1==f?g.abbr:g.name:""};Object.defineProperty(ProblemStateSaver,"XML_PROLOGUE",{enumerable:!1,configurable:!1,writable:!1,value:/<\? *[xX][mM][lL][^?]*\?>/});
Object.defineProperty(ProblemStateSaver,"LEADING_WHITE_SPACE",{enumerable:!1,configurable:!1,writable:!1,value:/^\s+</m});Object.defineProperty(ProblemStateSaver,"MESSAGES_TAG",{enumerable:!1,configurable:!1,writable:!1,value:"<messages>"});
ProblemStateSaver.prototype.editForProblemState=function(b){var g=b.split(ProblemStateSaver.XML_PROLOGUE),f=g[0],e;for(e=1;e<g.length;++e)f+=g[e];g=f.split(ProblemStateSaver.LEADING_WHITE_SPACE);f=g[0];for(e=1;e<g.length;++e)f.endsWith("\n")&&(f=f.slice(0,-1)),f.endsWith("\r")&&(f=f.slice(0,-1)),f+="<"+g[e];this.ctatdebug("ProblemStateSaver.editForProblemState("+b+")\n returns "+f);return f};ProblemStateSaver.omitFromRestore={init:!1};
ProblemStateSaver.mustSaveForRestore=function(b){ProblemStateSaver.omitFromRestore.init||(ProblemStateSaver.omitFromRestore[CTATMsgType.ASSOCIATED_RULES.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.BUGGY_MESSAGE.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.CORRECT_ACTION.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.INCORRECT_ACTION.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.INTERFACE_IDENTIFICATION.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.PROBLEM_RESTORE_END.toLowerCase()]=
!0,ProblemStateSaver.omitFromRestore[CTATMsgType.PROBLEM_SUMMARY_REQUEST.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.PROBLEM_SUMMARY_RESPONSE.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.SET_PREFERENCES.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.SHOW_HINTS_MESSAGE.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.SUCCESS_MESSAGE.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore.init=!0);return b&&ProblemStateSaver.omitFromRestore[b.toLowerCase()]?
!1:!0};ProblemStateSaver.prototype.forwardToInterface=function(b,g,f){var e=CTATMsgType.getMessageType(b);this.ctatdebug("PSS.forwardToInterface("+e+") problemState.length "+this.getProblemState().length+", outputStatus "+f);if(f&&f.isOutputSuppressed())return!1;CTAT.ToolTutor.sendToInterface(b,g);f&&f.transition(CTATMsgType.getMessageType(b));return!0};ProblemStateSaver.prototype.processMessage=function(b){this.ctatdebug("ProblemStateSaver.processMessage("+b+")")};
ProblemStateSaver.makeStepKey=function(b){if(!b)return" ";var g=b.getSelection();b=b.getAction();g="string"!=typeof g||1>g.length?" ":g;b="string"!=typeof b||1>b.length?" ":b;return g+" "+b};
ProblemStateSaver.fromJSON=function(b){if("string"!=typeof b)return ProblemStateSaver.jsonToState(b);switch(b.charAt(0)){case "[":return ProblemStateSaver.jsonToState(b);case "{":break;default:return ProblemStateSaver.jsonToState(b)}var g={};try{g=JSON.parse(b)}catch(f){return console.log("ProblemStateSaver.fromJSON() error",f,"problemState",b),ProblemStateSaver.jsonToState(null)}g.summary&&(b=CTAT.ToolTutor.tutor.getProblemSummary().fromJSON(g.summary),b=(new CTATTutorMessageBuilder).createAssociatedRulesMessageForAction(CTATMsgType.CORRECT_ACTION,
new CTATSAI("none","none","none"),CTATMsgType.DEFAULT_TOOL_ACTOR,new CTATSAI("none","none","none"),b.getSkills().getSkillBarVector(!1,!0),"0","T"+CTATGuid.guid(),"",null,null),CTAT.ToolTutor.sendToInterface(b));return g.state?ProblemStateSaver.jsonToXML(g.state):ProblemStateSaver.jsonToState(null)};
ProblemStateSaver.jsonToState=function(b){if("string"!=typeof b||"["!=b.charAt(0))return[];var g=[];try{g=JSON.parse(b)}catch(f){return console.log("ProblemStateSaver.jsonToState() error",f,"problemState",b),[]}return ProblemStateSaver.jsonToXML(g)};ProblemStateSaver.actionsToIgnore=[CTATTransactionListener.visibilitychangeSAI.action];
ProblemStateSaver.jsonToXML=function(b){var g=[];b.forEach(function(b,e){console.log("ProblemStateSaver.jsonToXML["+e+"] mo",b);e=ProblemStateSaver.getOutcome(b.m,b.o);if((CTATConfiguration.get("instructor_mode")||"U"==b.m||e==CTATExampleTracerLink.CORRECT_ACTION||e==CTATExampleTracerLink.FIREABLE_BUGGY_ACTION)&&!ProblemStateSaver.actionsToIgnore.includes(b.a)){e=decodeURIComponent(b.i);e=0>e.indexOf("<![CDATA[")?"<![CDATA["+e+"]]\x3e":e;var c;c="<message><verb>NotePropertySet</verb><properties><MessageType>"+
("U"==b.m?CTATMsgType.UNTUTORED_ACTION:CTATMsgType.INTERFACE_ACTION);c+="</MessageType><transaction_id>"+CTATMessage.makeTransactionId();c+="</transaction_id><Selection><value>";/^ *previousfocus *$/i.test(b.a)?(c+="hint</value><value>"+b.s,c+="</value></Selection><Action><value>ButtonPressed</value><value>"+b.a):(c+=b.s,c+="</value></Selection><Action><value>"+b.a);c+="</value></Action><Input><value>"+e+"</value></Input></properties></message>";g.push({outcome:ProblemStateSaver.getOutcome(b.m,b.o,
1),msg:c})}});return g};
ProblemStateSaver.xmlToJSON=function(b){var g=[];b.forEach(function(b,e){ctatdebug("ProblemStateSaver.xmlToJSON["+e+"] msg\n  "+b);if(b){var c={},a=null;c.o=ProblemStateSaver.getOutcome(b.msg||b,b.outcome,1);"undefined"!=typeof b.msg&&(b=b.msg);c.m=CTATMsgType.getMessageType(b)==CTATMsgType.UNTUTORED_ACTION?"U":"I";c.s=(a=CTATMsgType.getValue(CTATMsgType.getProperty(b,"Selection"),0))?a:"";c.a=(a=CTATMsgType.getValue(CTATMsgType.getProperty(b,"Action"),0))?a:"";if(/^ *(hint|help) *$/i.test(c.s)&&/^ *buttonpress[ed ]*$/i.test(c.a)){var d=
(a=CTATMsgType.getValue(CTATMsgType.getProperty(b,"Selection"),1))?a:"",f=(a=CTATMsgType.getValue(CTATMsgType.getProperty(b,"Action"),1))?a:"";d&&/^ *previousfocus *$/i.test(f)&&(c.s=d,c.a=f)}a=CTATMsgType.getValue(CTATMsgType.getProperty(b,"Input"),0)||"";b=a.replace(/^<!\[CDATA\[(.*)\]\]>$/,"$1");c.i=encodeURIComponent(b);ctatdebug("ProblemStateSaver.xmlToJSON["+e+"]  mo "+JSON.stringify(c));g.push(c)}});try{return JSON.stringify(g)}catch(f){return console.log("ProblemStateSaver.xmlToJSON() error",
f,"toStringify",g),""}};"undefined"!==typeof module&&(module.exports=ProblemStateSaver);var ProblemStateRestorer=function(b){CTATBase.call(this,"ProblemStateRestorer",b);var g=this,f=null;this.getRestoreProblemUrl=function(){return f};this.setRestoreProblemUrl=function(b){f=b};this.toString=function(){return"["+f+": 0]"};this.retrieveMessages=function(e){console.log("retrieveMessages("+e+", ...)");e.mustRetrieveProblemState()?(b.stopWorking(1),CTATLMS.getProblemState&&CTATLMS.getProblemState(g.process)):console.log("Retrieval status indicates that we should not retrieve")};this.process=
function(e){var c=null;b.getOutputStatus().transition(CTATMsgType.BEGIN_RESTORE);"string"!=typeof e||""==e?(console.log("ProblemStateRestorer.process("+e+") empty or not a string: ",typeof e),c=[]):/^[[{]/.test(e)||e.slice(0,ProblemStateSaver.MESSAGES_TAG.length)==ProblemStateSaver.MESSAGES_TAG||(console.log("ProblemStateRestorer.process() called with unrecognized string, to try htmlDecode(): ",e.slice(0,20)),e=(new DOMParser).parseFromString(e,"text/html").documentElement.textContent,e.slice(0,ProblemStateSaver.MESSAGES_TAG.length)!=
ProblemStateSaver.MESSAGES_TAG&&(console.log("ProblemStateRestorer.process() called with unrecognized string: ",e.slice(0,20)),c=[]));parent.postMessage({command:"startRestoreSteps",data:{restoreJSON:null==c?e:JSON.stringify(c)}},location.origin);if(null==c)a:{var a=e,c=[];if("string"==typeof a){e="";if(/^[[{]/.test(a))a=ProblemStateSaver.fromJSON(a);else{a=a.split(/<\/?messages>/);g.ctatdebug("msgsArr.length "+a.length+", msgsArr[1].length "+(a[1]?a[1].length:-1));if(2>a.length)break a;e="<message>";
a=a[1].split(e)}g.ctatdebug("problemStateArr.length "+a.length);for(var d=0,f=!1,l=0;l<a.length;++l)if(a[l]){var n=a[l],p=e+("string"==typeof n?n:n.msg),q=CTATMsgType.getMessageType(p);CTATMsgType.STATE_GRAPH==q?f=!0:CTATMsgType.START_STATE_END==q?f=!1:f?d++:CTATMsgType.INTERFACE_ACTION==q&&l==a.length-1&&CTATMsgType.isDoneMessage(p)&&b.getOutputStatus().isComplete()||(b.getProblemStateSaver().appendToProblemState(p,n.outcome,null,!0),p=CTATMsgType.setProperty(p,"Actor","Student"),c.push(p));g.ctatdebug("problemStateArr["+
l+"] "+(f?"omit ":"keep ")+q+" omitted "+d+" kept "+c.length)}}}b.insertFreeze(c);b.enqueueForRestore(c)}};ProblemStateRestorer.prototype=Object.create(CTATBase.prototype);ProblemStateRestorer.prototype.constructor=ProblemStateRestorer;var SCORMProblemSummary=function(){CTATBase.call(this,"SCORMProblemSummary","")};Object.defineProperty(SCORMProblemSummary,"LESSON_STATUS",{enumerable:!1,configurable:!1,writable:!1,value:"cmi.core.lesson_status"});Object.defineProperty(SCORMProblemSummary,"RAW_SCORE",{enumerable:!1,configurable:!1,writable:!1,value:"cmi.core.score.raw"});Object.defineProperty(SCORMProblemSummary,"EXIT",{enumerable:!1,configurable:!1,writable:!1,value:"cmi.core.exit"});
Object.defineProperty(SCORMProblemSummary,"SESSION_TIME",{enumerable:!1,configurable:!1,writable:!1,value:"cmi.core.session_time"});Object.defineProperty(SCORMProblemSummary,"ExitReason",{enumerable:!1,configurable:!1,writable:!1,value:{timeout:"time-out",suspend:"suspend",logout:"logout",done:" "}});
Object.defineProperty(SCORMProblemSummary,"LessonStatus",{enumerable:!1,configurable:!1,writable:!1,value:{passed:"passed",completed:"completed",failed:"failed",incomplete:"incomplete",browsed:"browsed",notAttempted:"not attempted"}});SCORMProblemSummary.getLessonStatus=function(b){return CTATMsgType.CompletionValue[1]==b.getCompletionStatus()?SCORMProblemSummary.LessonStatus.completed:SCORMProblemSummary.LessonStatus.incomplete};
SCORMProblemSummary.getRawScore=function(b){var g=b.getUniqueSteps();return 0==g?0:parseInt(100*(b.getUniqueCorrectUnassisted()/g+.005))};SCORMProblemSummary.getExitReason=function(b){return SCORMProblemSummary.ExitReason.suspend};SCORMProblemSummary.getSessionTime=function(b){var g=b.getTimeElapsed();b=g%1E3;var g=(g-b)/1E3,f=g/60,e=f/60,g=g%60;9999<e&&(e=9999,f=g=99,b=990);return sprintf("%04d:%02d:%02d.%02d",e,f,g,b/10)};
SCORMProblemSummary.getProblemSummaryElements=function(b){var g=sprintf("<%s>%s</%s>",SCORMProblemSummary.LESSON_STATUS,SCORMProblemSummary.getLessonStatus(b),SCORMProblemSummary.LESSON_STATUS),f=sprintf("<%s>%d</%s>",SCORMProblemSummary.RAW_SCORE,SCORMProblemSummary.getRawScore(b),SCORMProblemSummary.RAW_SCORE),e=sprintf("<%s>%s</%s>",SCORMProblemSummary.EXIT,SCORMProblemSummary.getExitReason(b),SCORMProblemSummary.EXIT);b=sprintf("<%s>%s</%s>",SCORMProblemSummary.SESSION_TIME,SCORMProblemSummary.getSessionTime(b),
SCORMProblemSummary.SESSION_TIME);return g+f+e+b};CTATMsgType.prototype=Object.create(CTATBase.prototype);CTATMsgType.prototype.constructor=SCORMProblemSummary;"undefined"!==typeof module&&(module.exports=SCORMProblemSummary);var CTATExampleTracer=function(b){function g(){return Q&&Q.getModelInitialized()||N&&N.getModelInitialized()}function f(a,b){b?na|=1<<a:(na&=-65537>>16-a,n())}function e(a){if(r.isFeedbackSuppressed()){var b=new CTATSAI("hint","SetVisible","false"),b=(new CTATTutoringServiceMessageBuilder).createInterfaceActionMessage("dummyTransactionID",b);a.push(b)}}function c(){return"<message><verb>NotePropertySet</verb><properties><MessageType>"+CTATMsgType.INTERFACE_REBOOT+"</MessageType></properties></message>"}
function a(a,b,c){r.ctatdebug("sendStartStateMessages() nMsgs "+a.length+", outputStatus "+X);for(var f=[],g=new XMLSerializer,h=null,l=null,n=0;n<a.length;n++)if("message"==W.getElementName(a[n])){var p=g.serializeToString(a[n]),q=CTATMsgType.getMessageType(p);if(CTATMsgType.SEND_WIDGET_LOCK==q)l=p;else{if(CTATMsgType.UNTUTORED_ACTION==q||CTATMsgType.INTERFACE_ACTION==q)r.setVariablesFromSAI(a[n],W);else if(CTATMsgType.START_STATE_END==q){e(f);h=p;f.push((new CTATTutoringServiceMessageBuilder).createInterfaceConfigurationEnd());
continue}f.push(p)}}l&&console.log("CTATExampleTracer.sendStartStateMessages(lockWidget="+c+") to replace SendWidgetLock",l);l=(new CTATTutorMessageBuilder).createLockWidgetMsg(c);f.unshift(l);f.unshift(b);CTATConfiguration.get("graph_for_results")||d(f);return h}function d(a){a.unshift(c());r.ctatdebug("sendStartStateMessageStrings(): "+a.length+" elts, "+X);r.sendBundle(a)}function h(){var a=[],b=S.getStartNode(),c;c=CTATMsgType.START_STATE_END;var d=b.getNodeID(),e=null,f=J;J=-1;0>f&&(f=(f=S?S.getStudentStartsHereNode():
null)?f.getNodeID():d);console.log("CTATExampleTracer.resetGoToState to transition1 destNodeID",f,"noopNodeID",d);f==d?X.transition(c,null):0<f&&((e=S.getNode(f))||console.log("CTATExampleTracer.resetGoToState to transition2 no destNode for destNodeID",f));r.ctatdebug("CTATET.resetGoToState("+c+", null, "+d+") returns "+e);c=e;if(null!==b&&null!==c&&b.getNodeID()!=c.getNodeID()){a=S.getBestSubpath(b,c);r.ctatdebug("advanceToStudentStartsHere() path "+a);if(!a)return;a=a.getSortedLinks();a=r.traceLinks(a);
r.ctatdebug("advanceToStudentStartsHere() results "+a)}c=b=null;0<a.length&&(c=a[a.length-1],a=c.getReportableLink(),null!==a&&(b=a.getNextNode()));r.ctatdebug("advanceToStudentStartsHere() to check for TPA "+b+", "+c);return z(b,N.findCurrentState(!1,!1),null,c)}function l(a,b){var c=a[b];if(!CTATMsgType.getProperty(c,"freezeHere"))return!1;a[b]=CTATMsgType.setProperty(c,"freezeHere","");return!0}function n(){var a=Math.min(ba.length,r.restoreStep||Number.MAX_SAFE_INTEGER);a==ba.length-1&&++a;r.restoreInterval=
r.restoreStep?0:Number.parseInt(CTATConfiguration.get("restore_interval"))||0;r.log("queue","workTheQueue() working "+na+", workOrRestoreQueue "+ea+", workQueue.length "+ma.length+", restoreQueue.length "+ba.length+", restoreIndex "+r.restoreIndex+", timer "+r.timer+", restoreInterval "+r.restoreInterval+", stopIndex "+a+", restoreStep "+r.restoreStep);if(!(na&1<<ea&&r.timer))for(;0!=(na=0<ma.length|(r.restoreIndex<a)<<1)&&1>r.timer;){var b=null,c=!1;if(r.restoreIndex<a){ea=1;if(l(ba,r.restoreIndex))return r.freezeRestore();
b=ba[r.restoreIndex++];r.restoreIndex>=r.restoreStep&&(clearTimeout(r.timer),r.timer=0);c=!0}else ea=0,b=ma.shift();r.log("queue","workTheQueue() working "+na+", restoreIndex "+r.restoreIndex+", stopIndex "+a+",\n  msg "+b);b=p(b,c);r.restoreInterval&&ea&&1<a-r.restoreIndex?(clearTimeout(r.timer),(new Promise(function(a){return r.timer=setTimeout(a,r.restoreInterval)})).then(function(){r.log("restore","***stopIndex "+a+", index "+r.restoreIndex);clearTimeout(r.timer);r.timer=0;n()}),r.log("restore",
"Now waiting "+r.restoreInterval+" ms on timer "+r.timer)):r.timer=-1;if(!b&&(r.log("queue","workTheQueue() suspending workQueue.length "+ma.length+", restoreQueue.length "+ba.length+", stopIndex "+a),r.stopWorking(c?1:0),1>r.timer))break;r.log("queue","workTheQueue() bottom workQueue.length "+ma.length+", restoreQueue.length "+ba.length+", stopIndex "+a)}}function p(a,b){r.lastMessageAsString=a;var d=r.lastMessageAsXML=(new CTATXML).parseXML(a),e=r.lastMessage=new CTATMessage(d),f=e.getMessageType();
r.log("trace","CTATExampleTracer.handleMessageFromInterface(msgType "+f+")");switch(f){case CTATMsgType.SET_PREFERENCES:return u(a,e,W,d),!1;case CTATMsgType.INTERFACE_IDENTIFICATION:return!0;case CTATMsgType.UNTUTORED_ACTION:b&&r.sendBundle([a]);var h=W;b=e.getTransactionID();r.ctatdebug("UntutoredAction ("+a+"), getTransactionID "+b);b=/^student$/i.test(String(e.getProperty("actor")||"student"));f=e.getProperty("saveForRestore");b&&r.getInitialValuesDemonstrateMode()?(e=y(a,e),r.log("startstate",
"handleUntutoredAction() in ivDemoMode",e)):((b||f)&&ha.appendToProblemState(a,"",r.getOutputStatus(),f)&&ha.saveAsYouGo(r.getProblemSummary()),g()&&(r.setVariablesFromSAI(d,h),H(a)));return!0;case CTATMsgType.INTERFACE_ACTION:return b&&r.sendBundle([a]),w(a,e,W,d);case CTATMsgType.PROBLEM_SUMMARY_REQUEST:return r.handleProblemSummaryRequest(r.getProblemSummary()),!0;case CTATMsgType.START_STATE_END:return X.transition(CTATMsgType.START_STATE_END),!0;case CTATMsgType.PROBLEM_RESTORE_END:if(CTATConfiguration.get("graph_for_results"))return r.restart();
CTATConfiguration.get("post_tracer_output")||(X.transition(CTATMsgType.PROBLEM_RESTORE_END),e=r.getSkillBarVector(),a=[],d=new CTATTutorMessageBuilder,a.push(d.createMessage(CTATMsgType.PROBLEM_RESTORE_END,e?{Skills:e}:null)),r.sendBundle(a));return!0;case CTATMsgType.GO_TO_STATE:a:{e=e.getProperty("nodeID");try{if(0>e||!sessionStorage||!sessionStorage.setItem){h=!0;break a}sessionStorage.setItem("Go-To-State",String(e))}catch(da){trace.error("Error in CTATExampleTracer.handleGoToState",da);h=!0;
break a}CTAT.ToolTutor.reboot("Go-To-State "+e+" from CTATExampleTracer")||(a=[],a.push(c()),r.log("load","CTATET.handleGoToState() saved nodeID "+e+"; sending to interface\n"+a),r.sendBundle(a));h=!1}return h;case CTATMsgType.ASSOCIATED_RULES:if(CTATConfiguration.get("graph_for_results")){e=(new CTATExampleTracerEvent(r)).fromAssociatedRules(e);r.messageTank=new CTATMessageTank(r,null);if(a=r.traceInGraphForResults(e))r.messageTank.addToMessageTank(CTATMsgType.ASSOCIATED_RULES,a.toAssociatedRules(),
a,a.getTutorSAI()),r.messageTank.flushMessageTank(null,!0);d=S.getLinkByID(Number(e.getSenderStepID()||a&&a.getStepID()||0));document.dispatchEvent(new CustomEvent("testStep",{detail:{sai:e.getStudentSAI()&&e.getStudentSAI().toString(),linkID:d&&d.getUniqueID(),linkStr:d&&d.toString(),modelResult:e.getResult(),graphResult:a&&a.getResult()||d&&d.getActionType()}}))}return!0;case CTATMsgType.INTERFACE_REBOOT:return a=e.getProperty("Reason"),e=e.getProperty("TutorOnly"),r.log("trace","ET.handleInterfaceReboot( reason",
a,"tutorOnly",e,")"),e&&CTAT.ToolTutor.reboot(a||"from tutor",!0,null,!0),!0;default:return r.log("trace","CTATExampleTracer.handleMessageFromInterface(restoring "+b+") "+(b?"sending":"unprocessed")+" message, type "+f+"\n  "+a),b&&r.sendBundle([a]),!0}}function q(a,b){r.interfaceDescs=(new CTATInterfaceDescriptions).parseXML(a,b)}function u(a,b,c,d){ta=b.getProperty("problem_name");r.log("load","handleSetPreferences() problem_name = "+ta);a=c.getElementChildren(c.getElementChildren(d)[1]);for(b=
0;b<a.length;b++)if(d=c.getElementName(a[b]),r.log("load","SetPreferences eltName "+d),d)switch(d.toLowerCase()){case "source_id":ua=c.getNodeTextValue(a[b]);break;case "tutoring_service_communication":V=c.getNodeTextValue(a[b]);break;case "question_file":M=CTATConfiguration.get("graph_for_results")||c.getNodeTextValue(a[b]);break;case "skills":r.log("skills","handleSetPreferences parseSkills(",a[b],")");d=new CTATSkills(CTATSkills.parseSkills(a[b]));r.getProblemSummary().setSkills(d,c);d.setExternallyDefined(!0);
break;case "problem_state_status":X.transition(CTATMsgType.SET_PREFERENCES,c.getNodeTextValue(a[b]));ja||(ja=new ProblemStateRestorer(r));r.ctatdebug("SetPreferences problemStateRestorer "+ja);break;case "curriculum_service_url":CTATConfiguration.set("curriculum_service_url",c.getNodeTextValue(a[b]));break;case "restore_problem_url":ja||(ja=new ProblemStateRestorer(r));r.ctatdebug("SetPreferences problemStateRestorer "+ja);CTATConfiguration.set("restoreProblemUrl",c.getNodeTextValue(a[b]));break;
case "session_id":xa=c.getNodeTextValue(a[b]);break;case "authenticity_token":ha.setAuthenticityToken(c.getNodeTextValue(a[b]));break;case "interface_descriptions":q(a[b],c)}r.log("restore","questionFile "+M+", outputStatus "+X+", problemStateRestorer "+ja);v();r.log("restore","outputStatus "+X+", problemStateRestorer "+ja);r.log("load","handleSetPreferences(): questionFile",M,"tutoringServiceCommunication",V);if(M)qa.retrieveProblemFile(M,c,r,null,null,{src:M});else if(/^(postmessage|authoringTool)$/i.test(V)){console.log("to reload upon setPreferences(postmessage)");
var e=Date.now();(new Promise(function(a,b){return r.loadGraphFromString(r.getGraph().toXML(r),function(b){r.log("load","then after setPreferences(",V,"), ms:",Date.now()-e,b);return a?a(b):b},function(a){console.log("error loading after setPreferences(postmessage)",a);return b?b(a):a},{src:M})})).then(function(a){r.log("load","then after setPreferences(",V,"): to startWorking");r.startWorking();/^authoringTool$/i.test(V)&&window.postMessage({command:"authortutorready"},location.origin)})}ja&&X.canRestore()&&
(CTAT.ToolTutor.commReadyPromise||Promise.resolve("no CTAT.ToolTutor.commReadyPromise")).then(function(a){r.log("collaborate","ET.handleSetPreferences: commReadyPromise result",a);return ja.retrieveMessages(X)})}function v(){try{if(0>J){var a="undefined"!=typeof sessionStorage&&sessionStorage?sessionStorage.getItem("Go-To-State"):null;if(null==a)return;sessionStorage.removeItem("Go-To-State");var b=Number(a);if(!Number.isSafeInteger(b)||0>=b)return;J=b}X.transition(CTATMsgType.BEGIN_GO_TO_STATE,null)}catch(ka){trace.error("Error in CTATExampleTracer.retrieveGoToState",
ka)}}function y(a,b){var c=r.getGraph().addStartStateLink(b.getSAI());r.log("startstate","ET.addStartStateLink() msgType, SAI, link",b.getMessageType(),b.getSAI(),c&&c.toString(),"\n",a);b.getMessageType()!=CTATMsgType.UNTUTORED_ACTION&&(r.messageTank=new CTATMessageTank(r,null),b=new CTATExampleTracerEvent("",b.getSAI(),CTATMsgType.UNGRADED_TOOL_ACTOR),b.addPreloadedLinkMatch(c),b.setAddedStepID(c.getUniqueID()),N.evaluate(b),a=b.toAssociatedRules(),r.log("startstate","ET.addStartStateLink() to addToMessageTank",
a),r.messageTank.addToMessageTank(CTATMsgType.ASSOCIATED_RULES,a,b,b.getTutorSAI()),r.messageTank.flushMessageTank(null,!0));return!0}function w(a,b,c,d){r.ctatdebug("Interface action received.");d=b.getTransactionID();if(!g())return!1;if(CTATShellTools.getReservedSelection(b))return!0;if(r.getInitialValuesDemonstrateMode())return a=y(a,b),r.log("startstate","handleInterfaceAction() in ivDemoMode",a),!0;r.log("trace","handleInterfaceAction",a);var e=b.getSAI(),f=b.getSelectionArray().slice(0);c=b.getActionArray().slice(0);
var h=b.getProperty("actor")||"student";if(f[0]&&"_tutor"==f[0].toLowerCase())return r.log("trace","handleInterfaceAction tutor cmd SAI",e&&e.toString()),c[0]&&"function"===typeof r[c[0]]&&(a=b.getSAI().getInput(),r[c[0]](a)),!0;if(r.messageTankForGroupTransaction(e))return!0;if(!f[0]||"hint"!=f[0].toLowerCase()&&"help"!=f[0].toLowerCase())return r.ctatdebug("calling doNewTrace("+r.getTutorType()+", "+b.getSAI()+") sai.selectionArray "+b.getSAI().getSelectionArray()+" msg.selectionArray "+b.getSelectionArray()),
x(r.getTutorType(),[null,b.getSAI(),h,!0,d,a]);r.ctatdebug("handleInterfaceAction() hint request: hintPolicy "+r.getHintPolicy()+", errorSAI "+T);r.getHintPolicy()===CTATHintPolicyEnum.HINTS_UNBIASED?(1<f.length&&(f[1]=""),1<c.length&&(c[1]="")):r.getHintPolicy()!==CTATHintPolicyEnum.HINTS_BIASED_BY_CURRENT_SELECTION_ONLY&&(r.getHintPolicy()===CTATHintPolicyEnum.HINTS_BIASED_BY_PRIOR_ERROR_ONLY?T&&T.getSelection()?(f.splice(1,0,T.getSelection()),c.splice(1,0,"PreviousFocus")):(f[1]="",c[1]=""):r.getHintPolicy()===
CTATHintPolicyEnum.HINTS_BIASED_BY_ALL&&T&&T.getSelection()&&(f.splice(1,0,T.getSelection()),c[1]=CTATMsgType.PREVIOUS_FOCUS.toString()));r.startSkillTransaction();return D(f,c,h,!0,d,a)}function A(a,b,c){var d={tutorAdvice:null,msg:null,msgType:null};d.tutorAdvice=a.getSuccessOrBuggyMsg();d.tutorAdvice&&d.tutorAdvice.length&&d.tutorAdvice[0]?(d.msg=c.createBuggyMessage(a.getTransactionID(),d.tutorAdvice),d.msgType="BuggyMessage"):d.tutorAdvice=null;if(a.isBuggyResult())return d;r.ctatdebug("CTATET.createBuggyMessage() past getReportableLink()");
if(a.isDoneStepFailed())return d.tutorAdvice=CTATMsgType.NOT_DONE_MSG,d.msg=c.createBuggyMessage(a.getTransactionID(),d.tutorAdvice),d.msgType="BuggyMessage",d;r.ctatdebug("CTATET.createBuggyMessage() past isDoneStepFailed()");var e=b&&b.getTutorSAI()?b.getTutorSAI().getSelection():null,e=e&&""!==e.trim()?e:null,f=a.getStudentSAI()?a.getStudentSAI().getSelection():null,f=f&&""!==f.trim()?f:null;r.ctatdebug("CTATET.createBuggyMessage() past hintSelection0 "+e+", studentSelection0 "+f);if(a.getResult()==
CTATExampleTracerLink.NO_MODEL&&a.isOutOfOrder()&&e&&e!=f)return r.ctatdebug("CTATET.createBuggyMessage() to create out of order"),r.isHighlightRightSelection()?(d.tutorAdvice=r.getOutOfOrderMessage(),d.msg=c.createHighlightWidgetMessage(e,b.getTutorSAI().getAction(),d.tutorAdvice,a.getTransactionID()),d.msgType="HighlightMsg",r.ctatdebug("createBuggyMessage() out of order with highlight; rtn: "+d)):(d.tutorAdvice=CTATGlobals.languageManager.getString("OUTOFORDER"),d.msg=c.createBuggyMessage(a.getTransactionID,
d.tutorAdvice),d.msgType="BuggyMessage",r.ctatdebug("createBuggyMessage() out of order without highlight; rtn: "+d)),d;if(b=("rule"===r.getTutorType()?Q:S).getDefaultBuggyMsg())return d.tutorAdvice=b,d.msg=c.createBuggyMessage(a.getTransactionID,d.tutorAdvice),d.msgType="BuggyMessage",r.ctatdebug("createBuggyMessage() default buggy msg: "+d),d;r.ctatdebug("createBuggyMessage() no buggy msg: "+d);return d}function z(a,b,c,d){r.ctatdebug("checkForTutorAction("+a+", "+b+", "+c+", "+d+")");var e=[];e[0]=
C(S.getNode(a),!0);e[1]=C(S.getNode(b),!1);r.ctatdebug("checkForTutorAction() links[0] "+e[0]+", links[1] "+e[1]+";");a=0;e[0]===e[1]?e[1]=null:e[0]||(a=1);b=null;r.messageTank||(r.messageTank=new CTATMessageTank(r,null));for(;a<e.length&&e[a];++a)if(b=CTATGuid.guid(),c){var f=e[a].getEvaluatedInput(c,d.getReportableVariableTable()),g=e[a].getDefaultSAI().clone();g.setInput(f);b=x("example",[e[a],g,e[a].getActor(),!0,b])}else b=x("example",[e[a],e[a].getDefaultSAI(),e[a].getActor(),!0,b]);r.ctatdebug("checkForTutorAction() returning "+
b+";");return b}function C(a,b){if(null===a||"undefined"===typeof a||1!==a.getCorrectOutDegree())return null;var c=null;a.getCorrectOutLinks().forEach(function(a){null===c&&a.isTutorPerformed(b)&&0<a.getMaxTraversals()&&(c=a)});return c}function D(a,b,c,d,e,f){r.ctatdebug("ExampleTracer.doHint, givenSelection = "+a);var g=null,h=null;if(d&&b&&1<b.length&&b[1].toString()===CTATMsgType.PREVIOUS_FOCUS.toString()&&a&&1<a.length&&a[1]&&"null"!==a[1].toString()&&(g=a[1]!==a[0]?[a[1]]:null,2<b.length))for(r.ctatdebug("CTATExampleTracer --\x3e in doHint inner if condition"),
h=[],a=2;a<b.length;a++)r.ctatdebug("CTATExampleTracer --\x3e in doHint for loop "+a),h.push(b[a]);r.ctatdebug("CTATExampleTracer --\x3e in doHint out of if condition");b=new CTATSAI(g,h,null);var l=new CTATExampleTracerEvent(r,b,c);l.setHintRequest(!0);l.setWantReportableHints(!0);f&&(l.setMsgToRestore(f),l.setSenderStepID(CTATMsgType.getProperty(f,"SenderStepID")));r.ctatdebug("CTATExampleTracerTracer --\x3e in doHint result: "+l);if("rule"===r.getTutorType())return Q&&Q.doHint(l,e,function(a){if(a){var b=
"nools hint trace error; tracer event: "+l.toString();console.log(b,a);"function"===typeof window.reportToTutorshop&&window.reportToTutorshop(b,a);throw a;}G.call(r,l,e,f)})?l:null;N.doHint(l);return G(l,e,f)}function F(a){for(var b=0;b<arguments.length;++b);for(var b={},c=0;c<arguments.length;++c){var d=arguments[c];"object"==typeof d?Object.assign(b,d):b["cf"+c]=d}return b}function G(a,b,c){var d=a.getReportableHints();if(!d||1>d.length)d=[],d.push(CTATGlobals.languageManager.getString("NO_HINT_AVAILABLE"));
var e=a.getAssociatedSkills()||[],f=a.getStepID(),g=a.getMsgToRestore();ha.appendToProblemState(g,a.getResult(),r.getOutputStatus(),CTATMsgType.getProperty(g,"saveForRestore"));r.updateSkills(CTATExampleTracerSkill.HINT,e,f,a.getActor());r.ctatdebug("Before building hint message: tutorSAI "+a.getTutorSAI()+", hints "+d+", edge # "+f);e=(new CTATTutorMessageBuilder).createHintMessage(d,a.getTutorSAI(),f,b);r.messageTank.addToMessageTank(CTATMsgType.SHOW_HINTS_MESSAGE,e,a,null);b=(new CTATTutorMessageBuilder).createAssociatedRulesMessageForHint(d,
a.getTutorSAI(),L(a.getActor()||CTATMsgType.DEFAULT_STUDENT_ACTOR),r.getSkillBarVector(!0),f,b,d.length,1,F(a.getCustomFields(),{rules:a.getAssociatedRules()}),{traceOutcome:a.getTraceOutcome(),tutorType:a.getTutorType(),senderStepID:a.getSenderStepID(),tracerInfo:a.getTracerInfo()});r.messageTank.addToMessageTank(CTATMsgType.ASSOCIATED_RULES,b,a,null);b=r.getProblemSummary(a.getReportableInterpretation());r.messageTank.flushMessageTank(b,!0);r.lastResult=a;r.ctatdebug("handleInterfaceAction() sent hint result "+
a);T=null;H(c);r.restartWorking();return a}function x(a,b){r.ctatdebug("doNewTrace ( "+a+", "+b+" )");var c=b.shift(),d=b.shift(),e=b.shift(),f=b.shift(),g=b.shift(),h=b.shift(),l=new CTATExampleTracerEvent(r,d,e),n=g;h&&l.setSenderStepID(CTATMsgType.getProperty(h,"SenderStepID"));r.startSkillTransaction();g=function(c){try{if(c)throw c;l.setTransactionID(n);var g=l.getMsgToRestore();if(g){var h=CTATMsgType.getProperty(g,"saveForRestore");if(/^student$/i.test(String(e))||h)r.scoreAsQuiz()?ha.replaceInProblemState(g,
l.getResult(),r.getOutputStatus(),l.getStudentSAI(),r.getFeedbackPolicy()==CTATMsgType.HIDE_BUT_ENFORCE,h):ha.appendToProblemState(g,l.getResult(),r.getOutputStatus(),h)}var p=P(l,d,e,f);r.ctatdebug("doNewTrace( "+a+", "+b+" ) returns "+p);H(g);r.restartWorking();return p}catch(va){throw c="nools trace error; tracer event: "+l.toString(),console.log(c,va),"function"===typeof window.reportToTutorshop&&window.reportToTutorshop(c,va),va;}};switch(a){case "example":n=K(c,l,h,n);if(l.getResult()==CTATExampleTracerLink.NO_MODEL){if(CTATConfiguration.get("graph_for_results"))return r.restartWorking(),
!0;r.getDemonstrateMode()&&(c=r.getTracer().addDemonstratedLink(l.getStudentSAI()),c.getMatcher().setActor(l.getActor()||CTATMsgType.DEFAULT_STUDENT_ACTOR),l.setAddedStepID(c.getUniqueID()),r.getTracer().replay(),n=K(c,l,h,n))}return g();case "rule":return f=!1,I(l,h,g)}return null}function H(a){if(ea){var b={stepNumber:r.restoreIndex-1};if(/<MessageType>InterfaceAction<.MessageType>/i.test(a)){a=b;var c=r.lastResult,d;if(d=c.getStudentSAI())a.selection=d.getSelection(),a.action=d.getAction(),a.input=
d.getInput();if(d=c.getTutorSAI())a.tutor_selection=d.getSelection(),a.tutor_action=d.getAction(),a.tutor_input=d.getInput();/hint/i.test(a.result=c.getResult())?a.tutor_advice=c.getReportableHints():a.tutor_advice=c.getSuccessOrBuggyMsg();a.skills=c.getAssociatedSkills()}else/<MessageType>UntutoredAction<.MessageType>/i.test(a)?(b.selection=CTATMsgType.getProperty(a,"Selection"),b.action=CTATMsgType.getProperty(a,"Action"),b.input=CTATMsgType.getProperty(a,"Input")):b=null;b&&parent.postMessage({command:"restoredStep",
data:b},location.origin)}}function K(a,b,c,d){r.ctatdebug("doNewExampleTrace (link "+a+", result "+b+", origMsgTxt "+c+", transactionID "+d);a&&b.addPreloadedLinkMatch(a);var e=N.evaluate(b);r.ctatdebug("Evaluate returned : "+e+", given link "+a+", result "+b);a?(r.log("trace","doNewExampleTrace after evaluate: result.getTutorSelection ",b.getTutorSelection(),"~Action ",b.getTutorAction(),"~Input "+b.getTutorInput(),"messageTank",r.messageTank),d=r.enqueueToolActionToStudent(b.getTutorSelection(),
b.getTutorAction(),b.getTutorInput())):b.setMsgToRestore(c);return d}function I(a,b,c){var d=null;try{r.ctatdebug("DoNewRuleTrace( "+a+", "+b+" )"),a.setMsgToRestore(b),d=Q.evaluate(a,c)}catch(la){throw console.log("doNewRuleTrace error: ",la),"function"===typeof window.reportToTutorshop&&window.reportToTutorshop("doNewRuleTrace error "+a.toString(),la),la;}return d}function L(a){return"undefined"!=typeof a&&a&&0<=a.toString().toLowerCase().indexOf("tutor")?"Tutor":"Student"}function P(a,b,c,d){r.ctatdebug("finishNewExampleTrace("+
a+", "+b+", "+c+", "+d+")");var e=a.getStudentSAI(),f=a.getTutorSAI(),g=a.getTransactionID(),h=new CTATTutorMessageBuilder,l=a.getReportableLink()||null,n=null;b=a.getAssociatedSkills()||[];var p=function(){r.lastResult=a;r.getTracer()&&"function"==typeof r.getTracer().saveLastReport&&r.getTracer().saveLastReport(a);var b=r.getProblemSummary(a.getReportableInterpretation());r.ctatdebug("finishNewExampleTrace() to flushMessageTank");r.messageTank.flushMessageTank(b,!0);r.ctatdebug("finishNewExampleTrace() sent result "+
a.getResult()+",\n studentSAI "+e+",\n tutorSAI "+a.getTutorSAI()+",\n successOrBuggyMsg "+a.getSuccessOrBuggyMsg());return a};if(a.isSolverResult())return a.getResult(),p();if(a.getResult()===CTATExampleTracerLink.CORRECT_ACTION){CTATMsgType.UNGRADED_TOOL_ACTOR.toUpperCase()!=c.toUpperCase()&&r.messageTank.addToMessageTank(CTATMsgType.CORRECT_ACTION,h.createCorrectActionMessage(g,f),a,f);r.updateSkills(CTATExampleTracerSkill.CORRECT,b,a.getStepID(),c);b=a.getSuccessOrBuggyMsg();var q=h.createAssociatedRulesMessageForAction(a.getResult(),
f,L(c),e,r.getSkillBarVector(!0,c),l?l.getUniqueID():a.getStepID(),g,b,a.isOutOfOrder(),F(a.getCustomFields(),{rules:a.getAssociatedRules()}),{traceOutcome:a.getTraceOutcome(),buggyStepID:a.getBuggyStepID(),addedStepID:a.getAddedStepID(),senderStepID:a.getSenderStepID(),tutorType:a.getTutorType(),tracerInfo:a.getTracerInfo()});r.messageTank.addToMessageTank(CTATMsgType.ASSOCIATED_RULES,q,a,f);r.ctatdebug("finishNewExampleTrace() successMsg "+b);b&&b.length&&b[0]&&r.messageTank.addToMessageTank("SuccessMessage",
h.createSuccessMessage(g,b),a,null);T=null;d&&(n=z(l?l.getNextNode():null,N.findCurrentState(!1,!1),r.lastMessage?r.lastMessage.getSAI():null,a))&&(a=n);return p()}r.messageTank.addToMessageTank(CTATMsgType.INCORRECT_ACTION,h.createInCorrectActionMessage(g,a.getInterpolatedSAI()),a,null);r.ctatdebug("about to do silent traceForHint("+e+"), selectionArray "+e.getSelectionArray());var u=r.lastSilentHintResult=new CTATExampleTracerEvent(r,e,c);u.setTutorType(r.getTutorType());u.setHintRequest(!0);b=
function(){var b=a.getAssociatedSkills()||[],q=a.getStepID()||"";r.updateSkills(CTATExampleTracerSkill.INCORRECT,b,q,c);f=a.getTutorSAI();b=A(a,u,h);r.ctatdebug("createBuggyMessage() tutorAdvice: "+b.tutorAdvice+";\n  msg "+b.msg);q=h.createAssociatedRulesMessageForAction(a.getResult(),f&&f.getSelection()?f:e,L(c),e,r.getSkillBarVector(!0,c),q,g,b.tutorAdvice,a.isOutOfOrder(),a.getCustomFields(),{traceOutcome:a.getTraceOutcome(),buggyStepID:a.getBuggyStepID(),addedStepID:a.getAddedStepID(),senderStepID:a.getSenderStepID(),
tutorType:a.getTutorType(),tracerInfo:a.getTracerInfo()});r.messageTank.addToMessageTank(CTATMsgType.ASSOCIATED_RULES,q,a,null);b.msg&&r.messageTank.addToMessageTank(b.msgType,b.msg,a);T=e;d&&CTATExampleTracerLink.FIREABLE_BUGGY_ACTION==a.getResult()?(n=z(l?l.getNextNode():null,N.findCurrentState(!1,!1),r.lastMessage?r.lastMessage.getSAI():null,a))&&(a=n):a.isDoneStepFailed()&&r.messageTank.flushDelayedFeedback();return p()};if("example"===r.getTutorType())return B(a,u),b();"rule"===r.getTutorType()&&
(a.setCustomFields(F(a.getCustomFields(),{rules:a.getAssociatedRules()})),b())}function B(a,b){var c=N.traceForHint(b);r.ctatdebug("silent hint result: "+b+"; hintLink "+c);c||(c=N.getBestNextLink(!1,b),r.ctatdebug("getBestNextLink result: "+b+"; hintLink "+c));c&&((c=b.getTutorSAI())&&c.getSelection()&&a.setTutorSAI(c),a.setStepID(b.getStepID()),a.setAssociatedSkills(b.getAssociatedSkills()),a.setReportableInterpretation(b.getReportableInterpretation()))}CTATBase.call(this,"CTATExampleTracer","tracer");
var r=this,M=null,V=null,N=null,Q,R=null,aa=null,E,S,W=new CTATXML;new XMLSerializer;var T=null,fa=CTATHintPolicyEnum.DEFAULT,Ba=!0,sa=CTATMsgType.SHOW_ALL_FEEDBACK,ga=null,ta=null,ua=null,ha=new ProblemStateSaver(r);ha.setAuthenticityToken(CTATCommLibrary.getAuthenticityToken());var ja=null,ea=1,X=new CTATProblemStateStatus,ba=[],ma=[],na=0,xa="",J=-1,pa=null;this.logger=new CTATLogger("load restore queue skills startstate trace".split(" "));this.log=r.logger.log;r.ctatdebug("CTATExampleTracer constructor outputStatus="+
X);this.interfaceDescs=this.messageTank=this.lastSilentHintResult=this.lastResult=this.lastMessage=this.lastMessageAsXML=this.lastMessageAsString=null;this.timer=-1;this.restoreInterval=0;this.restoreStep=Number.parseInt(CTATConfiguration.get("restore_step")||"-1")+1;var qa=new CTATCommLibrary(null,!Number(CTATConfiguration.get("restore_interval")));this.receiveFromInterface=function(a){r.log("queue","CTATExampleTracer.receiveFromInterface() \n  "+a);/<MessageType>SetPreferences<.MessageType>/i.test(a)?
(ea=1,ba.push(a)):ma.push(a);n()};this.setVariablesFromSAI=function(a,b){a=CTATMsgType.getSAIArraysFromElement(a,b);switch(r.getTutorType()){case "example":r.getTracer()&&r.getTracer().addInterfaceVariables(a.selection,a.action,a.input,r.interfaceDescs);break;case "rule":Q.handleUntutoredAction(a,r.interfaceDescs)}};this.traceLinks=function(a){for(var b=[],c=r.getTracer().getBestInterpretation(),d=0;d<a.length&&null!==a[d];++d)c.getTraversalCount(a[d])<a[d].getMinTraversals()&&(r.messageTank=new CTATMessageTank(r,
null),b.push(x("example",[a[d],a[d].getDefaultSAI(),a[d].getActor(),!1,null])),r.ctatdebug("traceLinks["+d+"] result "+b[d]));return b};this.enqueueForRestore=function(a){r.ctatdebug("enqueueForRestore() tracerReady "+g()+": got "+(a?a.length:-1)+" message elements");null==aa&&null!=a&&(aa=a);null!=aa&&(ba=ba.concat(aa),aa=null,a=(new CTATTutorMessageBuilder).createMessage(CTATMsgType.PROBLEM_RESTORE_END,null),ba.push(a),ea=1,g()&&r.startWorking())};this.restartWorking=function(){"rule"===r.getTutorType()&&
f(ea,!1)};this.startWorking=function(){f(ea,!1)};this.stopWorking=function(a){f("undefined"!=typeof a?a:ea,!0)};this.insertFreeze=function(a){var b=CTATConfiguration.get("freeze_restore");console.log("ET.insertFreeze(length "+a.length+") freezeAfterN",b);null!=b&&!1!==b&&"false"!==b&&(Number.isInteger(b=Number(b))||(b=1),CTATConfiguration.set("freeze_restore",!1),b<a.length&&(a[b]=CTATMsgType.setProperty(a[b],"freezeHere","default")))};this.restoreIndex=0;this.queueSetPreferences=function(){r.receiveFromInterface('<?xml version="1.0" encoding="UTF-8"?>\n<message>\n  <verb>NotePropertySet</verb>\n  <properties>\n    <MessageType>SetPreferences</MessageType>\n    <problem_name>'+
ta+"</problem_name>\n    <question_file></question_file>\n    <session_id>"+xa+"</session_id>\n    <source_id>PACT_CTAT_HTML5</source_id>\n    <problem_state_status>empty</problem_state_status>\n    <curriculum_service_url></curriculum_service_url>\n    <restore_problem_url></restore_problem_url>\n    <tutoring_service_communication>authoringTool</tutoring_service_communication>\n  </properties>\n</message>")};this.loadGraphForResults=function(){var a=CTATConfiguration.get("graph_for_results");r.log("load",
"ET.loadGraphForResults gfrName",a);return a?("CTATExampleTracerGraph.EMPTY_GRAPH"==a?Promise.resolve(CTATExampleTracerGraph.EMPTY_GRAPH):$.get(a)).then(function(b){return r.loadGraphFromString(b,null,null,{src:a})},function(b){return console.error("CTATExampleTracer.loadGraphForResults "+a,b)}):Promise.resolve(a)};this.loadProblemFile=function(a){return a?new Promise(function(b,c){qa.retrieveProblemFile(a,W,r,b,c,{src:a})}):Promise.reject(Error("no questionFile specified"))};this.goToStartState=
function(){var a=S.getStudentStartsHereNode()||S.getStartNode();a?r.goToState(a.getNodeName()):console.trace("goToStartState() did not find start node")};this.goToState=function(a){a=(a=S.findNode(a))?a.getNodeID():-1;0<a&&r.goToNode(a)};this.goToNode=function(a){S.getNode(a)&&r.receiveFromInterface("<message><verb>NotePropertySet</verb><properties><MessageType>"+CTATMsgType.GO_TO_STATE+"</MessageType><nodeID>"+a+"</nodeID></properties></message>")};this.setGoToNodeID=function(a){return S.getNode(a)?
(J=a)&&"":"no node found with ID "+a};this.loadGraphFromString=function(a,b,c,d){r.log("load","ET.loadGraphFromString options",d,a&&a.substring(0,120));try{var e=(new CTATXML).parseXML(a);return r.processXML(e,b,c,d)}catch(U){return"function"==typeof c?c(U):U}};this.processXML=function(c,d,e,f){if(null==c)return r.startWorking(),c=Error("empty or invalid XML document"),"function"==typeof e?e(c):c;r.ctatdebug("processXML (), tutorType = "+r.getTutorType());r.ctatdebug("No of children"+W.getElementChildren(c).length);
e=(new CTATGraphParser).parseGraph(c,r);S=e.gr;N=e.tracer;S.src=f&&f.src||"";N.setInterfaceDescriptions(r.interfaceDescs);f=e.ssm;b&&(f=S.convertStartStateToTPAs(e.ssm,W));e=a(f,e.sgMsg,S.getLockWidget());h();f=[];e&&f.push(e);X.canRestore()||f.push((new CTATTutorMessageBuilder).createMessage(CTATMsgType.PROBLEM_RESTORE_END,null));0<f.length&&r.sendBundle(f);N.setModelInitialized(!0);CTATConfiguration.get("graph_for_results")&&N.setMode("demonstrate");r.startWorking();return"function"==typeof d?d(c):
c};this.processNools=function(a,b,c,f){var g=new CTATTutorMessageBuilder;Q=new CTATRuleTracer("nools",r);Q.initEngine(a,function(c,f){r.log("load","nools engine compiled, startStateMsgs:",c,"stateGraphMsg:",f);var h;R=f;h=new CTATTutorMessageBuilder;var l=f.suppressStudentFeedback;if(null===l||void 0===l)l=CTATMsgType.SHOW_ALL_FEEDBACK;r.setFeedbackSuppressed(l);var n="false"!=f.highlightRightSelection,p=f.confirmDone;r.setConfirmDone("true"===p?!0:"false"===p?!1:l===CTATMsgType.HIDE_ALL_FEEDBACK);
l=l==CTATMsgType.SHOW_FEEDBACK_AS_QUIZ?!1:f.lockWidget;r.setHintPolicy(f.hintPolicy);r.setOutOfOrderMessage(f.outOfOrderMessage);h=h.createStateGraphMessage("false","false",l,r.isFeedbackSuppressed(),n,String(r.getConfirmDone()),r.getSkillBarVector(!1,!0));n=[];e(c);c.push((new CTATTutoringServiceMessageBuilder).createInterfaceConfigurationEnd());c.unshift(g.createLockWidgetMsg(f.lockWidget));c.unshift(h);d(c);n.push("<message><verb>SendNoteProperty</verb><properties><MessageType>StartStateEnd</MessageType></properties></message>");
X.canRestore()||n.push(g.createMessage(CTATMsgType.PROBLEM_RESTORE_END,null));r.sendBundle(n);r.enqueueForRestore();r.startWorking();"function"==typeof b&&b(a)},function(b){var d="nools load error; src file: "+a;console.log(d,b);"function"===typeof window.reportToTutorshop&&window.reportToTutorshop(d,b);if("function"==typeof c)return c(b)})};this.getRuleConfigObj=function(){return R};this.handleProblemSummaryRequest=function(a){r.ctatdebug("CTATExampleTracer.ProblemSummaryRequest getProblemSummary() "+
r.getProblemSummary());var b="<message><verb>NotePropertySet</verb><properties><MessageType>"+CTATMsgType.PROBLEM_SUMMARY_RESPONSE+"</MessageType>",b=b+SCORMProblemSummary.getProblemSummaryElements(a),b=b+("<ProblemSummary>"+a.toXML(!0)+"</ProblemSummary>"),b=b+("<ProblemSummaryJSON><![CDATA["+a.toJSONforTutorshop()+"]]\x3e</ProblemSummaryJSON>"),b=b+"<end_of_transaction>true</end_of_transaction></properties></message>",c=[];c.push(b);r.sendBundle(c);X.transition(CTATMsgType.PROBLEM_SUMMARY_RESPONSE,
a.getCompletionStatus());r.ctatdebug("CTATExampleTracer.handleProblemSummaryRequest() sent result '"+b+"';")};this.messageTankForGroupTransaction=function(a){this.log("trace","messageTankForGroupTransaction() sai",a&&a.toString());switch(a.getAction()){case "startGroupTransaction":return r.messageTank=new CTATMessageTank(r,{groupTransaction:a.toString()}),!0;case "endGroupTransaction":return a.setAction("startGroupTransaction"),r.messageTank&&r.messageTank.getGroupTransaction()==a.toString()?r.messageTank&&
(r.messageTank.flushMessageTank(null,!0,a.toString()),r.messageTank.setGroupTransaction("")):console.error("ET.messageTankForGroupTransaction messsageTank null or not for group",r.messageTank),!0;default:return r.messageTank&&r.messageTank.getGroupTransaction()||(r.messageTank=new CTATMessageTank(r)),!1}};this.restart=function(b){r.getTracer().resetTracer();b=a(S.getStartStateMsgs(),S.getStateGraphMsg(r),"undefined"==typeof b?S.getLockWidget():b);S.getStartNode();h();if(b&&!CTATConfiguration.get("graph_for_results")){var c=
[];c.push(b);c.push((new CTATTutorMessageBuilder).createMessage(CTATMsgType.PROBLEM_RESTORE_END,null));r.sendBundle(c)}N.setModelInitialized(!0);CTATConfiguration.get("graph_for_results")&&N.setMode("demonstrate");r.startWorking();return!0};this.setConfirmDone=function(a){Ba=a};this.getConfirmDone=function(){return Ba};this.addSkillsFromProblemFile=function(a){var b=r.getProblemSummary().getSkills()&&r.getProblemSummary().getSkills().getExternallyDefined();r.log("skills","adding skills from problem file, maybe: externallyDefined",
b,a);!b&&0<a.length&&(a=new CTATSkills(a),a.setExternallyDefined(!1),r.getProblemSummary().setSkills(a))};this.addSkill=function(a,b,c){return r.getProblemSummary().addSkill(a,b,c)};this.deleteSkill=function(a,b,c){key=b?CTATExampleTracerSkill.makeKey(a,b):a;var d=S.getLinks(),e=d.filter(function(a){return a.getSkillNames().includes(key)});r.log("skills","ET.deleteSkill() skillName",a," category",b," force",c," key",key," lnki",e);if(1>e.length)return r.getProblemSummary().removeSkill(a,b);if(c){for(;e<
d.length;++e)d[e].deleteSkillName(key);return r.getProblemSummary().removeSkill(a,b)}return null};this.getSkill=function(a,b){return r.getProblemSummary().getSkill(a,b)};this.getGraphSkills=function(){return r.getSkills()};this.getSkills=function(){var a=r.getProblemSummary().getSkills();return a?a.getAllSkills():[]};this.sendBundle=function(a){r.ctatdebug("sending bundle #msgs = "+a.length+", outputStatus "+X);for(var b=0,c=0;c<a.length;c++){r.ctatdebug("Sending message #"+c);var d=a[c];0>=c&&(d=
'<?xml version="1.0" encoding="UTF-8"?>'+d);ha.forwardToInterface(d,c>=a.length-1,X)&&++b}return 0<b};this.getHintPolicy=function(){return r.getRuleTracer()?fa:r.getGraph()&&r.getGraph().getHintPolicy()||CTATHintPolicyEnum.DEFAULT};this.setHintPolicy=function(a){r.getRuleTracer()?fa=CTATHintPolicyEnum.lookup(a):r.getGraph()&&r.getGraph().setHintPolicy(CTATHintPolicyEnum.lookup(a))};this.isHighlightRightSelection=function(){var a=null;switch(r.getTutorType()){case "example":a=r.getGraph()&&r.getGraph().isHighlightRightSelection();
break;case "rule":a="false"!=R.highlightRightSelection}return null==a?!0:a};this.updateSkills=function(a,b,c,d){var e=[];r.log("skills","in updateSkills("+b+") with step ID = "+c+", transaction result = "+a+", outputStatus "+r.getOutputStatus()+", ocountForProblemSummary "+r.getOutputStatus().countForProblemSummary()+", actor "+d);if(!r.getOutputStatus().countForProblemSummary()||d&&!/^(student)?$/i.test(d))return e;var f=r.getProblemSummary().getSkills();if(!f)return e;b.forEach(function(b){var d=
f.updateSkill(a,b,c);r.log("skills","updateSkill("+b+") returns "+(d?d.getSkillBarString(!0):null));d&&e.push(d)});return e};this.getSessionID=function(){return xa};this.getProblemSummary=function(a){r.ctatdebug("Entering getProblemSummary() problemSummary "+ga);if(null===ga||"undefined"===typeof ga){var b=r.getProblemName();if(null===b||"undefined"===typeof b||1>b.length)b="NoProblemDefined";ga=new CTATProblemSummary(b,null,r.scoreAsQuiz());ga.problemContext=CTATConfiguration.get("problem_context")}a&&
ga.setRequiredSteps(a.countStepsForScore(S));return ga};this.getProblemName=function(){return ta};this.getSourceID=function(){return ua};this.isSourceFlash=function(){return"string"==typeof ua&&ua.match(/flash/i)};this.scoreAsQuiz=function(){return r.isFeedbackSuppressed()||r.getFeedbackPolicy()==CTATMsgType.SHOW_FEEDBACK_AS_QUIZ};this.isFeedbackSuppressed=function(){switch(S?S.getFeedbackPolicy():sa){case CTATMsgType.SHOW_ALL_FEEDBACK:return!1;case CTATMsgType.SHOW_FEEDBACK_AS_QUIZ:return!1;case CTATMsgType.HIDE_ALL_FEEDBACK:return!0;
case CTATMsgType.HIDE_BUT_ENFORCE:return!0;case CTATMsgType.HIDE_BUT_COMPLETE:return!0;case CTATMsgType.DELAY_FEEDBACK:return!1;default:return!1}};this.setFeedbackSuppressed=function(a){if("false"===a||!1===a)a=CTATMsgType.SHOW_ALL_FEEDBACK;else if("true"===a||!0===a)a=CTATMsgType.HIDE_ALL_FEEDBACK;S?S.setFeedbackPolicy(a):sa=a;r.ctatdebug("setFeedbackSuppressed("+a+"): "+r.isFeedbackSuppressed());ga&&ga.setCountOnlyLastResults(r.scoreAsQuiz())};this.getSkillBarVector=function(a,b){var c=r.getProblemSummary().getSkills();
return null===c||"undefined"===typeof c?null:"Student"!=L(b)?null:"undefined"!=typeof a&&a?c.getSkillBarVector(!1,!1):c.getSkillBarVector(!0,!0)};this.startSkillTransaction=function(){var a=r.getProblemSummary().getSkills();a&&a.startTransaction()};this.getProblemStateSaver=function(){return ha};this.isSendingSavedMsgsForRestore=function(){return r.getOutputStatus().isSendingSavedMsgsForRestore()};this.getOutputStatus=function(){return X};this.setOutputStatus=function(a){var b=X.getStatus();r.ctatdebug("setOutputStatus() old "+
b+", new "+a);CTATProblemStateStatus[a]?X.setStatus(CTATProblemStateStatus[a]):(console.error("CTATExampleTracer.setOutputStatus() unexpected argument "+a),X.setStatus(CTATProblemStateStatus.empty))};this.enqueueToolActionToStudent=function(a,b,c,d){return r.messageTank.enqueueToolActionToStudent(a,b,c,d||CTATTutorMessageBuilder.TUTOR_PERFORMED,r.getTutorType())};this.traceInGraphForResults=function(a){if(!S||!CTATConfiguration.get("graph_for_results")||a.getResult()==CTATExampleTracerLink.HINT_ACTION||
a.getResult()==CTATExampleTracerLink.NO_MODEL)return null;var b=new CTATExampleTracerEvent("",a.getStudentSAI(),a.getActor()),c=N.evaluate(b);r.log("trace","ET.traceInGraphForResults isCorrect",c,b&&b.getResult(),b&&b.getTraceOutcome());(c=S.getLinkByID(Number(a.getSenderStepID())))?(b.setResult(c.getType()),b.setTraceOutcome(c.getType()),b.setStepID(c.getUniqueID()),/^correct/i.test(c.getType())||b.setBuggyStepID(c.getUniqueID()),b.setTutorSAI(c.getDefaultSAI()),b.setAddedStepID(""),b.setSenderStepID(a.getSenderStepID())):
b.getResult()==CTATExampleTracerLink.NO_MODEL&&(c=r.getTracer().addDemonstratedLink(b.getStudentSAI()),r.getTracer().replay(),c.setActionType(a.getTraceOutcome()),c.getMatcher().setActor(a.getActor()),b.addPreloadedLinkMatch(c),b.setAddedStepID(c.getUniqueID()),b.setSenderStepID(a.getSenderStepID()),N.evaluate(b));return b};this.getSAIsForReplay=function(){return N&&N.getSAIsForReplay()||[]};this.getMatchedLinks=function(){return r.getTracer().getMatchedLinks()};this.getFeedbackPolicy=function(){return S?
S.getFeedbackPolicy():sa?sa:CTATMsgType.SHOW_ALL_FEEDBACK};this.getGraph=function(){return S};this.getTracer=function(){return N};this.getRuleTracer=function(){return Q};this.getTutorType=function(){return Q&&"rule"||N&&"example"||null};this.getOutOfOrderMessage=function(){return E?E:CTATMsgType.DEFAULT_OUT_OF_ORDER_MESSAGE};this.setOutOfOrderMessage=function(a){E=a};this.getDelayedFeedback=function(){null==pa&&(pa={});return pa};this.clearDelayedFeedback=function(){pa=null};this.getDemonstrateMode=
function(){return N&&N.isDemonstrateMode()};this.setDemonstrateMode=function(a){N&&N.setMode(a?"demonstrate":"")};this.getInitialValuesDemonstrateMode=function(){return N&&N.isInitialValuesDemonstrateMode()};this.setInitialValuesDemonstrateMode=function(a,b,c,d){a&&b&&r.loadGraphFromString(r.getGraph().toXML(r),c||function(a){return console.log("reload after setInitialValuesDemonstrate",a)||a},d||function(a){return console.log("error loading after setInitialValuesDemonstrate",a)||a});N&&N.setMode(a?
"initialValuesDemonstrate":"")};this.getCurrentState=function(){return N&&N.findCurrentState()};this.getTraversedNodeIDs=function(){return N&&N.getTraversedNodeIDs()||new Set};this.getQuestionFile=function(a){if(!M||a)return M;a=M.split("/");return a[a.length-1]};this.resumeRestore=function(a){r.advanceToStep(0,a)};this.nextRestoreStep=function(a,b){r.advanceToStep(r.restoreIndex+(a||1),b)};this.advanceToStep=function(a,b){r.restoreStep=a<=r.restoreIndex?0:a;clearTimeout(r.timer);r.timer=0;Number.isInteger(b=
Number.parseInt(b))&&(r.restoreInterval=b,CTATConfiguration.set("restore_interval",""+b));n()};this.freezeRestore=function(a){a=Number(a)||2147483647;clearTimeout(r.timer);r.timer=setTimeout(function(){r.log("restore","***freezeRestore waited "+a+" ms; restoreQueue.length "+ba.length+", index "+r.restoreIndex);clearTimeout(r.timer);r.timer=0;n()},a);return r.timer};this.getRestoreQueue=function(){return ba}};CTATExampleTracer.prototype=Object.create(CTATBase.prototype);
CTATExampleTracer.prototype.constructor=CTATExampleTracer;"undefined"!==typeof module&&(module.exports=CTATExampleTracer);
